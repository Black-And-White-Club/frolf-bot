?   	github.com/Black-And-White-Club/frolf-bot/integration_tests/containers	[no test files]
2025/05/31 16:01:53 TestMain started in package leaderboardintegrationtests
=== RUN   TestProcessTagAssignments
2025/05/31 16:01:53 Starting PostgreSQL container with resource limits...
2025/05/31 16:01:54 github.com/testcontainers/testcontainers-go - Connected to docker: 
  Server Version: 28.1.1
  API Version: 1.48
  Operating System: Ubuntu 24.04.1 LTS
  Total Memory: 5923 MB
  Testcontainers for Go Version: v0.37.0
  Resolved Docker Host: unix:///Users/jace/.colima/default/docker.sock
  Resolved Docker Socket Path: /var/run/docker.sock
  Test SessionID: 9db56792615afb05e786a706eb0beac327e763183af153d41570e5011efcddd4
  Test ProcessID: ca657bbc-377f-49d6-9895-6b6d79eb9a4e
2025/05/31 16:01:54 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:01:54 🐳 Creating container for image testcontainers/ryuk:0.11.0
2025/05/31 16:01:54 ✅ Container created: 069f6d0247e2
2025/05/31 16:01:54 🐳 Starting container: 069f6d0247e2
2025/05/31 16:01:54 ✅ Container started: 069f6d0247e2
2025/05/31 16:01:54 ⏳ Waiting for container id 069f6d0247e2 image: testcontainers/ryuk:0.11.0. Waiting for: &{Port:8080/tcp timeout:<nil> PollInterval:100ms skipInternalCheck:false}
2025/05/31 16:01:55 🔔 Container is ready: 069f6d0247e2
2025/05/31 16:01:55 ✅ Container created: 577ae1f9f493
2025/05/31 16:01:55 🐳 Starting container: 577ae1f9f493
2025/05/31 16:01:56 ✅ Container started: 577ae1f9f493
2025/05/31 16:01:56 ⏳ Waiting for container id 577ae1f9f493 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000307ff0 Strategies:[0xc000311d70]}
2025/05/31 16:02:02 🔔 Container is ready: 577ae1f9f493
2025/05/31 16:02:02 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40398/testdb?sslmode=disable
2025/05/31 16:02:02 Starting NATS container with resource limits...
2025/05/31 16:02:02 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:02:03 ✅ Container created: 99135ab5f8d9
2025/05/31 16:02:03 🐳 Starting container: 99135ab5f8d9
2025/05/31 16:02:05 ✅ Container started: 99135ab5f8d9
2025/05/31 16:02:05 ⏳ Waiting for container id 99135ab5f8d9 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000171720 Strategies:[0xc0005d74a0 0xc000263c80]}
2025/05/31 16:02:08 🔔 Container is ready: 99135ab5f8d9
2025/05/31 16:02:08 NATS container started with resource limits. URL: nats://localhost:40410
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:02:08 Ran leaderboard migrations group #1
Creating user table...
User table created successfully!
2025/05/31 16:02:08 Ran user migrations group #2
Creating round table...
Round table created successfully!
2025/05/31 16:02:08 Ran round migrations group #3
Creating score table...
Score table created successfully!
2025/05/31 16:02:08 Ran score migrations group #4
2025/05/31 16:02:08 All migrations ran successfully
2025/05/31 16:02:08 newDBServiceWithDB - Registering models
2025/05/31 16:02:08 newDBServiceWithDB - Models registered successfully
2025/05/31 16:02:08 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00007e228 RoundDB:0xc00007e278 ScoreDB:0xc00007e280 LeaderboardDB:0xc00007e2f0 db:0xc0002bb540}
2025/05/31 16:02:08 Truncating tables: leaderboards
=== RUN   TestProcessTagAssignments/Successful_batch_assignment
=== RUN   TestProcessTagAssignments/Batch_assignment_with_some_invalid_tag_numbers_and_non-existent_users
=== RUN   TestProcessTagAssignments/Empty_assignments_list
=== RUN   TestProcessTagAssignments/Single_assignment_that_requires_tag_swap
2025/05/31 16:02:09 Cleaning up test environment...
2025/05/31 16:02:09 Context cancelled.
2025/05/31 16:02:09 EventBus closed.
2025/05/31 16:02:09 NATS connection closed.
2025/05/31 16:02:09 DB connection closed.
2025/05/31 16:02:09 🐳 Stopping container: 99135ab5f8d9
2025/05/31 16:02:09 ✅ Container stopped: 99135ab5f8d9
2025/05/31 16:02:09 🐳 Terminating container: 99135ab5f8d9
2025/05/31 16:02:09 🚫 Container terminated: 99135ab5f8d9
2025/05/31 16:02:09 NATS container terminated.
2025/05/31 16:02:09 🐳 Stopping container: 577ae1f9f493
2025/05/31 16:02:10 ✅ Container stopped: 577ae1f9f493
2025/05/31 16:02:10 🐳 Terminating container: 577ae1f9f493
2025/05/31 16:02:10 🚫 Container terminated: 577ae1f9f493
2025/05/31 16:02:10 PostgreSQL container terminated.
2025/05/31 16:02:10 Cleanup complete.
--- PASS: TestProcessTagAssignments (16.54s)
    --- PASS: TestProcessTagAssignments/Successful_batch_assignment (0.13s)
    --- PASS: TestProcessTagAssignments/Batch_assignment_with_some_invalid_tag_numbers_and_non-existent_users (0.10s)
    --- PASS: TestProcessTagAssignments/Empty_assignments_list (0.09s)
    --- PASS: TestProcessTagAssignments/Single_assignment_that_requires_tag_swap (0.06s)
=== RUN   TestGetLeaderboard
2025/05/31 16:02:10 Starting PostgreSQL container with resource limits...
2025/05/31 16:02:10 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:02:10 ✅ Container created: 84d9c7674876
2025/05/31 16:02:10 🐳 Starting container: 84d9c7674876
2025/05/31 16:02:11 ✅ Container started: 84d9c7674876
2025/05/31 16:02:11 ⏳ Waiting for container id 84d9c7674876 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000430390 Strategies:[0xc000480300]}
2025/05/31 16:02:17 🔔 Container is ready: 84d9c7674876
2025/05/31 16:02:17 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40429/testdb?sslmode=disable
2025/05/31 16:02:17 Starting NATS container with resource limits...
2025/05/31 16:02:17 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:02:17 ✅ Container created: 4c0f3f8e95fd
2025/05/31 16:02:17 🐳 Starting container: 4c0f3f8e95fd
2025/05/31 16:02:18 ✅ Container started: 4c0f3f8e95fd
2025/05/31 16:02:18 ⏳ Waiting for container id 4c0f3f8e95fd image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc0004e1af0 Strategies:[0xc00079b440 0xc000481590]}
2025/05/31 16:02:20 🔔 Container is ready: 4c0f3f8e95fd
2025/05/31 16:02:20 NATS container started with resource limits. URL: nats://localhost:40437
Creating score table...
Score table created successfully!
2025/05/31 16:02:20 Ran score migrations group #1
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:02:20 Ran leaderboard migrations group #2
Creating user table...
User table created successfully!
2025/05/31 16:02:20 Ran user migrations group #3
Creating round table...
Round table created successfully!
2025/05/31 16:02:20 Ran round migrations group #4
2025/05/31 16:02:20 All migrations ran successfully
2025/05/31 16:02:20 newDBServiceWithDB - Registering models
2025/05/31 16:02:20 newDBServiceWithDB - Models registered successfully
2025/05/31 16:02:20 newDBServiceWithDB - DBService initialized: &{UserDB:0xc000908108 RoundDB:0xc000908110 ScoreDB:0xc000908118 LeaderboardDB:0xc000908120 db:0xc0006232c0}
2025/05/31 16:02:20 Truncating tables: leaderboards
=== RUN   TestGetLeaderboard/Successful_retrieval_of_active_leaderboard_with_data
=== RUN   TestGetLeaderboard/Retrieval_when_no_active_leaderboard_exists
=== RUN   TestGetLeaderboard/Successful_retrieval_of_active_leaderboard_with_empty_data
2025/05/31 16:02:20 Cleaning up test environment...
2025/05/31 16:02:20 Context cancelled.
2025/05/31 16:02:20 EventBus closed.
2025/05/31 16:02:20 NATS connection closed.
2025/05/31 16:02:20 DB connection closed.
2025/05/31 16:02:20 🐳 Stopping container: 4c0f3f8e95fd
2025/05/31 16:02:21 ✅ Container stopped: 4c0f3f8e95fd
2025/05/31 16:02:21 🐳 Terminating container: 4c0f3f8e95fd
2025/05/31 16:02:21 🚫 Container terminated: 4c0f3f8e95fd
2025/05/31 16:02:21 NATS container terminated.
2025/05/31 16:02:21 🐳 Stopping container: 84d9c7674876
2025/05/31 16:02:22 ✅ Container stopped: 84d9c7674876
2025/05/31 16:02:22 🐳 Terminating container: 84d9c7674876
2025/05/31 16:02:22 🚫 Container terminated: 84d9c7674876
2025/05/31 16:02:22 PostgreSQL container terminated.
2025/05/31 16:02:22 Cleanup complete.
--- PASS: TestGetLeaderboard (12.48s)
    --- PASS: TestGetLeaderboard/Successful_retrieval_of_active_leaderboard_with_data (0.05s)
    --- PASS: TestGetLeaderboard/Retrieval_when_no_active_leaderboard_exists (0.02s)
    --- PASS: TestGetLeaderboard/Successful_retrieval_of_active_leaderboard_with_empty_data (0.02s)
=== RUN   TestRoundGetTagByUserID
2025/05/31 16:02:22 Starting PostgreSQL container with resource limits...
2025/05/31 16:02:22 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:02:23 ✅ Container created: 04c45a1f34cb
2025/05/31 16:02:23 🐳 Starting container: 04c45a1f34cb
2025/05/31 16:02:24 ✅ Container started: 04c45a1f34cb
2025/05/31 16:02:24 ⏳ Waiting for container id 04c45a1f34cb image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc0009280f0 Strategies:[0xc00067acf0]}
2025/05/31 16:02:28 🔔 Container is ready: 04c45a1f34cb
2025/05/31 16:02:28 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40449/testdb?sslmode=disable
2025/05/31 16:02:28 Starting NATS container with resource limits...
2025/05/31 16:02:28 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:02:29 ✅ Container created: b8936949bec7
2025/05/31 16:02:29 🐳 Starting container: b8936949bec7
2025/05/31 16:02:30 ✅ Container started: b8936949bec7
2025/05/31 16:02:30 ⏳ Waiting for container id b8936949bec7 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000802690 Strategies:[0xc00090a960 0xc00067a7e0]}
2025/05/31 16:02:32 🔔 Container is ready: b8936949bec7
2025/05/31 16:02:32 NATS container started with resource limits. URL: nats://localhost:40455
Creating user table...
User table created successfully!
2025/05/31 16:02:33 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/31 16:02:33 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/31 16:02:33 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:02:33 Ran leaderboard migrations group #4
2025/05/31 16:02:33 All migrations ran successfully
2025/05/31 16:02:33 newDBServiceWithDB - Registering models
2025/05/31 16:02:33 newDBServiceWithDB - Models registered successfully
2025/05/31 16:02:33 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00007e620 RoundDB:0xc00007e628 ScoreDB:0xc00007e630 LeaderboardDB:0xc00007e638 db:0xc0005c8200}
2025/05/31 16:02:33 Truncating tables: leaderboards
=== RUN   TestRoundGetTagByUserID/Successful_retrieval_of_tag_for_user_with_tag
=== RUN   TestRoundGetTagByUserID/User_exists_but_has_no_tag_number
2025/05/31 16:02:33 WARN No tag found for user in active leaderboard data user_id=user_no_tag
=== RUN   TestRoundGetTagByUserID/User_ID_not_found_in_database
2025/05/31 16:02:33 WARN No tag found for user in active leaderboard data user_id=non_existent_user
2025/05/31 16:02:33 Cleaning up test environment...
2025/05/31 16:02:33 Context cancelled.
2025/05/31 16:02:33 EventBus closed.
2025/05/31 16:02:33 NATS connection closed.
2025/05/31 16:02:33 DB connection closed.
2025/05/31 16:02:33 🐳 Stopping container: b8936949bec7
2025/05/31 16:02:34 ✅ Container stopped: b8936949bec7
2025/05/31 16:02:34 🐳 Terminating container: b8936949bec7
2025/05/31 16:02:34 🚫 Container terminated: b8936949bec7
2025/05/31 16:02:34 NATS container terminated.
2025/05/31 16:02:34 🐳 Stopping container: 04c45a1f34cb
2025/05/31 16:02:35 ✅ Container stopped: 04c45a1f34cb
2025/05/31 16:02:35 🐳 Terminating container: 04c45a1f34cb
2025/05/31 16:02:35 🚫 Container terminated: 04c45a1f34cb
2025/05/31 16:02:35 PostgreSQL container terminated.
2025/05/31 16:02:35 Cleanup complete.
--- PASS: TestRoundGetTagByUserID (13.05s)
    --- PASS: TestRoundGetTagByUserID/Successful_retrieval_of_tag_for_user_with_tag (0.03s)
    --- PASS: TestRoundGetTagByUserID/User_exists_but_has_no_tag_number (0.03s)
    --- PASS: TestRoundGetTagByUserID/User_ID_not_found_in_database (0.03s)
=== RUN   TestGetTagByUserID
2025/05/31 16:02:35 Starting PostgreSQL container with resource limits...
2025/05/31 16:02:35 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:02:36 ✅ Container created: 97243b45bd9c
2025/05/31 16:02:36 🐳 Starting container: 97243b45bd9c
2025/05/31 16:02:36 ✅ Container started: 97243b45bd9c
2025/05/31 16:02:36 ⏳ Waiting for container id 97243b45bd9c image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000170e80 Strategies:[0xc000481c50]}
2025/05/31 16:02:41 🔔 Container is ready: 97243b45bd9c
2025/05/31 16:02:41 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40467/testdb?sslmode=disable
2025/05/31 16:02:41 Starting NATS container with resource limits...
2025/05/31 16:02:41 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:02:41 ✅ Container created: 2cf9e12bc37d
2025/05/31 16:02:41 🐳 Starting container: 2cf9e12bc37d
2025/05/31 16:02:42 ✅ Container started: 2cf9e12bc37d
2025/05/31 16:02:42 ⏳ Waiting for container id 2cf9e12bc37d image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000802fa0 Strategies:[0xc00079aba0 0xc000780c90]}
2025/05/31 16:02:43 🔔 Container is ready: 2cf9e12bc37d
2025/05/31 16:02:43 NATS container started with resource limits. URL: nats://localhost:40478
Creating round table...
Round table created successfully!
2025/05/31 16:02:44 Ran round migrations group #1
Creating score table...
Score table created successfully!
2025/05/31 16:02:44 Ran score migrations group #2
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:02:44 Ran leaderboard migrations group #3
Creating user table...
User table created successfully!
2025/05/31 16:02:44 Ran user migrations group #4
2025/05/31 16:02:44 All migrations ran successfully
2025/05/31 16:02:44 newDBServiceWithDB - Registering models
2025/05/31 16:02:44 newDBServiceWithDB - Models registered successfully
2025/05/31 16:02:44 newDBServiceWithDB - DBService initialized: &{UserDB:0xc000908310 RoundDB:0xc000908318 ScoreDB:0xc000908320 LeaderboardDB:0xc000908328 db:0xc000623d40}
2025/05/31 16:02:44 Truncating tables: leaderboards
=== RUN   TestGetTagByUserID/Successful_retrieval_of_tag_for_user_with_tag
=== RUN   TestGetTagByUserID/User_exists_but_has_no_tag_number
2025/05/31 16:02:44 WARN No tag found for user in active leaderboard data user_id=user_C
=== RUN   TestGetTagByUserID/User_ID_not_found_in_database
2025/05/31 16:02:44 WARN No tag found for user in active leaderboard data user_id=non_existent_user_2
2025/05/31 16:02:44 Cleaning up test environment...
2025/05/31 16:02:44 Context cancelled.
2025/05/31 16:02:44 EventBus closed.
2025/05/31 16:02:44 NATS connection closed.
2025/05/31 16:02:44 DB connection closed.
2025/05/31 16:02:44 🐳 Stopping container: 2cf9e12bc37d
2025/05/31 16:02:44 ✅ Container stopped: 2cf9e12bc37d
2025/05/31 16:02:44 🐳 Terminating container: 2cf9e12bc37d
2025/05/31 16:02:44 🚫 Container terminated: 2cf9e12bc37d
2025/05/31 16:02:44 NATS container terminated.
2025/05/31 16:02:44 🐳 Stopping container: 97243b45bd9c
2025/05/31 16:02:45 ✅ Container stopped: 97243b45bd9c
2025/05/31 16:02:45 🐳 Terminating container: 97243b45bd9c
2025/05/31 16:02:45 🚫 Container terminated: 97243b45bd9c
2025/05/31 16:02:45 PostgreSQL container terminated.
2025/05/31 16:02:45 Cleanup complete.
--- PASS: TestGetTagByUserID (9.84s)
    --- PASS: TestGetTagByUserID/Successful_retrieval_of_tag_for_user_with_tag (0.02s)
    --- PASS: TestGetTagByUserID/User_exists_but_has_no_tag_number (0.01s)
    --- PASS: TestGetTagByUserID/User_ID_not_found_in_database (0.02s)
=== RUN   TestTagAssignmentRequested
2025/05/31 16:02:45 Starting PostgreSQL container with resource limits...
2025/05/31 16:02:45 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:02:45 ✅ Container created: 624429130ce0
2025/05/31 16:02:45 🐳 Starting container: 624429130ce0
2025/05/31 16:02:46 ✅ Container started: 624429130ce0
2025/05/31 16:02:46 ⏳ Waiting for container id 624429130ce0 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc0006100a8 Strategies:[0xc0004801e0]}
2025/05/31 16:02:51 🔔 Container is ready: 624429130ce0
2025/05/31 16:02:51 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40486/testdb?sslmode=disable
2025/05/31 16:02:51 Starting NATS container with resource limits...
2025/05/31 16:02:51 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:02:51 ✅ Container created: 5a4fe7fab49b
2025/05/31 16:02:51 🐳 Starting container: 5a4fe7fab49b
2025/05/31 16:02:52 ✅ Container started: 5a4fe7fab49b
2025/05/31 16:02:52 ⏳ Waiting for container id 5a4fe7fab49b image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000170ef0 Strategies:[0xc0005d6c00 0xc0005355c0]}
2025/05/31 16:02:53 🔔 Container is ready: 5a4fe7fab49b
2025/05/31 16:02:53 NATS container started with resource limits. URL: nats://localhost:40492
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:02:53 Ran leaderboard migrations group #1
Creating user table...
User table created successfully!
2025/05/31 16:02:53 Ran user migrations group #2
Creating round table...
Round table created successfully!
2025/05/31 16:02:53 Ran round migrations group #3
Creating score table...
Score table created successfully!
2025/05/31 16:02:53 Ran score migrations group #4
2025/05/31 16:02:53 All migrations ran successfully
2025/05/31 16:02:53 newDBServiceWithDB - Registering models
2025/05/31 16:02:53 newDBServiceWithDB - Models registered successfully
2025/05/31 16:02:53 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00007e6d8 RoundDB:0xc00007e6e0 ScoreDB:0xc00007e6e8 LeaderboardDB:0xc00007e6f0 db:0xc0005c9ec0}
2025/05/31 16:02:53 Truncating tables: leaderboards
=== RUN   TestTagAssignmentRequested/Successful_tag_assignment_to_a_new_user
=== RUN   TestTagAssignmentRequested/Tag_assignment_fails_if_tag_is_already_assigned
=== RUN   TestTagAssignmentRequested/Tag_assignment_fails_if_no_active_leaderboard_exists
=== RUN   TestTagAssignmentRequested/Tag_assignment_fails_for_invalid_tag_number_(e.g.,_negative)
2025/05/31 16:02:53 Cleaning up test environment...
2025/05/31 16:02:53 Context cancelled.
2025/05/31 16:02:53 EventBus closed.
2025/05/31 16:02:53 NATS connection closed.
2025/05/31 16:02:53 DB connection closed.
2025/05/31 16:02:53 🐳 Stopping container: 5a4fe7fab49b
2025/05/31 16:02:54 ✅ Container stopped: 5a4fe7fab49b
2025/05/31 16:02:54 🐳 Terminating container: 5a4fe7fab49b
2025/05/31 16:02:54 🚫 Container terminated: 5a4fe7fab49b
2025/05/31 16:02:54 NATS container terminated.
2025/05/31 16:02:54 🐳 Stopping container: 624429130ce0
2025/05/31 16:02:54 ✅ Container stopped: 624429130ce0
2025/05/31 16:02:54 🐳 Terminating container: 624429130ce0
2025/05/31 16:02:54 🚫 Container terminated: 624429130ce0
2025/05/31 16:02:54 PostgreSQL container terminated.
2025/05/31 16:02:54 Cleanup complete.
--- PASS: TestTagAssignmentRequested (9.15s)
    --- PASS: TestTagAssignmentRequested/Successful_tag_assignment_to_a_new_user (0.09s)
    --- PASS: TestTagAssignmentRequested/Tag_assignment_fails_if_tag_is_already_assigned (0.04s)
    --- PASS: TestTagAssignmentRequested/Tag_assignment_fails_if_no_active_leaderboard_exists (0.01s)
    --- PASS: TestTagAssignmentRequested/Tag_assignment_fails_for_invalid_tag_number_(e.g.,_negative) (0.02s)
=== RUN   TestCheckTagAvailability
2025/05/31 16:02:54 Starting PostgreSQL container with resource limits...
2025/05/31 16:02:54 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:02:54 ✅ Container created: cd9941bcc40d
2025/05/31 16:02:55 🐳 Starting container: cd9941bcc40d
2025/05/31 16:02:55 ✅ Container started: cd9941bcc40d
2025/05/31 16:02:55 ⏳ Waiting for container id cd9941bcc40d image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000928210 Strategies:[0xc000514990]}
2025/05/31 16:03:00 🔔 Container is ready: cd9941bcc40d
2025/05/31 16:03:00 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40504/testdb?sslmode=disable
2025/05/31 16:03:00 Starting NATS container with resource limits...
2025/05/31 16:03:00 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:03:00 ✅ Container created: ce7dc2246220
2025/05/31 16:03:00 🐳 Starting container: ce7dc2246220
2025/05/31 16:03:01 ✅ Container started: ce7dc2246220
2025/05/31 16:03:01 ⏳ Waiting for container id ce7dc2246220 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000928aa0 Strategies:[0xc000590780 0xc000341c20]}
2025/05/31 16:03:02 🔔 Container is ready: ce7dc2246220
2025/05/31 16:03:02 NATS container started with resource limits. URL: nats://localhost:40508
Creating score table...
Score table created successfully!
2025/05/31 16:03:02 Ran score migrations group #1
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:03:02 Ran leaderboard migrations group #2
Creating user table...
User table created successfully!
2025/05/31 16:03:02 Ran user migrations group #3
Creating round table...
Round table created successfully!
2025/05/31 16:03:02 Ran round migrations group #4
2025/05/31 16:03:02 All migrations ran successfully
2025/05/31 16:03:02 newDBServiceWithDB - Registering models
2025/05/31 16:03:02 newDBServiceWithDB - Models registered successfully
2025/05/31 16:03:02 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00007e2f8 RoundDB:0xc00007e310 ScoreDB:0xc00007e328 LeaderboardDB:0xc00007e330 db:0xc0004f3e00}
2025/05/31 16:03:02 Truncating tables: leaderboards
=== RUN   TestCheckTagAvailability/Tag_is_available_when_no_active_leaderboard_exists
=== RUN   TestCheckTagAvailability/Tag_is_available_when_active_leaderboard_exists_but_tag_is_not_assigned
=== RUN   TestCheckTagAvailability/Tag_is_not_available_when_active_leaderboard_exists_and_tag_is_assigned
    tag_availability_test.go:203: Debug: Created leaderboard ID 3 with 2 entries, IsActive=true
    tag_availability_test.go:206: Debug: Entry 0: UserID=tag_unavail_user_x, TagNumber=50
    tag_availability_test.go:206: Debug: Entry 1: UserID=tag_unavail_user_y, TagNumber=60
=== RUN   TestCheckTagAvailability/Tag_availability_check_succeeds_for_invalid_tag_number_(e.g.,_negative)
2025/05/31 16:03:03 Cleaning up test environment...
2025/05/31 16:03:03 Context cancelled.
2025/05/31 16:03:03 EventBus closed.
2025/05/31 16:03:03 NATS connection closed.
2025/05/31 16:03:03 DB connection closed.
2025/05/31 16:03:03 🐳 Stopping container: ce7dc2246220
2025/05/31 16:03:03 ✅ Container stopped: ce7dc2246220
2025/05/31 16:03:03 🐳 Terminating container: ce7dc2246220
2025/05/31 16:03:03 🚫 Container terminated: ce7dc2246220
2025/05/31 16:03:03 NATS container terminated.
2025/05/31 16:03:03 🐳 Stopping container: cd9941bcc40d
2025/05/31 16:03:04 ✅ Container stopped: cd9941bcc40d
2025/05/31 16:03:04 🐳 Terminating container: cd9941bcc40d
2025/05/31 16:03:04 🚫 Container terminated: cd9941bcc40d
2025/05/31 16:03:04 PostgreSQL container terminated.
2025/05/31 16:03:04 Cleanup complete.
--- PASS: TestCheckTagAvailability (9.61s)
    --- PASS: TestCheckTagAvailability/Tag_is_available_when_no_active_leaderboard_exists (0.02s)
    --- PASS: TestCheckTagAvailability/Tag_is_available_when_active_leaderboard_exists_but_tag_is_not_assigned (0.04s)
    --- PASS: TestCheckTagAvailability/Tag_is_not_available_when_active_leaderboard_exists_and_tag_is_assigned (0.04s)
    --- PASS: TestCheckTagAvailability/Tag_availability_check_succeeds_for_invalid_tag_number_(e.g.,_negative) (0.02s)
=== RUN   TestTagSwapRequested
2025/05/31 16:03:04 Starting PostgreSQL container with resource limits...
2025/05/31 16:03:04 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:03:04 ✅ Container created: 0620ac7b83a0
2025/05/31 16:03:05 🐳 Starting container: 0620ac7b83a0
2025/05/31 16:03:05 ✅ Container started: 0620ac7b83a0
2025/05/31 16:03:05 ⏳ Waiting for container id 0620ac7b83a0 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc0007b06b0 Strategies:[0xc000153d10]}
2025/05/31 16:03:08 🔔 Container is ready: 0620ac7b83a0
2025/05/31 16:03:08 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40518/testdb?sslmode=disable
2025/05/31 16:03:08 Starting NATS container with resource limits...
2025/05/31 16:03:08 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:03:09 ✅ Container created: 14d8ffcdbff3
2025/05/31 16:03:09 🐳 Starting container: 14d8ffcdbff3
2025/05/31 16:03:09 ✅ Container started: 14d8ffcdbff3
2025/05/31 16:03:09 ⏳ Waiting for container id 14d8ffcdbff3 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000611cc8 Strategies:[0xc00090ac00 0xc0007088a0]}
2025/05/31 16:03:11 🔔 Container is ready: 14d8ffcdbff3
2025/05/31 16:03:11 NATS container started with resource limits. URL: nats://localhost:40525
Creating score table...
Score table created successfully!
2025/05/31 16:03:11 Ran score migrations group #1
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:03:11 Ran leaderboard migrations group #2
Creating user table...
User table created successfully!
2025/05/31 16:03:11 Ran user migrations group #3
Creating round table...
Round table created successfully!
2025/05/31 16:03:11 Ran round migrations group #4
2025/05/31 16:03:11 All migrations ran successfully
2025/05/31 16:03:11 newDBServiceWithDB - Registering models
2025/05/31 16:03:11 newDBServiceWithDB - Models registered successfully
2025/05/31 16:03:11 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00007e540 RoundDB:0xc00007e548 ScoreDB:0xc00007e550 LeaderboardDB:0xc00007e558 db:0xc000701480}
2025/05/31 16:03:12 Truncating tables: leaderboards
=== RUN   TestTagSwapRequested/Successful_tag_swap_between_two_users
2025/05/31 16:03:12 Truncating tables: leaderboards
=== RUN   TestTagSwapRequested/Tag_swap_fails_if_requestor_does_not_have_a_tag
2025/05/31 16:03:12 Truncating tables: leaderboards
=== RUN   TestTagSwapRequested/Tag_swap_fails_if_target_does_not_have_a_tag
2025/05/31 16:03:12 Truncating tables: leaderboards
=== RUN   TestTagSwapRequested/Tag_swap_fails_if_neither_user_has_a_tag
2025/05/31 16:03:12 Truncating tables: leaderboards
=== RUN   TestTagSwapRequested/Tag_swap_fails_if_no_active_leaderboard_exists
2025/05/31 16:03:12 Truncating tables: leaderboards
2025/05/31 16:03:12 Cleaning up test environment...
2025/05/31 16:03:12 Context cancelled.
2025/05/31 16:03:12 EventBus closed.
2025/05/31 16:03:12 NATS connection closed.
2025/05/31 16:03:12 DB connection closed.
2025/05/31 16:03:12 🐳 Stopping container: 14d8ffcdbff3
2025/05/31 16:03:13 ✅ Container stopped: 14d8ffcdbff3
2025/05/31 16:03:13 🐳 Terminating container: 14d8ffcdbff3
2025/05/31 16:03:13 🚫 Container terminated: 14d8ffcdbff3
2025/05/31 16:03:13 NATS container terminated.
2025/05/31 16:03:13 🐳 Stopping container: 0620ac7b83a0
2025/05/31 16:03:13 ✅ Container stopped: 0620ac7b83a0
2025/05/31 16:03:13 🐳 Terminating container: 0620ac7b83a0
2025/05/31 16:03:14 🚫 Container terminated: 0620ac7b83a0
2025/05/31 16:03:14 PostgreSQL container terminated.
2025/05/31 16:03:14 Cleanup complete.
--- PASS: TestTagSwapRequested (9.70s)
    --- PASS: TestTagSwapRequested/Successful_tag_swap_between_two_users (0.06s)
    --- PASS: TestTagSwapRequested/Tag_swap_fails_if_requestor_does_not_have_a_tag (0.03s)
    --- PASS: TestTagSwapRequested/Tag_swap_fails_if_target_does_not_have_a_tag (0.03s)
    --- PASS: TestTagSwapRequested/Tag_swap_fails_if_neither_user_has_a_tag (0.02s)
    --- PASS: TestTagSwapRequested/Tag_swap_fails_if_no_active_leaderboard_exists (0.02s)
PASS
coverage: 40.0% of statements in ./app/...
2025/05/31 16:03:14 TestMain: finished with exit code: 0
ok  	github.com/Black-And-White-Club/frolf-bot/integration_tests/modules/leaderboard/application_tests	81.959s	coverage: 40.0% of statements in ./app/...
2025/05/31 16:01:57 TestMain started in package leaderboardhandler_integration_tests
=== RUN   TestHandleBatchTagAssignmentRequested
=== RUN   TestHandleBatchTagAssignmentRequested/Success_-_Process_Valid_Batch_Assignments
2025/05/31 16:01:57 Starting PostgreSQL container with resource limits...
2025/05/31 16:01:57 github.com/testcontainers/testcontainers-go - Connected to docker: 
  Server Version: 28.1.1
  API Version: 1.48
  Operating System: Ubuntu 24.04.1 LTS
  Total Memory: 5923 MB
  Testcontainers for Go Version: v0.37.0
  Resolved Docker Host: unix:///Users/jace/.colima/default/docker.sock
  Resolved Docker Socket Path: /var/run/docker.sock
  Test SessionID: 9db56792615afb05e786a706eb0beac327e763183af153d41570e5011efcddd4
  Test ProcessID: 3a05f236-7a38-4db2-ad0f-545d90a7fb3f
2025/05/31 16:01:57 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:01:57 ⏳ Waiting for Reaper "069f6d02" to be ready
2025/05/31 16:01:57 🔥 Reaper obtained from Docker for this test session 069f6d02
2025/05/31 16:01:57 ✅ Container created: a190baa65e2c
2025/05/31 16:01:57 🐳 Starting container: a190baa65e2c
2025/05/31 16:01:58 ✅ Container started: a190baa65e2c
2025/05/31 16:01:58 ⏳ Waiting for container id a190baa65e2c image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc0000122f0 Strategies:[0xc000594ea0]}
2025/05/31 16:02:05 🔔 Container is ready: a190baa65e2c
2025/05/31 16:02:05 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40400/testdb?sslmode=disable
2025/05/31 16:02:05 Starting NATS container with resource limits...
2025/05/31 16:02:05 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:02:05 ✅ Container created: 27f858409c2f
2025/05/31 16:02:05 🐳 Starting container: 27f858409c2f
2025/05/31 16:02:07 ✅ Container started: 27f858409c2f
2025/05/31 16:02:07 ⏳ Waiting for container id 27f858409c2f image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc00066dc70 Strategies:[0xc000683ce0 0xc00017b920]}
2025/05/31 16:02:08 🔔 Container is ready: 27f858409c2f
2025/05/31 16:02:08 NATS container started with resource limits. URL: nats://localhost:40416
Creating user table...
User table created successfully!
2025/05/31 16:02:08 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/31 16:02:08 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/31 16:02:08 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:02:08 Ran leaderboard migrations group #4
2025/05/31 16:02:08 All migrations ran successfully
2025/05/31 16:02:08 newDBServiceWithDB - Registering models
2025/05/31 16:02:08 newDBServiceWithDB - Models registered successfully
2025/05/31 16:02:08 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00014c690 RoundDB:0xc00014c698 ScoreDB:0xc00014c6a0 LeaderboardDB:0xc00014c6a8 db:0xc00033bb80}
2025/05/31 16:02:09 Truncating tables: leaderboards
    batch_tag_assign_test.go:373: Waiting for 1 messages on topic "discord.leaderboard.batch.tag.assigned" with timeout 5s
2025/05/31 16:02:10 Test received message 1021f631-49c6-48c7-8304-e40a60b4f132 on topic "discord.leaderboard.batch.tag.assigned"
    batch_tag_assign_test.go:373: Successfully received 1 messages on topic "discord.leaderboard.batch.tag.assigned"
    batch_tag_assign_test.go:161: Actual leaderboard data: map[120450641:20 156368732:2 201892185:10 344404888:1]
2025/05/31 16:02:10 Test Case "TestHandleBatchTagAssignmentRequested/Success_-_Process_Valid_Batch_Assignments": Canceling subscription context.
2025/05/31 16:02:10 Test Case "TestHandleBatchTagAssignmentRequested/Success_-_Process_Valid_Batch_Assignments": Waiting for subscriber goroutines to finish.
2025/05/31 16:02:10 Test Case "TestHandleBatchTagAssignmentRequested/Success_-_Process_Valid_Batch_Assignments": Subscriber goroutines finished.
2025/05/31 16:02:10 Running leaderboard handler test cleanup...
2025/05/31 16:02:11 Error closing Leaderboard module: error closing LeaderboardRouter: router close timeout
2025/05/31 16:02:11 Router goroutine finished.
2025/05/31 16:02:11 Leaderboard handler test cleanup finished.
2025/05/31 16:02:11 Cleaning up test environment...
2025/05/31 16:02:11 Context cancelled.
2025/05/31 16:02:11 EventBus closed.
2025/05/31 16:02:11 NATS connection closed.
2025/05/31 16:02:11 DB connection closed.
2025/05/31 16:02:11 🐳 Stopping container: 27f858409c2f
2025/05/31 16:02:12 ✅ Container stopped: 27f858409c2f
2025/05/31 16:02:12 🐳 Terminating container: 27f858409c2f
2025/05/31 16:02:12 🚫 Container terminated: 27f858409c2f
2025/05/31 16:02:12 NATS container terminated.
2025/05/31 16:02:12 🐳 Stopping container: a190baa65e2c
2025/05/31 16:02:13 ✅ Container stopped: a190baa65e2c
2025/05/31 16:02:13 🐳 Terminating container: a190baa65e2c
2025/05/31 16:02:13 🚫 Container terminated: a190baa65e2c
2025/05/31 16:02:13 PostgreSQL container terminated.
2025/05/31 16:02:13 Cleanup complete.
=== RUN   TestHandleBatchTagAssignmentRequested/Success_-_Batch_Assignment_with_Already_Assigned_Tag_
2025/05/31 16:02:13 Starting PostgreSQL container with resource limits...
2025/05/31 16:02:13 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:02:13 ✅ Container created: c809c12ee056
2025/05/31 16:02:13 🐳 Starting container: c809c12ee056
2025/05/31 16:02:14 ✅ Container started: c809c12ee056
2025/05/31 16:02:14 ⏳ Waiting for container id c809c12ee056 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc0001674d0 Strategies:[0xc00017b350]}
2025/05/31 16:02:21 🔔 Container is ready: c809c12ee056
2025/05/31 16:02:21 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40431/testdb?sslmode=disable
2025/05/31 16:02:21 Starting NATS container with resource limits...
2025/05/31 16:02:21 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:02:21 ✅ Container created: b38418eb4adf
2025/05/31 16:02:21 🐳 Starting container: b38418eb4adf
2025/05/31 16:02:23 ✅ Container started: b38418eb4adf
2025/05/31 16:02:23 ⏳ Waiting for container id b38418eb4adf image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc00089e130 Strategies:[0xc000609260 0xc0005b7260]}
2025/05/31 16:02:26 🔔 Container is ready: b38418eb4adf
2025/05/31 16:02:26 NATS container started with resource limits. URL: nats://localhost:40443
Creating user table...
User table created successfully!
2025/05/31 16:02:26 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/31 16:02:26 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/31 16:02:26 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:02:26 Ran leaderboard migrations group #4
2025/05/31 16:02:26 All migrations ran successfully
2025/05/31 16:02:26 newDBServiceWithDB - Registering models
2025/05/31 16:02:26 newDBServiceWithDB - Models registered successfully
2025/05/31 16:02:26 newDBServiceWithDB - DBService initialized: &{UserDB:0xc0001a6598 RoundDB:0xc0001a65a0 ScoreDB:0xc0001a65a8 LeaderboardDB:0xc0001a65b8 db:0xc000983980}
2025/05/31 16:02:26 Truncating tables: leaderboards
    batch_tag_assign_test.go:373: Waiting for 1 messages on topic "discord.leaderboard.batch.tag.assigned" with timeout 5s
2025/05/31 16:02:27 Test received message 4e07a983-2482-4886-b1e2-38f7fac591de on topic "discord.leaderboard.batch.tag.assigned"
    batch_tag_assign_test.go:373: Successfully received 1 messages on topic "discord.leaderboard.batch.tag.assigned"
2025/05/31 16:02:27 Test Case "TestHandleBatchTagAssignmentRequested/Success_-_Batch_Assignment_with_Already_Assigned_Tag_": Canceling subscription context.
2025/05/31 16:02:27 Test Case "TestHandleBatchTagAssignmentRequested/Success_-_Batch_Assignment_with_Already_Assigned_Tag_": Waiting for subscriber goroutines to finish.
2025/05/31 16:02:27 Test Case "TestHandleBatchTagAssignmentRequested/Success_-_Batch_Assignment_with_Already_Assigned_Tag_": Subscriber goroutines finished.
2025/05/31 16:02:27 Running leaderboard handler test cleanup...
2025/05/31 16:02:28 Error closing Leaderboard module: error closing LeaderboardRouter: router close timeout
2025/05/31 16:02:28 Router goroutine finished.
2025/05/31 16:02:28 Leaderboard handler test cleanup finished.
2025/05/31 16:02:28 Cleaning up test environment...
2025/05/31 16:02:28 Context cancelled.
2025/05/31 16:02:28 EventBus closed.
2025/05/31 16:02:28 NATS connection closed.
2025/05/31 16:02:28 DB connection closed.
2025/05/31 16:02:28 🐳 Stopping container: b38418eb4adf
2025/05/31 16:02:29 ✅ Container stopped: b38418eb4adf
2025/05/31 16:02:29 🐳 Terminating container: b38418eb4adf
2025/05/31 16:02:29 🚫 Container terminated: b38418eb4adf
2025/05/31 16:02:29 NATS container terminated.
2025/05/31 16:02:29 🐳 Stopping container: c809c12ee056
2025/05/31 16:02:30 ✅ Container stopped: c809c12ee056
2025/05/31 16:02:30 🐳 Terminating container: c809c12ee056
2025/05/31 16:02:30 🚫 Container terminated: c809c12ee056
2025/05/31 16:02:30 PostgreSQL container terminated.
2025/05/31 16:02:30 Cleanup complete.
=== RUN   TestHandleBatchTagAssignmentRequested/Failure_-_Invalid_Message_Payload_(Unmarshal_Error)
2025/05/31 16:02:30 Starting PostgreSQL container with resource limits...
2025/05/31 16:02:30 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:02:30 ✅ Container created: 113c38a49e58
2025/05/31 16:02:30 🐳 Starting container: 113c38a49e58
2025/05/31 16:02:31 ✅ Container started: 113c38a49e58
2025/05/31 16:02:31 ⏳ Waiting for container id 113c38a49e58 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc00089e410 Strategies:[0xc0004c3230]}
2025/05/31 16:02:37 🔔 Container is ready: 113c38a49e58
2025/05/31 16:02:37 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40461/testdb?sslmode=disable
2025/05/31 16:02:37 Starting NATS container with resource limits...
2025/05/31 16:02:37 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:02:37 ✅ Container created: ebfad48e74d5
2025/05/31 16:02:37 🐳 Starting container: ebfad48e74d5
2025/05/31 16:02:38 ✅ Container started: ebfad48e74d5
2025/05/31 16:02:38 ⏳ Waiting for container id ebfad48e74d5 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc00087ca38 Strategies:[0xc0008d0840 0xc000991c80]}
2025/05/31 16:02:41 🔔 Container is ready: ebfad48e74d5
2025/05/31 16:02:41 NATS container started with resource limits. URL: nats://localhost:40468
Creating user table...
User table created successfully!
2025/05/31 16:02:41 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/31 16:02:41 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/31 16:02:41 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:02:41 Ran leaderboard migrations group #4
2025/05/31 16:02:41 All migrations ran successfully
2025/05/31 16:02:41 newDBServiceWithDB - Registering models
2025/05/31 16:02:41 newDBServiceWithDB - Models registered successfully
2025/05/31 16:02:41 newDBServiceWithDB - DBService initialized: &{UserDB:0xc000542148 RoundDB:0xc000542150 ScoreDB:0xc000542180 LeaderboardDB:0xc000542190 db:0xc000808740}
2025/05/31 16:02:41 Truncating tables: leaderboards
2025/05/31 16:02:42 Test Case "TestHandleBatchTagAssignmentRequested/Failure_-_Invalid_Message_Payload_(Unmarshal_Error)": Canceling subscription context.
2025/05/31 16:02:42 Test Case "TestHandleBatchTagAssignmentRequested/Failure_-_Invalid_Message_Payload_(Unmarshal_Error)": Waiting for subscriber goroutines to finish.
2025/05/31 16:02:42 Test Case "TestHandleBatchTagAssignmentRequested/Failure_-_Invalid_Message_Payload_(Unmarshal_Error)": Subscriber goroutines finished.
2025/05/31 16:02:42 Running leaderboard handler test cleanup...
2025/05/31 16:02:43 Error closing Leaderboard module: error closing LeaderboardRouter: router close timeout
2025/05/31 16:02:43 Router goroutine finished.
2025/05/31 16:02:43 Leaderboard handler test cleanup finished.
2025/05/31 16:02:43 Cleaning up test environment...
2025/05/31 16:02:43 Context cancelled.
2025/05/31 16:02:43 EventBus closed.
2025/05/31 16:02:43 NATS connection closed.
2025/05/31 16:02:43 DB connection closed.
2025/05/31 16:02:43 🐳 Stopping container: ebfad48e74d5
2025/05/31 16:02:44 ✅ Container stopped: ebfad48e74d5
2025/05/31 16:02:44 🐳 Terminating container: ebfad48e74d5
2025/05/31 16:02:44 🚫 Container terminated: ebfad48e74d5
2025/05/31 16:02:44 NATS container terminated.
2025/05/31 16:02:44 🐳 Stopping container: 113c38a49e58
2025/05/31 16:02:45 ✅ Container stopped: 113c38a49e58
2025/05/31 16:02:45 🐳 Terminating container: 113c38a49e58
2025/05/31 16:02:45 🚫 Container terminated: 113c38a49e58
2025/05/31 16:02:45 PostgreSQL container terminated.
2025/05/31 16:02:45 Cleanup complete.
=== RUN   TestHandleBatchTagAssignmentRequested/Failure_-_Service_Returns_Error
2025/05/31 16:02:45 Starting PostgreSQL container with resource limits...
2025/05/31 16:02:45 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:02:45 ✅ Container created: 5ee160700a2b
2025/05/31 16:02:45 🐳 Starting container: 5ee160700a2b
2025/05/31 16:02:46 ✅ Container started: 5ee160700a2b
2025/05/31 16:02:46 ⏳ Waiting for container id 5ee160700a2b image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000920498 Strategies:[0xc0002973b0]}
2025/05/31 16:02:51 🔔 Container is ready: 5ee160700a2b
2025/05/31 16:02:51 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40487/testdb?sslmode=disable
2025/05/31 16:02:51 Starting NATS container with resource limits...
2025/05/31 16:02:51 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:02:51 ✅ Container created: 0253c6234fb7
2025/05/31 16:02:51 🐳 Starting container: 0253c6234fb7
2025/05/31 16:02:52 ✅ Container started: 0253c6234fb7
2025/05/31 16:02:52 ⏳ Waiting for container id 0253c6234fb7 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc0005f4278 Strategies:[0xc000746600 0xc0007e1b90]}
2025/05/31 16:02:56 🔔 Container is ready: 0253c6234fb7
2025/05/31 16:02:56 NATS container started with resource limits. URL: nats://localhost:40498
Creating round table...
Round table created successfully!
2025/05/31 16:02:57 Ran round migrations group #1
Creating score table...
Score table created successfully!
2025/05/31 16:02:57 Ran score migrations group #2
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:02:57 Ran leaderboard migrations group #3
Creating user table...
User table created successfully!
2025/05/31 16:02:57 Ran user migrations group #4
2025/05/31 16:02:57 All migrations ran successfully
2025/05/31 16:02:57 newDBServiceWithDB - Registering models
2025/05/31 16:02:57 newDBServiceWithDB - Models registered successfully
2025/05/31 16:02:57 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00079a4b0 RoundDB:0xc00079a4b8 ScoreDB:0xc00079a4c0 LeaderboardDB:0xc00079a4c8 db:0xc000558000}
2025/05/31 16:02:57 Truncating tables: leaderboards
2025/05/31 16:02:58 Test Case "TestHandleBatchTagAssignmentRequested/Failure_-_Service_Returns_Error": Canceling subscription context.
2025/05/31 16:02:58 Test Case "TestHandleBatchTagAssignmentRequested/Failure_-_Service_Returns_Error": Waiting for subscriber goroutines to finish.
2025/05/31 16:02:58 Test Case "TestHandleBatchTagAssignmentRequested/Failure_-_Service_Returns_Error": Subscriber goroutines finished.
2025/05/31 16:02:58 Running leaderboard handler test cleanup...
2025/05/31 16:02:59 Error closing Leaderboard module: error closing LeaderboardRouter: router close timeout
2025/05/31 16:02:59 Router goroutine finished.
2025/05/31 16:02:59 Leaderboard handler test cleanup finished.
2025/05/31 16:02:59 Cleaning up test environment...
2025/05/31 16:02:59 Context cancelled.
2025/05/31 16:02:59 EventBus closed.
2025/05/31 16:02:59 NATS connection closed.
2025/05/31 16:02:59 DB connection closed.
2025/05/31 16:02:59 🐳 Stopping container: 0253c6234fb7
2025/05/31 16:03:00 ✅ Container stopped: 0253c6234fb7
2025/05/31 16:03:00 🐳 Terminating container: 0253c6234fb7
2025/05/31 16:03:00 🚫 Container terminated: 0253c6234fb7
2025/05/31 16:03:00 NATS container terminated.
2025/05/31 16:03:00 🐳 Stopping container: 5ee160700a2b
2025/05/31 16:03:00 ✅ Container stopped: 5ee160700a2b
2025/05/31 16:03:00 🐳 Terminating container: 5ee160700a2b
2025/05/31 16:03:00 🚫 Container terminated: 5ee160700a2b
2025/05/31 16:03:00 PostgreSQL container terminated.
2025/05/31 16:03:00 Cleanup complete.
--- PASS: TestHandleBatchTagAssignmentRequested (63.84s)
    --- PASS: TestHandleBatchTagAssignmentRequested/Success_-_Process_Valid_Batch_Assignments (16.36s)
    --- PASS: TestHandleBatchTagAssignmentRequested/Success_-_Batch_Assignment_with_Already_Assigned_Tag_ (17.27s)
    --- PASS: TestHandleBatchTagAssignmentRequested/Failure_-_Invalid_Message_Payload_(Unmarshal_Error) (14.85s)
    --- PASS: TestHandleBatchTagAssignmentRequested/Failure_-_Service_Returns_Error (15.37s)
=== RUN   TestHandleGetLeaderboardRequested
=== RUN   TestHandleGetLeaderboardRequested/Success_-_Get_Leaderboard_With_Data
2025/05/31 16:03:00 Starting PostgreSQL container with resource limits...
2025/05/31 16:03:01 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:03:01 ✅ Container created: d43f32e5c475
2025/05/31 16:03:01 🐳 Starting container: d43f32e5c475
2025/05/31 16:03:02 ✅ Container started: d43f32e5c475
2025/05/31 16:03:02 ⏳ Waiting for container id d43f32e5c475 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000a94a10 Strategies:[0xc0008e41e0]}
2025/05/31 16:03:06 🔔 Container is ready: d43f32e5c475
2025/05/31 16:03:06 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40511/testdb?sslmode=disable
2025/05/31 16:03:06 Starting NATS container with resource limits...
2025/05/31 16:03:06 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:03:06 ✅ Container created: 0af5ffe8bf65
2025/05/31 16:03:06 🐳 Starting container: 0af5ffe8bf65
2025/05/31 16:03:06 ✅ Container started: 0af5ffe8bf65
2025/05/31 16:03:06 ⏳ Waiting for container id 0af5ffe8bf65 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc0005f43f8 Strategies:[0xc000180f00 0xc00082c9c0]}
2025/05/31 16:03:07 🔔 Container is ready: 0af5ffe8bf65
2025/05/31 16:03:07 NATS container started with resource limits. URL: nats://localhost:40522
Creating user table...
User table created successfully!
2025/05/31 16:03:07 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/31 16:03:07 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/31 16:03:07 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:03:07 Ran leaderboard migrations group #4
2025/05/31 16:03:07 All migrations ran successfully
2025/05/31 16:03:07 newDBServiceWithDB - Registering models
2025/05/31 16:03:07 newDBServiceWithDB - Models registered successfully
2025/05/31 16:03:07 newDBServiceWithDB - DBService initialized: &{UserDB:0xc0005c0220 RoundDB:0xc0005c0230 ScoreDB:0xc0005c0238 LeaderboardDB:0xc0005c0250 db:0xc000a00700}
2025/05/31 16:03:08 Truncating tables: leaderboards
    get_leaderboard_test.go:240: Waiting for 1 messages on topic "discord.get.leaderboard.success" with timeout 5s
2025/05/31 16:03:09 Test received message 97ea7bee-5b0b-4a0f-9b3c-4271a6c2d2bb on topic "discord.get.leaderboard.success"
    get_leaderboard_test.go:240: Successfully received 1 messages on topic "discord.get.leaderboard.success"
2025/05/31 16:03:09 Test Case "TestHandleGetLeaderboardRequested/Success_-_Get_Leaderboard_With_Data": Canceling subscription context.
2025/05/31 16:03:09 Test Case "TestHandleGetLeaderboardRequested/Success_-_Get_Leaderboard_With_Data": Waiting for subscriber goroutines to finish.
2025/05/31 16:03:09 Test Case "TestHandleGetLeaderboardRequested/Success_-_Get_Leaderboard_With_Data": Subscriber goroutines finished.
2025/05/31 16:03:09 Running leaderboard handler test cleanup...
2025/05/31 16:03:10 Error closing Leaderboard module: error closing LeaderboardRouter: router close timeout
2025/05/31 16:03:10 Router goroutine finished.
2025/05/31 16:03:10 Leaderboard handler test cleanup finished.
2025/05/31 16:03:10 Cleaning up test environment...
2025/05/31 16:03:10 Context cancelled.
2025/05/31 16:03:10 EventBus closed.
2025/05/31 16:03:10 NATS connection closed.
2025/05/31 16:03:10 DB connection closed.
2025/05/31 16:03:10 🐳 Stopping container: 0af5ffe8bf65
2025/05/31 16:03:10 ✅ Container stopped: 0af5ffe8bf65
2025/05/31 16:03:10 🐳 Terminating container: 0af5ffe8bf65
2025/05/31 16:03:10 🚫 Container terminated: 0af5ffe8bf65
2025/05/31 16:03:10 NATS container terminated.
2025/05/31 16:03:10 🐳 Stopping container: d43f32e5c475
2025/05/31 16:03:11 ✅ Container stopped: d43f32e5c475
2025/05/31 16:03:11 🐳 Terminating container: d43f32e5c475
2025/05/31 16:03:11 🚫 Container terminated: d43f32e5c475
2025/05/31 16:03:11 PostgreSQL container terminated.
2025/05/31 16:03:11 Cleanup complete.
=== RUN   TestHandleGetLeaderboardRequested/Success_-_Get_Empty_Leaderboard
2025/05/31 16:03:11 Starting PostgreSQL container with resource limits...
2025/05/31 16:03:11 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:03:11 ✅ Container created: 920678b18714
2025/05/31 16:03:11 🐳 Starting container: 920678b18714
2025/05/31 16:03:12 ✅ Container started: 920678b18714
2025/05/31 16:03:12 ⏳ Waiting for container id 920678b18714 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000167640 Strategies:[0xc00029b7d0]}
2025/05/31 16:03:16 🔔 Container is ready: 920678b18714
2025/05/31 16:03:16 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40529/testdb?sslmode=disable
2025/05/31 16:03:16 Starting NATS container with resource limits...
2025/05/31 16:03:16 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:03:16 ✅ Container created: 05089195b18a
2025/05/31 16:03:16 🐳 Starting container: 05089195b18a
2025/05/31 16:03:17 ✅ Container started: 05089195b18a
2025/05/31 16:03:17 ⏳ Waiting for container id 05089195b18a image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000012eb8 Strategies:[0xc0008d1aa0 0xc0008e5650]}
2025/05/31 16:03:20 🔔 Container is ready: 05089195b18a
2025/05/31 16:03:20 NATS container started with resource limits. URL: nats://localhost:40535
Creating score table...
Score table created successfully!
2025/05/31 16:03:20 Ran score migrations group #1
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:03:20 Ran leaderboard migrations group #2
Creating user table...
User table created successfully!
2025/05/31 16:03:20 Ran user migrations group #3
Creating round table...
Round table created successfully!
2025/05/31 16:03:20 Ran round migrations group #4
2025/05/31 16:03:20 All migrations ran successfully
2025/05/31 16:03:20 newDBServiceWithDB - Registering models
2025/05/31 16:03:20 newDBServiceWithDB - Models registered successfully
2025/05/31 16:03:20 newDBServiceWithDB - DBService initialized: &{UserDB:0xc0005c02a8 RoundDB:0xc0005c02b0 ScoreDB:0xc0005c02b8 LeaderboardDB:0xc0005c02c0 db:0xc000c9efc0}
2025/05/31 16:03:20 Truncating tables: leaderboards
    get_leaderboard_test.go:240: Waiting for 1 messages on topic "discord.get.leaderboard.success" with timeout 5s
2025/05/31 16:03:21 Test received message 93fa4db6-1cb6-4742-b40c-ff355758c260 on topic "discord.get.leaderboard.success"
    get_leaderboard_test.go:240: Successfully received 1 messages on topic "discord.get.leaderboard.success"
2025/05/31 16:03:21 Test Case "TestHandleGetLeaderboardRequested/Success_-_Get_Empty_Leaderboard": Canceling subscription context.
2025/05/31 16:03:21 Test Case "TestHandleGetLeaderboardRequested/Success_-_Get_Empty_Leaderboard": Waiting for subscriber goroutines to finish.
2025/05/31 16:03:21 Test Case "TestHandleGetLeaderboardRequested/Success_-_Get_Empty_Leaderboard": Subscriber goroutines finished.
2025/05/31 16:03:21 Running leaderboard handler test cleanup...
2025/05/31 16:03:22 Error closing Leaderboard module: error closing LeaderboardRouter: router close timeout
2025/05/31 16:03:22 Router goroutine finished.
2025/05/31 16:03:22 Leaderboard handler test cleanup finished.
2025/05/31 16:03:22 Cleaning up test environment...
2025/05/31 16:03:22 Context cancelled.
2025/05/31 16:03:22 EventBus closed.
2025/05/31 16:03:22 NATS connection closed.
2025/05/31 16:03:22 DB connection closed.
2025/05/31 16:03:22 🐳 Stopping container: 05089195b18a
2025/05/31 16:03:23 ✅ Container stopped: 05089195b18a
2025/05/31 16:03:23 🐳 Terminating container: 05089195b18a
2025/05/31 16:03:23 🚫 Container terminated: 05089195b18a
2025/05/31 16:03:23 NATS container terminated.
2025/05/31 16:03:23 🐳 Stopping container: 920678b18714
2025/05/31 16:03:24 ✅ Container stopped: 920678b18714
2025/05/31 16:03:24 🐳 Terminating container: 920678b18714
2025/05/31 16:03:24 🚫 Container terminated: 920678b18714
2025/05/31 16:03:24 PostgreSQL container terminated.
2025/05/31 16:03:24 Cleanup complete.
=== RUN   TestHandleGetLeaderboardRequested/Failure_-_Invalid_Message_Payload
2025/05/31 16:03:24 Starting PostgreSQL container with resource limits...
2025/05/31 16:03:24 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:03:24 ✅ Container created: e9ff072646d2
2025/05/31 16:03:24 🐳 Starting container: e9ff072646d2
2025/05/31 16:03:25 ✅ Container started: e9ff072646d2
2025/05/31 16:03:25 ⏳ Waiting for container id e9ff072646d2 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000804920 Strategies:[0xc000296090]}
2025/05/31 16:03:29 🔔 Container is ready: e9ff072646d2
2025/05/31 16:03:29 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40550/testdb?sslmode=disable
2025/05/31 16:03:29 Starting NATS container with resource limits...
2025/05/31 16:03:29 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:03:29 ✅ Container created: 960fa9037be5
2025/05/31 16:03:29 🐳 Starting container: 960fa9037be5
2025/05/31 16:03:30 ✅ Container started: 960fa9037be5
2025/05/31 16:03:30 ⏳ Waiting for container id 960fa9037be5 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc00089e850 Strategies:[0xc0007ecde0 0xc000b00ed0]}
2025/05/31 16:03:31 🔔 Container is ready: 960fa9037be5
2025/05/31 16:03:31 NATS container started with resource limits. URL: nats://localhost:40561
Creating user table...
User table created successfully!
2025/05/31 16:03:32 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/31 16:03:32 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/31 16:03:32 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:03:32 Ran leaderboard migrations group #4
2025/05/31 16:03:32 All migrations ran successfully
2025/05/31 16:03:32 newDBServiceWithDB - Registering models
2025/05/31 16:03:32 newDBServiceWithDB - Models registered successfully
2025/05/31 16:03:32 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00014c678 RoundDB:0xc00014c688 ScoreDB:0xc00014c690 LeaderboardDB:0xc00014c698 db:0xc00033a900}
2025/05/31 16:03:32 Truncating tables: leaderboards
2025/05/31 16:03:33 Test Case "TestHandleGetLeaderboardRequested/Failure_-_Invalid_Message_Payload": Canceling subscription context.
2025/05/31 16:03:33 Test Case "TestHandleGetLeaderboardRequested/Failure_-_Invalid_Message_Payload": Waiting for subscriber goroutines to finish.
2025/05/31 16:03:33 Test Case "TestHandleGetLeaderboardRequested/Failure_-_Invalid_Message_Payload": Subscriber goroutines finished.
2025/05/31 16:03:33 Running leaderboard handler test cleanup...
2025/05/31 16:03:34 Error closing Leaderboard module: error closing LeaderboardRouter: router close timeout
2025/05/31 16:03:34 Router goroutine finished.
2025/05/31 16:03:34 Leaderboard handler test cleanup finished.
2025/05/31 16:03:34 Cleaning up test environment...
2025/05/31 16:03:34 Context cancelled.
2025/05/31 16:03:34 EventBus closed.
2025/05/31 16:03:34 NATS connection closed.
2025/05/31 16:03:34 DB connection closed.
2025/05/31 16:03:34 🐳 Stopping container: 960fa9037be5
2025/05/31 16:03:34 ✅ Container stopped: 960fa9037be5
2025/05/31 16:03:34 🐳 Terminating container: 960fa9037be5
2025/05/31 16:03:34 🚫 Container terminated: 960fa9037be5
2025/05/31 16:03:34 NATS container terminated.
2025/05/31 16:03:34 🐳 Stopping container: e9ff072646d2
2025/05/31 16:03:35 ✅ Container stopped: e9ff072646d2
2025/05/31 16:03:35 🐳 Terminating container: e9ff072646d2
2025/05/31 16:03:35 🚫 Container terminated: e9ff072646d2
2025/05/31 16:03:35 PostgreSQL container terminated.
2025/05/31 16:03:35 Cleanup complete.
=== RUN   TestHandleGetLeaderboardRequested/Failure_-_No_Active_Leaderboard
2025/05/31 16:03:35 Starting PostgreSQL container with resource limits...
2025/05/31 16:03:35 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:03:35 ✅ Container created: 6b1aa1405357
2025/05/31 16:03:35 🐳 Starting container: 6b1aa1405357
2025/05/31 16:03:36 ✅ Container started: 6b1aa1405357
2025/05/31 16:03:36 ⏳ Waiting for container id 6b1aa1405357 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc0005f4f28 Strategies:[0xc000d81770]}
2025/05/31 16:03:39 🔔 Container is ready: 6b1aa1405357
2025/05/31 16:03:39 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40565/testdb?sslmode=disable
2025/05/31 16:03:39 Starting NATS container with resource limits...
2025/05/31 16:03:39 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:03:40 ✅ Container created: 542c597a3675
2025/05/31 16:03:40 🐳 Starting container: 542c597a3675
2025/05/31 16:03:40 ✅ Container started: 542c597a3675
2025/05/31 16:03:40 ⏳ Waiting for container id 542c597a3675 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000a4b5b0 Strategies:[0xc000746240 0xc0007e1ef0]}
2025/05/31 16:03:41 🔔 Container is ready: 542c597a3675
2025/05/31 16:03:41 NATS container started with resource limits. URL: nats://localhost:40570
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:03:41 Ran leaderboard migrations group #1
Creating user table...
User table created successfully!
2025/05/31 16:03:41 Ran user migrations group #2
Creating round table...
Round table created successfully!
2025/05/31 16:03:41 Ran round migrations group #3
Creating score table...
Score table created successfully!
2025/05/31 16:03:41 Ran score migrations group #4
2025/05/31 16:03:41 All migrations ran successfully
2025/05/31 16:03:41 newDBServiceWithDB - Registering models
2025/05/31 16:03:41 newDBServiceWithDB - Models registered successfully
2025/05/31 16:03:41 newDBServiceWithDB - DBService initialized: &{UserDB:0xc0001a6718 RoundDB:0xc0001a6720 ScoreDB:0xc0001a6728 LeaderboardDB:0xc0001a6730 db:0xc000c9e280}
2025/05/31 16:03:41 Truncating tables: leaderboards
2025/05/31 16:03:42 Test Case "TestHandleGetLeaderboardRequested/Failure_-_No_Active_Leaderboard": Canceling subscription context.
2025/05/31 16:03:42 Test Case "TestHandleGetLeaderboardRequested/Failure_-_No_Active_Leaderboard": Waiting for subscriber goroutines to finish.
2025/05/31 16:03:42 Test Case "TestHandleGetLeaderboardRequested/Failure_-_No_Active_Leaderboard": Subscriber goroutines finished.
2025/05/31 16:03:42 Running leaderboard handler test cleanup...
2025/05/31 16:03:43 Error closing Leaderboard module: error closing LeaderboardRouter: router close timeout
2025/05/31 16:03:43 Router goroutine finished.
2025/05/31 16:03:43 Leaderboard handler test cleanup finished.
2025/05/31 16:03:43 Cleaning up test environment...
2025/05/31 16:03:43 Context cancelled.
2025/05/31 16:03:43 EventBus closed.
2025/05/31 16:03:43 NATS connection closed.
2025/05/31 16:03:43 DB connection closed.
2025/05/31 16:03:43 🐳 Stopping container: 542c597a3675
2025/05/31 16:03:43 ✅ Container stopped: 542c597a3675
2025/05/31 16:03:43 🐳 Terminating container: 542c597a3675
2025/05/31 16:03:43 🚫 Container terminated: 542c597a3675
2025/05/31 16:03:43 NATS container terminated.
2025/05/31 16:03:43 🐳 Stopping container: 6b1aa1405357
2025/05/31 16:03:44 ✅ Container stopped: 6b1aa1405357
2025/05/31 16:03:44 🐳 Terminating container: 6b1aa1405357
2025/05/31 16:03:44 🚫 Container terminated: 6b1aa1405357
2025/05/31 16:03:44 PostgreSQL container terminated.
2025/05/31 16:03:44 Cleanup complete.
--- PASS: TestHandleGetLeaderboardRequested (43.40s)
    --- PASS: TestHandleGetLeaderboardRequested/Success_-_Get_Leaderboard_With_Data (10.26s)
    --- PASS: TestHandleGetLeaderboardRequested/Success_-_Get_Empty_Leaderboard (13.11s)
    --- PASS: TestHandleGetLeaderboardRequested/Failure_-_Invalid_Message_Payload (11.28s)
    --- PASS: TestHandleGetLeaderboardRequested/Failure_-_No_Active_Leaderboard (8.76s)
=== RUN   TestHandleLeaderboardUpdateRequested
=== RUN   TestHandleLeaderboardUpdateRequested/Success_-_Sorted_participant_tags_apply_to_new_leaderboard
2025/05/31 16:03:44 Starting PostgreSQL container with resource limits...
2025/05/31 16:03:44 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:03:44 ✅ Container created: c846b3431f4c
2025/05/31 16:03:44 🐳 Starting container: c846b3431f4c
2025/05/31 16:03:44 ✅ Container started: c846b3431f4c
2025/05/31 16:03:44 ⏳ Waiting for container id c846b3431f4c image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000a94cd8 Strategies:[0xc000a907e0]}
2025/05/31 16:03:47 🔔 Container is ready: c846b3431f4c
2025/05/31 16:03:47 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40583/testdb?sslmode=disable
2025/05/31 16:03:47 Starting NATS container with resource limits...
2025/05/31 16:03:47 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:03:47 ✅ Container created: 7c437ec2a71b
2025/05/31 16:03:47 🐳 Starting container: 7c437ec2a71b
2025/05/31 16:03:48 ✅ Container started: 7c437ec2a71b
2025/05/31 16:03:48 ⏳ Waiting for container id 7c437ec2a71b image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000b09768 Strategies:[0xc0009cd740 0xc0005b79e0]}
2025/05/31 16:03:50 🔔 Container is ready: 7c437ec2a71b
2025/05/31 16:03:50 NATS container started with resource limits. URL: nats://localhost:40584
Creating score table...
Score table created successfully!
2025/05/31 16:03:50 Ran score migrations group #1
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:03:50 Ran leaderboard migrations group #2
Creating user table...
User table created successfully!
2025/05/31 16:03:50 Ran user migrations group #3
Creating round table...
Round table created successfully!
2025/05/31 16:03:50 Ran round migrations group #4
2025/05/31 16:03:50 All migrations ran successfully
2025/05/31 16:03:50 newDBServiceWithDB - Registering models
2025/05/31 16:03:50 newDBServiceWithDB - Models registered successfully
2025/05/31 16:03:50 newDBServiceWithDB - DBService initialized: &{UserDB:0xc0005c0420 RoundDB:0xc0005c0428 ScoreDB:0xc0005c0430 LeaderboardDB:0xc0005c0438 db:0xc000559580}
2025/05/31 16:03:50 Truncating tables: leaderboards
    leaderboard_update_test.go:72: SetupFn: Initial Leaderboard ID: 2, UpdateID: bc977b6e-66f1-4d22-bff4-4c517faead9c, IsActive: true
    leaderboard_update_test.go:74: SetupFn: Created users with IDs: [465523328, 486055421, 798676566]
    leaderboard_update_test.go:92: PublishMsgFn: Publishing message with RoundID: d69fae24-2a5f-4c94-94f8-e47c744049fc, SortedParticipantTags: [3:798676566 1:465523328 2:486055421]
    leaderboard_update_test.go:94: PublishMsgFn: Using actual user IDs: [465523328, 486055421, 798676566]
    leaderboard_update_test.go:328: Waiting for 1 messages on topic "discord.leaderboard.updated" with timeout 5s
2025/05/31 16:03:51 Test received message 00fef67f-c8c0-4d4b-a019-d8d49d789aa6 on topic "discord.leaderboard.updated"
    leaderboard_update_test.go:328: Successfully received 1 messages on topic "discord.leaderboard.updated"
    leaderboard_update_test.go:118: ValidateFn: Retrieved 2 leaderboards from DB
    leaderboard_update_test.go:121: ValidateFn: DB Leaderboard 0: ID: 2, UpdateID: bc977b6e-66f1-4d22-bff4-4c517faead9c, IsActive: false, Data: [{TagNumber:10 UserID:465523328} {TagNumber:11 UserID:486055421} {TagNumber:12 UserID:798676566}]
    leaderboard_update_test.go:121: ValidateFn: DB Leaderboard 1: ID: 3, UpdateID: d69fae24-2a5f-4c94-94f8-e47c744049fc, IsActive: true, Data: [{TagNumber:1 UserID:465523328} {TagNumber:2 UserID:486055421} {TagNumber:3 UserID:798676566}]
    leaderboard_update_test.go:157: ValidateFn: Identified Old Leaderboard ID: 2, UpdateID: bc977b6e-66f1-4d22-bff4-4c517faead9c, IsActive: false
    leaderboard_update_test.go:159: ValidateFn: Identified New Leaderboard ID: 3, UpdateID: d69fae24-2a5f-4c94-94f8-e47c744049fc, IsActive: true
    leaderboard_update_test.go:162: ValidateFn: Raw New Leaderboard Data (newLB.LeaderboardData): [{TagNumber:1 UserID:465523328} {TagNumber:2 UserID:486055421} {TagNumber:3 UserID:798676566}]
    leaderboard_update_test.go:192: ValidateFn: Expected Data Map: map[465523328:1 486055421:2 798676566:3]
    leaderboard_update_test.go:195: ValidateFn: Actual Data Map (from newLB): map[465523328:1 486055421:2 798676566:3]
2025/05/31 16:03:51 Test Case "TestHandleLeaderboardUpdateRequested/Success_-_Sorted_participant_tags_apply_to_new_leaderboard": Canceling subscription context.
2025/05/31 16:03:51 Test Case "TestHandleLeaderboardUpdateRequested/Success_-_Sorted_participant_tags_apply_to_new_leaderboard": Waiting for subscriber goroutines to finish.
2025/05/31 16:03:51 Test Case "TestHandleLeaderboardUpdateRequested/Success_-_Sorted_participant_tags_apply_to_new_leaderboard": Subscriber goroutines finished.
2025/05/31 16:03:51 Running leaderboard handler test cleanup...
2025/05/31 16:03:52 Error closing Leaderboard module: error closing LeaderboardRouter: router close timeout
2025/05/31 16:03:52 Router goroutine finished.
2025/05/31 16:03:52 Leaderboard handler test cleanup finished.
2025/05/31 16:03:52 Cleaning up test environment...
2025/05/31 16:03:52 Context cancelled.
2025/05/31 16:03:52 EventBus closed.
2025/05/31 16:03:52 NATS connection closed.
2025/05/31 16:03:52 DB connection closed.
2025/05/31 16:03:52 🐳 Stopping container: 7c437ec2a71b
2025/05/31 16:03:53 ✅ Container stopped: 7c437ec2a71b
2025/05/31 16:03:53 🐳 Terminating container: 7c437ec2a71b
2025/05/31 16:03:53 🚫 Container terminated: 7c437ec2a71b
2025/05/31 16:03:53 NATS container terminated.
2025/05/31 16:03:53 🐳 Stopping container: c846b3431f4c
2025/05/31 16:03:54 ✅ Container stopped: c846b3431f4c
2025/05/31 16:03:54 🐳 Terminating container: c846b3431f4c
2025/05/31 16:03:54 🚫 Container terminated: c846b3431f4c
2025/05/31 16:03:54 PostgreSQL container terminated.
2025/05/31 16:03:54 Cleanup complete.
=== RUN   TestHandleLeaderboardUpdateRequested/Failure_-_Invalid_JSON_Payload
2025/05/31 16:03:54 Starting PostgreSQL container with resource limits...
2025/05/31 16:03:54 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:03:54 ✅ Container created: 271a315be4bf
2025/05/31 16:03:54 🐳 Starting container: 271a315be4bf
2025/05/31 16:03:54 ✅ Container started: 271a315be4bf
2025/05/31 16:03:54 ⏳ Waiting for container id 271a315be4bf image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc00089f3f8 Strategies:[0xc000b19470]}
2025/05/31 16:03:57 🔔 Container is ready: 271a315be4bf
2025/05/31 16:03:57 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40596/testdb?sslmode=disable
2025/05/31 16:03:57 Starting NATS container with resource limits...
2025/05/31 16:03:57 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:03:58 ✅ Container created: 80d18085bcbe
2025/05/31 16:03:58 🐳 Starting container: 80d18085bcbe
2025/05/31 16:03:58 ✅ Container started: 80d18085bcbe
2025/05/31 16:03:58 ⏳ Waiting for container id 80d18085bcbe image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc0005f5778 Strategies:[0xc000a829c0 0xc000a91860]}
2025/05/31 16:04:02 🔔 Container is ready: 80d18085bcbe
2025/05/31 16:04:02 NATS container started with resource limits. URL: nats://localhost:40600
Creating user table...
User table created successfully!
2025/05/31 16:04:02 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/31 16:04:02 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/31 16:04:02 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:04:02 Ran leaderboard migrations group #4
2025/05/31 16:04:02 All migrations ran successfully
2025/05/31 16:04:02 newDBServiceWithDB - Registering models
2025/05/31 16:04:02 newDBServiceWithDB - Models registered successfully
2025/05/31 16:04:02 newDBServiceWithDB - DBService initialized: &{UserDB:0xc0001a6a18 RoundDB:0xc0001a6a20 ScoreDB:0xc0001a6a68 LeaderboardDB:0xc0001a6a70 db:0xc00005f9c0}
2025/05/31 16:04:02 Truncating tables: leaderboards
2025/05/31 16:04:03 Test Case "TestHandleLeaderboardUpdateRequested/Failure_-_Invalid_JSON_Payload": Canceling subscription context.
2025/05/31 16:04:03 Test Case "TestHandleLeaderboardUpdateRequested/Failure_-_Invalid_JSON_Payload": Waiting for subscriber goroutines to finish.
2025/05/31 16:04:03 Test Case "TestHandleLeaderboardUpdateRequested/Failure_-_Invalid_JSON_Payload": Subscriber goroutines finished.
2025/05/31 16:04:03 Running leaderboard handler test cleanup...
2025/05/31 16:04:04 Error closing Leaderboard module: error closing LeaderboardRouter: router close timeout
2025/05/31 16:04:04 Router goroutine finished.
2025/05/31 16:04:04 Leaderboard handler test cleanup finished.
2025/05/31 16:04:04 Cleaning up test environment...
2025/05/31 16:04:04 Context cancelled.
2025/05/31 16:04:04 EventBus closed.
2025/05/31 16:04:04 NATS connection closed.
2025/05/31 16:04:04 DB connection closed.
2025/05/31 16:04:04 🐳 Stopping container: 80d18085bcbe
2025/05/31 16:04:05 ✅ Container stopped: 80d18085bcbe
2025/05/31 16:04:05 🐳 Terminating container: 80d18085bcbe
2025/05/31 16:04:05 🚫 Container terminated: 80d18085bcbe
2025/05/31 16:04:05 NATS container terminated.
2025/05/31 16:04:05 🐳 Stopping container: 271a315be4bf
2025/05/31 16:04:05 ✅ Container stopped: 271a315be4bf
2025/05/31 16:04:05 🐳 Terminating container: 271a315be4bf
2025/05/31 16:04:05 🚫 Container terminated: 271a315be4bf
2025/05/31 16:04:05 PostgreSQL container terminated.
2025/05/31 16:04:05 Cleanup complete.
=== RUN   TestHandleLeaderboardUpdateRequested/Failure_-_Empty_SortedParticipantTags
2025/05/31 16:04:05 Starting PostgreSQL container with resource limits...
2025/05/31 16:04:05 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:04:06 ✅ Container created: 4b7f4db63d97
2025/05/31 16:04:06 🐳 Starting container: 4b7f4db63d97
2025/05/31 16:04:06 ✅ Container started: 4b7f4db63d97
2025/05/31 16:04:06 ⏳ Waiting for container id 4b7f4db63d97 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc00089e640 Strategies:[0xc00017b6e0]}
2025/05/31 16:04:10 🔔 Container is ready: 4b7f4db63d97
2025/05/31 16:04:10 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40611/testdb?sslmode=disable
2025/05/31 16:04:10 Starting NATS container with resource limits...
2025/05/31 16:04:10 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:04:10 ✅ Container created: 7b563802e2a8
2025/05/31 16:04:10 🐳 Starting container: 7b563802e2a8
2025/05/31 16:04:11 ✅ Container started: 7b563802e2a8
2025/05/31 16:04:11 ⏳ Waiting for container id 7b563802e2a8 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc0005f4a08 Strategies:[0xc000a829c0 0xc000ba4390]}
2025/05/31 16:04:14 🔔 Container is ready: 7b563802e2a8
2025/05/31 16:04:14 NATS container started with resource limits. URL: nats://localhost:40615
Creating user table...
User table created successfully!
2025/05/31 16:04:14 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/31 16:04:14 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/31 16:04:14 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:04:14 Ran leaderboard migrations group #4
2025/05/31 16:04:14 All migrations ran successfully
2025/05/31 16:04:14 newDBServiceWithDB - Registering models
2025/05/31 16:04:14 newDBServiceWithDB - Models registered successfully
2025/05/31 16:04:14 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00079a460 RoundDB:0xc00079a468 ScoreDB:0xc00079a470 LeaderboardDB:0xc00079a480 db:0xc000a003c0}
2025/05/31 16:04:14 Truncating tables: leaderboards
2025/05/31 16:04:15 Test Case "TestHandleLeaderboardUpdateRequested/Failure_-_Empty_SortedParticipantTags": Canceling subscription context.
2025/05/31 16:04:15 Test Case "TestHandleLeaderboardUpdateRequested/Failure_-_Empty_SortedParticipantTags": Waiting for subscriber goroutines to finish.
2025/05/31 16:04:15 Test Case "TestHandleLeaderboardUpdateRequested/Failure_-_Empty_SortedParticipantTags": Subscriber goroutines finished.
2025/05/31 16:04:15 Running leaderboard handler test cleanup...
2025/05/31 16:04:16 Error closing Leaderboard module: error closing LeaderboardRouter: router close timeout
2025/05/31 16:04:16 Router goroutine finished.
2025/05/31 16:04:16 Leaderboard handler test cleanup finished.
2025/05/31 16:04:16 Cleaning up test environment...
2025/05/31 16:04:16 Context cancelled.
2025/05/31 16:04:16 EventBus closed.
2025/05/31 16:04:16 NATS connection closed.
2025/05/31 16:04:16 DB connection closed.
2025/05/31 16:04:16 🐳 Stopping container: 7b563802e2a8
2025/05/31 16:04:17 ✅ Container stopped: 7b563802e2a8
2025/05/31 16:04:17 🐳 Terminating container: 7b563802e2a8
2025/05/31 16:04:17 🚫 Container terminated: 7b563802e2a8
2025/05/31 16:04:17 NATS container terminated.
2025/05/31 16:04:17 🐳 Stopping container: 4b7f4db63d97
2025/05/31 16:04:17 ✅ Container stopped: 4b7f4db63d97
2025/05/31 16:04:17 🐳 Terminating container: 4b7f4db63d97
2025/05/31 16:04:17 🚫 Container terminated: 4b7f4db63d97
2025/05/31 16:04:17 PostgreSQL container terminated.
2025/05/31 16:04:17 Cleanup complete.
=== RUN   TestHandleLeaderboardUpdateRequested/Failure_-_Incorrect_Tag_Format
2025/05/31 16:04:17 Starting PostgreSQL container with resource limits...
2025/05/31 16:04:17 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:04:17 ✅ Container created: 8bd1d86cac86
2025/05/31 16:04:17 🐳 Starting container: 8bd1d86cac86
2025/05/31 16:04:17 ✅ Container started: 8bd1d86cac86
2025/05/31 16:04:17 ⏳ Waiting for container id 8bd1d86cac86 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc00089fca8 Strategies:[0xc000c67740]}
2025/05/31 16:04:21 🔔 Container is ready: 8bd1d86cac86
2025/05/31 16:04:21 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40622/testdb?sslmode=disable
2025/05/31 16:04:21 Starting NATS container with resource limits...
2025/05/31 16:04:21 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:04:21 ✅ Container created: a398fcd4df85
2025/05/31 16:04:21 🐳 Starting container: a398fcd4df85
2025/05/31 16:04:21 ✅ Container started: a398fcd4df85
2025/05/31 16:04:21 ⏳ Waiting for container id a398fcd4df85 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000a24488 Strategies:[0xc000a836e0 0xc00029bbf0]}
2025/05/31 16:04:22 🔔 Container is ready: a398fcd4df85
2025/05/31 16:04:22 NATS container started with resource limits. URL: nats://localhost:40626
Creating user table...
User table created successfully!
2025/05/31 16:04:23 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/31 16:04:23 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/31 16:04:23 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:04:23 Ran leaderboard migrations group #4
2025/05/31 16:04:23 All migrations ran successfully
2025/05/31 16:04:23 newDBServiceWithDB - Registering models
2025/05/31 16:04:23 newDBServiceWithDB - Models registered successfully
2025/05/31 16:04:23 newDBServiceWithDB - DBService initialized: &{UserDB:0xc000542640 RoundDB:0xc000542648 ScoreDB:0xc000542650 LeaderboardDB:0xc000542658 db:0xc000830400}
2025/05/31 16:04:23 Truncating tables: leaderboards
2025/05/31 16:04:23 Test Case "TestHandleLeaderboardUpdateRequested/Failure_-_Incorrect_Tag_Format": Canceling subscription context.
2025/05/31 16:04:23 Test Case "TestHandleLeaderboardUpdateRequested/Failure_-_Incorrect_Tag_Format": Waiting for subscriber goroutines to finish.
2025/05/31 16:04:23 Test Case "TestHandleLeaderboardUpdateRequested/Failure_-_Incorrect_Tag_Format": Subscriber goroutines finished.
2025/05/31 16:04:23 Running leaderboard handler test cleanup...
2025/05/31 16:04:24 Error closing Leaderboard module: error closing LeaderboardRouter: router close timeout
2025/05/31 16:04:24 Router goroutine finished.
2025/05/31 16:04:24 Leaderboard handler test cleanup finished.
2025/05/31 16:04:24 Cleaning up test environment...
2025/05/31 16:04:24 Context cancelled.
2025/05/31 16:04:24 EventBus closed.
2025/05/31 16:04:24 NATS connection closed.
2025/05/31 16:04:24 DB connection closed.
2025/05/31 16:04:24 🐳 Stopping container: a398fcd4df85
2025/05/31 16:04:25 ✅ Container stopped: a398fcd4df85
2025/05/31 16:04:25 🐳 Terminating container: a398fcd4df85
2025/05/31 16:04:25 🚫 Container terminated: a398fcd4df85
2025/05/31 16:04:25 NATS container terminated.
2025/05/31 16:04:25 🐳 Stopping container: 8bd1d86cac86
2025/05/31 16:04:25 ✅ Container stopped: 8bd1d86cac86
2025/05/31 16:04:25 🐳 Terminating container: 8bd1d86cac86
2025/05/31 16:04:25 🚫 Container terminated: 8bd1d86cac86
2025/05/31 16:04:25 PostgreSQL container terminated.
2025/05/31 16:04:25 Cleanup complete.
--- PASS: TestHandleLeaderboardUpdateRequested (41.50s)
    --- PASS: TestHandleLeaderboardUpdateRequested/Success_-_Sorted_participant_tags_apply_to_new_leaderboard (9.73s)
    --- PASS: TestHandleLeaderboardUpdateRequested/Failure_-_Invalid_JSON_Payload (11.72s)
    --- PASS: TestHandleLeaderboardUpdateRequested/Failure_-_Empty_SortedParticipantTags (11.59s)
    --- PASS: TestHandleLeaderboardUpdateRequested/Failure_-_Incorrect_Tag_Format (8.46s)
=== RUN   TestHandleRoundGetTagRequest
=== RUN   TestHandleRoundGetTagRequest/Success_-_Tag_found_for_user_on_active_leaderboard
2025/05/31 16:04:25 Starting PostgreSQL container with resource limits...
2025/05/31 16:04:25 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:04:26 ✅ Container created: c6fcc74e2497
2025/05/31 16:04:26 🐳 Starting container: c6fcc74e2497
2025/05/31 16:04:26 ✅ Container started: c6fcc74e2497
2025/05/31 16:04:26 ⏳ Waiting for container id c6fcc74e2497 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000a25620 Strategies:[0xc000c67a40]}
2025/05/31 16:04:29 🔔 Container is ready: c6fcc74e2497
2025/05/31 16:04:29 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40629/testdb?sslmode=disable
2025/05/31 16:04:29 Starting NATS container with resource limits...
2025/05/31 16:04:29 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:04:29 ✅ Container created: 0360e535887e
2025/05/31 16:04:29 🐳 Starting container: 0360e535887e
2025/05/31 16:04:29 ✅ Container started: 0360e535887e
2025/05/31 16:04:29 ⏳ Waiting for container id 0360e535887e image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000b08cc0 Strategies:[0xc000d1afc0 0xc0005b7500]}
2025/05/31 16:04:31 🔔 Container is ready: 0360e535887e
2025/05/31 16:04:31 NATS container started with resource limits. URL: nats://localhost:40631
Creating score table...
Score table created successfully!
2025/05/31 16:04:32 Ran score migrations group #1
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:04:32 Ran leaderboard migrations group #2
Creating user table...
User table created successfully!
2025/05/31 16:04:32 Ran user migrations group #3
Creating round table...
Round table created successfully!
2025/05/31 16:04:32 Ran round migrations group #4
2025/05/31 16:04:32 All migrations ran successfully
2025/05/31 16:04:32 newDBServiceWithDB - Registering models
2025/05/31 16:04:32 newDBServiceWithDB - Models registered successfully
2025/05/31 16:04:32 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00014cc18 RoundDB:0xc00014cc20 ScoreDB:0xc00014cc28 LeaderboardDB:0xc00014cc30 db:0xc00098c5c0}
2025/05/31 16:04:32 Truncating tables: leaderboards
    round_tag_by_userid_test.go:221: Waiting for 1 messages on topic "round.tag.lookup.found" with timeout 5s
2025/05/31 16:04:32 Test received message 025ec1b8-b476-4452-97b3-4f2bcfb87e9d on topic "round.tag.lookup.found"
    round_tag_by_userid_test.go:221: Successfully received 1 messages on topic "round.tag.lookup.found"
2025/05/31 16:04:33 Test Case "TestHandleRoundGetTagRequest/Success_-_Tag_found_for_user_on_active_leaderboard": Canceling subscription context.
2025/05/31 16:04:33 Test Case "TestHandleRoundGetTagRequest/Success_-_Tag_found_for_user_on_active_leaderboard": Waiting for subscriber goroutines to finish.
2025/05/31 16:04:33 Test Case "TestHandleRoundGetTagRequest/Success_-_Tag_found_for_user_on_active_leaderboard": Subscriber goroutines finished.
2025/05/31 16:04:33 Running leaderboard handler test cleanup...
2025/05/31 16:04:34 Error closing Leaderboard module: error closing LeaderboardRouter: router close timeout
2025/05/31 16:04:34 Router goroutine finished.
2025/05/31 16:04:34 Leaderboard handler test cleanup finished.
2025/05/31 16:04:34 Cleaning up test environment...
2025/05/31 16:04:34 Context cancelled.
2025/05/31 16:04:34 EventBus closed.
2025/05/31 16:04:34 NATS connection closed.
2025/05/31 16:04:34 DB connection closed.
2025/05/31 16:04:34 🐳 Stopping container: 0360e535887e
2025/05/31 16:04:34 ✅ Container stopped: 0360e535887e
2025/05/31 16:04:34 🐳 Terminating container: 0360e535887e
2025/05/31 16:04:34 🚫 Container terminated: 0360e535887e
2025/05/31 16:04:34 NATS container terminated.
2025/05/31 16:04:34 🐳 Stopping container: c6fcc74e2497
2025/05/31 16:04:35 ✅ Container stopped: c6fcc74e2497
2025/05/31 16:04:35 🐳 Terminating container: c6fcc74e2497
2025/05/31 16:04:35 🚫 Container terminated: c6fcc74e2497
2025/05/31 16:04:35 PostgreSQL container terminated.
2025/05/31 16:04:35 Cleanup complete.
=== RUN   TestHandleRoundGetTagRequest/Success_-_Tag_not_found_(user_not_on_leaderboard)
2025/05/31 16:04:35 Starting PostgreSQL container with resource limits...
2025/05/31 16:04:35 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:04:35 ✅ Container created: 8b4eb557870a
2025/05/31 16:04:35 🐳 Starting container: 8b4eb557870a
2025/05/31 16:04:35 ✅ Container started: 8b4eb557870a
2025/05/31 16:04:35 ⏳ Waiting for container id 8b4eb557870a image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc0005f4210 Strategies:[0xc000adeba0]}
2025/05/31 16:04:38 🔔 Container is ready: 8b4eb557870a
2025/05/31 16:04:38 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40637/testdb?sslmode=disable
2025/05/31 16:04:38 Starting NATS container with resource limits...
2025/05/31 16:04:38 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:04:38 ✅ Container created: 396936814c19
2025/05/31 16:04:38 🐳 Starting container: 396936814c19
2025/05/31 16:04:38 ✅ Container started: 396936814c19
2025/05/31 16:04:38 ⏳ Waiting for container id 396936814c19 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000805f18 Strategies:[0xc000df8480 0xc000b195c0]}
2025/05/31 16:04:40 🔔 Container is ready: 396936814c19
2025/05/31 16:04:40 NATS container started with resource limits. URL: nats://localhost:40638
Creating user table...
User table created successfully!
2025/05/31 16:04:40 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/31 16:04:40 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/31 16:04:40 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:04:40 Ran leaderboard migrations group #4
2025/05/31 16:04:40 All migrations ran successfully
2025/05/31 16:04:40 newDBServiceWithDB - Registering models
2025/05/31 16:04:40 newDBServiceWithDB - Models registered successfully
2025/05/31 16:04:40 newDBServiceWithDB - DBService initialized: &{UserDB:0xc0005c0970 RoundDB:0xc0005c0978 ScoreDB:0xc0005c0988 LeaderboardDB:0xc0005c0990 db:0xc000b0d340}
2025/05/31 16:04:40 Truncating tables: leaderboards
    round_tag_by_userid_test.go:221: Waiting for 1 messages on topic "round.tag.lookup.not.found" with timeout 5s
2025/05/31 16:04:41 WARN No tag found for user in active leaderboard data user_id=660172546
2025/05/31 16:04:41 Test received message bf638e5d-0e88-4be6-a557-fb6ab133339c on topic "round.tag.lookup.not.found"
    round_tag_by_userid_test.go:221: Successfully received 1 messages on topic "round.tag.lookup.not.found"
2025/05/31 16:04:41 Test Case "TestHandleRoundGetTagRequest/Success_-_Tag_not_found_(user_not_on_leaderboard)": Canceling subscription context.
2025/05/31 16:04:41 Test Case "TestHandleRoundGetTagRequest/Success_-_Tag_not_found_(user_not_on_leaderboard)": Waiting for subscriber goroutines to finish.
2025/05/31 16:04:41 Test Case "TestHandleRoundGetTagRequest/Success_-_Tag_not_found_(user_not_on_leaderboard)": Subscriber goroutines finished.
2025/05/31 16:04:41 Running leaderboard handler test cleanup...
2025/05/31 16:04:42 Error closing Leaderboard module: error closing LeaderboardRouter: router close timeout
2025/05/31 16:04:42 Router goroutine finished.
2025/05/31 16:04:42 Leaderboard handler test cleanup finished.
2025/05/31 16:04:42 Cleaning up test environment...
2025/05/31 16:04:42 Context cancelled.
2025/05/31 16:04:42 EventBus closed.
2025/05/31 16:04:42 NATS connection closed.
2025/05/31 16:04:42 DB connection closed.
2025/05/31 16:04:42 🐳 Stopping container: 396936814c19
2025/05/31 16:04:43 ✅ Container stopped: 396936814c19
2025/05/31 16:04:43 🐳 Terminating container: 396936814c19
2025/05/31 16:04:43 🚫 Container terminated: 396936814c19
2025/05/31 16:04:43 NATS container terminated.
2025/05/31 16:04:43 🐳 Stopping container: 8b4eb557870a
2025/05/31 16:04:43 ✅ Container stopped: 8b4eb557870a
2025/05/31 16:04:43 🐳 Terminating container: 8b4eb557870a
2025/05/31 16:04:43 🚫 Container terminated: 8b4eb557870a
2025/05/31 16:04:43 PostgreSQL container terminated.
2025/05/31 16:04:43 Cleanup complete.
=== RUN   TestHandleRoundGetTagRequest/Failure_-_No_active_leaderboard_present
2025/05/31 16:04:43 Starting PostgreSQL container with resource limits...
2025/05/31 16:04:43 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:04:43 ✅ Container created: ffecea7a4454
2025/05/31 16:04:43 🐳 Starting container: ffecea7a4454
2025/05/31 16:04:44 ✅ Container started: ffecea7a4454
2025/05/31 16:04:44 ⏳ Waiting for container id ffecea7a4454 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc0005f4858 Strategies:[0xc000b180c0]}
2025/05/31 16:04:46 🔔 Container is ready: ffecea7a4454
2025/05/31 16:04:46 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40641/testdb?sslmode=disable
2025/05/31 16:04:46 Starting NATS container with resource limits...
2025/05/31 16:04:46 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:04:46 ✅ Container created: 5075c4b87c23
2025/05/31 16:04:46 🐳 Starting container: 5075c4b87c23
2025/05/31 16:04:47 ✅ Container started: 5075c4b87c23
2025/05/31 16:04:47 ⏳ Waiting for container id 5075c4b87c23 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000be4f98 Strategies:[0xc000df9f20 0xc000b86ea0]}
2025/05/31 16:04:49 🔔 Container is ready: 5075c4b87c23
2025/05/31 16:04:49 NATS container started with resource limits. URL: nats://localhost:40642
Creating score table...
Score table created successfully!
2025/05/31 16:04:49 Ran score migrations group #1
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:04:49 Ran leaderboard migrations group #2
Creating user table...
User table created successfully!
2025/05/31 16:04:49 Ran user migrations group #3
Creating round table...
Round table created successfully!
2025/05/31 16:04:49 Ran round migrations group #4
2025/05/31 16:04:49 All migrations ran successfully
2025/05/31 16:04:49 newDBServiceWithDB - Registering models
2025/05/31 16:04:49 newDBServiceWithDB - Models registered successfully
2025/05/31 16:04:49 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00079a3a8 RoundDB:0xc00079a3b0 ScoreDB:0xc00079a3b8 LeaderboardDB:0xc00079a3c0 db:0xc00033aa00}
2025/05/31 16:04:49 Truncating tables: leaderboards
    round_tag_by_userid_test.go:221: Waiting for 1 messages on topic "discord.leaderboard.tag.get.by.user.id.failed" with timeout 5s
2025/05/31 16:04:50 WARN No active leaderboard found for tag lookup
2025/05/31 16:04:50 Test received message d8ae37d8-c543-463e-b164-f8398b17a270 on topic "discord.leaderboard.tag.get.by.user.id.failed"
    round_tag_by_userid_test.go:221: Successfully received 1 messages on topic "discord.leaderboard.tag.get.by.user.id.failed"
2025/05/31 16:04:50 Test Case "TestHandleRoundGetTagRequest/Failure_-_No_active_leaderboard_present": Canceling subscription context.
2025/05/31 16:04:50 Test Case "TestHandleRoundGetTagRequest/Failure_-_No_active_leaderboard_present": Waiting for subscriber goroutines to finish.
2025/05/31 16:04:50 Test Case "TestHandleRoundGetTagRequest/Failure_-_No_active_leaderboard_present": Subscriber goroutines finished.
2025/05/31 16:04:50 Running leaderboard handler test cleanup...
2025/05/31 16:04:51 Error closing Leaderboard module: error closing LeaderboardRouter: router close timeout
2025/05/31 16:04:51 Router goroutine finished.
2025/05/31 16:04:51 Leaderboard handler test cleanup finished.
2025/05/31 16:04:51 Cleaning up test environment...
2025/05/31 16:04:51 Context cancelled.
2025/05/31 16:04:51 EventBus closed.
2025/05/31 16:04:51 NATS connection closed.
2025/05/31 16:04:51 DB connection closed.
2025/05/31 16:04:51 🐳 Stopping container: 5075c4b87c23
2025/05/31 16:04:52 ✅ Container stopped: 5075c4b87c23
2025/05/31 16:04:52 🐳 Terminating container: 5075c4b87c23
2025/05/31 16:04:52 🚫 Container terminated: 5075c4b87c23
2025/05/31 16:04:52 NATS container terminated.
2025/05/31 16:04:52 🐳 Stopping container: ffecea7a4454
2025/05/31 16:04:52 ✅ Container stopped: ffecea7a4454
2025/05/31 16:04:52 🐳 Terminating container: ffecea7a4454
2025/05/31 16:04:52 🚫 Container terminated: ffecea7a4454
2025/05/31 16:04:52 PostgreSQL container terminated.
2025/05/31 16:04:52 Cleanup complete.
=== RUN   TestHandleRoundGetTagRequest/Failure_-_Invalid_payload_(unmarshal_error)
2025/05/31 16:04:52 Starting PostgreSQL container with resource limits...
2025/05/31 16:04:52 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:04:52 ✅ Container created: 66c3d8622997
2025/05/31 16:04:52 🐳 Starting container: 66c3d8622997
2025/05/31 16:04:53 ✅ Container started: 66c3d8622997
2025/05/31 16:04:53 ⏳ Waiting for container id 66c3d8622997 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc0005f5d10 Strategies:[0xc000ba5410]}
2025/05/31 16:04:55 🔔 Container is ready: 66c3d8622997
2025/05/31 16:04:55 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40645/testdb?sslmode=disable
2025/05/31 16:04:55 Starting NATS container with resource limits...
2025/05/31 16:04:55 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:04:55 ✅ Container created: 2780f23b9827
2025/05/31 16:04:55 🐳 Starting container: 2780f23b9827
2025/05/31 16:04:56 ✅ Container started: 2780f23b9827
2025/05/31 16:04:56 ⏳ Waiting for container id 2780f23b9827 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000804c88 Strategies:[0xc0009cd0e0 0xc000e735c0]}
2025/05/31 16:04:58 🔔 Container is ready: 2780f23b9827
2025/05/31 16:04:58 NATS container started with resource limits. URL: nats://localhost:40646
Creating score table...
Score table created successfully!
2025/05/31 16:04:58 Ran score migrations group #1
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:04:58 Ran leaderboard migrations group #2
Creating user table...
User table created successfully!
2025/05/31 16:04:58 Ran user migrations group #3
Creating round table...
Round table created successfully!
2025/05/31 16:04:58 Ran round migrations group #4
2025/05/31 16:04:58 All migrations ran successfully
2025/05/31 16:04:58 newDBServiceWithDB - Registering models
2025/05/31 16:04:58 newDBServiceWithDB - Models registered successfully
2025/05/31 16:04:58 newDBServiceWithDB - DBService initialized: &{UserDB:0xc0001a6af0 RoundDB:0xc0001a6af8 ScoreDB:0xc0001a6b28 LeaderboardDB:0xc0001a6b40 db:0xc000982040}
2025/05/31 16:04:59 Truncating tables: leaderboards
2025/05/31 16:04:59 Test Case "TestHandleRoundGetTagRequest/Failure_-_Invalid_payload_(unmarshal_error)": Canceling subscription context.
2025/05/31 16:04:59 Test Case "TestHandleRoundGetTagRequest/Failure_-_Invalid_payload_(unmarshal_error)": Waiting for subscriber goroutines to finish.
2025/05/31 16:04:59 Test Case "TestHandleRoundGetTagRequest/Failure_-_Invalid_payload_(unmarshal_error)": Subscriber goroutines finished.
2025/05/31 16:04:59 Running leaderboard handler test cleanup...
2025/05/31 16:05:00 Error closing Leaderboard module: error closing LeaderboardRouter: router close timeout
2025/05/31 16:05:00 Router goroutine finished.
2025/05/31 16:05:00 Leaderboard handler test cleanup finished.
2025/05/31 16:05:00 Cleaning up test environment...
2025/05/31 16:05:00 Context cancelled.
2025/05/31 16:05:00 EventBus closed.
2025/05/31 16:05:00 NATS connection closed.
2025/05/31 16:05:00 DB connection closed.
2025/05/31 16:05:00 🐳 Stopping container: 2780f23b9827
2025/05/31 16:05:01 ✅ Container stopped: 2780f23b9827
2025/05/31 16:05:01 🐳 Terminating container: 2780f23b9827
2025/05/31 16:05:01 🚫 Container terminated: 2780f23b9827
2025/05/31 16:05:01 NATS container terminated.
2025/05/31 16:05:01 🐳 Stopping container: 66c3d8622997
2025/05/31 16:05:01 ✅ Container stopped: 66c3d8622997
2025/05/31 16:05:01 🐳 Terminating container: 66c3d8622997
2025/05/31 16:05:01 🚫 Container terminated: 66c3d8622997
2025/05/31 16:05:01 PostgreSQL container terminated.
2025/05/31 16:05:01 Cleanup complete.
--- PASS: TestHandleRoundGetTagRequest (35.71s)
    --- PASS: TestHandleRoundGetTagRequest/Success_-_Tag_found_for_user_on_active_leaderboard (9.29s)
    --- PASS: TestHandleRoundGetTagRequest/Success_-_Tag_not_found_(user_not_on_leaderboard) (8.56s)
    --- PASS: TestHandleRoundGetTagRequest/Failure_-_No_active_leaderboard_present (8.86s)
    --- PASS: TestHandleRoundGetTagRequest/Failure_-_Invalid_payload_(unmarshal_error) (9.00s)
=== RUN   TestHandleTagAssignmentRequested
=== RUN   TestHandleTagAssignmentRequested/Success_-_Assign_New_Tag
2025/05/31 16:05:01 Starting PostgreSQL container with resource limits...
2025/05/31 16:05:01 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:05:01 ✅ Container created: 8f6c58533b4a
2025/05/31 16:05:01 🐳 Starting container: 8f6c58533b4a
2025/05/31 16:05:02 ✅ Container started: 8f6c58533b4a
2025/05/31 16:05:02 ⏳ Waiting for container id 8f6c58533b4a image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc0005f5e00 Strategies:[0xc000991440]}
2025/05/31 16:05:04 🔔 Container is ready: 8f6c58533b4a
2025/05/31 16:05:04 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40649/testdb?sslmode=disable
2025/05/31 16:05:04 Starting NATS container with resource limits...
2025/05/31 16:05:04 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:05:04 ✅ Container created: 04d1212cf225
2025/05/31 16:05:04 🐳 Starting container: 04d1212cf225
2025/05/31 16:05:05 ✅ Container started: 04d1212cf225
2025/05/31 16:05:05 ⏳ Waiting for container id 04d1212cf225 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000805288 Strategies:[0xc0007ed200 0xc000c66b70]}
2025/05/31 16:05:07 🔔 Container is ready: 04d1212cf225
2025/05/31 16:05:07 NATS container started with resource limits. URL: nats://localhost:40650
Creating user table...
User table created successfully!
2025/05/31 16:05:07 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/31 16:05:07 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/31 16:05:07 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:05:07 Ran leaderboard migrations group #4
2025/05/31 16:05:07 All migrations ran successfully
2025/05/31 16:05:07 newDBServiceWithDB - Registering models
2025/05/31 16:05:07 newDBServiceWithDB - Models registered successfully
2025/05/31 16:05:07 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00079a778 RoundDB:0xc00079a788 ScoreDB:0xc00079a790 LeaderboardDB:0xc00079a7a8 db:0xc00033a440}
2025/05/31 16:05:07 Truncating tables: leaderboards
    tag_assignment_test.go:269: Waiting for 1 messages on topic "discord.leaderboard.tag.assignment.success" with timeout 5s
2025/05/31 16:05:08 Test received message 009417f8-9ac8-4d65-801e-15d11ae9441c on topic "discord.leaderboard.tag.assignment.success"
    tag_assignment_test.go:269: Successfully received 1 messages on topic "discord.leaderboard.tag.assignment.success"
2025/05/31 16:05:08 Test Case "TestHandleTagAssignmentRequested/Success_-_Assign_New_Tag": Canceling subscription context.
2025/05/31 16:05:08 Test Case "TestHandleTagAssignmentRequested/Success_-_Assign_New_Tag": Waiting for subscriber goroutines to finish.
2025/05/31 16:05:08 Test Case "TestHandleTagAssignmentRequested/Success_-_Assign_New_Tag": Subscriber goroutines finished.
2025/05/31 16:05:08 Running leaderboard handler test cleanup...
2025/05/31 16:05:09 Error closing Leaderboard module: error closing LeaderboardRouter: router close timeout
2025/05/31 16:05:09 Router goroutine finished.
2025/05/31 16:05:09 Leaderboard handler test cleanup finished.
2025/05/31 16:05:09 Cleaning up test environment...
2025/05/31 16:05:09 Context cancelled.
2025/05/31 16:05:09 EventBus closed.
2025/05/31 16:05:09 NATS connection closed.
2025/05/31 16:05:09 DB connection closed.
2025/05/31 16:05:09 🐳 Stopping container: 04d1212cf225
2025/05/31 16:05:10 ✅ Container stopped: 04d1212cf225
2025/05/31 16:05:10 🐳 Terminating container: 04d1212cf225
2025/05/31 16:05:10 🚫 Container terminated: 04d1212cf225
2025/05/31 16:05:10 NATS container terminated.
2025/05/31 16:05:10 🐳 Stopping container: 8f6c58533b4a
2025/05/31 16:05:10 ✅ Container stopped: 8f6c58533b4a
2025/05/31 16:05:10 🐳 Terminating container: 8f6c58533b4a
2025/05/31 16:05:10 🚫 Container terminated: 8f6c58533b4a
2025/05/31 16:05:10 PostgreSQL container terminated.
2025/05/31 16:05:10 Cleanup complete.
=== RUN   TestHandleTagAssignmentRequested/Success_-_Update_Existing_Tag
2025/05/31 16:05:10 Starting PostgreSQL container with resource limits...
2025/05/31 16:05:10 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:05:10 ✅ Container created: 691764b246be
2025/05/31 16:05:10 🐳 Starting container: 691764b246be
2025/05/31 16:05:11 ✅ Container started: 691764b246be
2025/05/31 16:05:11 ⏳ Waiting for container id 691764b246be image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc0011c4350 Strategies:[0xc0011ca0f0]}
2025/05/31 16:05:13 🔔 Container is ready: 691764b246be
2025/05/31 16:05:13 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40653/testdb?sslmode=disable
2025/05/31 16:05:13 Starting NATS container with resource limits...
2025/05/31 16:05:13 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:05:13 ✅ Container created: 15b3daa86af6
2025/05/31 16:05:13 🐳 Starting container: 15b3daa86af6
2025/05/31 16:05:14 ✅ Container started: 15b3daa86af6
2025/05/31 16:05:14 ⏳ Waiting for container id 15b3daa86af6 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc0011c5aa8 Strategies:[0xc000ec7380 0xc0008e4c00]}
2025/05/31 16:05:17 🔔 Container is ready: 15b3daa86af6
2025/05/31 16:05:17 NATS container started with resource limits. URL: nats://localhost:40654
Creating score table...
Score table created successfully!
2025/05/31 16:05:17 Ran score migrations group #1
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:05:17 Ran leaderboard migrations group #2
Creating user table...
User table created successfully!
2025/05/31 16:05:17 Ran user migrations group #3
Creating round table...
Round table created successfully!
2025/05/31 16:05:17 Ran round migrations group #4
2025/05/31 16:05:17 All migrations ran successfully
2025/05/31 16:05:17 newDBServiceWithDB - Registering models
2025/05/31 16:05:17 newDBServiceWithDB - Models registered successfully
2025/05/31 16:05:17 newDBServiceWithDB - DBService initialized: &{UserDB:0xc0005c06b0 RoundDB:0xc0005c06b8 ScoreDB:0xc0005c06c0 LeaderboardDB:0xc0005c06c8 db:0xc00033b340}
2025/05/31 16:05:17 Truncating tables: leaderboards
    tag_assignment_test.go:269: Waiting for 1 messages on topic "discord.leaderboard.tag.assignment.success" with timeout 5s
2025/05/31 16:05:18 Test received message 908e73a1-294d-436b-9756-344d474e3d11 on topic "discord.leaderboard.tag.assignment.success"
    tag_assignment_test.go:269: Successfully received 1 messages on topic "discord.leaderboard.tag.assignment.success"
2025/05/31 16:05:18 Test Case "TestHandleTagAssignmentRequested/Success_-_Update_Existing_Tag": Canceling subscription context.
2025/05/31 16:05:18 Test Case "TestHandleTagAssignmentRequested/Success_-_Update_Existing_Tag": Waiting for subscriber goroutines to finish.
2025/05/31 16:05:18 Test Case "TestHandleTagAssignmentRequested/Success_-_Update_Existing_Tag": Subscriber goroutines finished.
2025/05/31 16:05:18 Running leaderboard handler test cleanup...
2025/05/31 16:05:19 Error closing Leaderboard module: error closing LeaderboardRouter: router close timeout
2025/05/31 16:05:19 Router goroutine finished.
2025/05/31 16:05:19 Leaderboard handler test cleanup finished.
2025/05/31 16:05:19 Cleaning up test environment...
2025/05/31 16:05:19 Context cancelled.
2025/05/31 16:05:19 EventBus closed.
2025/05/31 16:05:19 NATS connection closed.
2025/05/31 16:05:19 DB connection closed.
2025/05/31 16:05:19 🐳 Stopping container: 15b3daa86af6
2025/05/31 16:05:20 ✅ Container stopped: 15b3daa86af6
2025/05/31 16:05:20 🐳 Terminating container: 15b3daa86af6
2025/05/31 16:05:20 🚫 Container terminated: 15b3daa86af6
2025/05/31 16:05:20 NATS container terminated.
2025/05/31 16:05:20 🐳 Stopping container: 691764b246be
2025/05/31 16:05:20 ✅ Container stopped: 691764b246be
2025/05/31 16:05:20 🐳 Terminating container: 691764b246be
2025/05/31 16:05:20 🚫 Container terminated: 691764b246be
2025/05/31 16:05:20 PostgreSQL container terminated.
2025/05/31 16:05:20 Cleanup complete.
=== RUN   TestHandleTagAssignmentRequested/Success_-_Add_Brand_New_User
2025/05/31 16:05:20 Starting PostgreSQL container with resource limits...
2025/05/31 16:05:20 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:05:20 ✅ Container created: ad5af4a1cb1e
2025/05/31 16:05:20 🐳 Starting container: ad5af4a1cb1e
2025/05/31 16:05:20 ✅ Container started: ad5af4a1cb1e
2025/05/31 16:05:20 ⏳ Waiting for container id ad5af4a1cb1e image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000b08898 Strategies:[0xc0012b54d0]}
2025/05/31 16:05:24 🔔 Container is ready: ad5af4a1cb1e
2025/05/31 16:05:24 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40657/testdb?sslmode=disable
2025/05/31 16:05:24 Starting NATS container with resource limits...
2025/05/31 16:05:24 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:05:24 ✅ Container created: 4828168f7ba5
2025/05/31 16:05:24 🐳 Starting container: 4828168f7ba5
2025/05/31 16:05:24 ✅ Container started: 4828168f7ba5
2025/05/31 16:05:24 ⏳ Waiting for container id 4828168f7ba5 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000d89228 Strategies:[0xc000a83bc0 0xc000b00870]}
2025/05/31 16:05:25 🔔 Container is ready: 4828168f7ba5
2025/05/31 16:05:25 NATS container started with resource limits. URL: nats://localhost:40658
Creating round table...
Round table created successfully!
2025/05/31 16:05:26 Ran round migrations group #1
Creating score table...
Score table created successfully!
2025/05/31 16:05:26 Ran score migrations group #2
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:05:26 Ran leaderboard migrations group #3
Creating user table...
User table created successfully!
2025/05/31 16:05:26 Ran user migrations group #4
2025/05/31 16:05:26 All migrations ran successfully
2025/05/31 16:05:26 newDBServiceWithDB - Registering models
2025/05/31 16:05:26 newDBServiceWithDB - Models registered successfully
2025/05/31 16:05:26 newDBServiceWithDB - DBService initialized: &{UserDB:0xc0001a6a70 RoundDB:0xc0001a6aa0 ScoreDB:0xc0001a6ab0 LeaderboardDB:0xc0001a6ac0 db:0xc00033ac40}
2025/05/31 16:05:26 Truncating tables: leaderboards
    tag_assignment_test.go:269: Waiting for 1 messages on topic "discord.leaderboard.tag.assignment.success" with timeout 5s
2025/05/31 16:05:27 Test received message 4077435f-ab35-4cf1-8709-ba8936bff20d on topic "discord.leaderboard.tag.assignment.success"
    tag_assignment_test.go:269: Successfully received 1 messages on topic "discord.leaderboard.tag.assignment.success"
2025/05/31 16:05:27 Test Case "TestHandleTagAssignmentRequested/Success_-_Add_Brand_New_User": Canceling subscription context.
2025/05/31 16:05:27 Test Case "TestHandleTagAssignmentRequested/Success_-_Add_Brand_New_User": Waiting for subscriber goroutines to finish.
2025/05/31 16:05:27 Test Case "TestHandleTagAssignmentRequested/Success_-_Add_Brand_New_User": Subscriber goroutines finished.
2025/05/31 16:05:27 Running leaderboard handler test cleanup...
2025/05/31 16:05:28 Error closing Leaderboard module: error closing LeaderboardRouter: router close timeout
2025/05/31 16:05:28 Router goroutine finished.
2025/05/31 16:05:28 Leaderboard handler test cleanup finished.
2025/05/31 16:05:28 Cleaning up test environment...
2025/05/31 16:05:28 Context cancelled.
2025/05/31 16:05:28 EventBus closed.
2025/05/31 16:05:28 NATS connection closed.
2025/05/31 16:05:28 DB connection closed.
2025/05/31 16:05:28 🐳 Stopping container: 4828168f7ba5
2025/05/31 16:05:28 ✅ Container stopped: 4828168f7ba5
2025/05/31 16:05:28 🐳 Terminating container: 4828168f7ba5
2025/05/31 16:05:28 🚫 Container terminated: 4828168f7ba5
2025/05/31 16:05:28 NATS container terminated.
2025/05/31 16:05:28 🐳 Stopping container: ad5af4a1cb1e
2025/05/31 16:05:28 ✅ Container stopped: ad5af4a1cb1e
2025/05/31 16:05:28 🐳 Terminating container: ad5af4a1cb1e
2025/05/31 16:05:28 🚫 Container terminated: ad5af4a1cb1e
2025/05/31 16:05:28 PostgreSQL container terminated.
2025/05/31 16:05:28 Cleanup complete.
=== RUN   TestHandleTagAssignmentRequested/Success_-_Tag_Swap_Triggered_and_Processed
2025/05/31 16:05:28 Starting PostgreSQL container with resource limits...
2025/05/31 16:05:28 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:05:28 ✅ Container created: b047976749d5
2025/05/31 16:05:29 🐳 Starting container: b047976749d5
2025/05/31 16:05:29 ✅ Container started: b047976749d5
2025/05/31 16:05:29 ⏳ Waiting for container id b047976749d5 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000be4e88 Strategies:[0xc0012b5e30]}
2025/05/31 16:05:32 🔔 Container is ready: b047976749d5
2025/05/31 16:05:32 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40661/testdb?sslmode=disable
2025/05/31 16:05:32 Starting NATS container with resource limits...
2025/05/31 16:05:32 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:05:32 ✅ Container created: 968ce6302894
2025/05/31 16:05:32 🐳 Starting container: 968ce6302894
2025/05/31 16:05:32 ✅ Container started: 968ce6302894
2025/05/31 16:05:32 ⏳ Waiting for container id 968ce6302894 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc0003876b8 Strategies:[0xc0009e9200 0xc000a6f6e0]}
2025/05/31 16:05:34 🔔 Container is ready: 968ce6302894
2025/05/31 16:05:34 NATS container started with resource limits. URL: nats://localhost:40662
Creating user table...
User table created successfully!
2025/05/31 16:05:34 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/31 16:05:34 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/31 16:05:34 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:05:34 Ran leaderboard migrations group #4
2025/05/31 16:05:34 All migrations ran successfully
2025/05/31 16:05:34 newDBServiceWithDB - Registering models
2025/05/31 16:05:34 newDBServiceWithDB - Models registered successfully
2025/05/31 16:05:34 newDBServiceWithDB - DBService initialized: &{UserDB:0xc0005427f0 RoundDB:0xc0005427f8 ScoreDB:0xc000542800 LeaderboardDB:0xc000542808 db:0xc00033a500}
2025/05/31 16:05:34 Truncating tables: leaderboards
    tag_assignment_test.go:269: Waiting for 1 messages on topic "discord.leaderboard.tag.swap.processed" with timeout 5s
2025/05/31 16:05:35 Test received message c420274f-4535-41a3-a782-866cc9793317 on topic "discord.leaderboard.tag.swap.processed"
    tag_assignment_test.go:269: Successfully received 1 messages on topic "discord.leaderboard.tag.swap.processed"
    tag_assignment_test.go:213: Received downstream swap processed event: c420274f-4535-41a3-a782-866cc9793317
2025/05/31 16:05:35 Test Case "TestHandleTagAssignmentRequested/Success_-_Tag_Swap_Triggered_and_Processed": Canceling subscription context.
2025/05/31 16:05:35 Test Case "TestHandleTagAssignmentRequested/Success_-_Tag_Swap_Triggered_and_Processed": Waiting for subscriber goroutines to finish.
2025/05/31 16:05:35 Test Case "TestHandleTagAssignmentRequested/Success_-_Tag_Swap_Triggered_and_Processed": Subscriber goroutines finished.
2025/05/31 16:05:35 Running leaderboard handler test cleanup...
2025/05/31 16:05:36 Error closing Leaderboard module: error closing LeaderboardRouter: router close timeout
2025/05/31 16:05:36 Router goroutine finished.
2025/05/31 16:05:36 Leaderboard handler test cleanup finished.
2025/05/31 16:05:36 Cleaning up test environment...
2025/05/31 16:05:36 Context cancelled.
2025/05/31 16:05:36 EventBus closed.
2025/05/31 16:05:36 NATS connection closed.
2025/05/31 16:05:36 DB connection closed.
2025/05/31 16:05:36 🐳 Stopping container: 968ce6302894
2025/05/31 16:05:37 ✅ Container stopped: 968ce6302894
2025/05/31 16:05:37 🐳 Terminating container: 968ce6302894
2025/05/31 16:05:37 🚫 Container terminated: 968ce6302894
2025/05/31 16:05:37 NATS container terminated.
2025/05/31 16:05:37 🐳 Stopping container: b047976749d5
2025/05/31 16:05:37 ✅ Container stopped: b047976749d5
2025/05/31 16:05:37 🐳 Terminating container: b047976749d5
2025/05/31 16:05:37 🚫 Container terminated: b047976749d5
2025/05/31 16:05:37 PostgreSQL container terminated.
2025/05/31 16:05:37 Cleanup complete.
=== RUN   TestHandleTagAssignmentRequested/Failure_-_Invalid_JSON_Message
2025/05/31 16:05:37 Starting PostgreSQL container with resource limits...
2025/05/31 16:05:37 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:05:37 ✅ Container created: 459e3461cb58
2025/05/31 16:05:37 🐳 Starting container: 459e3461cb58
2025/05/31 16:05:38 ✅ Container started: 459e3461cb58
2025/05/31 16:05:38 ⏳ Waiting for container id 459e3461cb58 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000a25b38 Strategies:[0xc000f447e0]}
2025/05/31 16:05:40 🔔 Container is ready: 459e3461cb58
2025/05/31 16:05:40 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40665/testdb?sslmode=disable
2025/05/31 16:05:40 Starting NATS container with resource limits...
2025/05/31 16:05:40 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:05:40 ✅ Container created: e33d53a0a912
2025/05/31 16:05:40 🐳 Starting container: e33d53a0a912
2025/05/31 16:05:41 ✅ Container started: e33d53a0a912
2025/05/31 16:05:41 ⏳ Waiting for container id e33d53a0a912 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000d89f38 Strategies:[0xc0014671a0 0xc000d32150]}
2025/05/31 16:05:43 🔔 Container is ready: e33d53a0a912
2025/05/31 16:05:43 NATS container started with resource limits. URL: nats://localhost:40666
Creating score table...
Score table created successfully!
2025/05/31 16:05:43 Ran score migrations group #1
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:05:43 Ran leaderboard migrations group #2
Creating user table...
User table created successfully!
2025/05/31 16:05:43 Ran user migrations group #3
Creating round table...
Round table created successfully!
2025/05/31 16:05:43 Ran round migrations group #4
2025/05/31 16:05:43 All migrations ran successfully
2025/05/31 16:05:43 newDBServiceWithDB - Registering models
2025/05/31 16:05:43 newDBServiceWithDB - Models registered successfully
2025/05/31 16:05:43 newDBServiceWithDB - DBService initialized: &{UserDB:0xc0001a6ca0 RoundDB:0xc0001a6ca8 ScoreDB:0xc0001a6cb0 LeaderboardDB:0xc0001a6cb8 db:0xc000b8e6c0}
2025/05/31 16:05:44 Truncating tables: leaderboards
2025/05/31 16:05:44 Test Case "TestHandleTagAssignmentRequested/Failure_-_Invalid_JSON_Message": Canceling subscription context.
2025/05/31 16:05:44 Test Case "TestHandleTagAssignmentRequested/Failure_-_Invalid_JSON_Message": Waiting for subscriber goroutines to finish.
2025/05/31 16:05:44 Test Case "TestHandleTagAssignmentRequested/Failure_-_Invalid_JSON_Message": Subscriber goroutines finished.
2025/05/31 16:05:44 Running leaderboard handler test cleanup...
2025/05/31 16:05:45 Error closing Leaderboard module: error closing LeaderboardRouter: router close timeout
2025/05/31 16:05:45 Router goroutine finished.
2025/05/31 16:05:45 Leaderboard handler test cleanup finished.
2025/05/31 16:05:45 Cleaning up test environment...
2025/05/31 16:05:45 Context cancelled.
2025/05/31 16:05:45 EventBus closed.
2025/05/31 16:05:45 NATS connection closed.
2025/05/31 16:05:45 DB connection closed.
2025/05/31 16:05:45 🐳 Stopping container: e33d53a0a912
2025/05/31 16:05:46 ✅ Container stopped: e33d53a0a912
2025/05/31 16:05:46 🐳 Terminating container: e33d53a0a912
2025/05/31 16:05:46 🚫 Container terminated: e33d53a0a912
2025/05/31 16:05:46 NATS container terminated.
2025/05/31 16:05:46 🐳 Stopping container: 459e3461cb58
2025/05/31 16:05:46 ✅ Container stopped: 459e3461cb58
2025/05/31 16:05:46 🐳 Terminating container: 459e3461cb58
2025/05/31 16:05:46 🚫 Container terminated: 459e3461cb58
2025/05/31 16:05:46 PostgreSQL container terminated.
2025/05/31 16:05:46 Cleanup complete.
--- PASS: TestHandleTagAssignmentRequested (45.31s)
    --- PASS: TestHandleTagAssignmentRequested/Success_-_Assign_New_Tag (9.28s)
    --- PASS: TestHandleTagAssignmentRequested/Success_-_Update_Existing_Tag (9.63s)
    --- PASS: TestHandleTagAssignmentRequested/Success_-_Add_Brand_New_User (8.39s)
    --- PASS: TestHandleTagAssignmentRequested/Success_-_Tag_Swap_Triggered_and_Processed (8.81s)
    --- PASS: TestHandleTagAssignmentRequested/Failure_-_Invalid_JSON_Message (9.20s)
PASS
coverage: 41.0% of statements in ./app/...
2025/05/31 16:05:46 TestMain: finished with exit code: 0
ok  	github.com/Black-And-White-Club/frolf-bot/integration_tests/modules/leaderboard/handler_tests	233.614s	coverage: 41.0% of statements in ./app/...
=== RUN   TestValidateRoundDeleteRequest
=== RUN   TestValidateRoundDeleteRequest/Successful_validation_of_delete_request
2025/05/31 16:01:56 Initializing round test environment...
2025/05/31 16:01:56 Starting PostgreSQL container with resource limits...
2025/05/31 16:01:56 github.com/testcontainers/testcontainers-go - Connected to docker: 
  Server Version: 28.1.1
  API Version: 1.48
  Operating System: Ubuntu 24.04.1 LTS
  Total Memory: 5923 MB
  Testcontainers for Go Version: v0.37.0
  Resolved Docker Host: unix:///Users/jace/.colima/default/docker.sock
  Resolved Docker Socket Path: /var/run/docker.sock
  Test SessionID: 9db56792615afb05e786a706eb0beac327e763183af153d41570e5011efcddd4
  Test ProcessID: 88170777-7727-4e37-bf9e-b5d6ed7707ea
2025/05/31 16:01:56 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:01:56 ⏳ Waiting for Reaper "069f6d02" to be ready
2025/05/31 16:01:56 🔥 Reaper obtained from Docker for this test session 069f6d02
2025/05/31 16:01:56 ✅ Container created: 95860bf647e8
2025/05/31 16:01:56 🐳 Starting container: 95860bf647e8
2025/05/31 16:01:57 ✅ Container started: 95860bf647e8
2025/05/31 16:01:57 ⏳ Waiting for container id 95860bf647e8 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc00056a9b0 Strategies:[0xc00057f9e0]}
2025/05/31 16:02:04 🔔 Container is ready: 95860bf647e8
2025/05/31 16:02:04 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40399/testdb?sslmode=disable
2025/05/31 16:02:04 Starting NATS container with resource limits...
2025/05/31 16:02:04 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:02:05 ✅ Container created: c895cd22f8fd
2025/05/31 16:02:05 🐳 Starting container: c895cd22f8fd
2025/05/31 16:02:06 ✅ Container started: c895cd22f8fd
2025/05/31 16:02:06 ⏳ Waiting for container id c895cd22f8fd image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc0006b9720 Strategies:[0xc0005bf8c0 0xc000688330]}
2025/05/31 16:02:08 🔔 Container is ready: c895cd22f8fd
2025/05/31 16:02:08 NATS container started with resource limits. URL: nats://localhost:40413
Creating round table...
Round table created successfully!
2025/05/31 16:02:08 Ran round migrations group #1
Creating score table...
Score table created successfully!
2025/05/31 16:02:08 Ran score migrations group #2
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:02:08 Ran leaderboard migrations group #3
Creating user table...
User table created successfully!
2025/05/31 16:02:08 Ran user migrations group #4
2025/05/31 16:02:08 All migrations ran successfully
2025/05/31 16:02:08 newDBServiceWithDB - Registering models
2025/05/31 16:02:08 newDBServiceWithDB - Models registered successfully
2025/05/31 16:02:08 newDBServiceWithDB - DBService initialized: &{UserDB:0xc000710188 RoundDB:0xc000710190 ScoreDB:0xc000710198 LeaderboardDB:0xc0007101a0 db:0xc00005f8c0}
2025/05/31 16:02:08 Round test environment initialized successfully.
2025/05/31 16:02:08 Truncating tables: rounds
=== RUN   TestValidateRoundDeleteRequest/Validation_fails_with_zero_RoundID
2025/05/31 16:02:08 Truncating tables: rounds
=== RUN   TestValidateRoundDeleteRequest/Validation_fails_with_empty_RequestingUserUserID
2025/05/31 16:02:09 Truncating tables: rounds
=== RUN   TestValidateRoundDeleteRequest/Validation_fails_when_round_does_not_exist
2025/05/31 16:02:09 Truncating tables: rounds
=== RUN   TestValidateRoundDeleteRequest/Validation_fails_when_user_is_not_the_creator
2025/05/31 16:02:09 Truncating tables: rounds
--- PASS: TestValidateRoundDeleteRequest (13.44s)
    --- PASS: TestValidateRoundDeleteRequest/Successful_validation_of_delete_request (12.44s)
    --- PASS: TestValidateRoundDeleteRequest/Validation_fails_with_zero_RoundID (0.28s)
    --- PASS: TestValidateRoundDeleteRequest/Validation_fails_with_empty_RequestingUserUserID (0.29s)
    --- PASS: TestValidateRoundDeleteRequest/Validation_fails_when_round_does_not_exist (0.21s)
    --- PASS: TestValidateRoundDeleteRequest/Validation_fails_when_user_is_not_the_creator (0.22s)
=== RUN   TestDeleteRound
=== RUN   TestDeleteRound/Successful_deletion_of_an_existing_round
2025/05/31 16:02:09 Truncating tables: rounds
2025/05/31 16:02:10 INFO round deleted from DB
=== RUN   TestDeleteRound/Attempt_to_delete_a_non-existent_round
2025/05/31 16:02:10 Truncating tables: rounds
=== RUN   TestDeleteRound/Deletion_with_EventBus_error_(should_still_succeed_for_round_deletion)
2025/05/31 16:02:10 Truncating tables: rounds
2025/05/31 16:02:10 INFO round deleted from DB
=== RUN   TestDeleteRound/Attempt_to_delete_round_with_nil_UUID_payload
2025/05/31 16:02:10 Truncating tables: rounds
--- PASS: TestDeleteRound (0.82s)
    --- PASS: TestDeleteRound/Successful_deletion_of_an_existing_round (0.31s)
    --- PASS: TestDeleteRound/Attempt_to_delete_a_non-existent_round (0.17s)
    --- PASS: TestDeleteRound/Deletion_with_EventBus_error_(should_still_succeed_for_round_deletion) (0.20s)
    --- PASS: TestDeleteRound/Attempt_to_delete_round_with_nil_UUID_payload (0.14s)
=== RUN   TestFinalizeRound
=== RUN   TestFinalizeRound/Successful_finalization_of_an_existing_round
2025/05/31 16:02:10 Truncating tables: rounds
=== RUN   TestFinalizeRound/Attempt_to_finalize_a_non-existent_round
2025/05/31 16:02:10 Truncating tables: rounds
=== RUN   TestFinalizeRound/Finalization_with_nil_UUID_payload
2025/05/31 16:02:10 Truncating tables: rounds
=== RUN   TestFinalizeRound/Round_finalization_with_database_update_success_but_fetch_failure
2025/05/31 16:02:11 Truncating tables: rounds
--- PASS: TestFinalizeRound (0.87s)
    --- PASS: TestFinalizeRound/Successful_finalization_of_an_existing_round (0.16s)
    --- PASS: TestFinalizeRound/Attempt_to_finalize_a_non-existent_round (0.16s)
    --- PASS: TestFinalizeRound/Finalization_with_nil_UUID_payload (0.24s)
    --- PASS: TestFinalizeRound/Round_finalization_with_database_update_success_but_fetch_failure (0.31s)
=== RUN   TestNotifyScoreModule
=== RUN   TestNotifyScoreModule/Successful_notification_with_participants_having_scores_and_tag_numbers
2025/05/31 16:02:11 Truncating tables: rounds
=== RUN   TestNotifyScoreModule/Successful_notification_with_participants_having_nil_scores_and_tag_numbers
2025/05/31 16:02:11 Truncating tables: rounds
=== RUN   TestNotifyScoreModule/Successful_notification_with_empty_participants_list
2025/05/31 16:02:11 Truncating tables: rounds
=== RUN   TestNotifyScoreModule/Notification_with_mixed_participant_data
2025/05/31 16:02:12 Truncating tables: rounds
--- PASS: TestNotifyScoreModule (1.24s)
    --- PASS: TestNotifyScoreModule/Successful_notification_with_participants_having_scores_and_tag_numbers (0.24s)
    --- PASS: TestNotifyScoreModule/Successful_notification_with_participants_having_nil_scores_and_tag_numbers (0.20s)
    --- PASS: TestNotifyScoreModule/Successful_notification_with_empty_participants_list (0.45s)
    --- PASS: TestNotifyScoreModule/Notification_with_mixed_participant_data (0.34s)
=== RUN   TestParticipantRemoval
=== RUN   TestParticipantRemoval/Valid_removal_of_existing_participant_-_Expecting_ParticipantRemovedPayload
2025/05/31 16:02:12 Truncating tables: rounds
=== RUN   TestParticipantRemoval/Attempt_to_remove_non-existent_participant_-_Should_succeed_with_no_changes
2025/05/31 16:02:13 Truncating tables: rounds
=== RUN   TestParticipantRemoval/Remove_participant_from_round_with_multiple_participants_of_same_response_type
2025/05/31 16:02:13 Truncating tables: rounds
=== RUN   TestParticipantRemoval/Attempt_to_remove_participant_from_non-existent_round_-_Expecting_Error
2025/05/31 16:02:13 Truncating tables: rounds
=== RUN   TestParticipantRemoval/Remove_last_participant_from_round_-_Should_result_in_empty_lists
2025/05/31 16:02:13 Truncating tables: rounds
--- PASS: TestParticipantRemoval (1.49s)
    --- PASS: TestParticipantRemoval/Valid_removal_of_existing_participant_-_Expecting_ParticipantRemovedPayload (0.26s)
    --- PASS: TestParticipantRemoval/Attempt_to_remove_non-existent_participant_-_Should_succeed_with_no_changes (0.33s)
    --- PASS: TestParticipantRemoval/Remove_participant_from_round_with_multiple_participants_of_same_response_type (0.36s)
    --- PASS: TestParticipantRemoval/Attempt_to_remove_participant_from_non-existent_round_-_Expecting_Error (0.25s)
    --- PASS: TestParticipantRemoval/Remove_last_participant_from_round_-_Should_result_in_empty_lists (0.28s)
=== RUN   TestUpdateParticipantStatus
=== RUN   TestUpdateParticipantStatus/Internal_update:_Participant_status_and_tag_number_set_after_lookup
2025/05/31 16:02:14 Truncating tables: rounds
>>> Found existing participant existing_participant at index 0, updating...
>>> Updating response for user existing_participant: Old=TENTATIVE, New=ACCEPT
>>> Updating tag number for user existing_participant: Old=1, New=123
>>> After update: ParticipantsCount=1, Participants=[{existing_participant 123 ACCEPT 0xc000012d08}]
>>> Update successful. Final participants count: 1
=== RUN   TestUpdateParticipantStatus/Participant_accepts_without_TagNumber_(adds_participant_with_nil_tag)
2025/05/31 16:02:14 Truncating tables: rounds
>>> Adding new participant: UserID=participant_needs_tag, Response=ACCEPT, TagNumber=<nil>, Score=<nil>
>>> After update: ParticipantsCount=1, Participants=[{participant_needs_tag <nil> ACCEPT <nil>}]
>>> Update successful. Final participants count: 1
=== RUN   TestUpdateParticipantStatus/Participant_declines_(direct_update)
2025/05/31 16:02:14 Truncating tables: rounds
>>> Found existing participant participant_to_decline at index 0, updating...
>>> Updating response for user participant_to_decline: Old=ACCEPT, New=DECLINE
>>> Updating tag number for user participant_to_decline: Old=2, New=<nil>
>>> After update: ParticipantsCount=1, Participants=[{participant_to_decline <nil> DECLINE 0xc000828968}]
>>> Update successful. Final participants count: 1
=== RUN   TestUpdateParticipantStatus/Attempt_to_update_participant_in_non-existent_round_(with_tag)_-_Expecting_Error
2025/05/31 16:02:15 Truncating tables: rounds
=== RUN   TestUpdateParticipantStatus/Attempt_to_update_participant_in_non-existent_round_(decline)_-_Expecting_Error
2025/05/31 16:02:15 Truncating tables: rounds
=== RUN   TestUpdateParticipantStatus/Unknown_response_type_-_Expecting_Error
2025/05/31 16:02:15 Truncating tables: rounds
--- PASS: TestUpdateParticipantStatus (1.83s)
    --- PASS: TestUpdateParticipantStatus/Internal_update:_Participant_status_and_tag_number_set_after_lookup (0.26s)
    --- PASS: TestUpdateParticipantStatus/Participant_accepts_without_TagNumber_(adds_participant_with_nil_tag) (0.33s)
    --- PASS: TestUpdateParticipantStatus/Participant_declines_(direct_update) (0.30s)
    --- PASS: TestUpdateParticipantStatus/Attempt_to_update_participant_in_non-existent_round_(with_tag)_-_Expecting_Error (0.25s)
    --- PASS: TestUpdateParticipantStatus/Attempt_to_update_participant_in_non-existent_round_(decline)_-_Expecting_Error (0.33s)
    --- PASS: TestUpdateParticipantStatus/Unknown_response_type_-_Expecting_Error (0.35s)
=== RUN   TestCheckParticipantStatus
=== RUN   TestCheckParticipantStatus/User_not_a_participant,_requesting_Accept_-_Expecting_Validation_Request
2025/05/31 16:02:16 Truncating tables: rounds
=== RUN   TestCheckParticipantStatus/User_is_participant_with_Accept,_requesting_Accept_(toggle_off)_-_Expecting_Removal_Request
2025/05/31 16:02:16 Truncating tables: rounds
=== RUN   TestCheckParticipantStatus/User_is_participant_with_Tentative,_requesting_Accept_(change_status)_-_Expecting_Validation_Request
2025/05/31 16:02:16 Truncating tables: rounds
=== RUN   TestCheckParticipantStatus/Round_ID_is_nil_-_Expecting_Error
2025/05/31 16:02:17 Truncating tables: rounds
=== RUN   TestCheckParticipantStatus/Attempt_to_check_status_for_a_non-existent_round_-_Expecting_Error
2025/05/31 16:02:17 Truncating tables: rounds
--- PASS: TestCheckParticipantStatus (1.58s)
    --- PASS: TestCheckParticipantStatus/User_not_a_participant,_requesting_Accept_-_Expecting_Validation_Request (0.28s)
    --- PASS: TestCheckParticipantStatus/User_is_participant_with_Accept,_requesting_Accept_(toggle_off)_-_Expecting_Removal_Request (0.38s)
    --- PASS: TestCheckParticipantStatus/User_is_participant_with_Tentative,_requesting_Accept_(change_status)_-_Expecting_Validation_Request (0.28s)
    --- PASS: TestCheckParticipantStatus/Round_ID_is_nil_-_Expecting_Error (0.34s)
    --- PASS: TestCheckParticipantStatus/Attempt_to_check_status_for_a_non-existent_round_-_Expecting_Error (0.31s)
=== RUN   TestValidateParticipantJoinRequest
=== RUN   TestValidateParticipantJoinRequest/Valid_Accept_request,_round_Created_(not_late_join)_-_Expecting_TagLookupRequestPayload
2025/05/31 16:02:17 Truncating tables: rounds
=== RUN   TestValidateParticipantJoinRequest/Valid_Tentative_request,_round_InProgress_(late_join)_-_Expecting_TagLookupRequestPayload
2025/05/31 16:02:17 Truncating tables: rounds
=== RUN   TestValidateParticipantJoinRequest/Valid_Decline_request,_round_Finalized_(late_join)_-_Expecting_ParticipantJoinRequestPayload
2025/05/31 16:02:18 Truncating tables: rounds
=== RUN   TestValidateParticipantJoinRequest/Invalid:_Nil_Round_ID_-_Expecting_Error
2025/05/31 16:02:18 Truncating tables: rounds
=== RUN   TestValidateParticipantJoinRequest/Invalid:_Empty_User_ID_-_Expecting_Error
2025/05/31 16:02:18 Truncating tables: rounds
=== RUN   TestValidateParticipantJoinRequest/Attempt_to_validate_join_for_a_non-existent_round_-_Expecting_Error
2025/05/31 16:02:19 Truncating tables: rounds
=== RUN   TestValidateParticipantJoinRequest/Invalid:_Unexpected_response_type_-_Expecting_Error
2025/05/31 16:02:19 Truncating tables: rounds
--- PASS: TestValidateParticipantJoinRequest (2.07s)
    --- PASS: TestValidateParticipantJoinRequest/Valid_Accept_request,_round_Created_(not_late_join)_-_Expecting_TagLookupRequestPayload (0.31s)
    --- PASS: TestValidateParticipantJoinRequest/Valid_Tentative_request,_round_InProgress_(late_join)_-_Expecting_TagLookupRequestPayload (0.38s)
    --- PASS: TestValidateParticipantJoinRequest/Valid_Decline_request,_round_Finalized_(late_join)_-_Expecting_ParticipantJoinRequestPayload (0.28s)
    --- PASS: TestValidateParticipantJoinRequest/Invalid:_Nil_Round_ID_-_Expecting_Error (0.32s)
    --- PASS: TestValidateParticipantJoinRequest/Invalid:_Empty_User_ID_-_Expecting_Error (0.20s)
    --- PASS: TestValidateParticipantJoinRequest/Attempt_to_validate_join_for_a_non-existent_round_-_Expecting_Error (0.24s)
    --- PASS: TestValidateParticipantJoinRequest/Invalid:_Unexpected_response_type_-_Expecting_Error (0.33s)
=== RUN   TestUpdateScheduledRoundsWithNewTags
=== RUN   TestUpdateScheduledRoundsWithNewTags/Successful_update_of_scheduled_rounds_with_new_tags
2025/05/31 16:02:19 Truncating tables: rounds
=== RUN   TestUpdateScheduledRoundsWithNewTags/No_rounds_to_update_when_no_participants_match_changed_tags
2025/05/31 16:02:19 Truncating tables: rounds
=== RUN   TestUpdateScheduledRoundsWithNewTags/Update_with_empty_ChangedTags_map
2025/05/31 16:02:20 Truncating tables: rounds
=== RUN   TestUpdateScheduledRoundsWithNewTags/Update_with_nil_tag_values
2025/05/31 16:02:20 Truncating tables: rounds
--- PASS: TestUpdateScheduledRoundsWithNewTags (1.17s)
    --- PASS: TestUpdateScheduledRoundsWithNewTags/Successful_update_of_scheduled_rounds_with_new_tags (0.21s)
    --- PASS: TestUpdateScheduledRoundsWithNewTags/No_rounds_to_update_when_no_participants_match_changed_tags (0.27s)
    --- PASS: TestUpdateScheduledRoundsWithNewTags/Update_with_empty_ChangedTags_map (0.28s)
    --- PASS: TestUpdateScheduledRoundsWithNewTags/Update_with_nil_tag_values (0.40s)
=== RUN   TestGetRound
=== RUN   TestGetRound/Successful_retrieval_of_an_existing_round
2025/05/31 16:02:20 Truncating tables: rounds
=== RUN   TestGetRound/Retrieval_of_a_non-existent_round
2025/05/31 16:02:21 Truncating tables: rounds
--- PASS: TestGetRound (0.66s)
    --- PASS: TestGetRound/Successful_retrieval_of_an_existing_round (0.33s)
    --- PASS: TestGetRound/Retrieval_of_a_non-existent_round (0.33s)
=== RUN   TestProcessRoundReminder
=== RUN   TestProcessRoundReminder/Successful_processing_with_accepted_and_tentative_participants
2025/05/31 16:02:21 Truncating tables: rounds
=== RUN   TestProcessRoundReminder/Successful_processing_with_no_participants_to_notify
2025/05/31 16:02:21 Truncating tables: rounds
=== RUN   TestProcessRoundReminder/Error:_Round_not_found_in_DB
2025/05/31 16:02:22 Truncating tables: rounds
--- PASS: TestProcessRoundReminder (0.91s)
    --- PASS: TestProcessRoundReminder/Successful_processing_with_accepted_and_tentative_participants (0.36s)
    --- PASS: TestProcessRoundReminder/Successful_processing_with_no_participants_to_notify (0.25s)
    --- PASS: TestProcessRoundReminder/Error:_Round_not_found_in_DB (0.30s)
=== RUN   TestScheduleRoundEvents_Behavioral
=== RUN   TestScheduleRoundEvents_Behavioral/Round_scheduled_1_second_in_future_-_only_start_event_expected_(reminder_skipped)
2025/05/31 16:02:22 Truncating tables: rounds
    schedule_round_test.go:58: Start event received for RoundID: 90711b6f-584c-4650-8731-7b73dc346241
    schedule_round_test.go:92: Start event received as expected
    schedule_round_test.go:99: Reminder event NOT received as expected (correct behavior)
=== RUN   TestScheduleRoundEvents_Behavioral/Verify_delayed_messages_are_published_to_stream_with_correct_info
2025/05/31 16:02:24 Truncating tables: rounds
--- PASS: TestScheduleRoundEvents_Behavioral (2.55s)
    --- PASS: TestScheduleRoundEvents_Behavioral/Round_scheduled_1_second_in_future_-_only_start_event_expected_(reminder_skipped) (2.34s)
    --- PASS: TestScheduleRoundEvents_Behavioral/Verify_delayed_messages_are_published_to_stream_with_correct_info (0.21s)
=== RUN   TestValidateScoreUpdateRequest
=== RUN   TestValidateScoreUpdateRequest/Valid_score_update_request
2025/05/31 16:02:25 Truncating tables: rounds
=== RUN   TestValidateScoreUpdateRequest/Invalid_request_-_zero_round_ID
2025/05/31 16:02:25 Truncating tables: rounds
=== RUN   TestValidateScoreUpdateRequest/Invalid_request_-_empty_participant
2025/05/31 16:02:25 Truncating tables: rounds
=== RUN   TestValidateScoreUpdateRequest/Invalid_request_-_nil_score
2025/05/31 16:02:25 Truncating tables: rounds
=== RUN   TestValidateScoreUpdateRequest/Invalid_request_-_multiple_validation_errors
2025/05/31 16:02:25 Truncating tables: rounds
--- PASS: TestValidateScoreUpdateRequest (0.82s)
    --- PASS: TestValidateScoreUpdateRequest/Valid_score_update_request (0.15s)
    --- PASS: TestValidateScoreUpdateRequest/Invalid_request_-_zero_round_ID (0.16s)
    --- PASS: TestValidateScoreUpdateRequest/Invalid_request_-_empty_participant (0.18s)
    --- PASS: TestValidateScoreUpdateRequest/Invalid_request_-_nil_score (0.15s)
    --- PASS: TestValidateScoreUpdateRequest/Invalid_request_-_multiple_validation_errors (0.18s)
=== RUN   TestUpdateParticipantScore
=== RUN   TestUpdateParticipantScore/Successful_score_update
2025/05/31 16:02:25 Truncating tables: rounds
=== RUN   TestUpdateParticipantScore/Database_update_failure_(non-existent_round)
2025/05/31 16:02:26 Truncating tables: rounds
--- PASS: TestUpdateParticipantScore (0.39s)
    --- PASS: TestUpdateParticipantScore/Successful_score_update (0.20s)
    --- PASS: TestUpdateParticipantScore/Database_update_failure_(non-existent_round) (0.19s)
=== RUN   TestCheckAllScoresSubmitted
=== RUN   TestCheckAllScoresSubmitted/All_scores_submitted
2025/05/31 16:02:26 Truncating tables: rounds
=== RUN   TestCheckAllScoresSubmitted/Not_all_scores_submitted
2025/05/31 16:02:26 Truncating tables: rounds
=== RUN   TestCheckAllScoresSubmitted/Database_error_during_score_check_(non-existent_round)
2025/05/31 16:02:26 Truncating tables: rounds
--- PASS: TestCheckAllScoresSubmitted (0.75s)
    --- PASS: TestCheckAllScoresSubmitted/All_scores_submitted (0.24s)
    --- PASS: TestCheckAllScoresSubmitted/Not_all_scores_submitted (0.27s)
    --- PASS: TestCheckAllScoresSubmitted/Database_error_during_score_check_(non-existent_round) (0.24s)
=== RUN   TestProcessRoundStart
=== RUN   TestProcessRoundStart/Successful_round_start
2025/05/31 16:02:26 Truncating tables: rounds
=== RUN   TestProcessRoundStart/Round_not_found_in_DB
2025/05/31 16:02:27 Truncating tables: rounds
=== RUN   TestProcessRoundStart/Failed_to_update_round_state_in_DB
2025/05/31 16:02:27 Truncating tables: rounds
--- PASS: TestProcessRoundStart (0.68s)
    --- PASS: TestProcessRoundStart/Successful_round_start (0.26s)
    --- PASS: TestProcessRoundStart/Round_not_found_in_DB (0.22s)
    --- PASS: TestProcessRoundStart/Failed_to_update_round_state_in_DB (0.20s)
=== RUN   TestStoreRound
=== RUN   TestStoreRound/Successful_round_storage
2025/05/31 16:02:27 Truncating tables: rounds
=== RUN   TestStoreRound/Validation_failure_-_missing_title_in_payload
2025/05/31 16:02:27 Truncating tables: rounds
=== RUN   TestStoreRound/Validation_failure_-_nil_description_in_payload
2025/05/31 16:02:28 Truncating tables: rounds
=== RUN   TestStoreRound/Validation_failure_-_nil_location_in_payload
2025/05/31 16:02:28 Truncating tables: rounds
=== RUN   TestStoreRound/Validation_failure_-_nil_start_time_in_payload
2025/05/31 16:02:28 Truncating tables: rounds
--- PASS: TestStoreRound (1.06s)
    --- PASS: TestStoreRound/Successful_round_storage (0.27s)
    --- PASS: TestStoreRound/Validation_failure_-_missing_title_in_payload (0.19s)
    --- PASS: TestStoreRound/Validation_failure_-_nil_description_in_payload (0.23s)
    --- PASS: TestStoreRound/Validation_failure_-_nil_location_in_payload (0.18s)
    --- PASS: TestStoreRound/Validation_failure_-_nil_start_time_in_payload (0.19s)
=== RUN   TestUpdateRoundMessageID
=== RUN   TestUpdateRoundMessageID/Successful_update_of_Discord_message_ID_for_an_existing_round
2025/05/31 16:02:28 Truncating tables: rounds
=== RUN   TestUpdateRoundMessageID/Attempt_to_update_Discord_message_ID_for_a_non-existent_round
2025/05/31 16:02:29 Truncating tables: rounds
=== RUN   TestUpdateRoundMessageID/Update_Discord_message_ID_to_an_empty_string
2025/05/31 16:02:29 Truncating tables: rounds
--- PASS: TestUpdateRoundMessageID (0.80s)
    --- PASS: TestUpdateRoundMessageID/Successful_update_of_Discord_message_ID_for_an_existing_round (0.31s)
    --- PASS: TestUpdateRoundMessageID/Attempt_to_update_Discord_message_ID_for_a_non-existent_round (0.23s)
    --- PASS: TestUpdateRoundMessageID/Update_Discord_message_ID_to_an_empty_string (0.26s)
=== RUN   TestValidateRoundUpdateRequest
=== RUN   TestValidateRoundUpdateRequest/Valid_update_request_-_Title_only
2025/05/31 16:02:29 Truncating tables: rounds
=== RUN   TestValidateRoundUpdateRequest/Valid_update_request_-_All_fields_including_EventType
2025/05/31 16:02:29 Truncating tables: rounds
=== RUN   TestValidateRoundUpdateRequest/Invalid_update_request_-_Zero_RoundID
2025/05/31 16:02:30 Truncating tables: rounds
=== RUN   TestValidateRoundUpdateRequest/Invalid_update_request_-_No_fields_to_update
2025/05/31 16:02:30 Truncating tables: rounds
=== RUN   TestValidateRoundUpdateRequest/Invalid_update_request_-_Zero_RoundID_and_no_fields_to_update
2025/05/31 16:02:30 Truncating tables: rounds
--- PASS: TestValidateRoundUpdateRequest (1.25s)
    --- PASS: TestValidateRoundUpdateRequest/Valid_update_request_-_Title_only (0.24s)
    --- PASS: TestValidateRoundUpdateRequest/Valid_update_request_-_All_fields_including_EventType (0.34s)
    --- PASS: TestValidateRoundUpdateRequest/Invalid_update_request_-_Zero_RoundID (0.30s)
    --- PASS: TestValidateRoundUpdateRequest/Invalid_update_request_-_No_fields_to_update (0.19s)
    --- PASS: TestValidateRoundUpdateRequest/Invalid_update_request_-_Zero_RoundID_and_no_fields_to_update (0.18s)
=== RUN   TestUpdateRoundEntity
=== RUN   TestUpdateRoundEntity/Successful_update_of_title
2025/05/31 16:02:30 Truncating tables: rounds
=== RUN   TestUpdateRoundEntity/Successful_update_of_description,_location,_and_start_time
2025/05/31 16:02:31 Truncating tables: rounds
=== RUN   TestUpdateRoundEntity/Successful_update_of_EventType
2025/05/31 16:02:31 Truncating tables: rounds
=== RUN   TestUpdateRoundEntity/Failed_to_fetch_existing_round_(round_not_in_DB)
2025/05/31 16:02:31 Truncating tables: rounds
--- PASS: TestUpdateRoundEntity (0.93s)
    --- PASS: TestUpdateRoundEntity/Successful_update_of_title (0.27s)
    --- PASS: TestUpdateRoundEntity/Successful_update_of_description,_location,_and_start_time (0.22s)
    --- PASS: TestUpdateRoundEntity/Successful_update_of_EventType (0.24s)
    --- PASS: TestUpdateRoundEntity/Failed_to_fetch_existing_round_(round_not_in_DB) (0.19s)
=== RUN   TestUpdateScheduledRoundEvents
=== RUN   TestUpdateScheduledRoundEvents/Successful_update_of_scheduled_events
2025/05/31 16:02:31 Truncating tables: rounds
=== RUN   TestUpdateScheduledRoundEvents/Failed_to_fetch_round_for_rescheduling
2025/05/31 16:02:31 Truncating tables: rounds
--- PASS: TestUpdateScheduledRoundEvents (0.37s)
    --- PASS: TestUpdateScheduledRoundEvents/Successful_update_of_scheduled_events (0.19s)
    --- PASS: TestUpdateScheduledRoundEvents/Failed_to_fetch_round_for_rescheduling (0.18s)
=== RUN   TestValidateAndProcessRound
=== RUN   TestValidateAndProcessRound/Successful_round_creation
2025/05/31 16:02:32 Truncating tables: rounds
2025/05/31 16:02:32 INFO Timezone override user_timezone=America/Chicago
2025/05/31 16:02:32 INFO Parsed time using when parsed_time=2025-06-01T10:00:00-05:00
=== RUN   TestValidateAndProcessRound/Validation_failure_-_missing_title
2025/05/31 16:02:32 Truncating tables: rounds
=== RUN   TestValidateAndProcessRound/Validation_failure_-_start_time_in_past_(flaky_test)
2025/05/31 16:02:32 Truncating tables: rounds
2025/05/31 16:02:32 INFO Timezone override user_timezone=America/New_York
2025/05/31 16:02:32 INFO Parsed time using when parsed_time=2025-05-30T17:00:00-04:00
=== RUN   TestValidateAndProcessRound/Time_parsing_failure
2025/05/31 16:02:32 Truncating tables: rounds
2025/05/31 16:02:33 INFO Timezone override user_timezone=America/Los_Angeles
2025/05/31 16:02:33 WARN `when` failed to parse input, falling back to manual parsing input="not a real time string"
=== RUN   TestValidateAndProcessRound/Successful_creation_with_empty_description_and_location
2025/05/31 16:02:33 Truncating tables: rounds
=== RUN   TestValidateAndProcessRound/Successful_creation_with_optional_fields
2025/05/31 16:02:33 Truncating tables: rounds
2025/05/31 16:02:33 INFO Timezone override user_timezone=UTC
2025/05/31 16:02:33 INFO Parsed time using when parsed_time=2025-06-02T15:00:00Z
--- PASS: TestValidateAndProcessRound (1.57s)
    --- PASS: TestValidateAndProcessRound/Successful_round_creation (0.16s)
    --- PASS: TestValidateAndProcessRound/Validation_failure_-_missing_title (0.22s)
    --- PASS: TestValidateAndProcessRound/Validation_failure_-_start_time_in_past_(flaky_test) (0.33s)
    --- PASS: TestValidateAndProcessRound/Time_parsing_failure (0.26s)
    --- PASS: TestValidateAndProcessRound/Successful_creation_with_empty_description_and_location (0.31s)
    --- PASS: TestValidateAndProcessRound/Successful_creation_with_optional_fields (0.30s)
PASS
coverage: 58.6% of statements in ./app/...
ok  	github.com/Black-And-White-Club/frolf-bot/integration_tests/modules/round/application_tests	40.361s	coverage: 58.6% of statements in ./app/...
2025/05/31 16:01:54 TestMain started in package roundhandler_integration_tests
=== RUN   TestHandleRoundEntityCreated
=== RUN   TestHandleRoundEntityCreated/Success_-_Handler_Processes_Valid_Message_and_Publishes_Success_Event
2025/05/31 16:01:54 Starting PostgreSQL container with resource limits...
2025/05/31 16:01:55 github.com/testcontainers/testcontainers-go - Connected to docker: 
  Server Version: 28.1.1
  API Version: 1.48
  Operating System: Ubuntu 24.04.1 LTS
  Total Memory: 5923 MB
  Testcontainers for Go Version: v0.37.0
  Resolved Docker Host: unix:///Users/jace/.colima/default/docker.sock
  Resolved Docker Socket Path: /var/run/docker.sock
  Test SessionID: 9db56792615afb05e786a706eb0beac327e763183af153d41570e5011efcddd4
  Test ProcessID: 98621115-c74a-4885-bfe2-bbe4d1768177
2025/05/31 16:01:55 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:01:55 ⏳ Waiting for Reaper "069f6d02" to be ready
2025/05/31 16:01:55 🔥 Reaper obtained from Docker for this test session 069f6d02
2025/05/31 16:01:55 ✅ Container created: dfd3b555ec21
2025/05/31 16:01:55 🐳 Starting container: dfd3b555ec21
2025/05/31 16:01:56 ✅ Container started: dfd3b555ec21
2025/05/31 16:01:56 ⏳ Waiting for container id dfd3b555ec21 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000354c90 Strategies:[0xc0005b6f00]}
2025/05/31 16:02:02 🔔 Container is ready: dfd3b555ec21
2025/05/31 16:02:02 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40396/testdb?sslmode=disable
2025/05/31 16:02:02 Starting NATS container with resource limits...
2025/05/31 16:02:02 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:02:02 ✅ Container created: 0cac55c51da7
2025/05/31 16:02:02 🐳 Starting container: 0cac55c51da7
2025/05/31 16:02:04 ✅ Container started: 0cac55c51da7
2025/05/31 16:02:04 ⏳ Waiting for container id 0cac55c51da7 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000904cb0 Strategies:[0xc0000b7ec0 0xc000289da0]}
2025/05/31 16:02:06 🔔 Container is ready: 0cac55c51da7
2025/05/31 16:02:06 NATS container started with resource limits. URL: nats://localhost:40404
Creating round table...
Round table created successfully!
2025/05/31 16:02:06 Ran round migrations group #1
Creating score table...
Score table created successfully!
2025/05/31 16:02:06 Ran score migrations group #2
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:02:06 Ran leaderboard migrations group #3
Creating user table...
User table created successfully!
2025/05/31 16:02:06 Ran user migrations group #4
2025/05/31 16:02:06 All migrations ran successfully
2025/05/31 16:02:06 newDBServiceWithDB - Registering models
2025/05/31 16:02:06 newDBServiceWithDB - Models registered successfully
2025/05/31 16:02:06 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00059a218 RoundDB:0xc00059a250 ScoreDB:0xc00059a258 LeaderboardDB:0xc00059a260 db:0xc000386900}
2025/05/31 16:02:07 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:02:09 Starting lightweight round handler cleanup...
2025/05/31 16:02:09 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundEntityCreated/Success_-_Handler_Processes_Minimal_Valid_Message
2025/05/31 16:02:09 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:02:10 Starting lightweight round handler cleanup...
2025/05/31 16:02:10 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundEntityCreated/Success_-_Handler_Processes_Message_with_Complex_Participants
2025/05/31 16:02:10 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:02:12 Starting lightweight round handler cleanup...
2025/05/31 16:02:12 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundEntityCreated/Success_-_Handler_Processes_Different_Round_States
2025/05/31 16:02:12 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:02:14 Starting lightweight round handler cleanup...
2025/05/31 16:02:14 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundEntityCreated/Success_-_Handler_Processes_Multiple_Messages_Concurrently
2025/05/31 16:02:14 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:02:16 Starting lightweight round handler cleanup...
2025/05/31 16:02:16 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundEntityCreated/Failure_-_Handler_Rejects_Invalid_JSON_and_Doesn't_Publish_Events
2025/05/31 16:02:16 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:02:19 Starting lightweight round handler cleanup...
2025/05/31 16:02:19 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundEntityCreated/Success_-_Handler_Preserves_Message_Correlation_ID
2025/05/31 16:02:19 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:02:20 Starting lightweight round handler cleanup...
2025/05/31 16:02:20 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundEntityCreated/Success_-_Handler_Publishes_Correct_Event_Topic
2025/05/31 16:02:20 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:02:23 Starting lightweight round handler cleanup...
2025/05/31 16:02:23 Lightweight cleanup completed successfully
--- PASS: TestHandleRoundEntityCreated (28.66s)
    --- PASS: TestHandleRoundEntityCreated/Success_-_Handler_Processes_Valid_Message_and_Publishes_Success_Event (14.79s)
    --- PASS: TestHandleRoundEntityCreated/Success_-_Handler_Processes_Minimal_Valid_Message (1.14s)
    --- PASS: TestHandleRoundEntityCreated/Success_-_Handler_Processes_Message_with_Complex_Participants (1.94s)
    --- PASS: TestHandleRoundEntityCreated/Success_-_Handler_Processes_Different_Round_States (1.74s)
    --- PASS: TestHandleRoundEntityCreated/Success_-_Handler_Processes_Multiple_Messages_Concurrently (1.96s)
    --- PASS: TestHandleRoundEntityCreated/Failure_-_Handler_Rejects_Invalid_JSON_and_Doesn't_Publish_Events (2.68s)
    --- PASS: TestHandleRoundEntityCreated/Success_-_Handler_Preserves_Message_Correlation_ID (1.27s)
    --- PASS: TestHandleRoundEntityCreated/Success_-_Handler_Publishes_Correct_Event_Topic (3.15s)
=== RUN   TestHandleRoundEventMessageIDUpdate
=== RUN   TestHandleRoundEventMessageIDUpdate/Success_-_Update_Valid_Round_Message_ID
2025/05/31 16:02:23 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:02:24 Starting lightweight round handler cleanup...
2025/05/31 16:02:24 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundEventMessageIDUpdate/Success_-_Update_Round_Message_ID_with_Long_Discord_ID
2025/05/31 16:02:24 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:02:26 Starting lightweight round handler cleanup...
2025/05/31 16:02:26 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundEventMessageIDUpdate/Failure_-_Missing_Discord_Message_ID_in_Metadata
2025/05/31 16:02:26 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:02:29 Starting lightweight round handler cleanup...
2025/05/31 16:02:29 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundEventMessageIDUpdate/Failure_-_Empty_Discord_Message_ID_in_Metadata
2025/05/31 16:02:29 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:02:31 Starting lightweight round handler cleanup...
2025/05/31 16:02:32 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundEventMessageIDUpdate/Failure_-_Non-Existent_Round_ID
2025/05/31 16:02:32 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:02:34 Starting lightweight round handler cleanup...
2025/05/31 16:02:34 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundEventMessageIDUpdate/Failure_-_Invalid_JSON_Message
2025/05/31 16:02:34 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:02:37 Starting lightweight round handler cleanup...
2025/05/31 16:02:37 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundEventMessageIDUpdate/Success_-_Handler_Preserves_Message_Correlation_ID
2025/05/31 16:02:37 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:02:38 Starting lightweight round handler cleanup...
2025/05/31 16:02:38 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundEventMessageIDUpdate/Success_-_Multiple_Message_ID_Updates
2025/05/31 16:02:38 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:02:40 Starting lightweight round handler cleanup...
2025/05/31 16:02:40 Lightweight cleanup completed successfully
--- PASS: TestHandleRoundEventMessageIDUpdate (17.33s)
    --- PASS: TestHandleRoundEventMessageIDUpdate/Success_-_Update_Valid_Round_Message_ID (1.09s)
    --- PASS: TestHandleRoundEventMessageIDUpdate/Success_-_Update_Round_Message_ID_with_Long_Discord_ID (2.05s)
    --- PASS: TestHandleRoundEventMessageIDUpdate/Failure_-_Missing_Discord_Message_ID_in_Metadata (2.65s)
    --- PASS: TestHandleRoundEventMessageIDUpdate/Failure_-_Empty_Discord_Message_ID_in_Metadata (2.67s)
    --- PASS: TestHandleRoundEventMessageIDUpdate/Failure_-_Non-Existent_Round_ID (2.59s)
    --- PASS: TestHandleRoundEventMessageIDUpdate/Failure_-_Invalid_JSON_Message (2.60s)
    --- PASS: TestHandleRoundEventMessageIDUpdate/Success_-_Handler_Preserves_Message_Correlation_ID (1.09s)
    --- PASS: TestHandleRoundEventMessageIDUpdate/Success_-_Multiple_Message_ID_Updates (2.60s)
=== RUN   TestHandleCreateRoundRequest
=== RUN   TestHandleCreateRoundRequest/Success_-_Create_Valid_Round
2025/05/31 16:02:41 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:02:43 INFO Timezone override user_timezone=UTC
2025/05/31 16:02:43 INFO Parsed time using when parsed_time=2025-06-01T15:00:00Z
2025/05/31 16:02:43 Starting lightweight round handler cleanup...
2025/05/31 16:02:43 Lightweight cleanup completed successfully
=== RUN   TestHandleCreateRoundRequest/Success_-_Create_Round_with_Minimal_Information
2025/05/31 16:02:43 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:02:44 INFO Timezone override user_timezone=UTC
2025/05/31 16:02:44 INFO Parsed time using when parsed_time=2025-06-01T15:00:00Z
2025/05/31 16:02:44 Starting lightweight round handler cleanup...
2025/05/31 16:02:44 Lightweight cleanup completed successfully
=== RUN   TestHandleCreateRoundRequest/Failure_-_Empty_Description
2025/05/31 16:02:44 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:02:46 Starting lightweight round handler cleanup...
2025/05/31 16:02:46 Lightweight cleanup completed successfully
=== RUN   TestHandleCreateRoundRequest/Failure_-_Invalid_Time_Format
2025/05/31 16:02:46 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:02:49 INFO Timezone override user_timezone=UTC
2025/05/31 16:02:49 WARN `when` failed to parse input, falling back to manual parsing input=not-a-valid-time
2025/05/31 16:02:49 Starting lightweight round handler cleanup...
2025/05/31 16:02:49 Lightweight cleanup completed successfully
=== RUN   TestHandleCreateRoundRequest/Failure_-_Past_Start_Time
2025/05/31 16:02:49 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:02:51 INFO Timezone override user_timezone=UTC
2025/05/31 16:02:51 INFO Parsed time using when parsed_time=2025-05-30T15:00:00Z
2025/05/31 16:02:51 Starting lightweight round handler cleanup...
2025/05/31 16:02:51 Lightweight cleanup completed successfully
=== RUN   TestHandleCreateRoundRequest/Failure_-_Empty_Title
2025/05/31 16:02:52 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:02:52 Starting lightweight round handler cleanup...
2025/05/31 16:02:52 Lightweight cleanup completed successfully
=== RUN   TestHandleCreateRoundRequest/Failure_-_Empty_Location
2025/05/31 16:02:52 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:02:53 Starting lightweight round handler cleanup...
2025/05/31 16:02:53 Lightweight cleanup completed successfully
=== RUN   TestHandleCreateRoundRequest/Failure_-_Invalid_JSON_Message
2025/05/31 16:02:54 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:02:55 Starting lightweight round handler cleanup...
2025/05/31 16:02:55 Lightweight cleanup completed successfully
=== RUN   TestHandleCreateRoundRequest/Failure_-_Missing_Required_Fields
2025/05/31 16:02:55 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:02:57 Starting lightweight round handler cleanup...
2025/05/31 16:02:57 Lightweight cleanup completed successfully
--- PASS: TestHandleCreateRoundRequest (16.37s)
    --- PASS: TestHandleCreateRoundRequest/Success_-_Create_Valid_Round (2.29s)
    --- PASS: TestHandleCreateRoundRequest/Success_-_Create_Round_with_Minimal_Information (1.38s)
    --- PASS: TestHandleCreateRoundRequest/Failure_-_Empty_Description (1.72s)
    --- PASS: TestHandleCreateRoundRequest/Failure_-_Invalid_Time_Format (3.09s)
    --- PASS: TestHandleCreateRoundRequest/Failure_-_Past_Start_Time (2.53s)
    --- PASS: TestHandleCreateRoundRequest/Failure_-_Empty_Title (0.79s)
    --- PASS: TestHandleCreateRoundRequest/Failure_-_Empty_Location (1.23s)
    --- PASS: TestHandleCreateRoundRequest/Failure_-_Invalid_JSON_Message (1.48s)
    --- PASS: TestHandleCreateRoundRequest/Failure_-_Missing_Required_Fields (1.86s)
=== RUN   TestHandleRoundDeleteRequest
=== RUN   TestHandleRoundDeleteRequest/Success_-_Valid_Delete_Request
2025/05/31 16:02:57 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:02:59 Starting lightweight round handler cleanup...
2025/05/31 16:02:59 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundDeleteRequest/Failure_-_Nil_Round_ID
2025/05/31 16:02:59 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:03:00 Starting lightweight round handler cleanup...
2025/05/31 16:03:00 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundDeleteRequest/Failure_-_Non-Existent_Round_ID
2025/05/31 16:03:00 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:03:03 Starting lightweight round handler cleanup...
2025/05/31 16:03:03 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundDeleteRequest/Failure_-_Unauthorized_User
2025/05/31 16:03:03 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:03:04 Starting lightweight round handler cleanup...
2025/05/31 16:03:04 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundDeleteRequest/Failure_-_Invalid_JSON_Message
2025/05/31 16:03:04 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:03:05 Starting lightweight round handler cleanup...
2025/05/31 16:03:05 Lightweight cleanup completed successfully
--- PASS: TestHandleRoundDeleteRequest (7.95s)
    --- PASS: TestHandleRoundDeleteRequest/Success_-_Valid_Delete_Request (2.17s)
    --- PASS: TestHandleRoundDeleteRequest/Failure_-_Nil_Round_ID (1.04s)
    --- PASS: TestHandleRoundDeleteRequest/Failure_-_Non-Existent_Round_ID (2.74s)
    --- PASS: TestHandleRoundDeleteRequest/Failure_-_Unauthorized_User (1.00s)
    --- PASS: TestHandleRoundDeleteRequest/Failure_-_Invalid_JSON_Message (1.01s)
=== RUN   TestHandleRoundDeleteAuthorized
=== RUN   TestHandleRoundDeleteAuthorized/Success_-_Delete_Existing_Round
2025/05/31 16:03:05 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:03:05 INFO round deleted from DB
2025/05/31 16:03:06 Starting lightweight round handler cleanup...
2025/05/31 16:03:06 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundDeleteAuthorized/Failure_-_Non-Existent_Round_ID
2025/05/31 16:03:06 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:03:07 Starting lightweight round handler cleanup...
2025/05/31 16:03:07 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundDeleteAuthorized/Failure_-_Invalid_JSON_Message
2025/05/31 16:03:08 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:03:08 Starting lightweight round handler cleanup...
2025/05/31 16:03:08 Lightweight cleanup completed successfully
--- PASS: TestHandleRoundDeleteAuthorized (3.70s)
    --- PASS: TestHandleRoundDeleteAuthorized/Success_-_Delete_Existing_Round (0.99s)
    --- PASS: TestHandleRoundDeleteAuthorized/Failure_-_Non-Existent_Round_ID (1.71s)
    --- PASS: TestHandleRoundDeleteAuthorized/Failure_-_Invalid_JSON_Message (1.00s)
=== RUN   TestHandleAllScoresSubmitted
=== RUN   TestHandleAllScoresSubmitted/Success_-_Valid_All_Scores_Submitted
2025/05/31 16:03:09 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:03:10 Starting lightweight round handler cleanup...
2025/05/31 16:03:11 Lightweight cleanup completed successfully
=== RUN   TestHandleAllScoresSubmitted/Failure_-_Non-Existent_Round_ID
2025/05/31 16:03:11 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:03:11 Starting lightweight round handler cleanup...
2025/05/31 16:03:12 Lightweight cleanup completed successfully
=== RUN   TestHandleAllScoresSubmitted/Failure_-_Invalid_JSON_Message
2025/05/31 16:03:12 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:03:13 Starting lightweight round handler cleanup...
2025/05/31 16:03:13 Lightweight cleanup completed successfully
--- PASS: TestHandleAllScoresSubmitted (4.25s)
    --- PASS: TestHandleAllScoresSubmitted/Success_-_Valid_All_Scores_Submitted (2.10s)
    --- PASS: TestHandleAllScoresSubmitted/Failure_-_Non-Existent_Round_ID (1.01s)
    --- PASS: TestHandleAllScoresSubmitted/Failure_-_Invalid_JSON_Message (1.14s)
=== RUN   TestHandleRoundFinalized
=== RUN   TestHandleRoundFinalized/Success_-_Valid_Round_Finalized
2025/05/31 16:03:13 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:03:14 Starting lightweight round handler cleanup...
2025/05/31 16:03:14 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundFinalized/Failure_-_Non-Existent_Round_ID
2025/05/31 16:03:14 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:03:16 Starting lightweight round handler cleanup...
2025/05/31 16:03:16 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundFinalized/Failure_-_Invalid_JSON_Message
2025/05/31 16:03:16 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:03:17 Starting lightweight round handler cleanup...
2025/05/31 16:03:17 Lightweight cleanup completed successfully
--- PASS: TestHandleRoundFinalized (4.26s)
    --- PASS: TestHandleRoundFinalized/Success_-_Valid_Round_Finalized (1.07s)
    --- PASS: TestHandleRoundFinalized/Failure_-_Non-Existent_Round_ID (2.26s)
    --- PASS: TestHandleRoundFinalized/Failure_-_Invalid_JSON_Message (0.93s)
=== RUN   TestHandleParticipantJoinValidationRequest
=== RUN   TestHandleParticipantJoinValidationRequest/Success_-_Accept_Response_for_Scheduled_Round
2025/05/31 16:03:17 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:03:20 Starting lightweight round handler cleanup...
2025/05/31 16:03:20 Lightweight cleanup completed successfully
=== RUN   TestHandleParticipantJoinValidationRequest/Success_-_Accept_Response_for_InProgress_Round_(Late_Join)
2025/05/31 16:03:20 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:03:23 Starting lightweight round handler cleanup...
2025/05/31 16:03:23 Lightweight cleanup completed successfully
=== RUN   TestHandleParticipantJoinValidationRequest/Success_-_Decline_Response_for_Scheduled_Round
2025/05/31 16:03:24 Truncating tables: users, scores, leaderboards, rounds
>>> Adding new participant: UserID=484492868, Response=DECLINE, TagNumber=<nil>, Score=<nil>
>>> After update: ParticipantsCount=1, Participants=[{484492868 <nil> DECLINE <nil>}]
>>> Update successful. Final participants count: 1
2025/05/31 16:03:27 Starting lightweight round handler cleanup...
2025/05/31 16:03:27 Lightweight cleanup completed successfully
=== RUN   TestHandleParticipantJoinValidationRequest/Failure_-_Round_Not_Found
2025/05/31 16:03:27 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:03:29 Starting lightweight round handler cleanup...
2025/05/31 16:03:29 Lightweight cleanup completed successfully
=== RUN   TestHandleParticipantJoinValidationRequest/Failure_-_Empty_User_ID
2025/05/31 16:03:29 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:03:32 Starting lightweight round handler cleanup...
2025/05/31 16:03:32 Lightweight cleanup completed successfully
=== RUN   TestHandleParticipantJoinValidationRequest/Failure_-_Invalid_JSON_Message
2025/05/31 16:03:32 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:03:34 Starting lightweight round handler cleanup...
2025/05/31 16:03:34 Lightweight cleanup completed successfully
--- PASS: TestHandleParticipantJoinValidationRequest (17.21s)
    --- PASS: TestHandleParticipantJoinValidationRequest/Success_-_Accept_Response_for_Scheduled_Round (3.35s)
    --- PASS: TestHandleParticipantJoinValidationRequest/Success_-_Accept_Response_for_InProgress_Round_(Late_Join) (3.15s)
    --- PASS: TestHandleParticipantJoinValidationRequest/Success_-_Decline_Response_for_Scheduled_Round (3.36s)
    --- PASS: TestHandleParticipantJoinValidationRequest/Failure_-_Round_Not_Found (2.49s)
    --- PASS: TestHandleParticipantJoinValidationRequest/Failure_-_Empty_User_ID (2.41s)
    --- PASS: TestHandleParticipantJoinValidationRequest/Failure_-_Invalid_JSON_Message (2.44s)
=== RUN   TestHandleParticipantStatusUpdateRequest
=== RUN   TestHandleParticipantStatusUpdateRequest/Success_-_Accept_Response_with_Tag_Number
2025/05/31 16:03:34 Truncating tables: users, scores, leaderboards, rounds
>>> Adding new participant: UserID=133557373, Response=ACCEPT, TagNumber=42, Score=<nil>
>>> After update: ParticipantsCount=1, Participants=[{133557373 42 ACCEPT <nil>}]
>>> Update successful. Final participants count: 1
2025/05/31 16:03:37 Starting lightweight round handler cleanup...
2025/05/31 16:03:37 Lightweight cleanup completed successfully
=== RUN   TestHandleParticipantStatusUpdateRequest/Success_-_Decline_Response
2025/05/31 16:03:37 Truncating tables: users, scores, leaderboards, rounds
>>> Adding new participant: UserID=133557373, Response=DECLINE, TagNumber=<nil>, Score=<nil>
>>> After update: ParticipantsCount=1, Participants=[{133557373 <nil> DECLINE <nil>}]
>>> Update successful. Final participants count: 1
2025/05/31 16:03:40 Starting lightweight round handler cleanup...
2025/05/31 16:03:40 Lightweight cleanup completed successfully
=== RUN   TestHandleParticipantStatusUpdateRequest/Success_-_Tentative_Response_with_Late_Join
2025/05/31 16:03:40 Truncating tables: users, scores, leaderboards, rounds
>>> Adding new participant: UserID=133557373, Response=TENTATIVE, TagNumber=99, Score=<nil>
>>> After update: ParticipantsCount=1, Participants=[{133557373 99 TENTATIVE <nil>}]
>>> Update successful. Final participants count: 1
2025/05/31 16:03:43 Starting lightweight round handler cleanup...
2025/05/31 16:03:43 Lightweight cleanup completed successfully
=== RUN   TestHandleParticipantStatusUpdateRequest/Success_-_Accept_Response_without_Tag_Number
2025/05/31 16:03:43 Truncating tables: users, scores, leaderboards, rounds
>>> Adding new participant: UserID=133557373, Response=ACCEPT, TagNumber=<nil>, Score=<nil>
>>> After update: ParticipantsCount=1, Participants=[{133557373 <nil> ACCEPT <nil>}]
>>> Update successful. Final participants count: 1
2025/05/31 16:03:45 Starting lightweight round handler cleanup...
2025/05/31 16:03:45 Lightweight cleanup completed successfully
=== RUN   TestHandleParticipantStatusUpdateRequest/Failure_-_Round_Not_Found
2025/05/31 16:03:45 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:03:47 Starting lightweight round handler cleanup...
2025/05/31 16:03:47 Lightweight cleanup completed successfully
=== RUN   TestHandleParticipantStatusUpdateRequest/Failure_-_Invalid_JSON_Message
2025/05/31 16:03:47 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:03:49 Starting lightweight round handler cleanup...
2025/05/31 16:03:49 Lightweight cleanup completed successfully
--- PASS: TestHandleParticipantStatusUpdateRequest (15.09s)
    --- PASS: TestHandleParticipantStatusUpdateRequest/Success_-_Accept_Response_with_Tag_Number (2.69s)
    --- PASS: TestHandleParticipantStatusUpdateRequest/Success_-_Decline_Response (2.89s)
    --- PASS: TestHandleParticipantStatusUpdateRequest/Success_-_Tentative_Response_with_Late_Join (3.19s)
    --- PASS: TestHandleParticipantStatusUpdateRequest/Success_-_Accept_Response_without_Tag_Number (1.70s)
    --- PASS: TestHandleParticipantStatusUpdateRequest/Failure_-_Round_Not_Found (2.21s)
    --- PASS: TestHandleParticipantStatusUpdateRequest/Failure_-_Invalid_JSON_Message (2.42s)
=== RUN   TestHandleParticipantRemovalRequest
=== RUN   TestHandleParticipantRemovalRequest/Success_-_Remove_Existing_Accepted_Participant
2025/05/31 16:03:49 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:03:52 Starting lightweight round handler cleanup...
2025/05/31 16:03:52 Lightweight cleanup completed successfully
=== RUN   TestHandleParticipantRemovalRequest/Success_-_Remove_Existing_Tentative_Participant
2025/05/31 16:03:52 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:03:54 Starting lightweight round handler cleanup...
2025/05/31 16:03:55 Lightweight cleanup completed successfully
=== RUN   TestHandleParticipantRemovalRequest/Success_-_Remove_Existing_Declined_Participant
2025/05/31 16:03:55 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:03:57 Starting lightweight round handler cleanup...
2025/05/31 16:03:57 Lightweight cleanup completed successfully
=== RUN   TestHandleParticipantRemovalRequest/Failure_-_Round_Not_Found
2025/05/31 16:03:57 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:03:59 Starting lightweight round handler cleanup...
2025/05/31 16:03:59 Lightweight cleanup completed successfully
=== RUN   TestHandleParticipantRemovalRequest/Failure_-_Invalid_JSON_Message
2025/05/31 16:03:59 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:04:02 Starting lightweight round handler cleanup...
2025/05/31 16:04:02 Lightweight cleanup completed successfully
--- PASS: TestHandleParticipantRemovalRequest (12.50s)
    --- PASS: TestHandleParticipantRemovalRequest/Success_-_Remove_Existing_Accepted_Participant (2.84s)
    --- PASS: TestHandleParticipantRemovalRequest/Success_-_Remove_Existing_Tentative_Participant (2.43s)
    --- PASS: TestHandleParticipantRemovalRequest/Success_-_Remove_Existing_Declined_Participant (2.80s)
    --- PASS: TestHandleParticipantRemovalRequest/Failure_-_Round_Not_Found (2.00s)
    --- PASS: TestHandleParticipantRemovalRequest/Failure_-_Invalid_JSON_Message (2.43s)
=== RUN   TestHandleTagNumberFound
=== RUN   TestHandleTagNumberFound/Success_-_Accept_Response_with_Tag_Found
2025/05/31 16:04:02 Truncating tables: users, scores, leaderboards, rounds
>>> Adding new participant: UserID=244876961, Response=ACCEPT, TagNumber=42, Score=<nil>
>>> After update: ParticipantsCount=1, Participants=[{244876961 42 ACCEPT <nil>}]
>>> Update successful. Final participants count: 1
2025/05/31 16:04:04 Starting lightweight round handler cleanup...
2025/05/31 16:04:04 Lightweight cleanup completed successfully
=== RUN   TestHandleTagNumberFound/Success_-_Tentative_Response_with_Tag_Found
2025/05/31 16:04:04 Truncating tables: users, scores, leaderboards, rounds
>>> Adding new participant: UserID=244876961, Response=TENTATIVE, TagNumber=99, Score=<nil>
>>> After update: ParticipantsCount=1, Participants=[{244876961 99 TENTATIVE <nil>}]
>>> Update successful. Final participants count: 1
2025/05/31 16:04:06 Starting lightweight round handler cleanup...
2025/05/31 16:04:06 Lightweight cleanup completed successfully
=== RUN   TestHandleTagNumberFound/Success_-_Accept_Response_with_Late_Join
2025/05/31 16:04:07 Truncating tables: users, scores, leaderboards, rounds
>>> Adding new participant: UserID=244876961, Response=ACCEPT, TagNumber=77, Score=<nil>
>>> After update: ParticipantsCount=1, Participants=[{244876961 77 ACCEPT <nil>}]
>>> Update successful. Final participants count: 1
2025/05/31 16:04:10 Starting lightweight round handler cleanup...
2025/05/31 16:04:10 Lightweight cleanup completed successfully
=== RUN   TestHandleTagNumberFound/Failure_-_Round_Not_Found_(Tag_Found)
2025/05/31 16:04:10 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:04:12 Starting lightweight round handler cleanup...
2025/05/31 16:04:12 Lightweight cleanup completed successfully
--- PASS: TestHandleTagNumberFound (9.97s)
    --- PASS: TestHandleTagNumberFound/Success_-_Accept_Response_with_Tag_Found (1.87s)
    --- PASS: TestHandleTagNumberFound/Success_-_Tentative_Response_with_Tag_Found (2.81s)
    --- PASS: TestHandleTagNumberFound/Success_-_Accept_Response_with_Late_Join (3.31s)
    --- PASS: TestHandleTagNumberFound/Failure_-_Round_Not_Found_(Tag_Found) (1.99s)
=== RUN   TestHandleTagNumberNotFound
=== RUN   TestHandleTagNumberNotFound/Success_-_Accept_Response_with_No_Tag_(Still_Allows_Join)
2025/05/31 16:04:12 Truncating tables: users, scores, leaderboards, rounds
>>> Adding new participant: UserID=236727784, Response=ACCEPT, TagNumber=<nil>, Score=<nil>
>>> After update: ParticipantsCount=1, Participants=[{236727784 <nil> ACCEPT <nil>}]
>>> Update successful. Final participants count: 1
2025/05/31 16:04:14 Starting lightweight round handler cleanup...
2025/05/31 16:04:15 Lightweight cleanup completed successfully
=== RUN   TestHandleTagNumberNotFound/Success_-_Tentative_Response_with_No_Tag
2025/05/31 16:04:15 Truncating tables: users, scores, leaderboards, rounds
>>> Adding new participant: UserID=236727784, Response=TENTATIVE, TagNumber=<nil>, Score=<nil>
>>> After update: ParticipantsCount=1, Participants=[{236727784 <nil> TENTATIVE <nil>}]
>>> Update successful. Final participants count: 1
2025/05/31 16:04:17 Starting lightweight round handler cleanup...
2025/05/31 16:04:18 Lightweight cleanup completed successfully
=== RUN   TestHandleTagNumberNotFound/Success_-_Accept_Response_with_Late_Join_and_No_Tag
2025/05/31 16:04:18 Truncating tables: users, scores, leaderboards, rounds
>>> Adding new participant: UserID=236727784, Response=ACCEPT, TagNumber=<nil>, Score=<nil>
>>> After update: ParticipantsCount=1, Participants=[{236727784 <nil> ACCEPT <nil>}]
>>> Update successful. Final participants count: 1
2025/05/31 16:04:21 Starting lightweight round handler cleanup...
2025/05/31 16:04:21 Lightweight cleanup completed successfully
=== RUN   TestHandleTagNumberNotFound/Failure_-_Round_Not_Found_(Tag_Not_Found)
2025/05/31 16:04:21 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:04:23 Starting lightweight round handler cleanup...
2025/05/31 16:04:23 Lightweight cleanup completed successfully
--- PASS: TestHandleTagNumberNotFound (11.57s)
    --- PASS: TestHandleTagNumberNotFound/Success_-_Accept_Response_with_No_Tag_(Still_Allows_Join) (2.80s)
    --- PASS: TestHandleTagNumberNotFound/Success_-_Tentative_Response_with_No_Tag (3.00s)
    --- PASS: TestHandleTagNumberNotFound/Success_-_Accept_Response_with_Late_Join_and_No_Tag (3.34s)
    --- PASS: TestHandleTagNumberNotFound/Failure_-_Round_Not_Found_(Tag_Not_Found) (2.43s)
=== RUN   TestHandleTagLookupInvalidMessages
=== RUN   TestHandleTagLookupInvalidMessages/Invalid_JSON_-_Tag_Found_Handler
2025/05/31 16:04:23 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:04:26 Starting lightweight round handler cleanup...
2025/05/31 16:04:26 Lightweight cleanup completed successfully
=== RUN   TestHandleTagLookupInvalidMessages/Invalid_JSON_-_Tag_Not_Found_Handler
2025/05/31 16:04:26 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:04:28 Starting lightweight round handler cleanup...
2025/05/31 16:04:28 Lightweight cleanup completed successfully
--- PASS: TestHandleTagLookupInvalidMessages (4.84s)
    --- PASS: TestHandleTagLookupInvalidMessages/Invalid_JSON_-_Tag_Found_Handler (2.41s)
    --- PASS: TestHandleTagLookupInvalidMessages/Invalid_JSON_-_Tag_Not_Found_Handler (2.43s)
=== RUN   TestHandleParticipantDeclined
=== RUN   TestHandleParticipantDeclined/Success_-_Participant_Declined_(Upcoming_Round)
2025/05/31 16:04:28 Truncating tables: users, scores, leaderboards, rounds
>>> Adding new participant: UserID=498023289, Response=DECLINE, TagNumber=<nil>, Score=<nil>
>>> After update: ParticipantsCount=1, Participants=[{498023289 <nil> DECLINE <nil>}]
>>> Update successful. Final participants count: 1
2025/05/31 16:04:31 Starting lightweight round handler cleanup...
2025/05/31 16:04:31 Lightweight cleanup completed successfully
=== RUN   TestHandleParticipantDeclined/Success_-_Participant_Declined_(In_Progress_Round)
2025/05/31 16:04:31 Truncating tables: users, scores, leaderboards, rounds
>>> Adding new participant: UserID=498023289, Response=DECLINE, TagNumber=<nil>, Score=<nil>
>>> After update: ParticipantsCount=1, Participants=[{498023289 <nil> DECLINE <nil>}]
>>> Update successful. Final participants count: 1
2025/05/31 16:04:33 Starting lightweight round handler cleanup...
2025/05/31 16:04:33 Lightweight cleanup completed successfully
=== RUN   TestHandleParticipantDeclined/Failure_-_Round_Not_Found_(Participant_Declined)
2025/05/31 16:04:33 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:04:36 Starting lightweight round handler cleanup...
2025/05/31 16:04:36 Lightweight cleanup completed successfully
=== RUN   TestHandleParticipantDeclined/Invalid_JSON_-_Participant_Declined_Handler
2025/05/31 16:04:37 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:04:39 Starting lightweight round handler cleanup...
2025/05/31 16:04:39 Lightweight cleanup completed successfully
--- PASS: TestHandleParticipantDeclined (10.65s)
    --- PASS: TestHandleParticipantDeclined/Success_-_Participant_Declined_(Upcoming_Round) (3.18s)
    --- PASS: TestHandleParticipantDeclined/Success_-_Participant_Declined_(In_Progress_Round) (1.80s)
    --- PASS: TestHandleParticipantDeclined/Failure_-_Round_Not_Found_(Participant_Declined) (3.30s)
    --- PASS: TestHandleParticipantDeclined/Invalid_JSON_-_Participant_Declined_Handler (2.37s)
=== RUN   TestHandleParticipantJoinRequest
=== RUN   TestHandleParticipantJoinRequest/Success_-_New_Join_Request_(Accept)
2025/05/31 16:04:39 Truncating tables: users, scores, leaderboards, rounds
    participant_status_test.go:137: Starting test case: Success - New Join Request (Accept)
    participant_status_test.go:143: Waiting for message processing and capture...
    participant_status_test.go:152: Messages captured: validation=1, removal=0, error=0
2025/05/31 16:04:44 Starting lightweight round handler cleanup...
2025/05/31 16:04:44 Lightweight cleanup completed successfully
=== RUN   TestHandleParticipantJoinRequest/Success_-_New_Join_Request_(Tentative)
2025/05/31 16:04:44 Truncating tables: users, scores, leaderboards, rounds
    participant_status_test.go:137: Starting test case: Success - New Join Request (Tentative)
    participant_status_test.go:143: Waiting for message processing and capture...
    participant_status_test.go:152: Messages captured: validation=1, removal=0, error=0
2025/05/31 16:04:50 Starting lightweight round handler cleanup...
2025/05/31 16:04:50 Lightweight cleanup completed successfully
=== RUN   TestHandleParticipantJoinRequest/Success_-_New_Join_Request_(Decline)
2025/05/31 16:04:50 Truncating tables: users, scores, leaderboards, rounds
    participant_status_test.go:137: Starting test case: Success - New Join Request (Decline)
    participant_status_test.go:143: Waiting for message processing and capture...
>>> Adding new participant: UserID=983836335, Response=DECLINE, TagNumber=<nil>, Score=<nil>
>>> After update: ParticipantsCount=1, Participants=[{983836335 <nil> DECLINE <nil>}]
>>> Update successful. Final participants count: 1
    participant_status_test.go:152: Messages captured: validation=1, removal=0, error=0
2025/05/31 16:04:55 Starting lightweight round handler cleanup...
2025/05/31 16:04:55 Lightweight cleanup completed successfully
=== RUN   TestHandleParticipantJoinRequest/Success_-_Toggle_Removal_(Accept_to_Accept)
2025/05/31 16:04:55 Truncating tables: users, scores, leaderboards, rounds
    participant_status_test.go:137: Starting test case: Success - Toggle Removal (Accept to Accept)
    participant_status_test.go:143: Waiting for message processing and capture...
    participant_status_test.go:152: Messages captured: validation=0, removal=1, error=0
2025/05/31 16:05:00 Starting lightweight round handler cleanup...
2025/05/31 16:05:00 Lightweight cleanup completed successfully
=== RUN   TestHandleParticipantJoinRequest/Success_-_Toggle_Removal_(Decline_to_Decline)
2025/05/31 16:05:01 Truncating tables: users, scores, leaderboards, rounds
    participant_status_test.go:137: Starting test case: Success - Toggle Removal (Decline to Decline)
    participant_status_test.go:143: Waiting for message processing and capture...
    participant_status_test.go:152: Messages captured: validation=0, removal=1, error=0
2025/05/31 16:05:06 Starting lightweight round handler cleanup...
2025/05/31 16:05:06 Lightweight cleanup completed successfully
=== RUN   TestHandleParticipantJoinRequest/Success_-_Status_Change_(Accept_to_Decline)
2025/05/31 16:05:06 Truncating tables: users, scores, leaderboards, rounds
    participant_status_test.go:137: Starting test case: Success - Status Change (Accept to Decline)
    participant_status_test.go:143: Waiting for message processing and capture...
>>> Found existing participant 898404929 at index 0, updating...
>>> Updating response for user 898404929: Old=ACCEPT, New=DECLINE
>>> Updating tag number for user 898404929: Old=82, New=<nil>
>>> After update: ParticipantsCount=1, Participants=[{898404929 <nil> DECLINE <nil>}]
>>> Update successful. Final participants count: 1
    participant_status_test.go:152: Messages captured: validation=1, removal=0, error=0
2025/05/31 16:05:11 Starting lightweight round handler cleanup...
2025/05/31 16:05:11 Lightweight cleanup completed successfully
=== RUN   TestHandleParticipantJoinRequest/Success_-_Status_Change_(Decline_to_Accept)
2025/05/31 16:05:11 Truncating tables: users, scores, leaderboards, rounds
    participant_status_test.go:137: Starting test case: Success - Status Change (Decline to Accept)
    participant_status_test.go:143: Waiting for message processing and capture...
    participant_status_test.go:152: Messages captured: validation=1, removal=0, error=0
2025/05/31 16:05:17 Starting lightweight round handler cleanup...
2025/05/31 16:05:17 Lightweight cleanup completed successfully
=== RUN   TestHandleParticipantJoinRequest/Failure_-_Non-Existent_Round_ID
2025/05/31 16:05:17 Truncating tables: users, scores, leaderboards, rounds
    participant_status_test.go:137: Starting test case: Failure - Non-Existent Round ID
    participant_status_test.go:143: Waiting for message processing and capture...
    participant_status_test.go:152: Messages captured: validation=0, removal=0, error=1
2025/05/31 16:05:22 Starting lightweight round handler cleanup...
2025/05/31 16:05:22 Lightweight cleanup completed successfully
--- PASS: TestHandleParticipantJoinRequest (43.46s)
    --- PASS: TestHandleParticipantJoinRequest/Success_-_New_Join_Request_(Accept) (5.40s)
    --- PASS: TestHandleParticipantJoinRequest/Success_-_New_Join_Request_(Tentative) (5.36s)
    --- PASS: TestHandleParticipantJoinRequest/Success_-_New_Join_Request_(Decline) (5.46s)
    --- PASS: TestHandleParticipantJoinRequest/Success_-_Toggle_Removal_(Accept_to_Accept) (5.43s)
    --- PASS: TestHandleParticipantJoinRequest/Success_-_Toggle_Removal_(Decline_to_Decline) (5.37s)
    --- PASS: TestHandleParticipantJoinRequest/Success_-_Status_Change_(Accept_to_Decline) (5.40s)
    --- PASS: TestHandleParticipantJoinRequest/Success_-_Status_Change_(Decline_to_Accept) (5.52s)
    --- PASS: TestHandleParticipantJoinRequest/Failure_-_Non-Existent_Round_ID (5.52s)
=== RUN   TestHandleScheduledRoundTagUpdate
=== RUN   TestHandleScheduledRoundTagUpdate/Success_-_Tag_Update_for_Single_Round_with_Multiple_Participants
2025/05/31 16:05:22 Truncating tables: users, scores, leaderboards, rounds
    participant_tags_test.go:37: Created upcoming round 07091a4b-d720-4f45-bf52-d9f025377702 with participant 762159661 (tag: 10)
    participant_tags_test.go:38: Created upcoming round 1cfc22f0-0e4d-4b67-b47a-307b0d83493b with participant 405481500 (tag: 20)
    participant_tags_test.go:39: Created upcoming round 13c14325-9f88-436e-8b5b-e9082f48adf5 with participant 939877574 (tag: <nil>)
    participant_tags_test.go:42: Created rounds: 07091a4b-d720-4f45-bf52-d9f025377702, 1cfc22f0-0e4d-4b67-b47a-307b0d83493b, 13c14325-9f88-436e-8b5b-e9082f48adf5
    participant_tags_test.go:43: User1: 762159661 (tag 10), User2: 405481500 (tag 20), User3: 939877574 (no tag)
    participant_tags_test.go:55: Changing tags for: User1 762159661 -> 42, User2 405481500 -> 99
    participant_tags_test.go:278: Tag update success: 2 rounds, 2 participants
2025/05/31 16:05:24 Starting lightweight round handler cleanup...
2025/05/31 16:05:24 Lightweight cleanup completed successfully
=== RUN   TestHandleScheduledRoundTagUpdate/Success_-_Tag_Update_for_Multiple_Rounds_with_Same_Participant
2025/05/31 16:05:24 Truncating tables: users, scores, leaderboards, rounds
    participant_tags_test.go:278: Tag update success: 0 rounds, 0 participants
2025/05/31 16:05:26 Starting lightweight round handler cleanup...
2025/05/31 16:05:26 Lightweight cleanup completed successfully
=== RUN   TestHandleScheduledRoundTagUpdate/Success_-_Empty_Tag_Update_(No_Upcoming_Rounds_with_Matching_Participants)
2025/05/31 16:05:26 Truncating tables: users, scores, leaderboards, rounds
    participant_tags_test.go:278: Tag update success: 0 rounds, 0 participants
2025/05/31 16:05:29 Starting lightweight round handler cleanup...
2025/05/31 16:05:29 Lightweight cleanup completed successfully
=== RUN   TestHandleScheduledRoundTagUpdate/Success_-_Tag_Update_Only_Affects_Upcoming_Rounds
2025/05/31 16:05:29 Truncating tables: users, scores, leaderboards, rounds
    participant_tags_test.go:278: Tag update success: 0 rounds, 0 participants
2025/05/31 16:05:32 Starting lightweight round handler cleanup...
2025/05/31 16:05:32 Lightweight cleanup completed successfully
=== RUN   TestHandleScheduledRoundTagUpdate/Invalid_JSON_-_Scheduled_Round_Tag_Update_Handler
2025/05/31 16:05:32 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:05:35 Starting lightweight round handler cleanup...
2025/05/31 16:05:35 Lightweight cleanup completed successfully
--- PASS: TestHandleScheduledRoundTagUpdate (12.34s)
    --- PASS: TestHandleScheduledRoundTagUpdate/Success_-_Tag_Update_for_Single_Round_with_Multiple_Participants (1.96s)
    --- PASS: TestHandleScheduledRoundTagUpdate/Success_-_Tag_Update_for_Multiple_Rounds_with_Same_Participant (1.82s)
    --- PASS: TestHandleScheduledRoundTagUpdate/Success_-_Empty_Tag_Update_(No_Upcoming_Rounds_with_Matching_Participants) (2.68s)
    --- PASS: TestHandleScheduledRoundTagUpdate/Success_-_Tag_Update_Only_Affects_Upcoming_Rounds (3.42s)
    --- PASS: TestHandleScheduledRoundTagUpdate/Invalid_JSON_-_Scheduled_Round_Tag_Update_Handler (2.46s)
=== RUN   TestHandleRoundReminder
=== RUN   TestHandleRoundReminder/Success_-_Process_Round_Reminder_for_Upcoming_Round_with_Participants
2025/05/31 16:05:35 Truncating tables: users, scores, leaderboards, rounds
    round_reminder_test.go:33: Created upcoming round 543965e1-d2ae-4508-8914-8475a6f45d46 with participant 125954636 (tag: 1)
    round_reminder_test.go:237: Reminder processed successfully for round: 543965e1-d2ae-4508-8914-8475a6f45d46
2025/05/31 16:05:38 Starting lightweight round handler cleanup...
2025/05/31 16:05:38 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundReminder/Success_-_Process_Round_Reminder_with_No_Participants
2025/05/31 16:05:38 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:05:40 Starting lightweight round handler cleanup...
2025/05/31 16:05:40 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundReminder/Success_-_Process_Round_Reminder_with_Empty_User_List
2025/05/31 16:05:40 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:05:42 Starting lightweight round handler cleanup...
2025/05/31 16:05:42 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundReminder/Failure_-_Process_Reminder_for_Non-Existent_Round
2025/05/31 16:05:42 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:05:44 Starting lightweight round handler cleanup...
2025/05/31 16:05:44 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundReminder/Failure_-_Invalid_JSON_Message
2025/05/31 16:05:44 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:05:46 Starting lightweight round handler cleanup...
2025/05/31 16:05:46 Lightweight cleanup completed successfully
--- PASS: TestHandleRoundReminder (11.01s)
    --- PASS: TestHandleRoundReminder/Success_-_Process_Round_Reminder_for_Upcoming_Round_with_Participants (3.23s)
    --- PASS: TestHandleRoundReminder/Success_-_Process_Round_Reminder_with_No_Participants (1.92s)
    --- PASS: TestHandleRoundReminder/Success_-_Process_Round_Reminder_with_Empty_User_List (1.97s)
    --- PASS: TestHandleRoundReminder/Failure_-_Process_Reminder_for_Non-Existent_Round (1.92s)
    --- PASS: TestHandleRoundReminder/Failure_-_Invalid_JSON_Message (1.98s)
=== RUN   TestHandleGetRoundRequest
=== RUN   TestHandleGetRoundRequest/Success_-_Retrieve_Existing_Round
2025/05/31 16:05:46 Truncating tables: users, scores, leaderboards, rounds
    round_retrieval_test.go:269: Round retrieved successfully: 0ff1fb7f-02e1-4c85-a194-fcaf7f1d98a0
2025/05/31 16:05:48 Starting lightweight round handler cleanup...
2025/05/31 16:05:48 Lightweight cleanup completed successfully
=== RUN   TestHandleGetRoundRequest/Success_-_Retrieve_Round_with_Participants
2025/05/31 16:05:48 Truncating tables: users, scores, leaderboards, rounds
    round_retrieval_test.go:56: Created upcoming round 2b25f3f7-f756-4a91-a2d7-30aa4a4acca5 with participant 771804805 (tag: 1)
    round_retrieval_test.go:269: Round retrieved successfully: 2b25f3f7-f756-4a91-a2d7-30aa4a4acca5
2025/05/31 16:05:50 Starting lightweight round handler cleanup...
2025/05/31 16:05:50 Lightweight cleanup completed successfully
=== RUN   TestHandleGetRoundRequest/Success_-_Retrieve_In-Progress_Round
2025/05/31 16:05:51 Truncating tables: users, scores, leaderboards, rounds
    round_retrieval_test.go:269: Round retrieved successfully: 16b0ecae-6af9-41d2-b106-8165e3960b29
2025/05/31 16:05:52 Starting lightweight round handler cleanup...
2025/05/31 16:05:52 Lightweight cleanup completed successfully
=== RUN   TestHandleGetRoundRequest/Success_-_Retrieve_Completed_Round
2025/05/31 16:05:52 Truncating tables: users, scores, leaderboards, rounds
    round_retrieval_test.go:269: Round retrieved successfully: 8d62815a-5914-46b8-a538-d2ac472136c1
2025/05/31 16:05:55 Starting lightweight round handler cleanup...
2025/05/31 16:05:56 Lightweight cleanup completed successfully
=== RUN   TestHandleGetRoundRequest/Failure_-_Retrieve_Non-Existent_Round
2025/05/31 16:05:56 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:05:58 Starting lightweight round handler cleanup...
2025/05/31 16:05:58 Lightweight cleanup completed successfully
=== RUN   TestHandleGetRoundRequest/Failure_-_Invalid_JSON_Message
2025/05/31 16:05:59 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:06:00 Starting lightweight round handler cleanup...
2025/05/31 16:06:00 Lightweight cleanup completed successfully
--- PASS: TestHandleGetRoundRequest (14.73s)
    --- PASS: TestHandleGetRoundRequest/Success_-_Retrieve_Existing_Round (2.01s)
    --- PASS: TestHandleGetRoundRequest/Success_-_Retrieve_Round_with_Participants (2.82s)
    --- PASS: TestHandleGetRoundRequest/Success_-_Retrieve_In-Progress_Round (1.80s)
    --- PASS: TestHandleGetRoundRequest/Success_-_Retrieve_Completed_Round (3.27s)
    --- PASS: TestHandleGetRoundRequest/Failure_-_Retrieve_Non-Existent_Round (2.91s)
    --- PASS: TestHandleGetRoundRequest/Failure_-_Invalid_JSON_Message (1.92s)
=== RUN   TestHandleDiscordMessageIDUpdated
=== RUN   TestHandleDiscordMessageIDUpdated/Success_-_Schedule_Events_for_Future_Round
2025/05/31 16:06:00 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:06:02 Starting lightweight round handler cleanup...
2025/05/31 16:06:02 Lightweight cleanup completed successfully
=== RUN   TestHandleDiscordMessageIDUpdated/Success_-_Schedule_Events_for_Round_Less_Than_1_Hour_Away
2025/05/31 16:06:02 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:06:04 Starting lightweight round handler cleanup...
2025/05/31 16:06:04 Lightweight cleanup completed successfully
=== RUN   TestHandleDiscordMessageIDUpdated/Success_-_Schedule_Events_for_Round_Far_in_Future
2025/05/31 16:06:04 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:06:06 Starting lightweight round handler cleanup...
2025/05/31 16:06:06 Lightweight cleanup completed successfully
=== RUN   TestHandleDiscordMessageIDUpdated/Success_-_Handle_Round_with_Past_Start_Time
2025/05/31 16:06:06 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:06:08 Starting lightweight round handler cleanup...
2025/05/31 16:06:08 Lightweight cleanup completed successfully
=== RUN   TestHandleDiscordMessageIDUpdated/Failure_-_Invalid_JSON_Message
2025/05/31 16:06:08 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:06:10 Starting lightweight round handler cleanup...
2025/05/31 16:06:10 Lightweight cleanup completed successfully
--- PASS: TestHandleDiscordMessageIDUpdated (9.80s)
    --- PASS: TestHandleDiscordMessageIDUpdated/Success_-_Schedule_Events_for_Future_Round (1.98s)
    --- PASS: TestHandleDiscordMessageIDUpdated/Success_-_Schedule_Events_for_Round_Less_Than_1_Hour_Away (1.92s)
    --- PASS: TestHandleDiscordMessageIDUpdated/Success_-_Schedule_Events_for_Round_Far_in_Future (1.99s)
    --- PASS: TestHandleDiscordMessageIDUpdated/Success_-_Handle_Round_with_Past_Start_Time (1.98s)
    --- PASS: TestHandleDiscordMessageIDUpdated/Failure_-_Invalid_JSON_Message (1.93s)
=== RUN   TestHandleScoreUpdateValidated
=== RUN   TestHandleScoreUpdateValidated/Success_-_Update_Participant_Score_(Single_Participant)
2025/05/31 16:06:10 Truncating tables: users, scores, leaderboards, rounds
    score_round2_test.go:35: Created round 5870bcd0-7b60-4dcb-abda-306d8ca10f24 with 1 participants
    score_round2_test.go:330: Participant score updated successfully for round: 5870bcd0-7b60-4dcb-abda-306d8ca10f24, participant: 928487083, score: -1 under par, participants: 1
2025/05/31 16:06:12 Starting lightweight round handler cleanup...
2025/05/31 16:06:12 Lightweight cleanup completed successfully
=== RUN   TestHandleScoreUpdateValidated/Success_-_Update_Participant_Score_(Multiple_Participants)
2025/05/31 16:06:13 Truncating tables: users, scores, leaderboards, rounds
    score_round2_test.go:70: Created round 0fa4778b-ea73-4d84-8db5-57fc5d699c19 with 3 participants
    score_round2_test.go:330: Participant score updated successfully for round: 0fa4778b-ea73-4d84-8db5-57fc5d699c19, participant: 928487083, score: +3 over par, participants: 3
2025/05/31 16:06:14 Starting lightweight round handler cleanup...
2025/05/31 16:06:14 Lightweight cleanup completed successfully
=== RUN   TestHandleScoreUpdateValidated/Success_-_Update_Score_for_Participant_with_Existing_Score
2025/05/31 16:06:14 Truncating tables: users, scores, leaderboards, rounds
    score_round2_test.go:117: Created round d4ecbc1a-a00f-4bed-8020-e49ba8f63204 with 1 participants
    score_round2_test.go:330: Participant score updated successfully for round: d4ecbc1a-a00f-4bed-8020-e49ba8f63204, participant: 928487083, score: -2 under par, participants: 1
2025/05/31 16:06:17 Starting lightweight round handler cleanup...
2025/05/31 16:06:17 Lightweight cleanup completed successfully
=== RUN   TestHandleScoreUpdateValidated/Failure_-_Round_Not_Found
2025/05/31 16:06:17 Truncating tables: users, scores, leaderboards, rounds
    score_round2_test.go:343: Score update validation failed with error: Failed to update score in database: failed to fetch round: sql: no rows in result set
2025/05/31 16:06:18 Starting lightweight round handler cleanup...
2025/05/31 16:06:19 Lightweight cleanup completed successfully
=== RUN   TestHandleScoreUpdateValidated/Failure_-_Participant_Not_Found_in_Round
2025/05/31 16:06:19 Truncating tables: users, scores, leaderboards, rounds
    score_round2_test.go:154: Created round 9519b190-e2b7-4831-9718-ceace0450523 with 1 participants
    score_round2_test.go:343: Score update validation failed with error: Failed to update score in database: participant not found in round
2025/05/31 16:06:21 Starting lightweight round handler cleanup...
2025/05/31 16:06:22 Lightweight cleanup completed successfully
=== RUN   TestHandleScoreUpdateValidated/Failure_-_Invalid_JSON_Message
2025/05/31 16:06:22 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:06:23 Starting lightweight round handler cleanup...
2025/05/31 16:06:23 Lightweight cleanup completed successfully
--- PASS: TestHandleScoreUpdateValidated (13.28s)
    --- PASS: TestHandleScoreUpdateValidated/Success_-_Update_Participant_Score_(Single_Participant) (2.29s)
    --- PASS: TestHandleScoreUpdateValidated/Success_-_Update_Participant_Score_(Multiple_Participants) (1.89s)
    --- PASS: TestHandleScoreUpdateValidated/Success_-_Update_Score_for_Participant_with_Existing_Score (2.62s)
    --- PASS: TestHandleScoreUpdateValidated/Failure_-_Round_Not_Found (1.59s)
    --- PASS: TestHandleScoreUpdateValidated/Failure_-_Participant_Not_Found_in_Round (2.98s)
    --- PASS: TestHandleScoreUpdateValidated/Failure_-_Invalid_JSON_Message (1.90s)
=== RUN   TestHandleParticipantScoreUpdated
=== RUN   TestHandleParticipantScoreUpdated/Success_-_All_Scores_Submitted_(Single_Participant)
2025/05/31 16:06:24 Truncating tables: users, scores, leaderboards, rounds
    score_round3_test.go:37: Created round 54e9eca2-f213-4617-bc93-d62f53e49671 with 1 participants
    score_round3_test.go:433: All scores submitted for round: 54e9eca2-f213-4617-bc93-d62f53e49671, participants: 1
2025/05/31 16:06:26 Starting lightweight round handler cleanup...
2025/05/31 16:06:26 Lightweight cleanup completed successfully
=== RUN   TestHandleParticipantScoreUpdated/Success_-_All_Scores_Submitted_(Multiple_Participants)
2025/05/31 16:06:26 Truncating tables: users, scores, leaderboards, rounds
    score_round3_test.go:67: Created round 2e390cf8-8d10-4b76-84e9-6de62bb6c65e with 3 participants
    score_round3_test.go:433: All scores submitted for round: 2e390cf8-8d10-4b76-84e9-6de62bb6c65e, participants: 3
2025/05/31 16:06:30 Starting lightweight round handler cleanup...
2025/05/31 16:06:30 Lightweight cleanup completed successfully
=== RUN   TestHandleParticipantScoreUpdated/Success_-_Not_All_Scores_Submitted_(Single_Participant_Without_Score)
2025/05/31 16:06:30 Truncating tables: users, scores, leaderboards, rounds
    score_round3_test.go:103: Created round 63eb5cbe-8d7a-4e42-bfd2-0005c7b13a4d with 2 participants
    score_round3_test.go:446: Not all scores submitted for round: 63eb5cbe-8d7a-4e42-bfd2-0005c7b13a4d, updated participant: 511010263, score: +2 over par, total participants: 2
2025/05/31 16:06:32 Starting lightweight round handler cleanup...
2025/05/31 16:06:32 Lightweight cleanup completed successfully
=== RUN   TestHandleParticipantScoreUpdated/Success_-_Not_All_Scores_Submitted_(Multiple_Missing_Scores)
2025/05/31 16:06:32 Truncating tables: users, scores, leaderboards, rounds
    score_round3_test.go:136: Created round adf32833-f3bb-4ae2-9a55-88efb1aaaddb with 4 participants
    score_round3_test.go:446: Not all scores submitted for round: adf32833-f3bb-4ae2-9a55-88efb1aaaddb, updated participant: 511010263, score: -1 under par, total participants: 4
2025/05/31 16:06:35 Starting lightweight round handler cleanup...
2025/05/31 16:06:36 Lightweight cleanup completed successfully
=== RUN   TestHandleParticipantScoreUpdated/Success_-_Last_Score_Submitted_Triggers_All_Scores_Submitted
2025/05/31 16:06:36 Truncating tables: users, scores, leaderboards, rounds
    score_round3_test.go:180: Created round e1285a00-0433-4e21-ab30-7f6987b7e3e5 with 3 participants
    score_round3_test.go:433: All scores submitted for round: e1285a00-0433-4e21-ab30-7f6987b7e3e5, participants: 3
2025/05/31 16:06:39 Starting lightweight round handler cleanup...
2025/05/31 16:06:39 Lightweight cleanup completed successfully
=== RUN   TestHandleParticipantScoreUpdated/Failure_-_Round_Not_Found
2025/05/31 16:06:39 Truncating tables: users, scores, leaderboards, rounds
    score_round3_test.go:459: Score check failed with error: round with ID c91ad370-f8f6-4963-8c8a-c2728379434e not found
2025/05/31 16:06:41 Starting lightweight round handler cleanup...
2025/05/31 16:06:41 Lightweight cleanup completed successfully
=== RUN   TestHandleParticipantScoreUpdated/Failure_-_Invalid_JSON_Message
2025/05/31 16:06:41 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:06:43 Starting lightweight round handler cleanup...
2025/05/31 16:06:43 Lightweight cleanup completed successfully
--- PASS: TestHandleParticipantScoreUpdated (19.30s)
    --- PASS: TestHandleParticipantScoreUpdated/Success_-_All_Scores_Submitted_(Single_Participant) (2.40s)
    --- PASS: TestHandleParticipantScoreUpdated/Success_-_All_Scores_Submitted_(Multiple_Participants) (4.01s)
    --- PASS: TestHandleParticipantScoreUpdated/Success_-_Not_All_Scores_Submitted_(Single_Participant_Without_Score) (2.42s)
    --- PASS: TestHandleParticipantScoreUpdated/Success_-_Not_All_Scores_Submitted_(Multiple_Missing_Scores) (3.27s)
    --- PASS: TestHandleParticipantScoreUpdated/Success_-_Last_Score_Submitted_Triggers_All_Scores_Submitted (3.52s)
    --- PASS: TestHandleParticipantScoreUpdated/Failure_-_Round_Not_Found (1.70s)
    --- PASS: TestHandleParticipantScoreUpdated/Failure_-_Invalid_JSON_Message (1.98s)
=== RUN   TestHandleScoreUpdateRequest
=== RUN   TestHandleScoreUpdateRequest/Success_-_Valid_Score_Update_Request_(Under_Par)
2025/05/31 16:06:43 Truncating tables: users, scores, leaderboards, rounds
    score_round_test.go:304: Score update validated successfully for round: 0e7faea3-9810-44de-bc11-1f19476f1fc8, participant: 442104741, score: -2 under par
2025/05/31 16:06:46 Starting lightweight round handler cleanup...
2025/05/31 16:06:46 Lightweight cleanup timeout - forcing exit (this is OK for tests)
=== RUN   TestHandleScoreUpdateRequest/Success_-_Valid_Score_Update_Request_(Over_Par)
2025/05/31 16:06:46 Truncating tables: users, scores, leaderboards, rounds
    score_round_test.go:304: Score update validated successfully for round: 0b772708-971a-4c6f-9931-dbdb119a2dfe, participant: 362424585, score: +5 over par
2025/05/31 16:06:50 Starting lightweight round handler cleanup...
2025/05/31 16:06:50 Lightweight cleanup completed successfully
=== RUN   TestHandleScoreUpdateRequest/Success_-_Valid_Score_Update_Request_(Even_Par)
2025/05/31 16:06:50 Truncating tables: users, scores, leaderboards, rounds
    score_round_test.go:304: Score update validated successfully for round: 80aad61a-a783-4e39-a168-6383c3721327, participant: 442104741, score: even par
2025/05/31 16:06:53 Starting lightweight round handler cleanup...
2025/05/31 16:06:53 Lightweight cleanup completed successfully
=== RUN   TestHandleScoreUpdateRequest/Failure_-_Empty_Round_ID
2025/05/31 16:06:53 Truncating tables: users, scores, leaderboards, rounds
    score_round_test.go:317: Score update validation failed with error: validation errors: round ID cannot be zero
2025/05/31 16:06:55 Starting lightweight round handler cleanup...
2025/05/31 16:06:55 Lightweight cleanup completed successfully
=== RUN   TestHandleScoreUpdateRequest/Failure_-_Empty_Participant_ID
2025/05/31 16:06:55 Truncating tables: users, scores, leaderboards, rounds
    score_round_test.go:317: Score update validation failed with error: validation errors: participant Discord ID cannot be empty
2025/05/31 16:06:57 Starting lightweight round handler cleanup...
2025/05/31 16:06:57 Lightweight cleanup completed successfully
=== RUN   TestHandleScoreUpdateRequest/Failure_-_Nil_Score
2025/05/31 16:06:57 Truncating tables: users, scores, leaderboards, rounds
    score_round_test.go:317: Score update validation failed with error: validation errors: score cannot be empty
2025/05/31 16:07:00 Starting lightweight round handler cleanup...
2025/05/31 16:07:00 Lightweight cleanup completed successfully
=== RUN   TestHandleScoreUpdateRequest/Failure_-_Multiple_Validation_Errors
2025/05/31 16:07:00 Truncating tables: users, scores, leaderboards, rounds
    score_round_test.go:317: Score update validation failed with error: validation errors: round ID cannot be zero; participant Discord ID cannot be empty; score cannot be empty
2025/05/31 16:07:03 Starting lightweight round handler cleanup...
2025/05/31 16:07:03 Lightweight cleanup completed successfully
=== RUN   TestHandleScoreUpdateRequest/Failure_-_Invalid_JSON_Message
2025/05/31 16:07:03 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:07:05 Starting lightweight round handler cleanup...
2025/05/31 16:07:05 Lightweight cleanup completed successfully
--- PASS: TestHandleScoreUpdateRequest (22.41s)
    --- PASS: TestHandleScoreUpdateRequest/Success_-_Valid_Score_Update_Request_(Under_Par) (3.49s)
    --- PASS: TestHandleScoreUpdateRequest/Success_-_Valid_Score_Update_Request_(Over_Par) (3.90s)
    --- PASS: TestHandleScoreUpdateRequest/Success_-_Valid_Score_Update_Request_(Even_Par) (3.21s)
    --- PASS: TestHandleScoreUpdateRequest/Failure_-_Empty_Round_ID (2.01s)
    --- PASS: TestHandleScoreUpdateRequest/Failure_-_Empty_Participant_ID (1.99s)
    --- PASS: TestHandleScoreUpdateRequest/Failure_-_Nil_Score (2.30s)
    --- PASS: TestHandleScoreUpdateRequest/Failure_-_Multiple_Validation_Errors (3.60s)
    --- PASS: TestHandleScoreUpdateRequest/Failure_-_Invalid_JSON_Message (1.91s)
=== RUN   TestHandleRoundStarted
=== RUN   TestHandleRoundStarted/Success_-_Start_Round_with_Single_Participant
2025/05/31 16:07:05 Truncating tables: users, scores, leaderboards, rounds
    start_round_test.go:34: Created round 6819ccdf-a282-4c07-99ef-1bd3e930635a with 1 participants
    start_round_test.go:360: Round started successfully: 6819ccdf-a282-4c07-99ef-1bd3e930635a ('Test Round'), participants: 1
2025/05/31 16:07:08 Starting lightweight round handler cleanup...
2025/05/31 16:07:08 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundStarted/Success_-_Start_Round_with_Multiple_Participants
2025/05/31 16:07:08 Truncating tables: users, scores, leaderboards, rounds
    start_round_test.go:71: Created round f2b273c4-74cc-42e2-94a8-f9b28075810a with 3 participants
    start_round_test.go:360: Round started successfully: f2b273c4-74cc-42e2-94a8-f9b28075810a ('Multi-Player Round'), participants: 3
2025/05/31 16:07:11 Starting lightweight round handler cleanup...
2025/05/31 16:07:11 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundStarted/Success_-_Start_Round_with_No_Participants
2025/05/31 16:07:11 Truncating tables: users, scores, leaderboards, rounds
    start_round_test.go:139: Created round 5b3e8db1-ed64-4164-b79b-b786fa744ecd with 0 participants
    start_round_test.go:360: Round started successfully: 5b3e8db1-ed64-4164-b79b-b786fa744ecd ('Solo Round'), participants: 0
2025/05/31 16:07:13 Starting lightweight round handler cleanup...
2025/05/31 16:07:13 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundStarted/Success_-_Start_Round_with_Participant_Tag_Numbers
2025/05/31 16:07:13 Truncating tables: users, scores, leaderboards, rounds
    start_round_test.go:161: Created round 945c4a6a-233b-45ad-a78b-ca712da268e9 with 2 participants
    start_round_test.go:360: Round started successfully: 945c4a6a-233b-45ad-a78b-ca712da268e9 ('Tagged Round'), participants: 2
2025/05/31 16:07:15 Starting lightweight round handler cleanup...
2025/05/31 16:07:15 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundStarted/Failure_-_Round_Not_Found
2025/05/31 16:07:15 Truncating tables: users, scores, leaderboards, rounds
    start_round_test.go:373: Round start failed with error: round with ID 01a3cfb2-100a-43b1-9d7b-cb0fa15ca240 not found
2025/05/31 16:07:17 Starting lightweight round handler cleanup...
2025/05/31 16:07:17 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundStarted/Failure_-_Invalid_JSON_Message
2025/05/31 16:07:17 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:07:19 Starting lightweight round handler cleanup...
2025/05/31 16:07:19 Lightweight cleanup completed successfully
--- PASS: TestHandleRoundStarted (13.60s)
    --- PASS: TestHandleRoundStarted/Success_-_Start_Round_with_Single_Participant (2.78s)
    --- PASS: TestHandleRoundStarted/Success_-_Start_Round_with_Multiple_Participants (2.73s)
    --- PASS: TestHandleRoundStarted/Success_-_Start_Round_with_No_Participants (2.58s)
    --- PASS: TestHandleRoundStarted/Success_-_Start_Round_with_Participant_Tag_Numbers (1.89s)
    --- PASS: TestHandleRoundStarted/Failure_-_Round_Not_Found (1.72s)
    --- PASS: TestHandleRoundStarted/Failure_-_Invalid_JSON_Message (1.90s)
=== RUN   TestHandleRoundUpdateValidated
=== RUN   TestHandleRoundUpdateValidated/Success_-_Update_Title_Only
2025/05/31 16:07:19 Truncating tables: users, scores, leaderboards, rounds
    update_round2_test.go:32: Created round 54e48f13-2204-4ab7-9508-72a5da912dca with 1 participants
    update_round2_test.go:418: Round entity updated successfully: 54e48f13-2204-4ab7-9508-72a5da912dca ('Updated Round Title')
2025/05/31 16:07:23 Starting lightweight round handler cleanup...
2025/05/31 16:07:23 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundUpdateValidated/Success_-_Update_Description_Only
2025/05/31 16:07:23 Truncating tables: users, scores, leaderboards, rounds
    update_round2_test.go:67: Created round 50c50a5e-a663-48df-a897-78153e71456c with 0 participants
    update_round2_test.go:418: Round entity updated successfully: 50c50a5e-a663-48df-a897-78153e71456c ('Open addition.')
2025/05/31 16:07:26 Starting lightweight round handler cleanup...
2025/05/31 16:07:26 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundUpdateValidated/Success_-_Update_Location_Only
2025/05/31 16:07:26 Truncating tables: users, scores, leaderboards, rounds
    update_round2_test.go:93: Created round 95940a3c-bb1d-4e8a-9f14-c81b7eeb432a with 0 participants
    update_round2_test.go:418: Round entity updated successfully: 95940a3c-bb1d-4e8a-9f14-c81b7eeb432a ('Including week yourselves smell politely.')
2025/05/31 16:07:28 Starting lightweight round handler cleanup...
2025/05/31 16:07:29 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundUpdateValidated/Success_-_Update_Start_Time_Only
2025/05/31 16:07:29 Truncating tables: users, scores, leaderboards, rounds
    update_round2_test.go:110: Created round 559a58ce-8376-445b-91f8-efd98fb772c6 with 0 participants
    update_round2_test.go:418: Round entity updated successfully: 559a58ce-8376-445b-91f8-efd98fb772c6 ('Cheese his.')
2025/05/31 16:07:33 Starting lightweight round handler cleanup...
2025/05/31 16:07:33 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundUpdateValidated/Success_-_Update_Event_Type_Only
2025/05/31 16:07:33 Truncating tables: users, scores, leaderboards, rounds
    update_round2_test.go:132: Created round f104a265-c254-4ec5-888d-44c7c9cd4b7b with 0 participants
    update_round2_test.go:418: Round entity updated successfully: f104a265-c254-4ec5-888d-44c7c9cd4b7b ('When mall what.')
2025/05/31 16:07:34 Starting lightweight round handler cleanup...
2025/05/31 16:07:35 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundUpdateValidated/Success_-_Update_Multiple_Fields
2025/05/31 16:07:35 Truncating tables: users, scores, leaderboards, rounds
    update_round2_test.go:149: Created round e860ec86-89b6-45e2-a87c-ee446984a621 with 1 participants
    update_round2_test.go:418: Round entity updated successfully: e860ec86-89b6-45e2-a87c-ee446984a621 ('Multi-Update Round')
2025/05/31 16:07:38 Starting lightweight round handler cleanup...
2025/05/31 16:07:38 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundUpdateValidated/Success_-_Update_Round_with_Existing_Participants
2025/05/31 16:07:38 Truncating tables: users, scores, leaderboards, rounds
    update_round2_test.go:192: Created round 15d293f3-9eee-4879-be74-da2b5a94b7c3 with 1 participants
    update_round2_test.go:418: Round entity updated successfully: 15d293f3-9eee-4879-be74-da2b5a94b7c3 ('Updated Round with Participants')
2025/05/31 16:07:40 Starting lightweight round handler cleanup...
2025/05/31 16:07:40 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundUpdateValidated/Failure_-_Round_Not_Found
2025/05/31 16:07:40 Truncating tables: users, scores, leaderboards, rounds
    update_round2_test.go:431: Round entity update failed with error: round with ID d8d8c41b-92b1-41d1-a1d2-1c17654f89c7 not found
2025/05/31 16:07:41 Starting lightweight round handler cleanup...
2025/05/31 16:07:41 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundUpdateValidated/Failure_-_Invalid_JSON_Message
2025/05/31 16:07:42 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:07:43 Starting lightweight round handler cleanup...
2025/05/31 16:07:43 Lightweight cleanup completed successfully
--- PASS: TestHandleRoundUpdateValidated (24.61s)
    --- PASS: TestHandleRoundUpdateValidated/Success_-_Update_Title_Only (4.01s)
    --- PASS: TestHandleRoundUpdateValidated/Success_-_Update_Description_Only (3.07s)
    --- PASS: TestHandleRoundUpdateValidated/Success_-_Update_Location_Only (2.73s)
    --- PASS: TestHandleRoundUpdateValidated/Success_-_Update_Start_Time_Only (4.19s)
    --- PASS: TestHandleRoundUpdateValidated/Success_-_Update_Event_Type_Only (1.79s)
    --- PASS: TestHandleRoundUpdateValidated/Success_-_Update_Multiple_Fields (3.41s)
    --- PASS: TestHandleRoundUpdateValidated/Success_-_Update_Round_with_Existing_Participants (1.92s)
    --- PASS: TestHandleRoundUpdateValidated/Failure_-_Round_Not_Found (1.58s)
    --- PASS: TestHandleRoundUpdateValidated/Failure_-_Invalid_JSON_Message (1.90s)
=== RUN   TestHandleRoundScheduleUpdate
=== RUN   TestHandleRoundScheduleUpdate/Success_-_Update_Schedule_for_Round_with_No_Participants
2025/05/31 16:07:43 Truncating tables: users, scores, leaderboards, rounds
    update_round3_test.go:33: Created round dca300e4-d418-4ce1-acd1-1366461d6e30 with 0 participants
    update_round3_test.go:36: DEBUG: Created round ID: dca300e4-d418-4ce1-acd1-1366461d6e30
    update_round3_test.go:45: DEBUG: Original round from DBService - ID: dca300e4-d418-4ce1-acd1-1366461d6e30, Title: Shakespearean elsewhere several group fire., CreatedBy: 223056009, Participants: 0
    update_round3_test.go:53: DEBUG: Round via direct DB - ID: dca300e4-d418-4ce1-acd1-1366461d6e30, Title: Shakespearean elsewhere several group fire., CreatedBy: 223056009, Participants: 0
    update_round3_test.go:67: DEBUG: About to publish message with payload for round dca300e4-d418-4ce1-acd1-1366461d6e30
    update_round3_test.go:399: DEBUG: Received round data - ID: dca300e4-d418-4ce1-acd1-1366461d6e30, Title: Shakespearean elsewhere several group fire., CreatedBy: 223056009, Participants: 0
    update_round3_test.go:399: Round schedule updated successfully: dca300e4-d418-4ce1-acd1-1366461d6e30 ('Shakespearean elsewhere several group fire.'), participants: 0
2025/05/31 16:07:47 Starting lightweight round handler cleanup...
2025/05/31 16:07:47 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundScheduleUpdate/Success_-_Update_Schedule_for_Round_with_Participants
2025/05/31 16:07:47 Truncating tables: users, scores, leaderboards, rounds
    update_round3_test.go:89: Created round d76a9ad1-5079-4f3a-990c-a8bcd88946f0 with 2 participants
    update_round3_test.go:399: DEBUG: Received round data - ID: d76a9ad1-5079-4f3a-990c-a8bcd88946f0, Title: Clump yours lead in., CreatedBy: 223056009, Participants: 2
    update_round3_test.go:399: Round schedule updated successfully: d76a9ad1-5079-4f3a-990c-a8bcd88946f0 ('Clump yours lead in.'), participants: 2
2025/05/31 16:07:49 Starting lightweight round handler cleanup...
2025/05/31 16:07:49 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundScheduleUpdate/Success_-_Update_Schedule_with_Minimal_Payload_Data
2025/05/31 16:07:49 Truncating tables: users, scores, leaderboards, rounds
    update_round3_test.go:142: Created round 3289a278-b52a-415b-8082-69335d87b25e with 1 participants
    update_round3_test.go:399: DEBUG: Received round data - ID: 3289a278-b52a-415b-8082-69335d87b25e, Title: Him whose wow its greatly., CreatedBy: 223056009, Participants: 1
    update_round3_test.go:399: Round schedule updated successfully: 3289a278-b52a-415b-8082-69335d87b25e ('Him whose wow its greatly.'), participants: 1
2025/05/31 16:07:51 Starting lightweight round handler cleanup...
2025/05/31 16:07:52 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundScheduleUpdate/Success_-_Update_Schedule_for_Round_with_All_Field_Types
2025/05/31 16:07:52 Truncating tables: users, scores, leaderboards, rounds
    update_round3_test.go:166: Created round 6b6e081a-effc-4f10-98ac-b4be7c765e3c with 2 participants
    update_round3_test.go:399: DEBUG: Received round data - ID: 6b6e081a-effc-4f10-98ac-b4be7c765e3c, Title: Would murder ourselves it battery., CreatedBy: 223056009, Participants: 2
    update_round3_test.go:399: Round schedule updated successfully: 6b6e081a-effc-4f10-98ac-b4be7c765e3c ('Would murder ourselves it battery.'), participants: 2
2025/05/31 16:07:53 Starting lightweight round handler cleanup...
2025/05/31 16:07:53 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundScheduleUpdate/Failure_-_Round_Not_Found
2025/05/31 16:07:53 Truncating tables: users, scores, leaderboards, rounds
    update_round3_test.go:412: Round schedule update failed with error: round with ID 14b9d8b1-f8c7-4853-8a19-632df0982901 not found
2025/05/31 16:07:56 Starting lightweight round handler cleanup...
2025/05/31 16:07:56 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundScheduleUpdate/Failure_-_Invalid_JSON_Message
2025/05/31 16:07:56 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:07:58 Starting lightweight round handler cleanup...
2025/05/31 16:07:58 Lightweight cleanup completed successfully
--- PASS: TestHandleRoundScheduleUpdate (14.99s)
    --- PASS: TestHandleRoundScheduleUpdate/Success_-_Update_Schedule_for_Round_with_No_Participants (3.72s)
    --- PASS: TestHandleRoundScheduleUpdate/Success_-_Update_Schedule_for_Round_with_Participants (1.98s)
    --- PASS: TestHandleRoundScheduleUpdate/Success_-_Update_Schedule_with_Minimal_Payload_Data (2.50s)
    --- PASS: TestHandleRoundScheduleUpdate/Success_-_Update_Schedule_for_Round_with_All_Field_Types (1.67s)
    --- PASS: TestHandleRoundScheduleUpdate/Failure_-_Round_Not_Found (3.11s)
    --- PASS: TestHandleRoundScheduleUpdate/Failure_-_Invalid_JSON_Message (2.00s)
=== RUN   TestHandleRoundUpdateRequest
=== RUN   TestHandleRoundUpdateRequest/Success_-_Valid_Title_Update
2025/05/31 16:07:58 Truncating tables: users, scores, leaderboards, rounds
    update_round_test.go:31: Created round 7368444e-3a79-44f0-bd31-ebd7ab55d85d with 0 participants
    update_round_test.go:383: Round update request validated for round: 7368444e-3a79-44f0-bd31-ebd7ab55d85d, user: 545892707
2025/05/31 16:08:02 Starting lightweight round handler cleanup...
2025/05/31 16:08:02 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundUpdateRequest/Success_-_Valid_Description_Update
2025/05/31 16:08:02 Truncating tables: users, scores, leaderboards, rounds
    update_round_test.go:54: Created round 3dfc0018-77f4-48e3-9bbe-c164d07a31e9 with 0 participants
    update_round_test.go:383: Round update request validated for round: 3dfc0018-77f4-48e3-9bbe-c164d07a31e9, user: 545892707
2025/05/31 16:08:05 Starting lightweight round handler cleanup...
2025/05/31 16:08:05 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundUpdateRequest/Success_-_Valid_Location_Update
2025/05/31 16:08:06 Truncating tables: users, scores, leaderboards, rounds
    update_round_test.go:74: Created round 499b2050-93ba-4fa8-a2d2-041da4d041f5 with 0 participants
    update_round_test.go:383: Round update request validated for round: 499b2050-93ba-4fa8-a2d2-041da4d041f5, user: 545892707
2025/05/31 16:08:08 Starting lightweight round handler cleanup...
2025/05/31 16:08:08 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundUpdateRequest/Success_-_Valid_Start_Time_Update
2025/05/31 16:08:08 Truncating tables: users, scores, leaderboards, rounds
    update_round_test.go:91: Created round 0cea025d-b77c-4e7a-abe3-dad76c5acd3c with 0 participants
    update_round_test.go:383: Round update request validated for round: 0cea025d-b77c-4e7a-abe3-dad76c5acd3c, user: 545892707
2025/05/31 16:08:11 Starting lightweight round handler cleanup...
2025/05/31 16:08:11 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundUpdateRequest/Success_-_Multiple_Fields_Update
2025/05/31 16:08:11 Truncating tables: users, scores, leaderboards, rounds
    update_round_test.go:109: Created round 223fe795-04d8-4671-b4d2-368493a56af3 with 0 participants
    update_round_test.go:383: Round update request validated for round: 223fe795-04d8-4671-b4d2-368493a56af3, user: 545892707
2025/05/31 16:08:13 Starting lightweight round handler cleanup...
2025/05/31 16:08:13 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundUpdateRequest/Failure_-_Zero_Round_ID
2025/05/31 16:08:14 Truncating tables: users, scores, leaderboards, rounds
    update_round_test.go:396: Round update request failed with error: validation errors: round ID cannot be zero
2025/05/31 16:08:16 Starting lightweight round handler cleanup...
2025/05/31 16:08:16 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundUpdateRequest/Failure_-_No_Fields_to_Update
2025/05/31 16:08:16 Truncating tables: users, scores, leaderboards, rounds
    update_round_test.go:162: Created round 07fee1a5-69e5-4740-9923-590b0a31ea2f with 0 participants
    update_round_test.go:396: Round update request failed with error: validation errors: at least one field to update must be provided
2025/05/31 16:08:19 Starting lightweight round handler cleanup...
2025/05/31 16:08:19 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundUpdateRequest/Failure_-_Empty_Title_with_No_Other_Fields
2025/05/31 16:08:19 Truncating tables: users, scores, leaderboards, rounds
    update_round_test.go:178: Created round 3f2eccfc-7b2e-4eaf-8cb3-c33a3b654136 with 0 participants
    update_round_test.go:396: Round update request failed with error: validation errors: at least one field to update must be provided
2025/05/31 16:08:23 Starting lightweight round handler cleanup...
2025/05/31 16:08:23 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundUpdateRequest/Failure_-_Multiple_Validation_Errors
2025/05/31 16:08:23 Truncating tables: users, scores, leaderboards, rounds
    update_round_test.go:396: Round update request failed with error: validation errors: round ID cannot be zero; at least one field to update must be provided
2025/05/31 16:08:26 Starting lightweight round handler cleanup...
2025/05/31 16:08:26 Lightweight cleanup completed successfully
=== RUN   TestHandleRoundUpdateRequest/Failure_-_Invalid_JSON_Message
2025/05/31 16:08:26 Truncating tables: users, scores, leaderboards, rounds
2025/05/31 16:08:28 Starting lightweight round handler cleanup...
2025/05/31 16:08:28 Lightweight cleanup completed successfully
--- PASS: TestHandleRoundUpdateRequest (29.32s)
    --- PASS: TestHandleRoundUpdateRequest/Success_-_Valid_Title_Update (3.40s)
    --- PASS: TestHandleRoundUpdateRequest/Success_-_Valid_Description_Update (3.72s)
    --- PASS: TestHandleRoundUpdateRequest/Success_-_Valid_Location_Update (2.38s)
    --- PASS: TestHandleRoundUpdateRequest/Success_-_Valid_Start_Time_Update (3.22s)
    --- PASS: TestHandleRoundUpdateRequest/Success_-_Multiple_Fields_Update (2.40s)
    --- PASS: TestHandleRoundUpdateRequest/Failure_-_Zero_Round_ID (2.69s)
    --- PASS: TestHandleRoundUpdateRequest/Failure_-_No_Fields_to_Update (3.11s)
    --- PASS: TestHandleRoundUpdateRequest/Failure_-_Empty_Title_with_No_Other_Fields (3.69s)
    --- PASS: TestHandleRoundUpdateRequest/Failure_-_Multiple_Validation_Errors (2.72s)
    --- PASS: TestHandleRoundUpdateRequest/Failure_-_Invalid_JSON_Message (2.00s)
PASS
coverage: 62.1% of statements in ./app/...
2025/05/31 16:08:28 TestMain: finished with exit code: 0
ok  	github.com/Black-And-White-Club/frolf-bot/integration_tests/modules/round/handler_tests	394.890s	coverage: 62.1% of statements in ./app/...
2025/05/31 16:01:55 TestMain started in package scoreintegrationtests
=== RUN   TestCorrectScore
2025/05/31 16:01:55 Starting PostgreSQL container with resource limits...
2025/05/31 16:01:55 github.com/testcontainers/testcontainers-go - Connected to docker: 
  Server Version: 28.1.1
  API Version: 1.48
  Operating System: Ubuntu 24.04.1 LTS
  Total Memory: 5923 MB
  Testcontainers for Go Version: v0.37.0
  Resolved Docker Host: unix:///Users/jace/.colima/default/docker.sock
  Resolved Docker Socket Path: /var/run/docker.sock
  Test SessionID: 9db56792615afb05e786a706eb0beac327e763183af153d41570e5011efcddd4
  Test ProcessID: 068e5a67-57f9-4a3a-813b-95eef18d3f92
2025/05/31 16:01:55 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:01:55 ⏳ Waiting for Reaper "069f6d02" to be ready
2025/05/31 16:01:55 🔥 Reaper obtained from Docker for this test session 069f6d02
2025/05/31 16:01:55 ✅ Container created: 0ba9ef1b254d
2025/05/31 16:01:55 🐳 Starting container: 0ba9ef1b254d
2025/05/31 16:01:56 ✅ Container started: 0ba9ef1b254d
2025/05/31 16:01:56 ⏳ Waiting for container id 0ba9ef1b254d image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc0004d5f00 Strategies:[0xc00054aab0]}
2025/05/31 16:02:02 🔔 Container is ready: 0ba9ef1b254d
2025/05/31 16:02:02 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40397/testdb?sslmode=disable
2025/05/31 16:02:02 Starting NATS container with resource limits...
2025/05/31 16:02:02 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:02:02 ✅ Container created: fbf4f32a9d60
2025/05/31 16:02:02 🐳 Starting container: fbf4f32a9d60
2025/05/31 16:02:04 ✅ Container started: fbf4f32a9d60
2025/05/31 16:02:04 ⏳ Waiting for container id fbf4f32a9d60 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000805ac8 Strategies:[0xc0005d1c80 0xc00068f8f0]}
2025/05/31 16:02:06 🔔 Container is ready: fbf4f32a9d60
2025/05/31 16:02:06 NATS container started with resource limits. URL: nats://localhost:40407
Creating user table...
User table created successfully!
2025/05/31 16:02:06 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/31 16:02:06 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/31 16:02:06 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:02:06 Ran leaderboard migrations group #4
2025/05/31 16:02:06 All migrations ran successfully
2025/05/31 16:02:06 newDBServiceWithDB - Registering models
2025/05/31 16:02:06 newDBServiceWithDB - Models registered successfully
2025/05/31 16:02:06 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00053e148 RoundDB:0xc00053e150 ScoreDB:0xc00053e158 LeaderboardDB:0xc00053e160 db:0xc000168a40}
2025/05/31 16:02:07 Truncating tables: scores
2025/05/31 16:02:07 Truncating tables: scores
=== RUN   TestCorrectScore/Add_initial_score_with_tag_number
[DEBUG LogScores] Insert/Update Executed for RoundID 01fec8ca-8c33-41dd-9a09-d7458bc7cd8b. Error: <nil>, Result: {Locker:0xc00017ce00 resi:1}
=== RUN   TestCorrectScore/Add_initial_score_without_tag_number
[DEBUG LogScores] Insert/Update Executed for RoundID 179c1e71-289f-42fc-a6b5-b7a1fdf05345. Error: <nil>, Result: {Locker:0xc00017ce00 resi:1}
=== RUN   TestCorrectScore/Update_existing_score_with_new_tag
[DEBUG LogScores] Insert/Update Executed for RoundID ab2ac442-b94d-44a1-8e9c-e2b98d706af0. Error: <nil>, Result: {Locker:0xc00017ce00 resi:1}
=== RUN   TestCorrectScore/Update_existing_score_without_tag
[DEBUG LogScores] Insert/Update Executed for RoundID baccf184-f85f-49d1-96f7-673484c2ecd8. Error: <nil>, Result: {Locker:0xc00017ce00 resi:1}
=== RUN   TestCorrectScore/Fails_with_invalid_round_ID
2025/05/31 16:02:07 Cleaning up test environment...
2025/05/31 16:02:07 Context cancelled.
2025/05/31 16:02:07 EventBus closed.
2025/05/31 16:02:07 NATS connection closed.
2025/05/31 16:02:07 DB connection closed.
2025/05/31 16:02:07 🐳 Stopping container: fbf4f32a9d60
2025/05/31 16:02:08 ✅ Container stopped: fbf4f32a9d60
2025/05/31 16:02:08 🐳 Terminating container: fbf4f32a9d60
2025/05/31 16:02:08 🚫 Container terminated: fbf4f32a9d60
2025/05/31 16:02:08 NATS container terminated.
2025/05/31 16:02:08 🐳 Stopping container: 0ba9ef1b254d
2025/05/31 16:02:08 ✅ Container stopped: 0ba9ef1b254d
2025/05/31 16:02:08 🐳 Terminating container: 0ba9ef1b254d
2025/05/31 16:02:09 🚫 Container terminated: 0ba9ef1b254d
2025/05/31 16:02:09 PostgreSQL container terminated.
2025/05/31 16:02:09 Cleanup complete.
--- PASS: TestCorrectScore (13.39s)
    --- PASS: TestCorrectScore/Add_initial_score_with_tag_number (0.03s)
    --- PASS: TestCorrectScore/Add_initial_score_without_tag_number (0.04s)
    --- PASS: TestCorrectScore/Update_existing_score_with_new_tag (0.03s)
    --- PASS: TestCorrectScore/Update_existing_score_without_tag (0.03s)
    --- PASS: TestCorrectScore/Fails_with_invalid_round_ID (0.01s)
=== RUN   TestProcessRoundScores
2025/05/31 16:02:09 Starting PostgreSQL container with resource limits...
2025/05/31 16:02:09 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:02:09 ✅ Container created: 4d84e593556d
2025/05/31 16:02:09 🐳 Starting container: 4d84e593556d
2025/05/31 16:02:10 ✅ Container started: 4d84e593556d
2025/05/31 16:02:10 ⏳ Waiting for container id 4d84e593556d image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc0005a63e8 Strategies:[0xc0007a9ce0]}
2025/05/31 16:02:16 🔔 Container is ready: 4d84e593556d
2025/05/31 16:02:16 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40428/testdb?sslmode=disable
2025/05/31 16:02:16 Starting NATS container with resource limits...
2025/05/31 16:02:16 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:02:16 ✅ Container created: b578a9858c47
2025/05/31 16:02:16 🐳 Starting container: b578a9858c47
2025/05/31 16:02:18 ✅ Container started: b578a9858c47
2025/05/31 16:02:18 ⏳ Waiting for container id b578a9858c47 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000306cd8 Strategies:[0xc00080e600 0xc000148120]}
2025/05/31 16:02:20 🔔 Container is ready: b578a9858c47
2025/05/31 16:02:20 NATS container started with resource limits. URL: nats://localhost:40433
Creating user table...
User table created successfully!
2025/05/31 16:02:20 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/31 16:02:20 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/31 16:02:20 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:02:20 Ran leaderboard migrations group #4
2025/05/31 16:02:20 All migrations ran successfully
2025/05/31 16:02:20 newDBServiceWithDB - Registering models
2025/05/31 16:02:20 newDBServiceWithDB - Models registered successfully
2025/05/31 16:02:20 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00053e318 RoundDB:0xc00053e320 ScoreDB:0xc00053e328 LeaderboardDB:0xc00053e330 db:0xc000787dc0}
2025/05/31 16:02:21 Truncating tables: scores
2025/05/31 16:02:21 Truncating tables: scores
=== RUN   TestProcessRoundScores/Successfully_processes_round_scores_with_tags
[DEBUG LogScores] Insert/Update Executed for RoundID dd92f355-2fbe-4dd7-a73c-17094c354ee1. Error: <nil>, Result: {Locker:0xc00036f080 resi:1}
=== RUN   TestProcessRoundScores/Successfully_processes_round_scores_without_tags
[DEBUG LogScores] Insert/Update Executed for RoundID ae865396-02b4-41b2-b180-c93e7b7965e8. Error: <nil>, Result: {Locker:0xc00036f080 resi:1}
=== RUN   TestProcessRoundScores/Handles_empty_score_list
=== RUN   TestProcessRoundScores/Correctly_sorts_scores
[DEBUG LogScores] Insert/Update Executed for RoundID 27d2ac29-de0a-4fa2-9c27-5feba3f5b39c. Error: <nil>, Result: {Locker:0xc00036f080 resi:1}
=== RUN   TestProcessRoundScores/Handles_concurrent_score_processing
[DEBUG LogScores] Insert/Update Executed for RoundID d518d5fe-89f0-40b8-9e44-f0001edf0f72. Error: <nil>, Result: {Locker:0xc00036f080 resi:1}
[DEBUG LogScores] Insert/Update Executed for RoundID b9d2d89b-6247-4bbb-8809-d1836627e239. Error: <nil>, Result: {Locker:0xc00051e380 resi:1}
[DEBUG LogScores] Insert/Update Executed for RoundID eb5e4325-6035-45de-8c45-3f291a8b16f5. Error: <nil>, Result: {Locker:0xc0004b4000 resi:1}
2025/05/31 16:02:21 Cleaning up test environment...
2025/05/31 16:02:21 Context cancelled.
2025/05/31 16:02:21 EventBus closed.
2025/05/31 16:02:21 NATS connection closed.
2025/05/31 16:02:21 DB connection closed.
2025/05/31 16:02:21 🐳 Stopping container: b578a9858c47
2025/05/31 16:02:22 ✅ Container stopped: b578a9858c47
2025/05/31 16:02:22 🐳 Terminating container: b578a9858c47
2025/05/31 16:02:22 🚫 Container terminated: b578a9858c47
2025/05/31 16:02:22 NATS container terminated.
2025/05/31 16:02:22 🐳 Stopping container: 4d84e593556d
2025/05/31 16:02:23 ✅ Container stopped: 4d84e593556d
2025/05/31 16:02:23 🐳 Terminating container: 4d84e593556d
2025/05/31 16:02:23 🚫 Container terminated: 4d84e593556d
2025/05/31 16:02:23 PostgreSQL container terminated.
2025/05/31 16:02:23 Cleanup complete.
--- PASS: TestProcessRoundScores (14.54s)
    --- PASS: TestProcessRoundScores/Successfully_processes_round_scores_with_tags (0.01s)
    --- PASS: TestProcessRoundScores/Successfully_processes_round_scores_without_tags (0.01s)
    --- PASS: TestProcessRoundScores/Handles_empty_score_list (0.00s)
    --- PASS: TestProcessRoundScores/Correctly_sorts_scores (0.01s)
    --- PASS: TestProcessRoundScores/Handles_concurrent_score_processing (0.20s)
=== RUN   TestProcessScoresForStorage
2025/05/31 16:02:23 Starting PostgreSQL container with resource limits...
2025/05/31 16:02:23 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:02:23 ✅ Container created: f51dd7ae1040
2025/05/31 16:02:23 🐳 Starting container: f51dd7ae1040
2025/05/31 16:02:24 ✅ Container started: f51dd7ae1040
2025/05/31 16:02:24 ⏳ Waiting for container id f51dd7ae1040 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc0007c2188 Strategies:[0xc000148a20]}
2025/05/31 16:02:29 🔔 Container is ready: f51dd7ae1040
2025/05/31 16:02:29 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40450/testdb?sslmode=disable
2025/05/31 16:02:29 Starting NATS container with resource limits...
2025/05/31 16:02:29 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:02:29 ✅ Container created: 2f8d17699ca8
2025/05/31 16:02:29 🐳 Starting container: 2f8d17699ca8
2025/05/31 16:02:30 ✅ Container started: 2f8d17699ca8
2025/05/31 16:02:30 ⏳ Waiting for container id 2f8d17699ca8 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc0005a6d40 Strategies:[0xc00080f440 0xc0002fc660]}
2025/05/31 16:02:32 🔔 Container is ready: 2f8d17699ca8
2025/05/31 16:02:32 NATS container started with resource limits. URL: nats://localhost:40458
Creating user table...
User table created successfully!
2025/05/31 16:02:33 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/31 16:02:33 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/31 16:02:33 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:02:33 Ran leaderboard migrations group #4
2025/05/31 16:02:33 All migrations ran successfully
2025/05/31 16:02:33 newDBServiceWithDB - Registering models
2025/05/31 16:02:33 newDBServiceWithDB - Models registered successfully
2025/05/31 16:02:33 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00059a1c0 RoundDB:0xc00059a1c8 ScoreDB:0xc00059a1d0 LeaderboardDB:0xc00059a1d8 db:0xc00042c9c0}
2025/05/31 16:02:33 Truncating tables: scores
2025/05/31 16:02:33 Truncating tables: scores
=== RUN   TestProcessScoresForStorage/Correctly_processes_and_sorts_scores
=== RUN   TestProcessScoresForStorage/Handles_empty_score_list_correctly
=== RUN   TestProcessScoresForStorage/Handles_extreme_scores
2025/05/31 16:02:33 Cleaning up test environment...
2025/05/31 16:02:33 Context cancelled.
2025/05/31 16:02:33 EventBus closed.
2025/05/31 16:02:33 NATS connection closed.
2025/05/31 16:02:33 DB connection closed.
2025/05/31 16:02:33 🐳 Stopping container: 2f8d17699ca8
2025/05/31 16:02:34 ✅ Container stopped: 2f8d17699ca8
2025/05/31 16:02:34 🐳 Terminating container: 2f8d17699ca8
2025/05/31 16:02:34 🚫 Container terminated: 2f8d17699ca8
2025/05/31 16:02:34 NATS container terminated.
2025/05/31 16:02:34 🐳 Stopping container: f51dd7ae1040
2025/05/31 16:02:35 ✅ Container stopped: f51dd7ae1040
2025/05/31 16:02:35 🐳 Terminating container: f51dd7ae1040
2025/05/31 16:02:35 🚫 Container terminated: f51dd7ae1040
2025/05/31 16:02:35 PostgreSQL container terminated.
2025/05/31 16:02:35 Cleanup complete.
--- PASS: TestProcessScoresForStorage (11.92s)
    --- PASS: TestProcessScoresForStorage/Correctly_processes_and_sorts_scores (0.00s)
    --- PASS: TestProcessScoresForStorage/Handles_empty_score_list_correctly (0.00s)
    --- PASS: TestProcessScoresForStorage/Handles_extreme_scores (0.00s)
PASS
coverage: 21.8% of statements in ./app/...
2025/05/31 16:02:35 TestMain: finished with exit code: 0
ok  	github.com/Black-And-White-Club/frolf-bot/integration_tests/modules/score/application_tests	42.229s	coverage: 21.8% of statements in ./app/...
2025/05/31 16:01:57 TestMain started in package scorehandler_integration_tests
=== RUN   TestHandleCorrectScoreRequest
=== RUN   TestHandleCorrectScoreRequest/Success_-_Correct_score_with_valid_data
2025/05/31 16:01:57 Starting PostgreSQL container with resource limits...
2025/05/31 16:01:57 github.com/testcontainers/testcontainers-go - Connected to docker: 
  Server Version: 28.1.1
  API Version: 1.48
  Operating System: Ubuntu 24.04.1 LTS
  Total Memory: 5923 MB
  Testcontainers for Go Version: v0.37.0
  Resolved Docker Host: unix:///Users/jace/.colima/default/docker.sock
  Resolved Docker Socket Path: /var/run/docker.sock
  Test SessionID: 9db56792615afb05e786a706eb0beac327e763183af153d41570e5011efcddd4
  Test ProcessID: fa7844fd-3dfa-4e6f-907e-7afc646d5cb3
2025/05/31 16:01:58 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:01:58 ⏳ Waiting for Reaper "069f6d02" to be ready
2025/05/31 16:01:58 🔥 Reaper obtained from Docker for this test session 069f6d02
2025/05/31 16:01:58 ✅ Container created: a500c152ac77
2025/05/31 16:01:58 🐳 Starting container: a500c152ac77
2025/05/31 16:01:59 ✅ Container started: a500c152ac77
2025/05/31 16:01:59 ⏳ Waiting for container id a500c152ac77 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000285be0 Strategies:[0xc000415b00]}
2025/05/31 16:02:05 🔔 Container is ready: a500c152ac77
2025/05/31 16:02:05 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40401/testdb?sslmode=disable
2025/05/31 16:02:05 Starting NATS container with resource limits...
2025/05/31 16:02:05 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:02:06 ✅ Container created: 11d71f890665
2025/05/31 16:02:06 🐳 Starting container: 11d71f890665
2025/05/31 16:02:07 ✅ Container started: 11d71f890665
2025/05/31 16:02:07 ⏳ Waiting for container id 11d71f890665 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc00055c300 Strategies:[0xc0005c6060 0xc000442870]}
2025/05/31 16:02:08 🔔 Container is ready: 11d71f890665
2025/05/31 16:02:08 NATS container started with resource limits. URL: nats://localhost:40419
Creating user table...
User table created successfully!
2025/05/31 16:02:08 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/31 16:02:08 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/31 16:02:08 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:02:08 Ran leaderboard migrations group #4
2025/05/31 16:02:08 All migrations ran successfully
2025/05/31 16:02:08 newDBServiceWithDB - Registering models
2025/05/31 16:02:08 newDBServiceWithDB - Models registered successfully
2025/05/31 16:02:08 newDBServiceWithDB - DBService initialized: &{UserDB:0xc0004442e0 RoundDB:0xc0004442e8 ScoreDB:0xc0004442f0 LeaderboardDB:0xc0004442f8 db:0xc00043bbc0}
2025/05/31 16:02:08 Truncating tables: scores
2025/05/31 16:02:08 Truncating tables: scores, users, rounds, leaderboards
[DEBUG LogScores] Insert/Update Executed for RoundID 939a0ec0-ef0f-41c6-9ac3-f5ebcce95062. Error: <nil>, Result: {Locker:0xc00045c080 resi:1}
    correct_scores_test.go:291: Waiting for 1 messages on topic "discord.score.update.success" with timeout 5s
2025/05/31 16:02:10 Test received message 04aba8d0-c566-4b44-a9ad-829bf0771a5c on topic "discord.score.update.success"
    correct_scores_test.go:291: Successfully received 1 messages on topic "discord.score.update.success"
2025/05/31 16:02:10 Test Case "TestHandleCorrectScoreRequest/Success_-_Correct_score_with_valid_data": Canceling subscription context.
2025/05/31 16:02:10 Test Case "TestHandleCorrectScoreRequest/Success_-_Correct_score_with_valid_data": Waiting for subscriber goroutines to finish.
2025/05/31 16:02:10 Test Case "TestHandleCorrectScoreRequest/Success_-_Correct_score_with_valid_data": Subscriber goroutines finished.
2025/05/31 16:02:10 Running score handler test cleanup...
2025/05/31 16:02:11 Error closing Score module: error closing ScoreRouter: router close timeout
2025/05/31 16:02:11 Score handler router goroutine finished.
2025/05/31 16:02:11 Score handler test cleanup finished.
2025/05/31 16:02:11 Cleaning up test environment...
2025/05/31 16:02:11 Context cancelled.
2025/05/31 16:02:11 EventBus closed.
2025/05/31 16:02:11 NATS connection closed.
2025/05/31 16:02:11 DB connection closed.
2025/05/31 16:02:11 🐳 Stopping container: 11d71f890665
2025/05/31 16:02:12 ✅ Container stopped: 11d71f890665
2025/05/31 16:02:12 🐳 Terminating container: 11d71f890665
2025/05/31 16:02:12 🚫 Container terminated: 11d71f890665
2025/05/31 16:02:12 NATS container terminated.
2025/05/31 16:02:12 🐳 Stopping container: a500c152ac77
2025/05/31 16:02:13 ✅ Container stopped: a500c152ac77
2025/05/31 16:02:13 🐳 Terminating container: a500c152ac77
2025/05/31 16:02:13 🚫 Container terminated: a500c152ac77
2025/05/31 16:02:13 PostgreSQL container terminated.
2025/05/31 16:02:13 Cleanup complete.
=== RUN   TestHandleCorrectScoreRequest/Failure_-_Score_record_not_found
2025/05/31 16:02:13 Starting PostgreSQL container with resource limits...
2025/05/31 16:02:13 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:02:13 ✅ Container created: c34fd831c4ea
2025/05/31 16:02:13 🐳 Starting container: c34fd831c4ea
2025/05/31 16:02:14 ✅ Container started: c34fd831c4ea
2025/05/31 16:02:14 ⏳ Waiting for container id c34fd831c4ea image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc0003070d0 Strategies:[0xc0004fa8d0]}
2025/05/31 16:02:21 🔔 Container is ready: c34fd831c4ea
2025/05/31 16:02:21 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40430/testdb?sslmode=disable
2025/05/31 16:02:21 Starting NATS container with resource limits...
2025/05/31 16:02:21 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:02:21 ✅ Container created: 01c5019a9c0f
2025/05/31 16:02:21 🐳 Starting container: 01c5019a9c0f
2025/05/31 16:02:22 ✅ Container started: 01c5019a9c0f
2025/05/31 16:02:22 ⏳ Waiting for container id 01c5019a9c0f image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc0006492e0 Strategies:[0xc00065d4a0 0xc0004faf30]}
2025/05/31 16:02:26 🔔 Container is ready: 01c5019a9c0f
2025/05/31 16:02:26 NATS container started with resource limits. URL: nats://localhost:40440
Creating round table...
Round table created successfully!
2025/05/31 16:02:26 Ran round migrations group #1
Creating score table...
Score table created successfully!
2025/05/31 16:02:26 Ran score migrations group #2
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:02:26 Ran leaderboard migrations group #3
Creating user table...
User table created successfully!
2025/05/31 16:02:26 Ran user migrations group #4
2025/05/31 16:02:26 All migrations ran successfully
2025/05/31 16:02:26 newDBServiceWithDB - Registering models
2025/05/31 16:02:26 newDBServiceWithDB - Models registered successfully
2025/05/31 16:02:26 newDBServiceWithDB - DBService initialized: &{UserDB:0xc0002fe2f8 RoundDB:0xc0002fe300 ScoreDB:0xc0002fe308 LeaderboardDB:0xc0002fe310 db:0xc00002ea00}
2025/05/31 16:02:27 Truncating tables: scores
2025/05/31 16:02:27 Truncating tables: scores, users, rounds, leaderboards
    correct_scores_test.go:291: Waiting for 1 messages on topic "discord.score.update.fail" with timeout 5s
2025/05/31 16:02:28 Test received message 161c0a19-7f26-41e8-af2b-1139bb93e440 on topic "discord.score.update.fail"
    correct_scores_test.go:291: Successfully received 1 messages on topic "discord.score.update.fail"
2025/05/31 16:02:28 Test Case "TestHandleCorrectScoreRequest/Failure_-_Score_record_not_found": Canceling subscription context.
2025/05/31 16:02:28 Test Case "TestHandleCorrectScoreRequest/Failure_-_Score_record_not_found": Waiting for subscriber goroutines to finish.
2025/05/31 16:02:28 Test Case "TestHandleCorrectScoreRequest/Failure_-_Score_record_not_found": Subscriber goroutines finished.
2025/05/31 16:02:28 Running score handler test cleanup...
2025/05/31 16:02:29 Error closing Score module: error closing ScoreRouter: router close timeout
2025/05/31 16:02:29 Score handler router goroutine finished.
2025/05/31 16:02:29 Score handler test cleanup finished.
2025/05/31 16:02:29 Cleaning up test environment...
2025/05/31 16:02:29 Context cancelled.
2025/05/31 16:02:29 EventBus closed.
2025/05/31 16:02:29 NATS connection closed.
2025/05/31 16:02:29 DB connection closed.
2025/05/31 16:02:29 🐳 Stopping container: 01c5019a9c0f
2025/05/31 16:02:30 ✅ Container stopped: 01c5019a9c0f
2025/05/31 16:02:30 🐳 Terminating container: 01c5019a9c0f
2025/05/31 16:02:30 🚫 Container terminated: 01c5019a9c0f
2025/05/31 16:02:30 NATS container terminated.
2025/05/31 16:02:30 🐳 Stopping container: c34fd831c4ea
2025/05/31 16:02:30 ✅ Container stopped: c34fd831c4ea
2025/05/31 16:02:30 🐳 Terminating container: c34fd831c4ea
2025/05/31 16:02:31 🚫 Container terminated: c34fd831c4ea
2025/05/31 16:02:31 PostgreSQL container terminated.
2025/05/31 16:02:31 Cleanup complete.
=== RUN   TestHandleCorrectScoreRequest/Failure_-_Invalid_Score_Value
2025/05/31 16:02:31 Starting PostgreSQL container with resource limits...
2025/05/31 16:02:31 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:02:31 ✅ Container created: 2d4d09c2bc4b
2025/05/31 16:02:31 🐳 Starting container: 2d4d09c2bc4b
2025/05/31 16:02:31 ✅ Container started: 2d4d09c2bc4b
2025/05/31 16:02:31 ⏳ Waiting for container id 2d4d09c2bc4b image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc00077c268 Strategies:[0xc0004814d0]}
2025/05/31 16:02:37 🔔 Container is ready: 2d4d09c2bc4b
2025/05/31 16:02:37 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40462/testdb?sslmode=disable
2025/05/31 16:02:37 Starting NATS container with resource limits...
2025/05/31 16:02:37 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:02:37 ✅ Container created: 304d511cb7aa
2025/05/31 16:02:37 🐳 Starting container: 304d511cb7aa
2025/05/31 16:02:39 ✅ Container started: 304d511cb7aa
2025/05/31 16:02:39 ⏳ Waiting for container id 304d511cb7aa image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc00077c830 Strategies:[0xc000920660 0xc000747140]}
2025/05/31 16:02:41 🔔 Container is ready: 304d511cb7aa
2025/05/31 16:02:41 NATS container started with resource limits. URL: nats://localhost:40471
Creating user table...
User table created successfully!
2025/05/31 16:02:41 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/31 16:02:41 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/31 16:02:41 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:02:41 Ran leaderboard migrations group #4
2025/05/31 16:02:41 All migrations ran successfully
2025/05/31 16:02:41 newDBServiceWithDB - Registering models
2025/05/31 16:02:41 newDBServiceWithDB - Models registered successfully
2025/05/31 16:02:41 newDBServiceWithDB - DBService initialized: &{UserDB:0xc000444190 RoundDB:0xc0004441a0 ScoreDB:0xc0004441a8 LeaderboardDB:0xc0004441b0 db:0xc00043ab40}
2025/05/31 16:02:41 Truncating tables: scores
2025/05/31 16:02:41 Truncating tables: scores, users, rounds, leaderboards
[DEBUG LogScores] Insert/Update Executed for RoundID 3befc072-b01d-4786-aa09-2bf474e62a42. Error: <nil>, Result: {Locker:0xc000785f00 resi:1}
    correct_scores_test.go:291: Waiting for 1 messages on topic "discord.score.update.fail" with timeout 5s
2025/05/31 16:02:42 Test received message 831998f7-e70e-4ab6-bc46-fbdfc80ab8ed on topic "discord.score.update.fail"
    correct_scores_test.go:291: Successfully received 1 messages on topic "discord.score.update.fail"
2025/05/31 16:02:42 Test Case "TestHandleCorrectScoreRequest/Failure_-_Invalid_Score_Value": Canceling subscription context.
2025/05/31 16:02:42 Test Case "TestHandleCorrectScoreRequest/Failure_-_Invalid_Score_Value": Waiting for subscriber goroutines to finish.
2025/05/31 16:02:42 Test Case "TestHandleCorrectScoreRequest/Failure_-_Invalid_Score_Value": Subscriber goroutines finished.
2025/05/31 16:02:42 Running score handler test cleanup...
2025/05/31 16:02:43 Error closing Score module: error closing ScoreRouter: router close timeout
2025/05/31 16:02:43 Score handler router goroutine finished.
2025/05/31 16:02:43 Score handler test cleanup finished.
2025/05/31 16:02:43 Cleaning up test environment...
2025/05/31 16:02:43 Context cancelled.
2025/05/31 16:02:43 EventBus closed.
2025/05/31 16:02:43 NATS connection closed.
2025/05/31 16:02:43 DB connection closed.
2025/05/31 16:02:43 🐳 Stopping container: 304d511cb7aa
2025/05/31 16:02:44 ✅ Container stopped: 304d511cb7aa
2025/05/31 16:02:44 🐳 Terminating container: 304d511cb7aa
2025/05/31 16:02:44 🚫 Container terminated: 304d511cb7aa
2025/05/31 16:02:44 NATS container terminated.
2025/05/31 16:02:44 🐳 Stopping container: 2d4d09c2bc4b
2025/05/31 16:02:45 ✅ Container stopped: 2d4d09c2bc4b
2025/05/31 16:02:45 🐳 Terminating container: 2d4d09c2bc4b
2025/05/31 16:02:45 🚫 Container terminated: 2d4d09c2bc4b
2025/05/31 16:02:45 PostgreSQL container terminated.
2025/05/31 16:02:45 Cleanup complete.
=== RUN   TestHandleCorrectScoreRequest/Failure_-_Invalid_Payload_Format
2025/05/31 16:02:45 Starting PostgreSQL container with resource limits...
2025/05/31 16:02:45 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:02:45 ✅ Container created: 3c753e26d0ad
2025/05/31 16:02:45 🐳 Starting container: 3c753e26d0ad
2025/05/31 16:02:46 ✅ Container started: 3c753e26d0ad
2025/05/31 16:02:46 ⏳ Waiting for container id 3c753e26d0ad image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000836598 Strategies:[0xc00068fec0]}
2025/05/31 16:02:51 🔔 Container is ready: 3c753e26d0ad
2025/05/31 16:02:51 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40485/testdb?sslmode=disable
2025/05/31 16:02:51 Starting NATS container with resource limits...
2025/05/31 16:02:51 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:02:51 ✅ Container created: fb26de9eed5e
2025/05/31 16:02:51 🐳 Starting container: fb26de9eed5e
2025/05/31 16:02:52 ✅ Container started: fb26de9eed5e
2025/05/31 16:02:52 ⏳ Waiting for container id fb26de9eed5e image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc0006f0b78 Strategies:[0xc000921740 0xc0005a64e0]}
2025/05/31 16:02:53 🔔 Container is ready: fb26de9eed5e
2025/05/31 16:02:53 NATS container started with resource limits. URL: nats://localhost:40495
Creating round table...
Round table created successfully!
2025/05/31 16:02:53 Ran round migrations group #1
Creating score table...
Score table created successfully!
2025/05/31 16:02:53 Ran score migrations group #2
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:02:53 Ran leaderboard migrations group #3
Creating user table...
User table created successfully!
2025/05/31 16:02:53 Ran user migrations group #4
2025/05/31 16:02:53 All migrations ran successfully
2025/05/31 16:02:53 newDBServiceWithDB - Registering models
2025/05/31 16:02:53 newDBServiceWithDB - Models registered successfully
2025/05/31 16:02:53 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00060e300 RoundDB:0xc00060e460 ScoreDB:0xc00060e468 LeaderboardDB:0xc00060e470 db:0xc00088ea40}
2025/05/31 16:02:53 Truncating tables: scores
2025/05/31 16:02:53 Truncating tables: scores, users, rounds, leaderboards
2025/05/31 16:02:54 Test Case "TestHandleCorrectScoreRequest/Failure_-_Invalid_Payload_Format": Canceling subscription context.
2025/05/31 16:02:54 Test Case "TestHandleCorrectScoreRequest/Failure_-_Invalid_Payload_Format": Waiting for subscriber goroutines to finish.
2025/05/31 16:02:54 Test Case "TestHandleCorrectScoreRequest/Failure_-_Invalid_Payload_Format": Subscriber goroutines finished.
2025/05/31 16:02:54 Running score handler test cleanup...
2025/05/31 16:02:55 Error closing Score module: error closing ScoreRouter: router close timeout
2025/05/31 16:02:55 Score handler router goroutine finished.
2025/05/31 16:02:55 Score handler test cleanup finished.
2025/05/31 16:02:55 Cleaning up test environment...
2025/05/31 16:02:55 Context cancelled.
2025/05/31 16:02:55 EventBus closed.
2025/05/31 16:02:55 NATS connection closed.
2025/05/31 16:02:55 DB connection closed.
2025/05/31 16:02:55 🐳 Stopping container: fb26de9eed5e
2025/05/31 16:02:56 ✅ Container stopped: fb26de9eed5e
2025/05/31 16:02:56 🐳 Terminating container: fb26de9eed5e
2025/05/31 16:02:56 🚫 Container terminated: fb26de9eed5e
2025/05/31 16:02:56 NATS container terminated.
2025/05/31 16:02:56 🐳 Stopping container: 3c753e26d0ad
2025/05/31 16:02:56 ✅ Container stopped: 3c753e26d0ad
2025/05/31 16:02:56 🐳 Terminating container: 3c753e26d0ad
2025/05/31 16:02:57 🚫 Container terminated: 3c753e26d0ad
2025/05/31 16:02:57 PostgreSQL container terminated.
2025/05/31 16:02:57 Cleanup complete.
--- PASS: TestHandleCorrectScoreRequest (59.32s)
    --- PASS: TestHandleCorrectScoreRequest/Success_-_Correct_score_with_valid_data (15.36s)
    --- PASS: TestHandleCorrectScoreRequest/Failure_-_Score_record_not_found (17.92s)
    --- PASS: TestHandleCorrectScoreRequest/Failure_-_Invalid_Score_Value (14.27s)
    --- PASS: TestHandleCorrectScoreRequest/Failure_-_Invalid_Payload_Format (11.77s)
=== RUN   TestHandleProcessRoundScoresRequest
=== RUN   TestHandleProcessRoundScoresRequest/Success_-_Process_Valid_Round_Scores
2025/05/31 16:02:57 Starting PostgreSQL container with resource limits...
2025/05/31 16:02:57 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:02:57 ✅ Container created: cf2975795f6e
2025/05/31 16:02:57 🐳 Starting container: cf2975795f6e
2025/05/31 16:02:58 ✅ Container started: cf2975795f6e
2025/05/31 16:02:58 ⏳ Waiting for container id cf2975795f6e image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc0003ca068 Strategies:[0xc0001700f0]}
2025/05/31 16:03:03 🔔 Container is ready: cf2975795f6e
2025/05/31 16:03:03 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40505/testdb?sslmode=disable
2025/05/31 16:03:03 Starting NATS container with resource limits...
2025/05/31 16:03:03 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:03:03 ✅ Container created: f7adbe0edb16
2025/05/31 16:03:03 🐳 Starting container: f7adbe0edb16
2025/05/31 16:03:05 ✅ Container started: f7adbe0edb16
2025/05/31 16:03:05 ⏳ Waiting for container id f7adbe0edb16 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc00077deb8 Strategies:[0xc000b88b40 0xc000481020]}
2025/05/31 16:03:08 🔔 Container is ready: f7adbe0edb16
2025/05/31 16:03:08 NATS container started with resource limits. URL: nats://localhost:40515
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:03:08 Ran leaderboard migrations group #1
Creating user table...
User table created successfully!
2025/05/31 16:03:08 Ran user migrations group #2
Creating round table...
Round table created successfully!
2025/05/31 16:03:08 Ran round migrations group #3
Creating score table...
Score table created successfully!
2025/05/31 16:03:08 Ran score migrations group #4
2025/05/31 16:03:08 All migrations ran successfully
2025/05/31 16:03:08 newDBServiceWithDB - Registering models
2025/05/31 16:03:08 newDBServiceWithDB - Models registered successfully
2025/05/31 16:03:08 newDBServiceWithDB - DBService initialized: &{UserDB:0xc0004443b0 RoundDB:0xc0004443d8 ScoreDB:0xc0004443e0 LeaderboardDB:0xc0004443e8 db:0xc0008b9d40}
2025/05/31 16:03:08 Truncating tables: scores
2025/05/31 16:03:08 Truncating tables: scores, users, rounds, leaderboards
    process_scores_test.go:273: Waiting for 1 messages on topic "leaderboard.batch.tag.assignment.requested" with timeout 10s
[DEBUG LogScores] Insert/Update Executed for RoundID f143161a-e28b-458f-b2c9-ccf38bdb542e. Error: <nil>, Result: {Locker:0xc00045cc80 resi:1}
2025/05/31 16:03:09 Test received message 27218944-5931-40fe-b773-ca4c43d7cf4d on topic "leaderboard.batch.tag.assignment.requested"
    process_scores_test.go:273: Successfully received 1 messages on topic "leaderboard.batch.tag.assignment.requested"
2025/05/31 16:03:09 Test Case "TestHandleProcessRoundScoresRequest/Success_-_Process_Valid_Round_Scores": Canceling subscription context.
2025/05/31 16:03:09 Test Case "TestHandleProcessRoundScoresRequest/Success_-_Process_Valid_Round_Scores": Waiting for subscriber goroutines to finish.
2025/05/31 16:03:09 Test Case "TestHandleProcessRoundScoresRequest/Success_-_Process_Valid_Round_Scores": Subscriber goroutines finished.
2025/05/31 16:03:09 Running score handler test cleanup...
2025/05/31 16:03:10 Error closing Score module: error closing ScoreRouter: router close timeout
2025/05/31 16:03:10 Score handler router goroutine finished.
2025/05/31 16:03:10 Score handler test cleanup finished.
2025/05/31 16:03:10 Cleaning up test environment...
2025/05/31 16:03:10 Context cancelled.
2025/05/31 16:03:10 EventBus closed.
2025/05/31 16:03:10 NATS connection closed.
2025/05/31 16:03:10 DB connection closed.
2025/05/31 16:03:10 🐳 Stopping container: f7adbe0edb16
2025/05/31 16:03:11 ✅ Container stopped: f7adbe0edb16
2025/05/31 16:03:11 🐳 Terminating container: f7adbe0edb16
2025/05/31 16:03:11 🚫 Container terminated: f7adbe0edb16
2025/05/31 16:03:11 NATS container terminated.
2025/05/31 16:03:11 🐳 Stopping container: cf2975795f6e
2025/05/31 16:03:12 ✅ Container stopped: cf2975795f6e
2025/05/31 16:03:12 🐳 Terminating container: cf2975795f6e
2025/05/31 16:03:12 🚫 Container terminated: cf2975795f6e
2025/05/31 16:03:12 PostgreSQL container terminated.
2025/05/31 16:03:12 Cleanup complete.
=== RUN   TestHandleProcessRoundScoresRequest/Failure_-_Empty_Scores_List
2025/05/31 16:03:12 Starting PostgreSQL container with resource limits...
2025/05/31 16:03:12 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:03:12 ✅ Container created: a076460f87bc
2025/05/31 16:03:12 🐳 Starting container: a076460f87bc
2025/05/31 16:03:13 ✅ Container started: a076460f87bc
2025/05/31 16:03:13 ⏳ Waiting for container id a076460f87bc image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000836dc0 Strategies:[0xc00091f410]}
2025/05/31 16:03:17 🔔 Container is ready: a076460f87bc
2025/05/31 16:03:17 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40530/testdb?sslmode=disable
2025/05/31 16:03:17 Starting NATS container with resource limits...
2025/05/31 16:03:17 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:03:17 ✅ Container created: 3b9fa16e68cb
2025/05/31 16:03:17 🐳 Starting container: 3b9fa16e68cb
2025/05/31 16:03:18 ✅ Container started: 3b9fa16e68cb
2025/05/31 16:03:18 ⏳ Waiting for container id 3b9fa16e68cb image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc0006f0fb8 Strategies:[0xc000920120 0xc00091e4e0]}
2025/05/31 16:03:20 🔔 Container is ready: 3b9fa16e68cb
2025/05/31 16:03:20 NATS container started with resource limits. URL: nats://localhost:40538
Creating user table...
User table created successfully!
2025/05/31 16:03:20 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/31 16:03:20 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/31 16:03:20 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:03:20 Ran leaderboard migrations group #4
2025/05/31 16:03:20 All migrations ran successfully
2025/05/31 16:03:20 newDBServiceWithDB - Registering models
2025/05/31 16:03:20 newDBServiceWithDB - Models registered successfully
2025/05/31 16:03:20 newDBServiceWithDB - DBService initialized: &{UserDB:0xc0002fe0c0 RoundDB:0xc0002fe0c8 ScoreDB:0xc0002fe0d0 LeaderboardDB:0xc0002fe0d8 db:0xc00079a0c0}
2025/05/31 16:03:20 Truncating tables: scores
2025/05/31 16:03:20 Truncating tables: scores, users, rounds, leaderboards
    process_scores_test.go:273: Waiting for 1 messages on topic "score.process.round.scores.fail" with timeout 5s
2025/05/31 16:03:21 Test received message 86df980c-37fd-41ec-a326-544748c36d6f on topic "score.process.round.scores.fail"
    process_scores_test.go:273: Successfully received 1 messages on topic "score.process.round.scores.fail"
2025/05/31 16:03:21 Test Case "TestHandleProcessRoundScoresRequest/Failure_-_Empty_Scores_List": Canceling subscription context.
2025/05/31 16:03:21 Test Case "TestHandleProcessRoundScoresRequest/Failure_-_Empty_Scores_List": Waiting for subscriber goroutines to finish.
2025/05/31 16:03:21 Test Case "TestHandleProcessRoundScoresRequest/Failure_-_Empty_Scores_List": Subscriber goroutines finished.
2025/05/31 16:03:21 Running score handler test cleanup...
2025/05/31 16:03:22 Error closing Score module: error closing ScoreRouter: router close timeout
2025/05/31 16:03:22 Score handler router goroutine finished.
2025/05/31 16:03:22 Score handler test cleanup finished.
2025/05/31 16:03:22 Cleaning up test environment...
2025/05/31 16:03:22 Context cancelled.
2025/05/31 16:03:22 EventBus closed.
2025/05/31 16:03:22 NATS connection closed.
2025/05/31 16:03:22 DB connection closed.
2025/05/31 16:03:22 🐳 Stopping container: 3b9fa16e68cb
2025/05/31 16:03:23 ✅ Container stopped: 3b9fa16e68cb
2025/05/31 16:03:23 🐳 Terminating container: 3b9fa16e68cb
2025/05/31 16:03:23 🚫 Container terminated: 3b9fa16e68cb
2025/05/31 16:03:23 NATS container terminated.
2025/05/31 16:03:23 🐳 Stopping container: a076460f87bc
2025/05/31 16:03:24 ✅ Container stopped: a076460f87bc
2025/05/31 16:03:24 🐳 Terminating container: a076460f87bc
2025/05/31 16:03:24 🚫 Container terminated: a076460f87bc
2025/05/31 16:03:24 PostgreSQL container terminated.
2025/05/31 16:03:24 Cleanup complete.
=== RUN   TestHandleProcessRoundScoresRequest/Failure_-_Invalid_Message_Payload
2025/05/31 16:03:24 Starting PostgreSQL container with resource limits...
2025/05/31 16:03:24 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:03:24 ✅ Container created: e03d9624064b
2025/05/31 16:03:24 🐳 Starting container: e03d9624064b
2025/05/31 16:03:25 ✅ Container started: e03d9624064b
2025/05/31 16:03:25 ⏳ Waiting for container id e03d9624064b image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000649438 Strategies:[0xc0005a7890]}
2025/05/31 16:03:29 🔔 Container is ready: e03d9624064b
2025/05/31 16:03:29 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40549/testdb?sslmode=disable
2025/05/31 16:03:29 Starting NATS container with resource limits...
2025/05/31 16:03:29 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:03:29 ✅ Container created: dc8a694044cd
2025/05/31 16:03:29 🐳 Starting container: dc8a694044cd
2025/05/31 16:03:29 ✅ Container started: dc8a694044cd
2025/05/31 16:03:29 ⏳ Waiting for container id dc8a694044cd image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc00077d1f8 Strategies:[0xc0009219e0 0xc000b01950]}
2025/05/31 16:03:32 🔔 Container is ready: dc8a694044cd
2025/05/31 16:03:32 NATS container started with resource limits. URL: nats://localhost:40555
Creating round table...
Round table created successfully!
2025/05/31 16:03:32 Ran round migrations group #1
Creating score table...
Score table created successfully!
2025/05/31 16:03:32 Ran score migrations group #2
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:03:32 Ran leaderboard migrations group #3
Creating user table...
User table created successfully!
2025/05/31 16:03:32 Ran user migrations group #4
2025/05/31 16:03:32 All migrations ran successfully
2025/05/31 16:03:32 newDBServiceWithDB - Registering models
2025/05/31 16:03:32 newDBServiceWithDB - Models registered successfully
2025/05/31 16:03:32 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00060e5c8 RoundDB:0xc00060e5d8 ScoreDB:0xc00060e5e0 LeaderboardDB:0xc00060e5e8 db:0xc000b9aa40}
2025/05/31 16:03:32 Truncating tables: scores
2025/05/31 16:03:32 Truncating tables: scores, users, rounds, leaderboards
2025/05/31 16:03:33 Test Case "TestHandleProcessRoundScoresRequest/Failure_-_Invalid_Message_Payload": Canceling subscription context.
2025/05/31 16:03:33 Test Case "TestHandleProcessRoundScoresRequest/Failure_-_Invalid_Message_Payload": Waiting for subscriber goroutines to finish.
2025/05/31 16:03:33 Test Case "TestHandleProcessRoundScoresRequest/Failure_-_Invalid_Message_Payload": Subscriber goroutines finished.
2025/05/31 16:03:33 Running score handler test cleanup...
2025/05/31 16:03:34 Error closing Score module: error closing ScoreRouter: router close timeout
2025/05/31 16:03:34 Score handler router goroutine finished.
2025/05/31 16:03:34 Score handler test cleanup finished.
2025/05/31 16:03:34 Cleaning up test environment...
2025/05/31 16:03:34 Context cancelled.
2025/05/31 16:03:34 EventBus closed.
2025/05/31 16:03:34 NATS connection closed.
2025/05/31 16:03:34 DB connection closed.
2025/05/31 16:03:34 🐳 Stopping container: dc8a694044cd
2025/05/31 16:03:35 ✅ Container stopped: dc8a694044cd
2025/05/31 16:03:35 🐳 Terminating container: dc8a694044cd
2025/05/31 16:03:35 🚫 Container terminated: dc8a694044cd
2025/05/31 16:03:35 NATS container terminated.
2025/05/31 16:03:35 🐳 Stopping container: e03d9624064b
2025/05/31 16:03:35 ✅ Container stopped: e03d9624064b
2025/05/31 16:03:35 🐳 Terminating container: e03d9624064b
2025/05/31 16:03:35 🚫 Container terminated: e03d9624064b
2025/05/31 16:03:35 PostgreSQL container terminated.
2025/05/31 16:03:35 Cleanup complete.
--- PASS: TestHandleProcessRoundScoresRequest (38.64s)
    --- PASS: TestHandleProcessRoundScoresRequest/Success_-_Process_Valid_Round_Scores (15.41s)
    --- PASS: TestHandleProcessRoundScoresRequest/Failure_-_Empty_Scores_List (11.60s)
    --- PASS: TestHandleProcessRoundScoresRequest/Failure_-_Invalid_Message_Payload (11.63s)
PASS
coverage: 31.2% of statements in ./app/...
2025/05/31 16:03:35 TestMain: finished with exit code: 0
ok  	github.com/Black-And-White-Club/frolf-bot/integration_tests/modules/score/handler_tests	102.539s	coverage: 31.2% of statements in ./app/...
2025/05/31 16:01:58 TestMain started in package userintegrationtests
=== RUN   TestCreateUser
=== RUN   TestCreateUser/Success_-_Valid_user_creation
2025/05/31 16:01:58 Starting PostgreSQL container with resource limits...
2025/05/31 16:01:58 github.com/testcontainers/testcontainers-go - Connected to docker: 
  Server Version: 28.1.1
  API Version: 1.48
  Operating System: Ubuntu 24.04.1 LTS
  Total Memory: 5923 MB
  Testcontainers for Go Version: v0.37.0
  Resolved Docker Host: unix:///Users/jace/.colima/default/docker.sock
  Resolved Docker Socket Path: /var/run/docker.sock
  Test SessionID: 9db56792615afb05e786a706eb0beac327e763183af153d41570e5011efcddd4
  Test ProcessID: 65a33d70-2b26-4108-a5b6-2a707b744d0d
2025/05/31 16:01:58 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:01:59 ⏳ Waiting for Reaper "069f6d02" to be ready
2025/05/31 16:01:59 🔥 Reaper obtained from Docker for this test session 069f6d02
2025/05/31 16:01:59 ✅ Container created: b62f5ba2bde6
2025/05/31 16:01:59 🐳 Starting container: b62f5ba2bde6
2025/05/31 16:02:00 ✅ Container started: b62f5ba2bde6
2025/05/31 16:02:00 ⏳ Waiting for container id b62f5ba2bde6 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000353c20 Strategies:[0xc0000e2ae0]}
2025/05/31 16:02:07 🔔 Container is ready: b62f5ba2bde6
2025/05/31 16:02:07 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40402/testdb?sslmode=disable
2025/05/31 16:02:07 Starting NATS container with resource limits...
2025/05/31 16:02:07 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:02:08 ✅ Container created: ec0f16b8dea3
2025/05/31 16:02:08 🐳 Starting container: ec0f16b8dea3
2025/05/31 16:02:09 ✅ Container started: ec0f16b8dea3
2025/05/31 16:02:09 ⏳ Waiting for container id ec0f16b8dea3 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc0006d23b0 Strategies:[0xc000698300 0xc000293b60]}
2025/05/31 16:02:12 🔔 Container is ready: ec0f16b8dea3
2025/05/31 16:02:12 NATS container started with resource limits. URL: nats://localhost:40422
Creating user table...
User table created successfully!
2025/05/31 16:02:12 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/31 16:02:12 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/31 16:02:12 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:02:12 Ran leaderboard migrations group #4
2025/05/31 16:02:12 All migrations ran successfully
2025/05/31 16:02:12 newDBServiceWithDB - Registering models
2025/05/31 16:02:12 newDBServiceWithDB - Models registered successfully
2025/05/31 16:02:12 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00011e620 RoundDB:0xc00011e628 ScoreDB:0xc00011e630 LeaderboardDB:0xc00011e638 db:0xc0003ea9c0}
2025/05/31 16:02:12 Truncating tables: users
2025/05/31 16:02:12 Truncating tables: users
2025/05/31 16:02:12 Truncating tables: users
2025/05/31 16:02:12 Cleaning up test environment...
2025/05/31 16:02:12 Context cancelled.
2025/05/31 16:02:12 EventBus closed.
2025/05/31 16:02:12 NATS connection closed.
2025/05/31 16:02:12 DB connection closed.
2025/05/31 16:02:12 🐳 Stopping container: ec0f16b8dea3
2025/05/31 16:02:13 ✅ Container stopped: ec0f16b8dea3
2025/05/31 16:02:13 🐳 Terminating container: ec0f16b8dea3
2025/05/31 16:02:13 🚫 Container terminated: ec0f16b8dea3
2025/05/31 16:02:13 NATS container terminated.
2025/05/31 16:02:13 🐳 Stopping container: b62f5ba2bde6
2025/05/31 16:02:14 ✅ Container stopped: b62f5ba2bde6
2025/05/31 16:02:14 🐳 Terminating container: b62f5ba2bde6
2025/05/31 16:02:14 🚫 Container terminated: b62f5ba2bde6
2025/05/31 16:02:14 PostgreSQL container terminated.
2025/05/31 16:02:14 Cleanup complete.
=== RUN   TestCreateUser/Failure_-_Empty_Discord_ID
2025/05/31 16:02:14 Starting PostgreSQL container with resource limits...
2025/05/31 16:02:14 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:02:14 ✅ Container created: 5c1f0f08790f
2025/05/31 16:02:14 🐳 Starting container: 5c1f0f08790f
2025/05/31 16:02:15 ✅ Container started: 5c1f0f08790f
2025/05/31 16:02:15 ⏳ Waiting for container id 5c1f0f08790f image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000714540 Strategies:[0xc0000c0840]}
2025/05/31 16:02:22 🔔 Container is ready: 5c1f0f08790f
2025/05/31 16:02:22 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40432/testdb?sslmode=disable
2025/05/31 16:02:22 Starting NATS container with resource limits...
2025/05/31 16:02:22 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:02:22 ✅ Container created: 4ae6585149d1
2025/05/31 16:02:22 🐳 Starting container: 4ae6585149d1
2025/05/31 16:02:23 ✅ Container started: 4ae6585149d1
2025/05/31 16:02:23 ⏳ Waiting for container id 4ae6585149d1 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000352100 Strategies:[0xc000405680 0xc0003f4840]}
2025/05/31 16:02:26 🔔 Container is ready: 4ae6585149d1
2025/05/31 16:02:26 NATS container started with resource limits. URL: nats://localhost:40446
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:02:26 Ran leaderboard migrations group #1
Creating user table...
User table created successfully!
2025/05/31 16:02:26 Ran user migrations group #2
Creating round table...
Round table created successfully!
2025/05/31 16:02:26 Ran round migrations group #3
Creating score table...
Score table created successfully!
2025/05/31 16:02:26 Ran score migrations group #4
2025/05/31 16:02:26 All migrations ran successfully
2025/05/31 16:02:26 newDBServiceWithDB - Registering models
2025/05/31 16:02:26 newDBServiceWithDB - Models registered successfully
2025/05/31 16:02:26 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00011e690 RoundDB:0xc00011e698 ScoreDB:0xc00011e6a0 LeaderboardDB:0xc00011e6a8 db:0xc00005f3c0}
2025/05/31 16:02:26 Truncating tables: users
2025/05/31 16:02:26 Truncating tables: users
2025/05/31 16:02:26 Truncating tables: users
2025/05/31 16:02:26 Cleaning up test environment...
2025/05/31 16:02:26 Context cancelled.
2025/05/31 16:02:26 EventBus closed.
2025/05/31 16:02:26 NATS connection closed.
2025/05/31 16:02:26 DB connection closed.
2025/05/31 16:02:26 🐳 Stopping container: 4ae6585149d1
2025/05/31 16:02:27 ✅ Container stopped: 4ae6585149d1
2025/05/31 16:02:27 🐳 Terminating container: 4ae6585149d1
2025/05/31 16:02:27 🚫 Container terminated: 4ae6585149d1
2025/05/31 16:02:27 NATS container terminated.
2025/05/31 16:02:27 🐳 Stopping container: 5c1f0f08790f
2025/05/31 16:02:27 ✅ Container stopped: 5c1f0f08790f
2025/05/31 16:02:27 🐳 Terminating container: 5c1f0f08790f
2025/05/31 16:02:28 🚫 Container terminated: 5c1f0f08790f
2025/05/31 16:02:28 PostgreSQL container terminated.
2025/05/31 16:02:28 Cleanup complete.
=== RUN   TestCreateUser/Failure_-_Negative_tag_number
2025/05/31 16:02:28 Starting PostgreSQL container with resource limits...
2025/05/31 16:02:28 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:02:28 ✅ Container created: 642bab4fa79c
2025/05/31 16:02:28 🐳 Starting container: 642bab4fa79c
2025/05/31 16:02:28 ✅ Container started: 642bab4fa79c
2025/05/31 16:02:28 ⏳ Waiting for container id 642bab4fa79c image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc0000128a8 Strategies:[0xc0003f4300]}
2025/05/31 16:02:34 🔔 Container is ready: 642bab4fa79c
2025/05/31 16:02:34 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40454/testdb?sslmode=disable
2025/05/31 16:02:34 Starting NATS container with resource limits...
2025/05/31 16:02:34 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:02:35 ✅ Container created: 573e1e1186b0
2025/05/31 16:02:35 🐳 Starting container: 573e1e1186b0
2025/05/31 16:02:36 ✅ Container started: 573e1e1186b0
2025/05/31 16:02:36 ⏳ Waiting for container id 573e1e1186b0 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000383c90 Strategies:[0xc000405260 0xc0000c0570]}
2025/05/31 16:02:38 🔔 Container is ready: 573e1e1186b0
2025/05/31 16:02:38 NATS container started with resource limits. URL: nats://localhost:40464
Creating user table...
User table created successfully!
2025/05/31 16:02:38 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/31 16:02:38 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/31 16:02:38 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:02:38 Ran leaderboard migrations group #4
2025/05/31 16:02:38 All migrations ran successfully
2025/05/31 16:02:38 newDBServiceWithDB - Registering models
2025/05/31 16:02:38 newDBServiceWithDB - Models registered successfully
2025/05/31 16:02:38 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00046c050 RoundDB:0xc00046c058 ScoreDB:0xc00046c060 LeaderboardDB:0xc00046c068 db:0xc00005ee00}
2025/05/31 16:02:38 Truncating tables: users
2025/05/31 16:02:38 Truncating tables: users
2025/05/31 16:02:38 Truncating tables: users
2025/05/31 16:02:38 Cleaning up test environment...
2025/05/31 16:02:38 Context cancelled.
2025/05/31 16:02:38 EventBus closed.
2025/05/31 16:02:38 NATS connection closed.
2025/05/31 16:02:38 DB connection closed.
2025/05/31 16:02:38 🐳 Stopping container: 573e1e1186b0
2025/05/31 16:02:39 ✅ Container stopped: 573e1e1186b0
2025/05/31 16:02:39 🐳 Terminating container: 573e1e1186b0
2025/05/31 16:02:39 🚫 Container terminated: 573e1e1186b0
2025/05/31 16:02:39 NATS container terminated.
2025/05/31 16:02:39 🐳 Stopping container: 642bab4fa79c
2025/05/31 16:02:39 ✅ Container stopped: 642bab4fa79c
2025/05/31 16:02:39 🐳 Terminating container: 642bab4fa79c
2025/05/31 16:02:40 🚫 Container terminated: 642bab4fa79c
2025/05/31 16:02:40 PostgreSQL container terminated.
2025/05/31 16:02:40 Cleanup complete.
=== RUN   TestCreateUser/Success_-_Nil_tag_number
2025/05/31 16:02:40 Starting PostgreSQL container with resource limits...
2025/05/31 16:02:40 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:02:40 ✅ Container created: c70a3ccae1bd
2025/05/31 16:02:40 🐳 Starting container: c70a3ccae1bd
2025/05/31 16:02:40 ✅ Container started: c70a3ccae1bd
2025/05/31 16:02:40 ⏳ Waiting for container id c70a3ccae1bd image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc0004b91f8 Strategies:[0xc0005d8b40]}
2025/05/31 16:02:43 🔔 Container is ready: c70a3ccae1bd
2025/05/31 16:02:43 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40477/testdb?sslmode=disable
2025/05/31 16:02:43 Starting NATS container with resource limits...
2025/05/31 16:02:44 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:02:44 ✅ Container created: 591678df0544
2025/05/31 16:02:44 🐳 Starting container: 591678df0544
2025/05/31 16:02:45 ✅ Container started: 591678df0544
2025/05/31 16:02:45 ⏳ Waiting for container id 591678df0544 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000012510 Strategies:[0xc000646cc0 0xc0004edb60]}
2025/05/31 16:02:48 🔔 Container is ready: 591678df0544
2025/05/31 16:02:48 NATS container started with resource limits. URL: nats://localhost:40481
Creating user table...
User table created successfully!
2025/05/31 16:02:48 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/31 16:02:48 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/31 16:02:48 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:02:48 Ran leaderboard migrations group #4
2025/05/31 16:02:48 All migrations ran successfully
2025/05/31 16:02:48 newDBServiceWithDB - Registering models
2025/05/31 16:02:48 newDBServiceWithDB - Models registered successfully
2025/05/31 16:02:48 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00062e0a8 RoundDB:0xc00062e0b0 ScoreDB:0xc00062e0b8 LeaderboardDB:0xc00062e0c0 db:0xc000533340}
2025/05/31 16:02:48 Truncating tables: users
2025/05/31 16:02:48 Truncating tables: users
2025/05/31 16:02:48 Truncating tables: users
2025/05/31 16:02:48 Cleaning up test environment...
2025/05/31 16:02:48 Context cancelled.
2025/05/31 16:02:48 EventBus closed.
2025/05/31 16:02:48 NATS connection closed.
2025/05/31 16:02:48 DB connection closed.
2025/05/31 16:02:48 🐳 Stopping container: 591678df0544
2025/05/31 16:02:49 ✅ Container stopped: 591678df0544
2025/05/31 16:02:49 🐳 Terminating container: 591678df0544
2025/05/31 16:02:49 🚫 Container terminated: 591678df0544
2025/05/31 16:02:49 NATS container terminated.
2025/05/31 16:02:49 🐳 Stopping container: c70a3ccae1bd
2025/05/31 16:02:49 ✅ Container stopped: c70a3ccae1bd
2025/05/31 16:02:49 🐳 Terminating container: c70a3ccae1bd
2025/05/31 16:02:50 🚫 Container terminated: c70a3ccae1bd
2025/05/31 16:02:50 PostgreSQL container terminated.
2025/05/31 16:02:50 Cleanup complete.
=== RUN   TestCreateUser/Failure_-_Nil_context
=== RUN   TestCreateUser/Success_-_Large_tag_number
2025/05/31 16:02:50 Starting PostgreSQL container with resource limits...
2025/05/31 16:02:50 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:02:50 ✅ Container created: 7ee4fab8f25c
2025/05/31 16:02:50 🐳 Starting container: 7ee4fab8f25c
2025/05/31 16:02:51 ✅ Container started: 7ee4fab8f25c
2025/05/31 16:02:51 ⏳ Waiting for container id 7ee4fab8f25c image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc0004b8928 Strategies:[0xc0000e34a0]}
2025/05/31 16:02:54 🔔 Container is ready: 7ee4fab8f25c
2025/05/31 16:02:54 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40488/testdb?sslmode=disable
2025/05/31 16:02:54 Starting NATS container with resource limits...
2025/05/31 16:02:54 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:02:55 ✅ Container created: 07647ecc1605
2025/05/31 16:02:55 🐳 Starting container: 07647ecc1605
2025/05/31 16:02:55 ✅ Container started: 07647ecc1605
2025/05/31 16:02:55 ⏳ Waiting for container id 07647ecc1605 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000310be8 Strategies:[0xc000894000 0xc000896000]}
2025/05/31 16:02:56 🔔 Container is ready: 07647ecc1605
2025/05/31 16:02:56 NATS container started with resource limits. URL: nats://localhost:40501
Creating score table...
Score table created successfully!
2025/05/31 16:02:57 Ran score migrations group #1
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:02:57 Ran leaderboard migrations group #2
Creating user table...
User table created successfully!
2025/05/31 16:02:57 Ran user migrations group #3
Creating round table...
Round table created successfully!
2025/05/31 16:02:57 Ran round migrations group #4
2025/05/31 16:02:57 All migrations ran successfully
2025/05/31 16:02:57 newDBServiceWithDB - Registering models
2025/05/31 16:02:57 newDBServiceWithDB - Models registered successfully
2025/05/31 16:02:57 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00062e208 RoundDB:0xc00062e210 ScoreDB:0xc00062e218 LeaderboardDB:0xc00062e220 db:0xc00089f480}
2025/05/31 16:02:57 Truncating tables: users
2025/05/31 16:02:57 Truncating tables: users
2025/05/31 16:02:57 Truncating tables: users
2025/05/31 16:02:57 Cleaning up test environment...
2025/05/31 16:02:57 Context cancelled.
2025/05/31 16:02:57 EventBus closed.
2025/05/31 16:02:57 NATS connection closed.
2025/05/31 16:02:57 DB connection closed.
2025/05/31 16:02:57 🐳 Stopping container: 07647ecc1605
2025/05/31 16:02:58 ✅ Container stopped: 07647ecc1605
2025/05/31 16:02:58 🐳 Terminating container: 07647ecc1605
2025/05/31 16:02:58 🚫 Container terminated: 07647ecc1605
2025/05/31 16:02:58 NATS container terminated.
2025/05/31 16:02:58 🐳 Stopping container: 7ee4fab8f25c
2025/05/31 16:02:58 ✅ Container stopped: 7ee4fab8f25c
2025/05/31 16:02:58 🐳 Terminating container: 7ee4fab8f25c
2025/05/31 16:02:58 🚫 Container terminated: 7ee4fab8f25c
2025/05/31 16:02:58 PostgreSQL container terminated.
2025/05/31 16:02:58 Cleanup complete.
=== RUN   TestCreateUser/Failure_-_User_already_exists
2025/05/31 16:02:58 Starting PostgreSQL container with resource limits...
2025/05/31 16:02:58 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:02:59 ✅ Container created: 84e68b3340c4
2025/05/31 16:02:59 🐳 Starting container: 84e68b3340c4
2025/05/31 16:03:00 ✅ Container started: 84e68b3340c4
2025/05/31 16:03:00 ⏳ Waiting for container id 84e68b3340c4 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc0007813c8 Strategies:[0xc0008973b0]}
2025/05/31 16:03:05 🔔 Container is ready: 84e68b3340c4
2025/05/31 16:03:05 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40507/testdb?sslmode=disable
2025/05/31 16:03:05 Starting NATS container with resource limits...
2025/05/31 16:03:05 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:03:05 ✅ Container created: ca3c174af102
2025/05/31 16:03:05 🐳 Starting container: ca3c174af102
2025/05/31 16:03:05 ✅ Container started: ca3c174af102
2025/05/31 16:03:05 ⏳ Waiting for container id ca3c174af102 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000013d00 Strategies:[0xc000405ce0 0xc000896060]}
2025/05/31 16:03:08 🔔 Container is ready: ca3c174af102
2025/05/31 16:03:08 NATS container started with resource limits. URL: nats://localhost:40519
Creating user table...
User table created successfully!
2025/05/31 16:03:08 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/31 16:03:08 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/31 16:03:08 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:03:08 Ran leaderboard migrations group #4
2025/05/31 16:03:08 All migrations ran successfully
2025/05/31 16:03:08 newDBServiceWithDB - Registering models
2025/05/31 16:03:08 newDBServiceWithDB - Models registered successfully
2025/05/31 16:03:08 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00046c140 RoundDB:0xc00046c148 ScoreDB:0xc00046c150 LeaderboardDB:0xc00046c158 db:0xc0003ebb40}
2025/05/31 16:03:08 Truncating tables: users
2025/05/31 16:03:08 Truncating tables: users
2025/05/31 16:03:08 Truncating tables: users
2025/05/31 16:03:08 Cleaning up test environment...
2025/05/31 16:03:08 Context cancelled.
2025/05/31 16:03:08 EventBus closed.
2025/05/31 16:03:08 NATS connection closed.
2025/05/31 16:03:08 DB connection closed.
2025/05/31 16:03:08 🐳 Stopping container: ca3c174af102
2025/05/31 16:03:09 ✅ Container stopped: ca3c174af102
2025/05/31 16:03:09 🐳 Terminating container: ca3c174af102
2025/05/31 16:03:09 🚫 Container terminated: ca3c174af102
2025/05/31 16:03:09 NATS container terminated.
2025/05/31 16:03:09 🐳 Stopping container: 84e68b3340c4
2025/05/31 16:03:09 ✅ Container stopped: 84e68b3340c4
2025/05/31 16:03:09 🐳 Terminating container: 84e68b3340c4
2025/05/31 16:03:09 🚫 Container terminated: 84e68b3340c4
2025/05/31 16:03:09 PostgreSQL container terminated.
2025/05/31 16:03:09 Cleanup complete.
--- PASS: TestCreateUser (71.00s)
    --- PASS: TestCreateUser/Success_-_Valid_user_creation (16.04s)
    --- PASS: TestCreateUser/Failure_-_Empty_Discord_ID (13.38s)
    --- PASS: TestCreateUser/Failure_-_Negative_tag_number (12.13s)
    --- PASS: TestCreateUser/Success_-_Nil_tag_number (9.96s)
    --- PASS: TestCreateUser/Failure_-_Nil_context (0.00s)
    --- PASS: TestCreateUser/Success_-_Large_tag_number (8.82s)
    --- PASS: TestCreateUser/Failure_-_User_already_exists (10.67s)
=== RUN   TestGetUser
=== RUN   TestGetUser/Success_-_User_exists
2025/05/31 16:03:09 Starting PostgreSQL container with resource limits...
2025/05/31 16:03:09 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:03:09 ✅ Container created: ba44eeb5b7b9
2025/05/31 16:03:09 🐳 Starting container: ba44eeb5b7b9
2025/05/31 16:03:10 ✅ Container started: ba44eeb5b7b9
2025/05/31 16:03:10 ⏳ Waiting for container id ba44eeb5b7b9 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc00044ec88 Strategies:[0xc0000c04e0]}
2025/05/31 16:03:14 🔔 Container is ready: ba44eeb5b7b9
2025/05/31 16:03:14 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40528/testdb?sslmode=disable
2025/05/31 16:03:14 Starting NATS container with resource limits...
2025/05/31 16:03:14 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:03:14 ✅ Container created: 0dbb11a74516
2025/05/31 16:03:14 🐳 Starting container: 0dbb11a74516
2025/05/31 16:03:15 ✅ Container started: 0dbb11a74516
2025/05/31 16:03:15 ⏳ Waiting for container id 0dbb11a74516 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000781208 Strategies:[0xc0000ae300 0xc00056a300]}
2025/05/31 16:03:16 🔔 Container is ready: 0dbb11a74516
2025/05/31 16:03:16 NATS container started with resource limits. URL: nats://localhost:40532
Creating score table...
Score table created successfully!
2025/05/31 16:03:17 Ran score migrations group #1
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:03:17 Ran leaderboard migrations group #2
Creating user table...
User table created successfully!
2025/05/31 16:03:17 Ran user migrations group #3
Creating round table...
Round table created successfully!
2025/05/31 16:03:17 Ran round migrations group #4
2025/05/31 16:03:17 All migrations ran successfully
2025/05/31 16:03:17 newDBServiceWithDB - Registering models
2025/05/31 16:03:17 newDBServiceWithDB - Models registered successfully
2025/05/31 16:03:17 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00046c2a0 RoundDB:0xc00046c2a8 ScoreDB:0xc00046c2b0 LeaderboardDB:0xc00046c2b8 db:0xc0005ef440}
2025/05/31 16:03:17 Truncating tables: users
2025/05/31 16:03:17 Truncating tables: users
2025/05/31 16:03:17 Truncating tables: users
2025/05/31 16:03:17 Cleaning up test environment...
2025/05/31 16:03:17 Context cancelled.
2025/05/31 16:03:17 EventBus closed.
2025/05/31 16:03:17 NATS connection closed.
2025/05/31 16:03:17 DB connection closed.
2025/05/31 16:03:17 🐳 Stopping container: 0dbb11a74516
2025/05/31 16:03:17 ✅ Container stopped: 0dbb11a74516
2025/05/31 16:03:17 🐳 Terminating container: 0dbb11a74516
2025/05/31 16:03:17 🚫 Container terminated: 0dbb11a74516
2025/05/31 16:03:17 NATS container terminated.
2025/05/31 16:03:17 🐳 Stopping container: ba44eeb5b7b9
2025/05/31 16:03:18 ✅ Container stopped: ba44eeb5b7b9
2025/05/31 16:03:18 🐳 Terminating container: ba44eeb5b7b9
2025/05/31 16:03:18 🚫 Container terminated: ba44eeb5b7b9
2025/05/31 16:03:18 PostgreSQL container terminated.
2025/05/31 16:03:18 Cleanup complete.
=== RUN   TestGetUser/Failure_-_User_does_not_exist
2025/05/31 16:03:18 Starting PostgreSQL container with resource limits...
2025/05/31 16:03:18 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:03:18 ✅ Container created: f5307ac54382
2025/05/31 16:03:18 🐳 Starting container: f5307ac54382
2025/05/31 16:03:18 ✅ Container started: f5307ac54382
2025/05/31 16:03:18 ⏳ Waiting for container id f5307ac54382 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000714600 Strategies:[0xc0000e3ec0]}
2025/05/31 16:03:21 🔔 Container is ready: f5307ac54382
2025/05/31 16:03:21 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40544/testdb?sslmode=disable
2025/05/31 16:03:21 Starting NATS container with resource limits...
2025/05/31 16:03:21 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:03:21 ✅ Container created: 8625685e2872
2025/05/31 16:03:21 🐳 Starting container: 8625685e2872
2025/05/31 16:03:22 ✅ Container started: 8625685e2872
2025/05/31 16:03:22 ⏳ Waiting for container id 8625685e2872 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000012e28 Strategies:[0xc000404d80 0xc000414990]}
2025/05/31 16:03:22 🔔 Container is ready: 8625685e2872
2025/05/31 16:03:22 NATS container started with resource limits. URL: nats://localhost:40545
Creating score table...
Score table created successfully!
2025/05/31 16:03:23 Ran score migrations group #1
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:03:23 Ran leaderboard migrations group #2
Creating user table...
User table created successfully!
2025/05/31 16:03:23 Ran user migrations group #3
Creating round table...
Round table created successfully!
2025/05/31 16:03:23 Ran round migrations group #4
2025/05/31 16:03:23 All migrations ran successfully
2025/05/31 16:03:23 newDBServiceWithDB - Registering models
2025/05/31 16:03:23 newDBServiceWithDB - Models registered successfully
2025/05/31 16:03:23 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00030c0a8 RoundDB:0xc00030c0b0 ScoreDB:0xc00030c0b8 LeaderboardDB:0xc00030c0c0 db:0xc0004705c0}
2025/05/31 16:03:23 Truncating tables: users
2025/05/31 16:03:23 Truncating tables: users
2025/05/31 16:03:23 Truncating tables: users
2025/05/31 16:03:23 Truncating tables: users
2025/05/31 16:03:23 Cleaning up test environment...
2025/05/31 16:03:23 Context cancelled.
2025/05/31 16:03:23 EventBus closed.
2025/05/31 16:03:23 NATS connection closed.
2025/05/31 16:03:23 DB connection closed.
2025/05/31 16:03:23 🐳 Stopping container: 8625685e2872
2025/05/31 16:03:23 ✅ Container stopped: 8625685e2872
2025/05/31 16:03:23 🐳 Terminating container: 8625685e2872
2025/05/31 16:03:23 🚫 Container terminated: 8625685e2872
2025/05/31 16:03:23 NATS container terminated.
2025/05/31 16:03:23 🐳 Stopping container: f5307ac54382
2025/05/31 16:03:24 ✅ Container stopped: f5307ac54382
2025/05/31 16:03:24 🐳 Terminating container: f5307ac54382
2025/05/31 16:03:24 🚫 Container terminated: f5307ac54382
2025/05/31 16:03:24 PostgreSQL container terminated.
2025/05/31 16:03:24 Cleanup complete.
=== RUN   TestGetUser/Failure_-_Empty_Discord_ID
2025/05/31 16:03:24 Starting PostgreSQL container with resource limits...
2025/05/31 16:03:24 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:03:24 ✅ Container created: 0653de1a8ea2
2025/05/31 16:03:24 🐳 Starting container: 0653de1a8ea2
2025/05/31 16:03:25 ✅ Container started: 0653de1a8ea2
2025/05/31 16:03:25 ⏳ Waiting for container id 0653de1a8ea2 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000781aa8 Strategies:[0xc00056b4d0]}
2025/05/31 16:03:29 🔔 Container is ready: 0653de1a8ea2
2025/05/31 16:03:29 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40551/testdb?sslmode=disable
2025/05/31 16:03:29 Starting NATS container with resource limits...
2025/05/31 16:03:29 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:03:29 ✅ Container created: d22c3a2ad7bc
2025/05/31 16:03:29 🐳 Starting container: d22c3a2ad7bc
2025/05/31 16:03:30 ✅ Container started: d22c3a2ad7bc
2025/05/31 16:03:30 ⏳ Waiting for container id d22c3a2ad7bc image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc0008043b8 Strategies:[0xc0000ae840 0xc0004d87b0]}
2025/05/31 16:03:32 🔔 Container is ready: d22c3a2ad7bc
2025/05/31 16:03:32 NATS container started with resource limits. URL: nats://localhost:40558
Creating user table...
User table created successfully!
2025/05/31 16:03:32 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/31 16:03:32 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/31 16:03:32 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:03:32 Ran leaderboard migrations group #4
2025/05/31 16:03:32 All migrations ran successfully
2025/05/31 16:03:32 newDBServiceWithDB - Registering models
2025/05/31 16:03:32 newDBServiceWithDB - Models registered successfully
2025/05/31 16:03:32 newDBServiceWithDB - DBService initialized: &{UserDB:0xc0000d82f8 RoundDB:0xc0000d8310 ScoreDB:0xc0000d8318 LeaderboardDB:0xc0000d8320 db:0xc0002c4b40}
2025/05/31 16:03:32 Truncating tables: users
2025/05/31 16:03:32 Truncating tables: users
2025/05/31 16:03:32 Truncating tables: users
2025/05/31 16:03:32 Cleaning up test environment...
2025/05/31 16:03:32 Context cancelled.
2025/05/31 16:03:32 EventBus closed.
2025/05/31 16:03:32 NATS connection closed.
2025/05/31 16:03:32 DB connection closed.
2025/05/31 16:03:32 🐳 Stopping container: d22c3a2ad7bc
2025/05/31 16:03:33 ✅ Container stopped: d22c3a2ad7bc
2025/05/31 16:03:33 🐳 Terminating container: d22c3a2ad7bc
2025/05/31 16:03:33 🚫 Container terminated: d22c3a2ad7bc
2025/05/31 16:03:33 NATS container terminated.
2025/05/31 16:03:33 🐳 Stopping container: 0653de1a8ea2
2025/05/31 16:03:33 ✅ Container stopped: 0653de1a8ea2
2025/05/31 16:03:33 🐳 Terminating container: 0653de1a8ea2
2025/05/31 16:03:33 🚫 Container terminated: 0653de1a8ea2
2025/05/31 16:03:33 PostgreSQL container terminated.
2025/05/31 16:03:33 Cleanup complete.
--- PASS: TestGetUser (23.76s)
    --- PASS: TestGetUser/Success_-_User_exists (8.90s)
    --- PASS: TestGetUser/Failure_-_User_does_not_exist (6.05s)
    --- PASS: TestGetUser/Failure_-_Empty_Discord_ID (8.81s)
=== RUN   TestGetUserRole
=== RUN   TestGetUserRole/Success_-_Valid_user_role
2025/05/31 16:03:33 Starting PostgreSQL container with resource limits...
2025/05/31 16:03:33 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:03:33 ✅ Container created: 4b6b95d200d3
2025/05/31 16:03:33 🐳 Starting container: 4b6b95d200d3
2025/05/31 16:03:33 ✅ Container started: 4b6b95d200d3
2025/05/31 16:03:33 ⏳ Waiting for container id 4b6b95d200d3 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000805c20 Strategies:[0xc0004d9650]}
2025/05/31 16:03:36 🔔 Container is ready: 4b6b95d200d3
2025/05/31 16:03:36 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40564/testdb?sslmode=disable
2025/05/31 16:03:36 Starting NATS container with resource limits...
2025/05/31 16:03:36 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:03:36 ✅ Container created: b9e58a446802
2025/05/31 16:03:36 🐳 Starting container: b9e58a446802
2025/05/31 16:03:37 ✅ Container started: b9e58a446802
2025/05/31 16:03:37 ⏳ Waiting for container id b9e58a446802 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000805b50 Strategies:[0xc000698420 0xc000415050]}
2025/05/31 16:03:38 🔔 Container is ready: b9e58a446802
2025/05/31 16:03:38 NATS container started with resource limits. URL: nats://localhost:40567
Creating score table...
Score table created successfully!
2025/05/31 16:03:38 Ran score migrations group #1
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:03:38 Ran leaderboard migrations group #2
Creating user table...
User table created successfully!
2025/05/31 16:03:38 Ran user migrations group #3
Creating round table...
Round table created successfully!
2025/05/31 16:03:38 Ran round migrations group #4
2025/05/31 16:03:38 All migrations ran successfully
2025/05/31 16:03:38 newDBServiceWithDB - Registering models
2025/05/31 16:03:38 newDBServiceWithDB - Models registered successfully
2025/05/31 16:03:38 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00046c248 RoundDB:0xc00046c250 ScoreDB:0xc00046c260 LeaderboardDB:0xc00046c280 db:0xc0002c4340}
2025/05/31 16:03:38 Truncating tables: users
2025/05/31 16:03:38 Truncating tables: users
2025/05/31 16:03:38 Truncating tables: users
2025/05/31 16:03:38 Cleaning up test environment...
2025/05/31 16:03:38 Context cancelled.
2025/05/31 16:03:38 EventBus closed.
2025/05/31 16:03:38 NATS connection closed.
2025/05/31 16:03:38 DB connection closed.
2025/05/31 16:03:38 🐳 Stopping container: b9e58a446802
2025/05/31 16:03:39 ✅ Container stopped: b9e58a446802
2025/05/31 16:03:39 🐳 Terminating container: b9e58a446802
2025/05/31 16:03:39 🚫 Container terminated: b9e58a446802
2025/05/31 16:03:39 NATS container terminated.
2025/05/31 16:03:39 🐳 Stopping container: 4b6b95d200d3
2025/05/31 16:03:39 ✅ Container stopped: 4b6b95d200d3
2025/05/31 16:03:39 🐳 Terminating container: 4b6b95d200d3
2025/05/31 16:03:40 🚫 Container terminated: 4b6b95d200d3
2025/05/31 16:03:40 PostgreSQL container terminated.
2025/05/31 16:03:40 Cleanup complete.
=== RUN   TestGetUserRole/Failure_-_User_does_not_exist
2025/05/31 16:03:40 Starting PostgreSQL container with resource limits...
2025/05/31 16:03:40 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:03:40 ✅ Container created: bce934adb687
2025/05/31 16:03:40 🐳 Starting container: bce934adb687
2025/05/31 16:03:40 ✅ Container started: bce934adb687
2025/05/31 16:03:40 ⏳ Waiting for container id bce934adb687 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000012318 Strategies:[0xc0007861b0]}
2025/05/31 16:03:44 🔔 Container is ready: bce934adb687
2025/05/31 16:03:44 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40578/testdb?sslmode=disable
2025/05/31 16:03:44 Starting NATS container with resource limits...
2025/05/31 16:03:44 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:03:44 ✅ Container created: 73159fbfdaad
2025/05/31 16:03:44 🐳 Starting container: 73159fbfdaad
2025/05/31 16:03:44 ✅ Container started: 73159fbfdaad
2025/05/31 16:03:44 ⏳ Waiting for container id 73159fbfdaad image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000782768 Strategies:[0xc000646cc0 0xc00056af60]}
2025/05/31 16:03:46 🔔 Container is ready: 73159fbfdaad
2025/05/31 16:03:46 NATS container started with resource limits. URL: nats://localhost:40579
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:03:47 Ran leaderboard migrations group #1
Creating user table...
User table created successfully!
2025/05/31 16:03:47 Ran user migrations group #2
Creating round table...
Round table created successfully!
2025/05/31 16:03:47 Ran round migrations group #3
Creating score table...
Score table created successfully!
2025/05/31 16:03:47 Ran score migrations group #4
2025/05/31 16:03:47 All migrations ran successfully
2025/05/31 16:03:47 newDBServiceWithDB - Registering models
2025/05/31 16:03:47 newDBServiceWithDB - Models registered successfully
2025/05/31 16:03:47 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00069e270 RoundDB:0xc00069e278 ScoreDB:0xc00069e280 LeaderboardDB:0xc00069e288 db:0xc0002c4500}
2025/05/31 16:03:47 Truncating tables: users
2025/05/31 16:03:47 Truncating tables: users
2025/05/31 16:03:47 Truncating tables: users
2025/05/31 16:03:47 Truncating tables: users
2025/05/31 16:03:47 Cleaning up test environment...
2025/05/31 16:03:47 Context cancelled.
2025/05/31 16:03:47 EventBus closed.
2025/05/31 16:03:47 NATS connection closed.
2025/05/31 16:03:47 DB connection closed.
2025/05/31 16:03:47 🐳 Stopping container: 73159fbfdaad
2025/05/31 16:03:47 ✅ Container stopped: 73159fbfdaad
2025/05/31 16:03:47 🐳 Terminating container: 73159fbfdaad
2025/05/31 16:03:47 🚫 Container terminated: 73159fbfdaad
2025/05/31 16:03:47 NATS container terminated.
2025/05/31 16:03:47 🐳 Stopping container: bce934adb687
2025/05/31 16:03:48 ✅ Container stopped: bce934adb687
2025/05/31 16:03:48 🐳 Terminating container: bce934adb687
2025/05/31 16:03:48 🚫 Container terminated: bce934adb687
2025/05/31 16:03:48 PostgreSQL container terminated.
2025/05/31 16:03:48 Cleanup complete.
=== RUN   TestGetUserRole/Failure_-_Nil_context
--- PASS: TestGetUserRole (14.86s)
    --- PASS: TestGetUserRole/Success_-_Valid_user_role (6.71s)
    --- PASS: TestGetUserRole/Failure_-_User_does_not_exist (8.15s)
    --- PASS: TestGetUserRole/Failure_-_Nil_context (0.00s)
=== RUN   TestUpdateUserRoleInDatabase
=== RUN   TestUpdateUserRoleInDatabase/Success_-_Update_user_role
2025/05/31 16:03:48 Starting PostgreSQL container with resource limits...
2025/05/31 16:03:48 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:03:48 ✅ Container created: 14e256a4a1ad
2025/05/31 16:03:48 🐳 Starting container: 14e256a4a1ad
2025/05/31 16:03:48 ✅ Container started: 14e256a4a1ad
2025/05/31 16:03:48 ⏳ Waiting for container id 14e256a4a1ad image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000782330 Strategies:[0xc0007870b0]}
2025/05/31 16:03:51 🔔 Container is ready: 14e256a4a1ad
2025/05/31 16:03:51 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40588/testdb?sslmode=disable
2025/05/31 16:03:51 Starting NATS container with resource limits...
2025/05/31 16:03:51 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:03:51 ✅ Container created: b16bfc15d2a1
2025/05/31 16:03:51 🐳 Starting container: b16bfc15d2a1
2025/05/31 16:03:52 ✅ Container started: b16bfc15d2a1
2025/05/31 16:03:52 ⏳ Waiting for container id b16bfc15d2a1 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000383060 Strategies:[0xc000698c00 0xc0003f5440]}
2025/05/31 16:03:52 🔔 Container is ready: b16bfc15d2a1
2025/05/31 16:03:52 NATS container started with resource limits. URL: nats://localhost:40593
Creating user table...
User table created successfully!
2025/05/31 16:03:53 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/31 16:03:53 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/31 16:03:53 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:03:53 Ran leaderboard migrations group #4
2025/05/31 16:03:53 All migrations ran successfully
2025/05/31 16:03:53 newDBServiceWithDB - Registering models
2025/05/31 16:03:53 newDBServiceWithDB - Models registered successfully
2025/05/31 16:03:53 newDBServiceWithDB - DBService initialized: &{UserDB:0xc0000d8358 RoundDB:0xc0000d8360 ScoreDB:0xc0000d8368 LeaderboardDB:0xc0000d8370 db:0xc0007195c0}
2025/05/31 16:03:53 Truncating tables: users
2025/05/31 16:03:53 Truncating tables: users
2025/05/31 16:03:53 Truncating tables: users
2025/05/31 16:03:53 Truncating tables: users
2025/05/31 16:03:53 Truncating tables: users
2025/05/31 16:03:53 Cleaning up test environment...
2025/05/31 16:03:53 Context cancelled.
2025/05/31 16:03:53 EventBus closed.
2025/05/31 16:03:53 NATS connection closed.
2025/05/31 16:03:53 DB connection closed.
2025/05/31 16:03:53 🐳 Stopping container: b16bfc15d2a1
2025/05/31 16:03:53 ✅ Container stopped: b16bfc15d2a1
2025/05/31 16:03:53 🐳 Terminating container: b16bfc15d2a1
2025/05/31 16:03:53 🚫 Container terminated: b16bfc15d2a1
2025/05/31 16:03:53 NATS container terminated.
2025/05/31 16:03:53 🐳 Stopping container: 14e256a4a1ad
2025/05/31 16:03:54 ✅ Container stopped: 14e256a4a1ad
2025/05/31 16:03:54 🐳 Terminating container: 14e256a4a1ad
2025/05/31 16:03:54 🚫 Container terminated: 14e256a4a1ad
2025/05/31 16:03:54 PostgreSQL container terminated.
2025/05/31 16:03:54 Cleanup complete.
=== RUN   TestUpdateUserRoleInDatabase/Failure_-_Invalid_role
2025/05/31 16:03:54 Starting PostgreSQL container with resource limits...
2025/05/31 16:03:54 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:03:54 ✅ Container created: 14570d8794cf
2025/05/31 16:03:54 🐳 Starting container: 14570d8794cf
2025/05/31 16:03:54 ✅ Container started: 14570d8794cf
2025/05/31 16:03:54 ⏳ Waiting for container id 14570d8794cf image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000382498 Strategies:[0xc000611860]}
2025/05/31 16:03:58 🔔 Container is ready: 14570d8794cf
2025/05/31 16:03:58 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40597/testdb?sslmode=disable
2025/05/31 16:03:58 Starting NATS container with resource limits...
2025/05/31 16:03:58 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:03:58 ✅ Container created: e3d8bd064542
2025/05/31 16:03:58 🐳 Starting container: e3d8bd064542
2025/05/31 16:03:58 ✅ Container started: e3d8bd064542
2025/05/31 16:03:59 ⏳ Waiting for container id e3d8bd064542 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000783910 Strategies:[0xc000699bc0 0xc0004d9740]}
2025/05/31 16:04:02 🔔 Container is ready: e3d8bd064542
2025/05/31 16:04:02 NATS container started with resource limits. URL: nats://localhost:40603
Creating round table...
Round table created successfully!
2025/05/31 16:04:02 Ran round migrations group #1
Creating score table...
Score table created successfully!
2025/05/31 16:04:02 Ran score migrations group #2
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:04:02 Ran leaderboard migrations group #3
Creating user table...
User table created successfully!
2025/05/31 16:04:02 Ran user migrations group #4
2025/05/31 16:04:02 All migrations ran successfully
2025/05/31 16:04:02 newDBServiceWithDB - Registering models
2025/05/31 16:04:02 newDBServiceWithDB - Models registered successfully
2025/05/31 16:04:02 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00011e7d8 RoundDB:0xc00011e7e0 ScoreDB:0xc00011e7e8 LeaderboardDB:0xc00011e7f0 db:0xc0006ad600}
2025/05/31 16:04:02 Truncating tables: users
2025/05/31 16:04:02 Truncating tables: users
2025/05/31 16:04:02 Truncating tables: users
2025/05/31 16:04:02 Truncating tables: users
2025/05/31 16:04:02 Cleaning up test environment...
2025/05/31 16:04:02 Context cancelled.
2025/05/31 16:04:02 EventBus closed.
2025/05/31 16:04:02 NATS connection closed.
2025/05/31 16:04:02 DB connection closed.
2025/05/31 16:04:02 🐳 Stopping container: e3d8bd064542
2025/05/31 16:04:02 ✅ Container stopped: e3d8bd064542
2025/05/31 16:04:02 🐳 Terminating container: e3d8bd064542
2025/05/31 16:04:03 🚫 Container terminated: e3d8bd064542
2025/05/31 16:04:03 NATS container terminated.
2025/05/31 16:04:03 🐳 Stopping container: 14570d8794cf
2025/05/31 16:04:03 ✅ Container stopped: 14570d8794cf
2025/05/31 16:04:03 🐳 Terminating container: 14570d8794cf
2025/05/31 16:04:03 🚫 Container terminated: 14570d8794cf
2025/05/31 16:04:03 PostgreSQL container terminated.
2025/05/31 16:04:03 Cleanup complete.
=== RUN   TestUpdateUserRoleInDatabase/Failure_-_User_does_not_exist
2025/05/31 16:04:03 Starting PostgreSQL container with resource limits...
2025/05/31 16:04:03 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:04:03 ✅ Container created: 7c8bcb6a89ba
2025/05/31 16:04:03 🐳 Starting container: 7c8bcb6a89ba
2025/05/31 16:04:03 ✅ Container started: 7c8bcb6a89ba
2025/05/31 16:04:03 ⏳ Waiting for container id 7c8bcb6a89ba image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000714570 Strategies:[0xc000786330]}
2025/05/31 16:04:07 🔔 Container is ready: 7c8bcb6a89ba
2025/05/31 16:04:07 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40609/testdb?sslmode=disable
2025/05/31 16:04:07 Starting NATS container with resource limits...
2025/05/31 16:04:07 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:04:08 ✅ Container created: b9a76acb986f
2025/05/31 16:04:08 🐳 Starting container: b9a76acb986f
2025/05/31 16:04:09 ✅ Container started: b9a76acb986f
2025/05/31 16:04:09 ⏳ Waiting for container id b9a76acb986f image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000383010 Strategies:[0xc0005dd980 0xc000786ba0]}
2025/05/31 16:04:10 🔔 Container is ready: b9a76acb986f
2025/05/31 16:04:10 NATS container started with resource limits. URL: nats://localhost:40612
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:04:11 Ran leaderboard migrations group #1
Creating user table...
User table created successfully!
2025/05/31 16:04:11 Ran user migrations group #2
Creating round table...
Round table created successfully!
2025/05/31 16:04:11 Ran round migrations group #3
Creating score table...
Score table created successfully!
2025/05/31 16:04:11 Ran score migrations group #4
2025/05/31 16:04:11 All migrations ran successfully
2025/05/31 16:04:11 newDBServiceWithDB - Registering models
2025/05/31 16:04:11 newDBServiceWithDB - Models registered successfully
2025/05/31 16:04:11 newDBServiceWithDB - DBService initialized: &{UserDB:0xc0000d8038 RoundDB:0xc0000d8058 ScoreDB:0xc0000d80c8 LeaderboardDB:0xc0000d80d0 db:0xc00054d4c0}
2025/05/31 16:04:11 Truncating tables: users
2025/05/31 16:04:11 Truncating tables: users
2025/05/31 16:04:11 Truncating tables: users
2025/05/31 16:04:11 Truncating tables: users
2025/05/31 16:04:11 Truncating tables: users
2025/05/31 16:04:11 Cleaning up test environment...
2025/05/31 16:04:11 Context cancelled.
2025/05/31 16:04:11 EventBus closed.
2025/05/31 16:04:11 NATS connection closed.
2025/05/31 16:04:11 DB connection closed.
2025/05/31 16:04:11 🐳 Stopping container: b9a76acb986f
2025/05/31 16:04:11 ✅ Container stopped: b9a76acb986f
2025/05/31 16:04:11 🐳 Terminating container: b9a76acb986f
2025/05/31 16:04:11 🚫 Container terminated: b9a76acb986f
2025/05/31 16:04:11 NATS container terminated.
2025/05/31 16:04:11 🐳 Stopping container: 7c8bcb6a89ba
2025/05/31 16:04:12 ✅ Container stopped: 7c8bcb6a89ba
2025/05/31 16:04:12 🐳 Terminating container: 7c8bcb6a89ba
2025/05/31 16:04:12 🚫 Container terminated: 7c8bcb6a89ba
2025/05/31 16:04:12 PostgreSQL container terminated.
2025/05/31 16:04:12 Cleanup complete.
=== RUN   TestUpdateUserRoleInDatabase/Failure_-_Nil_context
--- PASS: TestUpdateUserRoleInDatabase (24.18s)
    --- PASS: TestUpdateUserRoleInDatabase/Success_-_Update_user_role (6.10s)
    --- PASS: TestUpdateUserRoleInDatabase/Failure_-_Invalid_role (9.05s)
    --- PASS: TestUpdateUserRoleInDatabase/Failure_-_User_does_not_exist (9.04s)
    --- PASS: TestUpdateUserRoleInDatabase/Failure_-_Nil_context (0.00s)
PASS
coverage: 27.2% of statements in ./app/...
2025/05/31 16:04:12 TestMain: finished with exit code: 0
ok  	github.com/Black-And-White-Club/frolf-bot/integration_tests/modules/user/application_tests	139.125s	coverage: 27.2% of statements in ./app/...
2025/05/31 16:01:59 TestMain started in package userhandler_integration_tests
=== RUN   TestHandleTagAvailable
=== RUN   TestHandleTagAvailable/Success_-_user_created_from_tag_available
2025/05/31 16:01:59 Starting PostgreSQL container with resource limits...
2025/05/31 16:01:59 github.com/testcontainers/testcontainers-go - Connected to docker: 
  Server Version: 28.1.1
  API Version: 1.48
  Operating System: Ubuntu 24.04.1 LTS
  Total Memory: 5923 MB
  Testcontainers for Go Version: v0.37.0
  Resolved Docker Host: unix:///Users/jace/.colima/default/docker.sock
  Resolved Docker Socket Path: /var/run/docker.sock
  Test SessionID: 9db56792615afb05e786a706eb0beac327e763183af153d41570e5011efcddd4
  Test ProcessID: e09cfaf4-555c-4f95-958c-e0a03e73e1d4
2025/05/31 16:01:59 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:01:59 ⏳ Waiting for Reaper "069f6d02" to be ready
2025/05/31 16:01:59 🔥 Reaper obtained from Docker for this test session 069f6d02
2025/05/31 16:01:59 ✅ Container created: 974e239640a0
2025/05/31 16:01:59 🐳 Starting container: 974e239640a0
2025/05/31 16:02:00 ✅ Container started: 974e239640a0
2025/05/31 16:02:00 ⏳ Waiting for container id 974e239640a0 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc0003f6960 Strategies:[0xc000406390]}
2025/05/31 16:02:08 🔔 Container is ready: 974e239640a0
2025/05/31 16:02:08 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40403/testdb?sslmode=disable
2025/05/31 16:02:08 Starting NATS container with resource limits...
2025/05/31 16:02:08 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:02:08 ✅ Container created: 38cebe07505e
2025/05/31 16:02:08 🐳 Starting container: 38cebe07505e
2025/05/31 16:02:09 ✅ Container started: 38cebe07505e
2025/05/31 16:02:09 ⏳ Waiting for container id 38cebe07505e image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc0003868e0 Strategies:[0xc00063e120 0xc000540570]}
2025/05/31 16:02:11 🔔 Container is ready: 38cebe07505e
2025/05/31 16:02:11 NATS container started with resource limits. URL: nats://localhost:40425
Creating user table...
User table created successfully!
2025/05/31 16:02:12 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/31 16:02:12 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/31 16:02:12 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:02:12 Ran leaderboard migrations group #4
2025/05/31 16:02:12 All migrations ran successfully
2025/05/31 16:02:12 newDBServiceWithDB - Registering models
2025/05/31 16:02:12 newDBServiceWithDB - Models registered successfully
2025/05/31 16:02:12 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00007c680 RoundDB:0xc00007c690 ScoreDB:0xc00007c698 LeaderboardDB:0xc00007c6a0 db:0xc00035cb40}
2025/05/31 16:02:12 Truncating tables: users
2025/05/31 16:02:12 Truncating tables: users
    tag_availability_test.go:157: Waiting for 1 messages on topic "user.created" with timeout 5s
2025/05/31 16:02:13 Test received message d34d0c97-1f76-46c1-ab09-fc7c1e22106d on topic "user.created"
    tag_availability_test.go:157: Successfully received 1 messages on topic "user.created"
2025/05/31 16:02:13 Test Case "TestHandleTagAvailable/Success_-_user_created_from_tag_available": Canceling subscription context.
2025/05/31 16:02:13 Test Case "TestHandleTagAvailable/Success_-_user_created_from_tag_available": Waiting for subscriber goroutines to finish.
2025/05/31 16:02:13 Test Case "TestHandleTagAvailable/Success_-_user_created_from_tag_available": Subscriber goroutines finished.
2025/05/31 16:02:13 Running user handler test cleanup...
2025/05/31 16:02:14 Error closing User module: error closing UserRouter: router close timeout
2025/05/31 16:02:14 User handler router goroutine finished.
2025/05/31 16:02:14 User handler test cleanup finished.
2025/05/31 16:02:14 Cleaning up test environment...
2025/05/31 16:02:14 Context cancelled.
2025/05/31 16:02:14 EventBus closed.
2025/05/31 16:02:14 NATS connection closed.
2025/05/31 16:02:14 DB connection closed.
2025/05/31 16:02:14 🐳 Stopping container: 38cebe07505e
2025/05/31 16:02:15 ✅ Container stopped: 38cebe07505e
2025/05/31 16:02:15 🐳 Terminating container: 38cebe07505e
2025/05/31 16:02:15 🚫 Container terminated: 38cebe07505e
2025/05/31 16:02:15 NATS container terminated.
2025/05/31 16:02:15 🐳 Stopping container: 974e239640a0
2025/05/31 16:02:16 ✅ Container stopped: 974e239640a0
2025/05/31 16:02:16 🐳 Terminating container: 974e239640a0
2025/05/31 16:02:16 🚫 Container terminated: 974e239640a0
2025/05/31 16:02:16 PostgreSQL container terminated.
2025/05/31 16:02:16 Cleanup complete.
=== RUN   TestHandleTagAvailable/Failure_-_user_already_exists
2025/05/31 16:02:16 Starting PostgreSQL container with resource limits...
2025/05/31 16:02:16 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:02:17 ✅ Container created: 33d79ae2092f
2025/05/31 16:02:17 🐳 Starting container: 33d79ae2092f
2025/05/31 16:02:18 ✅ Container started: 33d79ae2092f
2025/05/31 16:02:18 ⏳ Waiting for container id 33d79ae2092f image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc0005cc5c8 Strategies:[0xc000406f60]}
2025/05/31 16:02:24 🔔 Container is ready: 33d79ae2092f
2025/05/31 16:02:24 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40436/testdb?sslmode=disable
2025/05/31 16:02:24 Starting NATS container with resource limits...
2025/05/31 16:02:24 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:02:25 ✅ Container created: a55102c7a165
2025/05/31 16:02:25 🐳 Starting container: a55102c7a165
2025/05/31 16:02:25 ✅ Container started: a55102c7a165
2025/05/31 16:02:25 ⏳ Waiting for container id a55102c7a165 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc0004f1510 Strategies:[0xc000995740 0xc000262a80]}
2025/05/31 16:02:29 🔔 Container is ready: a55102c7a165
2025/05/31 16:02:29 NATS container started with resource limits. URL: nats://localhost:40451
Creating user table...
User table created successfully!
2025/05/31 16:02:29 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/31 16:02:29 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/31 16:02:29 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:02:29 Ran leaderboard migrations group #4
2025/05/31 16:02:29 All migrations ran successfully
2025/05/31 16:02:29 newDBServiceWithDB - Registering models
2025/05/31 16:02:29 newDBServiceWithDB - Models registered successfully
2025/05/31 16:02:29 newDBServiceWithDB - DBService initialized: &{UserDB:0xc000682028 RoundDB:0xc000682030 ScoreDB:0xc000682038 LeaderboardDB:0xc000682040 db:0xc000588780}
2025/05/31 16:02:30 Truncating tables: users
2025/05/31 16:02:30 Truncating tables: users
    tag_availability_test.go:157: Waiting for 1 messages on topic "user.creation.failed" with timeout 5s
2025/05/31 16:02:31 Test received message e105cec8-2fb1-4a08-96d4-eb37aa9bace2 on topic "user.creation.failed"
    tag_availability_test.go:157: Successfully received 1 messages on topic "user.creation.failed"
2025/05/31 16:02:31 Test Case "TestHandleTagAvailable/Failure_-_user_already_exists": Canceling subscription context.
2025/05/31 16:02:31 Test Case "TestHandleTagAvailable/Failure_-_user_already_exists": Waiting for subscriber goroutines to finish.
2025/05/31 16:02:31 Test Case "TestHandleTagAvailable/Failure_-_user_already_exists": Subscriber goroutines finished.
2025/05/31 16:02:31 Running user handler test cleanup...
2025/05/31 16:02:32 Error closing User module: error closing UserRouter: router close timeout
2025/05/31 16:02:32 User handler router goroutine finished.
2025/05/31 16:02:32 User handler test cleanup finished.
2025/05/31 16:02:32 Cleaning up test environment...
2025/05/31 16:02:32 Context cancelled.
2025/05/31 16:02:32 EventBus closed.
2025/05/31 16:02:32 NATS connection closed.
2025/05/31 16:02:32 DB connection closed.
2025/05/31 16:02:32 🐳 Stopping container: a55102c7a165
2025/05/31 16:02:33 ✅ Container stopped: a55102c7a165
2025/05/31 16:02:33 🐳 Terminating container: a55102c7a165
2025/05/31 16:02:33 🚫 Container terminated: a55102c7a165
2025/05/31 16:02:33 NATS container terminated.
2025/05/31 16:02:33 🐳 Stopping container: 33d79ae2092f
2025/05/31 16:02:33 ✅ Container stopped: 33d79ae2092f
2025/05/31 16:02:33 🐳 Terminating container: 33d79ae2092f
2025/05/31 16:02:34 🚫 Container terminated: 33d79ae2092f
2025/05/31 16:02:34 PostgreSQL container terminated.
2025/05/31 16:02:34 Cleanup complete.
--- PASS: TestHandleTagAvailable (34.55s)
    --- PASS: TestHandleTagAvailable/Success_-_user_created_from_tag_available (17.21s)
    --- PASS: TestHandleTagAvailable/Failure_-_user_already_exists (17.34s)
=== RUN   TestHandleTagUnavailable
=== RUN   TestHandleTagUnavailable/Always_fails_with_'tag_not_available'
2025/05/31 16:02:34 Starting PostgreSQL container with resource limits...
2025/05/31 16:02:34 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:02:34 ✅ Container created: d0406eb132c5
2025/05/31 16:02:34 🐳 Starting container: d0406eb132c5
2025/05/31 16:02:35 ✅ Container started: d0406eb132c5
2025/05/31 16:02:35 ⏳ Waiting for container id d0406eb132c5 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc0004f00d8 Strategies:[0xc00066ddd0]}
2025/05/31 16:02:39 🔔 Container is ready: d0406eb132c5
2025/05/31 16:02:39 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40463/testdb?sslmode=disable
2025/05/31 16:02:39 Starting NATS container with resource limits...
2025/05/31 16:02:39 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:02:39 ✅ Container created: e393ca5fcbc1
2025/05/31 16:02:39 🐳 Starting container: e393ca5fcbc1
2025/05/31 16:02:40 ✅ Container started: e393ca5fcbc1
2025/05/31 16:02:40 ⏳ Waiting for container id e393ca5fcbc1 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000612610 Strategies:[0xc00087c000 0xc00085aae0]}
2025/05/31 16:02:41 🔔 Container is ready: e393ca5fcbc1
2025/05/31 16:02:41 NATS container started with resource limits. URL: nats://localhost:40474
Creating round table...
Round table created successfully!
2025/05/31 16:02:41 Ran round migrations group #1
Creating score table...
Score table created successfully!
2025/05/31 16:02:41 Ran score migrations group #2
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:02:41 Ran leaderboard migrations group #3
Creating user table...
User table created successfully!
2025/05/31 16:02:41 Ran user migrations group #4
2025/05/31 16:02:41 All migrations ran successfully
2025/05/31 16:02:41 newDBServiceWithDB - Registering models
2025/05/31 16:02:41 newDBServiceWithDB - Models registered successfully
2025/05/31 16:02:41 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00007c750 RoundDB:0xc00007c758 ScoreDB:0xc00007c760 LeaderboardDB:0xc00007c768 db:0xc0007a0f40}
2025/05/31 16:02:41 Truncating tables: users
2025/05/31 16:02:41 Truncating tables: users
    tag_availability_test.go:249: Waiting for 1 messages on topic "user.creation.failed" with timeout 5s
2025/05/31 16:02:42 Test received message 816f1b75-94de-46b2-93f6-337a9ff4ca41 on topic "user.creation.failed"
    tag_availability_test.go:249: Successfully received 1 messages on topic "user.creation.failed"
2025/05/31 16:02:42 Test Case "TestHandleTagUnavailable/Always_fails_with_'tag_not_available'": Canceling subscription context.
2025/05/31 16:02:42 Test Case "TestHandleTagUnavailable/Always_fails_with_'tag_not_available'": Waiting for subscriber goroutines to finish.
2025/05/31 16:02:42 Test Case "TestHandleTagUnavailable/Always_fails_with_'tag_not_available'": Subscriber goroutines finished.
2025/05/31 16:02:42 Running user handler test cleanup...
2025/05/31 16:02:43 Error closing User module: error closing UserRouter: router close timeout
2025/05/31 16:02:43 User handler router goroutine finished.
2025/05/31 16:02:43 User handler test cleanup finished.
2025/05/31 16:02:43 Cleaning up test environment...
2025/05/31 16:02:43 Context cancelled.
2025/05/31 16:02:43 EventBus closed.
2025/05/31 16:02:43 NATS connection closed.
2025/05/31 16:02:43 DB connection closed.
2025/05/31 16:02:43 🐳 Stopping container: e393ca5fcbc1
2025/05/31 16:02:44 ✅ Container stopped: e393ca5fcbc1
2025/05/31 16:02:44 🐳 Terminating container: e393ca5fcbc1
2025/05/31 16:02:44 🚫 Container terminated: e393ca5fcbc1
2025/05/31 16:02:44 NATS container terminated.
2025/05/31 16:02:44 🐳 Stopping container: d0406eb132c5
2025/05/31 16:02:45 ✅ Container stopped: d0406eb132c5
2025/05/31 16:02:45 🐳 Terminating container: d0406eb132c5
2025/05/31 16:02:45 🚫 Container terminated: d0406eb132c5
2025/05/31 16:02:45 PostgreSQL container terminated.
2025/05/31 16:02:45 Cleanup complete.
--- PASS: TestHandleTagUnavailable (11.12s)
    --- PASS: TestHandleTagUnavailable/Always_fails_with_'tag_not_available' (11.12s)
=== RUN   TestHandleUserSignupRequest
=== RUN   TestHandleUserSignupRequest/Success_-_User_Signup_without_Tag
2025/05/31 16:02:45 Starting PostgreSQL container with resource limits...
2025/05/31 16:02:45 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:02:45 ✅ Container created: 196b9744cfbe
2025/05/31 16:02:45 🐳 Starting container: 196b9744cfbe
2025/05/31 16:02:45 ✅ Container started: 196b9744cfbe
2025/05/31 16:02:45 ⏳ Waiting for container id 196b9744cfbe image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000386ca8 Strategies:[0xc0006925a0]}
2025/05/31 16:02:51 🔔 Container is ready: 196b9744cfbe
2025/05/31 16:02:51 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40484/testdb?sslmode=disable
2025/05/31 16:02:51 Starting NATS container with resource limits...
2025/05/31 16:02:51 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:02:51 ✅ Container created: b6dc0d423601
2025/05/31 16:02:51 🐳 Starting container: b6dc0d423601
2025/05/31 16:02:52 ✅ Container started: b6dc0d423601
2025/05/31 16:02:52 ⏳ Waiting for container id b6dc0d423601 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000386238 Strategies:[0xc0006b4060 0xc000b00210]}
2025/05/31 16:02:53 🔔 Container is ready: b6dc0d423601
2025/05/31 16:02:53 NATS container started with resource limits. URL: nats://localhost:40489
Creating user table...
User table created successfully!
2025/05/31 16:02:53 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/31 16:02:53 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/31 16:02:53 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:02:53 Ran leaderboard migrations group #4
2025/05/31 16:02:53 All migrations ran successfully
2025/05/31 16:02:53 newDBServiceWithDB - Registering models
2025/05/31 16:02:53 newDBServiceWithDB - Models registered successfully
2025/05/31 16:02:53 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00007c570 RoundDB:0xc00007c590 ScoreDB:0xc00007c598 LeaderboardDB:0xc00007c5d0 db:0xc0007a0300}
2025/05/31 16:02:53 Truncating tables: users
2025/05/31 16:02:53 Truncating tables: users
    user_creation_test.go:321: Waiting for 1 messages on topic "user.created" with timeout 5s
2025/05/31 16:02:54 Test received message 11a63610-554d-450e-94d1-d1f97de9b4e4 on topic "user.created"
    user_creation_test.go:321: Successfully received 1 messages on topic "user.created"
2025/05/31 16:02:54 Test Case "TestHandleUserSignupRequest/Success_-_User_Signup_without_Tag": Canceling subscription context.
2025/05/31 16:02:54 Test Case "TestHandleUserSignupRequest/Success_-_User_Signup_without_Tag": Waiting for subscriber goroutines to finish.
2025/05/31 16:02:54 Test Case "TestHandleUserSignupRequest/Success_-_User_Signup_without_Tag": Subscriber goroutines finished.
2025/05/31 16:02:54 Running user handler test cleanup...
2025/05/31 16:02:55 Error closing User module: error closing UserRouter: router close timeout
2025/05/31 16:02:55 User handler router goroutine finished.
2025/05/31 16:02:55 User handler test cleanup finished.
2025/05/31 16:02:55 Cleaning up test environment...
2025/05/31 16:02:55 Context cancelled.
2025/05/31 16:02:55 EventBus closed.
2025/05/31 16:02:55 NATS connection closed.
2025/05/31 16:02:55 DB connection closed.
2025/05/31 16:02:55 🐳 Stopping container: b6dc0d423601
2025/05/31 16:02:56 ✅ Container stopped: b6dc0d423601
2025/05/31 16:02:56 🐳 Terminating container: b6dc0d423601
2025/05/31 16:02:56 🚫 Container terminated: b6dc0d423601
2025/05/31 16:02:56 NATS container terminated.
2025/05/31 16:02:56 🐳 Stopping container: 196b9744cfbe
2025/05/31 16:02:57 ✅ Container stopped: 196b9744cfbe
2025/05/31 16:02:57 🐳 Terminating container: 196b9744cfbe
2025/05/31 16:02:57 🚫 Container terminated: 196b9744cfbe
2025/05/31 16:02:57 PostgreSQL container terminated.
2025/05/31 16:02:57 Cleanup complete.
=== RUN   TestHandleUserSignupRequest/Success_-_User_Signup_with_Tag_(requests_availability_check)
2025/05/31 16:02:57 Starting PostgreSQL container with resource limits...
2025/05/31 16:02:57 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:02:57 ✅ Container created: 7f9c35cf643d
2025/05/31 16:02:57 🐳 Starting container: 7f9c35cf643d
2025/05/31 16:02:58 ✅ Container started: 7f9c35cf643d
2025/05/31 16:02:58 ⏳ Waiting for container id 7f9c35cf643d image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000387c80 Strategies:[0xc000540ab0]}
2025/05/31 16:03:03 🔔 Container is ready: 7f9c35cf643d
2025/05/31 16:03:03 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40506/testdb?sslmode=disable
2025/05/31 16:03:03 Starting NATS container with resource limits...
2025/05/31 16:03:03 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:03:03 ✅ Container created: 764255e3e220
2025/05/31 16:03:03 🐳 Starting container: 764255e3e220
2025/05/31 16:03:04 ✅ Container started: 764255e3e220
2025/05/31 16:03:04 ⏳ Waiting for container id 764255e3e220 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000616728 Strategies:[0xc000161560 0xc000997dd0]}
2025/05/31 16:03:08 🔔 Container is ready: 764255e3e220
2025/05/31 16:03:08 NATS container started with resource limits. URL: nats://localhost:40512
Creating score table...
Score table created successfully!
2025/05/31 16:03:08 Ran score migrations group #1
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:03:08 Ran leaderboard migrations group #2
Creating user table...
User table created successfully!
2025/05/31 16:03:08 Ran user migrations group #3
Creating round table...
Round table created successfully!
2025/05/31 16:03:08 Ran round migrations group #4
2025/05/31 16:03:08 All migrations ran successfully
2025/05/31 16:03:08 newDBServiceWithDB - Registering models
2025/05/31 16:03:08 newDBServiceWithDB - Models registered successfully
2025/05/31 16:03:08 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00007ca80 RoundDB:0xc00007ca88 ScoreDB:0xc00007caa8 LeaderboardDB:0xc00007cab8 db:0xc000033000}
2025/05/31 16:03:08 Truncating tables: users
2025/05/31 16:03:08 Truncating tables: users
    user_creation_test.go:321: Waiting for 1 messages on topic "leaderboard.tag.availability.check.requested" with timeout 5s
2025/05/31 16:03:09 Test received message 68419eac-69dd-4210-a2ff-97820205132d on topic "leaderboard.tag.availability.check.requested"
    user_creation_test.go:321: Successfully received 1 messages on topic "leaderboard.tag.availability.check.requested"
2025/05/31 16:03:09 Test Case "TestHandleUserSignupRequest/Success_-_User_Signup_with_Tag_(requests_availability_check)": Canceling subscription context.
2025/05/31 16:03:09 Test Case "TestHandleUserSignupRequest/Success_-_User_Signup_with_Tag_(requests_availability_check)": Waiting for subscriber goroutines to finish.
2025/05/31 16:03:09 Test Case "TestHandleUserSignupRequest/Success_-_User_Signup_with_Tag_(requests_availability_check)": Subscriber goroutines finished.
2025/05/31 16:03:09 Running user handler test cleanup...
2025/05/31 16:03:10 Error closing User module: error closing UserRouter: router close timeout
2025/05/31 16:03:10 User handler router goroutine finished.
2025/05/31 16:03:10 User handler test cleanup finished.
2025/05/31 16:03:10 Cleaning up test environment...
2025/05/31 16:03:10 Context cancelled.
2025/05/31 16:03:10 EventBus closed.
2025/05/31 16:03:10 NATS connection closed.
2025/05/31 16:03:10 DB connection closed.
2025/05/31 16:03:10 🐳 Stopping container: 764255e3e220
2025/05/31 16:03:11 ✅ Container stopped: 764255e3e220
2025/05/31 16:03:11 🐳 Terminating container: 764255e3e220
2025/05/31 16:03:11 🚫 Container terminated: 764255e3e220
2025/05/31 16:03:11 NATS container terminated.
2025/05/31 16:03:11 🐳 Stopping container: 7f9c35cf643d
2025/05/31 16:03:12 ✅ Container stopped: 7f9c35cf643d
2025/05/31 16:03:12 🐳 Terminating container: 7f9c35cf643d
2025/05/31 16:03:12 🚫 Container terminated: 7f9c35cf643d
2025/05/31 16:03:12 PostgreSQL container terminated.
2025/05/31 16:03:12 Cleanup complete.
=== RUN   TestHandleUserSignupRequest/Failure_-_User_Already_Exists_(no_tag)
2025/05/31 16:03:12 Starting PostgreSQL container with resource limits...
2025/05/31 16:03:12 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:03:13 ✅ Container created: bcf81617b697
2025/05/31 16:03:13 🐳 Starting container: bcf81617b697
2025/05/31 16:03:14 ✅ Container started: bcf81617b697
2025/05/31 16:03:14 ⏳ Waiting for container id bcf81617b697 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc0004f05e8 Strategies:[0xc0008dd830]}
2025/05/31 16:03:17 🔔 Container is ready: bcf81617b697
2025/05/31 16:03:17 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40531/testdb?sslmode=disable
2025/05/31 16:03:17 Starting NATS container with resource limits...
2025/05/31 16:03:17 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:03:17 ✅ Container created: 77a433a2980f
2025/05/31 16:03:17 🐳 Starting container: 77a433a2980f
2025/05/31 16:03:18 ✅ Container started: 77a433a2980f
2025/05/31 16:03:18 ⏳ Waiting for container id 77a433a2980f image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000a8eeb8 Strategies:[0xc0006b4c60 0xc0009979b0]}
2025/05/31 16:03:20 🔔 Container is ready: 77a433a2980f
2025/05/31 16:03:20 NATS container started with resource limits. URL: nats://localhost:40541
Creating score table...
Score table created successfully!
2025/05/31 16:03:20 Ran score migrations group #1
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:03:20 Ran leaderboard migrations group #2
Creating user table...
User table created successfully!
2025/05/31 16:03:20 Ran user migrations group #3
Creating round table...
Round table created successfully!
2025/05/31 16:03:20 Ran round migrations group #4
2025/05/31 16:03:20 All migrations ran successfully
2025/05/31 16:03:20 newDBServiceWithDB - Registering models
2025/05/31 16:03:20 newDBServiceWithDB - Models registered successfully
2025/05/31 16:03:20 newDBServiceWithDB - DBService initialized: &{UserDB:0xc0003305a0 RoundDB:0xc0003305a8 ScoreDB:0xc0003305b0 LeaderboardDB:0xc0003305b8 db:0xc0002b8a00}
2025/05/31 16:03:20 Truncating tables: users
2025/05/31 16:03:20 Truncating tables: users
2025/05/31 16:03:21 Pre-created user "testuser-exists-789" for test
    user_creation_test.go:321: Waiting for 1 messages on topic "user.creation.failed" with timeout 5s
2025/05/31 16:03:21 Test received message 607ee83f-23f1-40f6-aeb0-ed7991a8a881 on topic "user.creation.failed"
    user_creation_test.go:321: Successfully received 1 messages on topic "user.creation.failed"
2025/05/31 16:03:21 Test Case "TestHandleUserSignupRequest/Failure_-_User_Already_Exists_(no_tag)": Canceling subscription context.
2025/05/31 16:03:21 Test Case "TestHandleUserSignupRequest/Failure_-_User_Already_Exists_(no_tag)": Waiting for subscriber goroutines to finish.
2025/05/31 16:03:21 Test Case "TestHandleUserSignupRequest/Failure_-_User_Already_Exists_(no_tag)": Subscriber goroutines finished.
2025/05/31 16:03:21 Running user handler test cleanup...
2025/05/31 16:03:22 Error closing User module: error closing UserRouter: router close timeout
2025/05/31 16:03:22 User handler router goroutine finished.
2025/05/31 16:03:22 User handler test cleanup finished.
2025/05/31 16:03:22 Cleaning up test environment...
2025/05/31 16:03:22 Context cancelled.
2025/05/31 16:03:22 EventBus closed.
2025/05/31 16:03:22 NATS connection closed.
2025/05/31 16:03:22 DB connection closed.
2025/05/31 16:03:22 🐳 Stopping container: 77a433a2980f
2025/05/31 16:03:23 ✅ Container stopped: 77a433a2980f
2025/05/31 16:03:23 🐳 Terminating container: 77a433a2980f
2025/05/31 16:03:23 🚫 Container terminated: 77a433a2980f
2025/05/31 16:03:23 NATS container terminated.
2025/05/31 16:03:23 🐳 Stopping container: bcf81617b697
2025/05/31 16:03:23 ✅ Container stopped: bcf81617b697
2025/05/31 16:03:23 🐳 Terminating container: bcf81617b697
2025/05/31 16:03:23 🚫 Container terminated: bcf81617b697
2025/05/31 16:03:23 PostgreSQL container terminated.
2025/05/31 16:03:23 Cleanup complete.
--- PASS: TestHandleUserSignupRequest (38.60s)
    --- PASS: TestHandleUserSignupRequest/Success_-_User_Signup_without_Tag (12.36s)
    --- PASS: TestHandleUserSignupRequest/Success_-_User_Signup_with_Tag_(requests_availability_check) (15.36s)
    --- PASS: TestHandleUserSignupRequest/Failure_-_User_Already_Exists_(no_tag) (10.88s)
=== RUN   TestHandleGetUserRequest
=== RUN   TestHandleGetUserRequest/Success_-_user_found
2025/05/31 16:03:23 Starting PostgreSQL container with resource limits...
2025/05/31 16:03:23 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:03:23 ✅ Container created: ac80cd71a3ad
2025/05/31 16:03:23 🐳 Starting container: ac80cd71a3ad
2025/05/31 16:03:24 ✅ Container started: ac80cd71a3ad
2025/05/31 16:03:24 ⏳ Waiting for container id ac80cd71a3ad image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc00034f070 Strategies:[0xc000996870]}
2025/05/31 16:03:28 🔔 Container is ready: ac80cd71a3ad
2025/05/31 16:03:28 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40548/testdb?sslmode=disable
2025/05/31 16:03:28 Starting NATS container with resource limits...
2025/05/31 16:03:28 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:03:28 ✅ Container created: 5ad3564d8b2c
2025/05/31 16:03:28 🐳 Starting container: 5ad3564d8b2c
2025/05/31 16:03:29 ✅ Container started: 5ad3564d8b2c
2025/05/31 16:03:29 ⏳ Waiting for container id 5ad3564d8b2c image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc0008e4340 Strategies:[0xc0007f24e0 0xc000564660]}
2025/05/31 16:03:32 🔔 Container is ready: 5ad3564d8b2c
2025/05/31 16:03:32 NATS container started with resource limits. URL: nats://localhost:40552
Creating user table...
User table created successfully!
2025/05/31 16:03:32 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/31 16:03:32 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/31 16:03:32 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:03:32 Ran leaderboard migrations group #4
2025/05/31 16:03:32 All migrations ran successfully
2025/05/31 16:03:32 newDBServiceWithDB - Registering models
2025/05/31 16:03:32 newDBServiceWithDB - Models registered successfully
2025/05/31 16:03:32 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00054c5c8 RoundDB:0xc00054c5d8 ScoreDB:0xc00054c5e0 LeaderboardDB:0xc00054c5e8 db:0xc000c23b00}
2025/05/31 16:03:32 Truncating tables: users
2025/05/31 16:03:32 Truncating tables: users
2025/05/31 16:03:33 Warning: Could not create user with tag number in setup, assuming user exists: CreateUser operation failed: user already exists
    user_retrieval_test.go:166: Waiting for 1 messages on topic "user.get.response" with timeout 5s
2025/05/31 16:03:33 Test received message 2c01772a-9403-47d4-a7ca-7b9b56804248 on topic "user.get.response"
    user_retrieval_test.go:166: Successfully received 1 messages on topic "user.get.response"
2025/05/31 16:03:33 Test Case "TestHandleGetUserRequest/Success_-_user_found": Canceling subscription context.
2025/05/31 16:03:33 Test Case "TestHandleGetUserRequest/Success_-_user_found": Waiting for subscriber goroutines to finish.
2025/05/31 16:03:33 Test Case "TestHandleGetUserRequest/Success_-_user_found": Subscriber goroutines finished.
2025/05/31 16:03:33 Running user handler test cleanup...
2025/05/31 16:03:34 Error closing User module: error closing UserRouter: router close timeout
2025/05/31 16:03:34 User handler router goroutine finished.
2025/05/31 16:03:34 User handler test cleanup finished.
2025/05/31 16:03:34 Cleaning up test environment...
2025/05/31 16:03:34 Context cancelled.
2025/05/31 16:03:34 EventBus closed.
2025/05/31 16:03:34 NATS connection closed.
2025/05/31 16:03:34 DB connection closed.
2025/05/31 16:03:34 🐳 Stopping container: 5ad3564d8b2c
2025/05/31 16:03:35 ✅ Container stopped: 5ad3564d8b2c
2025/05/31 16:03:35 🐳 Terminating container: 5ad3564d8b2c
2025/05/31 16:03:35 🚫 Container terminated: 5ad3564d8b2c
2025/05/31 16:03:35 NATS container terminated.
2025/05/31 16:03:35 🐳 Stopping container: ac80cd71a3ad
2025/05/31 16:03:35 ✅ Container stopped: ac80cd71a3ad
2025/05/31 16:03:35 🐳 Terminating container: ac80cd71a3ad
2025/05/31 16:03:36 🚫 Container terminated: ac80cd71a3ad
2025/05/31 16:03:36 PostgreSQL container terminated.
2025/05/31 16:03:36 Cleanup complete.
=== RUN   TestHandleGetUserRequest/Failure_-_user_not_found
2025/05/31 16:03:36 Starting PostgreSQL container with resource limits...
2025/05/31 16:03:36 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:03:36 ✅ Container created: 8b3587ffd2a3
2025/05/31 16:03:36 🐳 Starting container: 8b3587ffd2a3
2025/05/31 16:03:36 ✅ Container started: 8b3587ffd2a3
2025/05/31 16:03:36 ⏳ Waiting for container id 8b3587ffd2a3 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000616420 Strategies:[0xc000c02b70]}
2025/05/31 16:03:40 🔔 Container is ready: 8b3587ffd2a3
2025/05/31 16:03:40 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40566/testdb?sslmode=disable
2025/05/31 16:03:40 Starting NATS container with resource limits...
2025/05/31 16:03:40 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:03:40 ✅ Container created: 47991d2aed45
2025/05/31 16:03:40 🐳 Starting container: 47991d2aed45
2025/05/31 16:03:40 ✅ Container started: 47991d2aed45
2025/05/31 16:03:40 ⏳ Waiting for container id 47991d2aed45 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc0008e5258 Strategies:[0xc0006b4660 0xc000a89980]}
2025/05/31 16:03:44 🔔 Container is ready: 47991d2aed45
2025/05/31 16:03:44 NATS container started with resource limits. URL: nats://localhost:40573
Creating user table...
User table created successfully!
2025/05/31 16:03:44 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/31 16:03:44 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/31 16:03:44 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:03:44 Ran leaderboard migrations group #4
2025/05/31 16:03:44 All migrations ran successfully
2025/05/31 16:03:44 newDBServiceWithDB - Registering models
2025/05/31 16:03:44 newDBServiceWithDB - Models registered successfully
2025/05/31 16:03:44 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00054c308 RoundDB:0xc00054c310 ScoreDB:0xc00054c318 LeaderboardDB:0xc00054c320 db:0xc0008324c0}
2025/05/31 16:03:44 Truncating tables: users
2025/05/31 16:03:44 Truncating tables: users
    user_retrieval_test.go:166: Waiting for 1 messages on topic "user.get.failed" with timeout 5s
2025/05/31 16:03:45 Test received message 176d1784-3f80-4c0f-8b3d-1ba36c1f4215 on topic "user.get.failed"
    user_retrieval_test.go:166: Successfully received 1 messages on topic "user.get.failed"
2025/05/31 16:03:45 Test Case "TestHandleGetUserRequest/Failure_-_user_not_found": Canceling subscription context.
2025/05/31 16:03:45 Test Case "TestHandleGetUserRequest/Failure_-_user_not_found": Waiting for subscriber goroutines to finish.
2025/05/31 16:03:45 Test Case "TestHandleGetUserRequest/Failure_-_user_not_found": Subscriber goroutines finished.
2025/05/31 16:03:45 Running user handler test cleanup...
2025/05/31 16:03:46 Error closing User module: error closing UserRouter: router close timeout
2025/05/31 16:03:46 User handler router goroutine finished.
2025/05/31 16:03:46 User handler test cleanup finished.
2025/05/31 16:03:46 Cleaning up test environment...
2025/05/31 16:03:46 Context cancelled.
2025/05/31 16:03:46 EventBus closed.
2025/05/31 16:03:46 NATS connection closed.
2025/05/31 16:03:46 DB connection closed.
2025/05/31 16:03:46 🐳 Stopping container: 47991d2aed45
2025/05/31 16:03:47 ✅ Container stopped: 47991d2aed45
2025/05/31 16:03:47 🐳 Terminating container: 47991d2aed45
2025/05/31 16:03:47 🚫 Container terminated: 47991d2aed45
2025/05/31 16:03:47 NATS container terminated.
2025/05/31 16:03:47 🐳 Stopping container: 8b3587ffd2a3
2025/05/31 16:03:47 ✅ Container stopped: 8b3587ffd2a3
2025/05/31 16:03:47 🐳 Terminating container: 8b3587ffd2a3
2025/05/31 16:03:47 🚫 Container terminated: 8b3587ffd2a3
2025/05/31 16:03:47 PostgreSQL container terminated.
2025/05/31 16:03:47 Cleanup complete.
--- PASS: TestHandleGetUserRequest (23.84s)
    --- PASS: TestHandleGetUserRequest/Success_-_user_found (12.29s)
    --- PASS: TestHandleGetUserRequest/Failure_-_user_not_found (11.56s)
=== RUN   TestHandleGetUserRoleRequest
=== RUN   TestHandleGetUserRoleRequest/Success_-_role_found
2025/05/31 16:03:47 Starting PostgreSQL container with resource limits...
2025/05/31 16:03:47 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:03:47 ✅ Container created: 14b6c655f6f7
2025/05/31 16:03:47 🐳 Starting container: 14b6c655f6f7
2025/05/31 16:03:48 ✅ Container started: 14b6c655f6f7
2025/05/31 16:03:48 ⏳ Waiting for container id 14b6c655f6f7 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc0008c3c20 Strategies:[0xc000a9e150]}
2025/05/31 16:03:51 🔔 Container is ready: 14b6c655f6f7
2025/05/31 16:03:51 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40587/testdb?sslmode=disable
2025/05/31 16:03:51 Starting NATS container with resource limits...
2025/05/31 16:03:51 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:03:51 ✅ Container created: cc1530b60a3a
2025/05/31 16:03:51 🐳 Starting container: cc1530b60a3a
2025/05/31 16:03:52 ✅ Container started: cc1530b60a3a
2025/05/31 16:03:52 ⏳ Waiting for container id cc1530b60a3a image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000a4aee0 Strategies:[0xc000be17a0 0xc000c03b00]}
2025/05/31 16:03:53 🔔 Container is ready: cc1530b60a3a
2025/05/31 16:03:53 NATS container started with resource limits. URL: nats://localhost:40589
Creating user table...
User table created successfully!
2025/05/31 16:03:53 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/31 16:03:53 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/31 16:03:53 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:03:53 Ran leaderboard migrations group #4
2025/05/31 16:03:53 All migrations ran successfully
2025/05/31 16:03:53 newDBServiceWithDB - Registering models
2025/05/31 16:03:53 newDBServiceWithDB - Models registered successfully
2025/05/31 16:03:53 newDBServiceWithDB - DBService initialized: &{UserDB:0xc000330818 RoundDB:0xc000330820 ScoreDB:0xc000330828 LeaderboardDB:0xc000330830 db:0xc000833280}
2025/05/31 16:03:53 Truncating tables: users
2025/05/31 16:03:53 Truncating tables: users
    user_retrieval_test.go:321: Waiting for 1 messages on topic "discord.user.role.get.response" with timeout 5s
2025/05/31 16:03:54 Test received message 2dc7db45-7b8d-4866-9c97-8530dae6f161 on topic "discord.user.role.get.response"
    user_retrieval_test.go:321: Successfully received 1 messages on topic "discord.user.role.get.response"
2025/05/31 16:03:54 Test Case "TestHandleGetUserRoleRequest/Success_-_role_found": Canceling subscription context.
2025/05/31 16:03:54 Test Case "TestHandleGetUserRoleRequest/Success_-_role_found": Waiting for subscriber goroutines to finish.
2025/05/31 16:03:54 Test Case "TestHandleGetUserRoleRequest/Success_-_role_found": Subscriber goroutines finished.
2025/05/31 16:03:54 Running user handler test cleanup...
2025/05/31 16:03:55 Error closing User module: error closing UserRouter: router close timeout
2025/05/31 16:03:55 User handler router goroutine finished.
2025/05/31 16:03:55 User handler test cleanup finished.
2025/05/31 16:03:55 Cleaning up test environment...
2025/05/31 16:03:55 Context cancelled.
2025/05/31 16:03:55 EventBus closed.
2025/05/31 16:03:55 NATS connection closed.
2025/05/31 16:03:55 DB connection closed.
2025/05/31 16:03:55 🐳 Stopping container: cc1530b60a3a
2025/05/31 16:03:56 ✅ Container stopped: cc1530b60a3a
2025/05/31 16:03:56 🐳 Terminating container: cc1530b60a3a
2025/05/31 16:03:56 🚫 Container terminated: cc1530b60a3a
2025/05/31 16:03:56 NATS container terminated.
2025/05/31 16:03:56 🐳 Stopping container: 14b6c655f6f7
2025/05/31 16:03:56 ✅ Container stopped: 14b6c655f6f7
2025/05/31 16:03:56 🐳 Terminating container: 14b6c655f6f7
2025/05/31 16:03:56 🚫 Container terminated: 14b6c655f6f7
2025/05/31 16:03:56 PostgreSQL container terminated.
2025/05/31 16:03:56 Cleanup complete.
=== RUN   TestHandleGetUserRoleRequest/Failure_-_user_for_role_not_found
2025/05/31 16:03:56 Starting PostgreSQL container with resource limits...
2025/05/31 16:03:56 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:03:56 ✅ Container created: 283dadf8eff3
2025/05/31 16:03:56 🐳 Starting container: 283dadf8eff3
2025/05/31 16:03:57 ✅ Container started: 283dadf8eff3
2025/05/31 16:03:57 ⏳ Waiting for container id 283dadf8eff3 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc0004f04f0 Strategies:[0xc000c5f680]}
2025/05/31 16:04:00 🔔 Container is ready: 283dadf8eff3
2025/05/31 16:04:00 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40599/testdb?sslmode=disable
2025/05/31 16:04:00 Starting NATS container with resource limits...
2025/05/31 16:04:01 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:04:01 ✅ Container created: f45bbafab770
2025/05/31 16:04:01 🐳 Starting container: f45bbafab770
2025/05/31 16:04:01 ✅ Container started: f45bbafab770
2025/05/31 16:04:01 ⏳ Waiting for container id f45bbafab770 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc0006174c0 Strategies:[0xc000c27b00 0xc0008dd530]}
2025/05/31 16:04:01 🔔 Container is ready: f45bbafab770
2025/05/31 16:04:01 NATS container started with resource limits. URL: nats://localhost:40606
Creating user table...
User table created successfully!
2025/05/31 16:04:01 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/31 16:04:01 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/31 16:04:02 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:04:02 Ran leaderboard migrations group #4
2025/05/31 16:04:02 All migrations ran successfully
2025/05/31 16:04:02 newDBServiceWithDB - Registering models
2025/05/31 16:04:02 newDBServiceWithDB - Models registered successfully
2025/05/31 16:04:02 newDBServiceWithDB - DBService initialized: &{UserDB:0xc000682080 RoundDB:0xc000682090 ScoreDB:0xc0006820a8 LeaderboardDB:0xc0006820b0 db:0xc000a98e00}
2025/05/31 16:04:02 Truncating tables: users
2025/05/31 16:04:02 Truncating tables: users
    user_retrieval_test.go:321: Waiting for 1 messages on topic "discord.user.role.get.failed" with timeout 5s
2025/05/31 16:04:03 Test received message 6cc33b09-26f1-4012-a24a-1f6785253ac4 on topic "discord.user.role.get.failed"
    user_retrieval_test.go:321: Successfully received 1 messages on topic "discord.user.role.get.failed"
2025/05/31 16:04:03 Test Case "TestHandleGetUserRoleRequest/Failure_-_user_for_role_not_found": Canceling subscription context.
2025/05/31 16:04:03 Test Case "TestHandleGetUserRoleRequest/Failure_-_user_for_role_not_found": Waiting for subscriber goroutines to finish.
2025/05/31 16:04:03 Test Case "TestHandleGetUserRoleRequest/Failure_-_user_for_role_not_found": Subscriber goroutines finished.
2025/05/31 16:04:03 Running user handler test cleanup...
2025/05/31 16:04:04 Error closing User module: error closing UserRouter: router close timeout
2025/05/31 16:04:04 User handler router goroutine finished.
2025/05/31 16:04:04 User handler test cleanup finished.
2025/05/31 16:04:04 Cleaning up test environment...
2025/05/31 16:04:04 Context cancelled.
2025/05/31 16:04:04 EventBus closed.
2025/05/31 16:04:04 NATS connection closed.
2025/05/31 16:04:04 DB connection closed.
2025/05/31 16:04:04 🐳 Stopping container: f45bbafab770
2025/05/31 16:04:04 ✅ Container stopped: f45bbafab770
2025/05/31 16:04:04 🐳 Terminating container: f45bbafab770
2025/05/31 16:04:04 🚫 Container terminated: f45bbafab770
2025/05/31 16:04:04 NATS container terminated.
2025/05/31 16:04:04 🐳 Stopping container: 283dadf8eff3
2025/05/31 16:04:05 ✅ Container stopped: 283dadf8eff3
2025/05/31 16:04:05 🐳 Terminating container: 283dadf8eff3
2025/05/31 16:04:05 🚫 Container terminated: 283dadf8eff3
2025/05/31 16:04:05 PostgreSQL container terminated.
2025/05/31 16:04:05 Cleanup complete.
--- PASS: TestHandleGetUserRoleRequest (17.94s)
    --- PASS: TestHandleGetUserRoleRequest/Success_-_role_found (9.17s)
    --- PASS: TestHandleGetUserRoleRequest/Failure_-_user_for_role_not_found (8.78s)
=== RUN   TestHandleUserRoleUpdateRequest
=== RUN   TestHandleUserRoleUpdateRequest/Success_-_role_updated
2025/05/31 16:04:05 Starting PostgreSQL container with resource limits...
2025/05/31 16:04:05 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:04:05 ✅ Container created: 9b761f4bad11
2025/05/31 16:04:05 🐳 Starting container: 9b761f4bad11
2025/05/31 16:04:06 ✅ Container started: 9b761f4bad11
2025/05/31 16:04:06 ⏳ Waiting for container id 9b761f4bad11 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000c9cdc0 Strategies:[0xc0006a9da0]}
2025/05/31 16:04:10 🔔 Container is ready: 9b761f4bad11
2025/05/31 16:04:10 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40610/testdb?sslmode=disable
2025/05/31 16:04:10 Starting NATS container with resource limits...
2025/05/31 16:04:10 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:04:10 ✅ Container created: a8f9a43b6681
2025/05/31 16:04:10 🐳 Starting container: a8f9a43b6681
2025/05/31 16:04:11 ✅ Container started: a8f9a43b6681
2025/05/31 16:04:11 ⏳ Waiting for container id a8f9a43b6681 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000616aa0 Strategies:[0xc0004a3320 0xc000de0f00]}
2025/05/31 16:04:14 🔔 Container is ready: a8f9a43b6681
2025/05/31 16:04:14 NATS container started with resource limits. URL: nats://localhost:40618
Creating user table...
User table created successfully!
2025/05/31 16:04:14 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/31 16:04:14 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/31 16:04:14 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:04:14 Ran leaderboard migrations group #4
2025/05/31 16:04:14 All migrations ran successfully
2025/05/31 16:04:14 newDBServiceWithDB - Registering models
2025/05/31 16:04:14 newDBServiceWithDB - Models registered successfully
2025/05/31 16:04:14 newDBServiceWithDB - DBService initialized: &{UserDB:0xc000620600 RoundDB:0xc000620618 ScoreDB:0xc000620620 LeaderboardDB:0xc000620628 db:0xc0007a0d40}
2025/05/31 16:04:14 Truncating tables: users
2025/05/31 16:04:14 Truncating tables: users
    user_role_test.go:249: Waiting for 1 messages on topic "discord.user.role.updated" with timeout 5s
2025/05/31 16:04:15 Test received message f9b9ac7d-50b6-4be4-89e5-032bd7dbb5fd on topic "discord.user.role.updated"
    user_role_test.go:249: Successfully received 1 messages on topic "discord.user.role.updated"
2025/05/31 16:04:15 Test Case "TestHandleUserRoleUpdateRequest/Success_-_role_updated": Canceling subscription context.
2025/05/31 16:04:15 Test Case "TestHandleUserRoleUpdateRequest/Success_-_role_updated": Waiting for subscriber goroutines to finish.
2025/05/31 16:04:15 Test Case "TestHandleUserRoleUpdateRequest/Success_-_role_updated": Subscriber goroutines finished.
2025/05/31 16:04:15 Running user handler test cleanup...
2025/05/31 16:04:16 Error closing User module: error closing UserRouter: router close timeout
2025/05/31 16:04:16 User handler router goroutine finished.
2025/05/31 16:04:16 User handler test cleanup finished.
2025/05/31 16:04:16 Cleaning up test environment...
2025/05/31 16:04:16 Context cancelled.
2025/05/31 16:04:16 EventBus closed.
2025/05/31 16:04:16 NATS connection closed.
2025/05/31 16:04:16 DB connection closed.
2025/05/31 16:04:16 🐳 Stopping container: a8f9a43b6681
2025/05/31 16:04:16 ✅ Container stopped: a8f9a43b6681
2025/05/31 16:04:16 🐳 Terminating container: a8f9a43b6681
2025/05/31 16:04:16 🚫 Container terminated: a8f9a43b6681
2025/05/31 16:04:16 NATS container terminated.
2025/05/31 16:04:16 🐳 Stopping container: 9b761f4bad11
2025/05/31 16:04:17 ✅ Container stopped: 9b761f4bad11
2025/05/31 16:04:17 🐳 Terminating container: 9b761f4bad11
2025/05/31 16:04:17 🚫 Container terminated: 9b761f4bad11
2025/05/31 16:04:17 PostgreSQL container terminated.
2025/05/31 16:04:17 Cleanup complete.
=== RUN   TestHandleUserRoleUpdateRequest/Failure_-_invalid_role
2025/05/31 16:04:17 Starting PostgreSQL container with resource limits...
2025/05/31 16:04:17 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:04:17 ✅ Container created: af8af136787b
2025/05/31 16:04:17 🐳 Starting container: af8af136787b
2025/05/31 16:04:17 ✅ Container started: af8af136787b
2025/05/31 16:04:17 ⏳ Waiting for container id af8af136787b image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc0004f1450 Strategies:[0xc000bc4ed0]}
2025/05/31 16:04:20 🔔 Container is ready: af8af136787b
2025/05/31 16:04:20 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40621/testdb?sslmode=disable
2025/05/31 16:04:20 Starting NATS container with resource limits...
2025/05/31 16:04:20 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:04:21 ✅ Container created: 8632314a212a
2025/05/31 16:04:21 🐳 Starting container: 8632314a212a
2025/05/31 16:04:21 ✅ Container started: 8632314a212a
2025/05/31 16:04:21 ⏳ Waiting for container id 8632314a212a image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000f818f0 Strategies:[0xc000c27980 0xc000a9fa10]}
2025/05/31 16:04:23 🔔 Container is ready: 8632314a212a
2025/05/31 16:04:23 NATS container started with resource limits. URL: nats://localhost:40623
Creating round table...
Round table created successfully!
2025/05/31 16:04:23 Ran round migrations group #1
Creating score table...
Score table created successfully!
2025/05/31 16:04:23 Ran score migrations group #2
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:04:23 Ran leaderboard migrations group #3
Creating user table...
User table created successfully!
2025/05/31 16:04:23 Ran user migrations group #4
2025/05/31 16:04:23 All migrations ran successfully
2025/05/31 16:04:23 newDBServiceWithDB - Registering models
2025/05/31 16:04:23 newDBServiceWithDB - Models registered successfully
2025/05/31 16:04:23 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00054c820 RoundDB:0xc00054c828 ScoreDB:0xc00054c830 LeaderboardDB:0xc00054c838 db:0xc000a99300}
2025/05/31 16:04:23 Truncating tables: users
2025/05/31 16:04:23 Truncating tables: users
    user_role_test.go:249: Waiting for 1 messages on topic "discord.user.role.update.failed" with timeout 5s
2025/05/31 16:04:24 Test received message c3edbcd4-764a-46cf-8fcf-e4aaac9d8ff3 on topic "discord.user.role.update.failed"
    user_role_test.go:249: Successfully received 1 messages on topic "discord.user.role.update.failed"
2025/05/31 16:04:24 Test Case "TestHandleUserRoleUpdateRequest/Failure_-_invalid_role": Canceling subscription context.
2025/05/31 16:04:24 Test Case "TestHandleUserRoleUpdateRequest/Failure_-_invalid_role": Waiting for subscriber goroutines to finish.
2025/05/31 16:04:24 Test Case "TestHandleUserRoleUpdateRequest/Failure_-_invalid_role": Subscriber goroutines finished.
2025/05/31 16:04:24 Running user handler test cleanup...
2025/05/31 16:04:25 Error closing User module: error closing UserRouter: router close timeout
2025/05/31 16:04:25 User handler router goroutine finished.
2025/05/31 16:04:25 User handler test cleanup finished.
2025/05/31 16:04:25 Cleaning up test environment...
2025/05/31 16:04:25 Context cancelled.
2025/05/31 16:04:25 EventBus closed.
2025/05/31 16:04:25 NATS connection closed.
2025/05/31 16:04:25 DB connection closed.
2025/05/31 16:04:25 🐳 Stopping container: 8632314a212a
2025/05/31 16:04:25 ✅ Container stopped: 8632314a212a
2025/05/31 16:04:25 🐳 Terminating container: 8632314a212a
2025/05/31 16:04:25 🚫 Container terminated: 8632314a212a
2025/05/31 16:04:25 NATS container terminated.
2025/05/31 16:04:25 🐳 Stopping container: af8af136787b
2025/05/31 16:04:26 ✅ Container stopped: af8af136787b
2025/05/31 16:04:26 🐳 Terminating container: af8af136787b
2025/05/31 16:04:26 🚫 Container terminated: af8af136787b
2025/05/31 16:04:26 PostgreSQL container terminated.
2025/05/31 16:04:26 Cleanup complete.
=== RUN   TestHandleUserRoleUpdateRequest/Failure_-_user_not_found
2025/05/31 16:04:26 Starting PostgreSQL container with resource limits...
2025/05/31 16:04:26 🐳 Creating container for image postgres:16-alpine
2025/05/31 16:04:26 ✅ Container created: e2e8177c0b8f
2025/05/31 16:04:26 🐳 Starting container: e2e8177c0b8f
2025/05/31 16:04:26 ✅ Container started: e2e8177c0b8f
2025/05/31 16:04:26 ⏳ Waiting for container id e2e8177c0b8f image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc00034ffc8 Strategies:[0xc000ec4390]}
2025/05/31 16:04:29 🔔 Container is ready: e2e8177c0b8f
2025/05/31 16:04:29 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:40630/testdb?sslmode=disable
2025/05/31 16:04:29 Starting NATS container with resource limits...
2025/05/31 16:04:29 🐳 Creating container for image nats:2.10-alpine
2025/05/31 16:04:29 ✅ Container created: e972aa513293
2025/05/31 16:04:29 🐳 Starting container: e972aa513293
2025/05/31 16:04:29 ✅ Container started: e972aa513293
2025/05/31 16:04:29 ⏳ Waiting for container id e972aa513293 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc0004f0138 Strategies:[0xc000ec3740 0xc000de03f0]}
2025/05/31 16:04:31 🔔 Container is ready: e972aa513293
2025/05/31 16:04:31 NATS container started with resource limits. URL: nats://localhost:40634
Creating user table...
User table created successfully!
2025/05/31 16:04:32 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/31 16:04:32 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/31 16:04:32 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/31 16:04:32 Ran leaderboard migrations group #4
2025/05/31 16:04:32 All migrations ran successfully
2025/05/31 16:04:32 newDBServiceWithDB - Registering models
2025/05/31 16:04:32 newDBServiceWithDB - Models registered successfully
2025/05/31 16:04:32 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00007cb78 RoundDB:0xc00007cb88 ScoreDB:0xc00007cba0 LeaderboardDB:0xc00007cbc0 db:0xc0006520c0}
2025/05/31 16:04:32 Truncating tables: users
2025/05/31 16:04:32 Truncating tables: users
    user_role_test.go:249: Waiting for 1 messages on topic "discord.user.role.update.failed" with timeout 5s
2025/05/31 16:04:32 Test received message e4847f5c-db45-4677-8b72-a6745a39a3d2 on topic "discord.user.role.update.failed"
    user_role_test.go:249: Successfully received 1 messages on topic "discord.user.role.update.failed"
2025/05/31 16:04:33 Test Case "TestHandleUserRoleUpdateRequest/Failure_-_user_not_found": Canceling subscription context.
2025/05/31 16:04:33 Test Case "TestHandleUserRoleUpdateRequest/Failure_-_user_not_found": Waiting for subscriber goroutines to finish.
2025/05/31 16:04:33 Test Case "TestHandleUserRoleUpdateRequest/Failure_-_user_not_found": Subscriber goroutines finished.
2025/05/31 16:04:33 Running user handler test cleanup...
2025/05/31 16:04:34 Error closing User module: error closing UserRouter: router close timeout
2025/05/31 16:04:34 User handler router goroutine finished.
2025/05/31 16:04:34 User handler test cleanup finished.
2025/05/31 16:04:34 Cleaning up test environment...
2025/05/31 16:04:34 Context cancelled.
2025/05/31 16:04:34 EventBus closed.
2025/05/31 16:04:34 NATS connection closed.
2025/05/31 16:04:34 DB connection closed.
2025/05/31 16:04:34 🐳 Stopping container: e972aa513293
2025/05/31 16:04:34 ✅ Container stopped: e972aa513293
2025/05/31 16:04:34 🐳 Terminating container: e972aa513293
2025/05/31 16:04:34 🚫 Container terminated: e972aa513293
2025/05/31 16:04:34 NATS container terminated.
2025/05/31 16:04:34 🐳 Stopping container: e2e8177c0b8f
2025/05/31 16:04:34 ✅ Container stopped: e2e8177c0b8f
2025/05/31 16:04:34 🐳 Terminating container: e2e8177c0b8f
2025/05/31 16:04:34 🚫 Container terminated: e2e8177c0b8f
2025/05/31 16:04:34 PostgreSQL container terminated.
2025/05/31 16:04:34 Cleanup complete.
--- PASS: TestHandleUserRoleUpdateRequest (29.45s)
    --- PASS: TestHandleUserRoleUpdateRequest/Success_-_role_updated (11.75s)
    --- PASS: TestHandleUserRoleUpdateRequest/Failure_-_invalid_role (8.92s)
    --- PASS: TestHandleUserRoleUpdateRequest/Failure_-_user_not_found (8.78s)
PASS
coverage: 38.5% of statements in ./app/...
2025/05/31 16:04:34 TestMain: finished with exit code: 0
ok  	github.com/Black-And-White-Club/frolf-bot/integration_tests/modules/user/handler_tests	160.430s	coverage: 38.5% of statements in ./app/...
?   	github.com/Black-And-White-Club/frolf-bot/integration_tests/testutils	[no test files]
