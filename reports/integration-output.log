	github.com/Black-And-White-Club/frolf-bot/integration_tests/containers		coverage: 0.0% of statements
2025/05/30 08:05:03 TestMain started in package leaderboardintegrationtests
2025/05/30 08:05:03 TestMain: Initializing global test environment...
2025/05/30 08:05:03 Starting PostgreSQL container with resource limits...
2025/05/30 08:05:03 github.com/testcontainers/testcontainers-go - Connected to docker: 
  Server Version: 28.1.1
  API Version: 1.48
  Operating System: Ubuntu 24.04.1 LTS
  Total Memory: 5923 MB
  Testcontainers for Go Version: v0.37.0
  Resolved Docker Host: unix:///Users/jace/.colima/default/docker.sock
  Resolved Docker Socket Path: /var/run/docker.sock
  Test SessionID: 1c3e5913ff4c8d72222fa8df6b3ad50fa0270000fc9316f5df82cdbd728ebba2
  Test ProcessID: 9caebc7c-3a35-4af7-818c-136148f74886
2025/05/30 08:05:03 üê≥ Creating container for image postgres:16-alpine
2025/05/30 08:05:03 üê≥ Creating container for image testcontainers/ryuk:0.11.0
2025/05/30 08:05:03 ‚úÖ Container created: 16723bdfc8e3
2025/05/30 08:05:03 üê≥ Starting container: 16723bdfc8e3
2025/05/30 08:05:03 ‚úÖ Container started: 16723bdfc8e3
2025/05/30 08:05:03 ‚è≥ Waiting for container id 16723bdfc8e3 image: testcontainers/ryuk:0.11.0. Waiting for: &{Port:8080/tcp timeout:<nil> PollInterval:100ms skipInternalCheck:false}
2025/05/30 08:05:07 üîî Container is ready: 16723bdfc8e3
2025/05/30 08:05:08 ‚úÖ Container created: 4f5098062e2d
2025/05/30 08:05:08 üê≥ Starting container: 4f5098062e2d
2025/05/30 08:05:08 ‚úÖ Container started: 4f5098062e2d
2025/05/30 08:05:08 ‚è≥ Waiting for container id 4f5098062e2d image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000546f28 Strategies:[0xc00055ddd0]}
2025/05/30 08:05:16 üîî Container is ready: 4f5098062e2d
2025/05/30 08:05:16 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:33684/testdb?sslmode=disable
2025/05/30 08:05:16 Starting NATS container with resource limits...
2025/05/30 08:05:16 üê≥ Creating container for image nats:2.10-alpine
2025/05/30 08:05:16 ‚úÖ Container created: bcf47d601f23
2025/05/30 08:05:16 üê≥ Starting container: bcf47d601f23
2025/05/30 08:05:17 ‚úÖ Container started: bcf47d601f23
2025/05/30 08:05:17 ‚è≥ Waiting for container id bcf47d601f23 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc0005cb998 Strategies:[0xc00059b0e0 0xc00051bc20]}
2025/05/30 08:05:21 üîî Container is ready: bcf47d601f23
2025/05/30 08:05:21 NATS container started with resource limits. URL: nats://localhost:33699
Creating user table...
User table created successfully!
2025/05/30 08:05:21 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/30 08:05:21 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/30 08:05:21 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/30 08:05:21 Ran leaderboard migrations group #4
2025/05/30 08:05:21 All migrations ran successfully
2025/05/30 08:05:21 newDBServiceWithDB - Registering models
2025/05/30 08:05:21 newDBServiceWithDB - Models registered successfully
2025/05/30 08:05:21 newDBServiceWithDB - DBService initialized: &{UserDB:0xc0005ae168 RoundDB:0xc0005ae170 ScoreDB:0xc0005ae1a0 LeaderboardDB:0xc0005ae1b0 db:0xc0003f5f00}
2025/05/30 08:05:21 TestMain: Global test environment initialized successfully.
2025/05/30 08:05:21 TestMain: Running tests with m.Run()...
2025/05/30 08:05:21 TestMain: Container recreation configured every 20 tests
=== RUN   TestProcessTagAssignments
2025/05/30 08:05:21 Truncating tables: rounds
2025/05/30 08:05:21 Truncating tables: users
2025/05/30 08:05:21 Truncating tables: scores
2025/05/30 08:05:21 Truncating tables: leaderboards
2025/05/30 08:05:21 Truncating tables: leaderboards
=== RUN   TestProcessTagAssignments/Successful_batch_assignment
=== RUN   TestProcessTagAssignments/Batch_assignment_with_some_invalid_tag_numbers_and_non-existent_users
    batch_tag_assign_test.go:551: Failed to set up test data: ERROR: duplicate key value violates unique constraint "users_pkey" (SQLSTATE 23505)
=== RUN   TestProcessTagAssignments/Empty_assignments_list
    batch_tag_assign_test.go:551: Failed to set up test data: ERROR: duplicate key value violates unique constraint "users_pkey" (SQLSTATE 23505)
=== RUN   TestProcessTagAssignments/Single_assignment_that_requires_tag_swap
    batch_tag_assign_test.go:551: Failed to set up test data: ERROR: duplicate key value violates unique constraint "users_pkey" (SQLSTATE 23505)
--- FAIL: TestProcessTagAssignments (0.10s)
    --- PASS: TestProcessTagAssignments/Successful_batch_assignment (0.05s)
    --- FAIL: TestProcessTagAssignments/Batch_assignment_with_some_invalid_tag_numbers_and_non-existent_users (0.00s)
    --- FAIL: TestProcessTagAssignments/Empty_assignments_list (0.00s)
    --- FAIL: TestProcessTagAssignments/Single_assignment_that_requires_tag_swap (0.00s)
=== RUN   TestGetLeaderboard
2025/05/30 08:05:21 Truncating tables: rounds
2025/05/30 08:05:21 Truncating tables: users
2025/05/30 08:05:22 Truncating tables: scores
2025/05/30 08:05:22 Truncating tables: leaderboards
2025/05/30 08:05:22 Truncating tables: leaderboards
=== RUN   TestGetLeaderboard/Successful_retrieval_of_active_leaderboard_with_data
=== RUN   TestGetLeaderboard/Retrieval_when_no_active_leaderboard_exists
=== RUN   TestGetLeaderboard/Successful_retrieval_of_active_leaderboard_with_empty_data
--- PASS: TestGetLeaderboard (0.08s)
    --- PASS: TestGetLeaderboard/Successful_retrieval_of_active_leaderboard_with_data (0.02s)
    --- PASS: TestGetLeaderboard/Retrieval_when_no_active_leaderboard_exists (0.01s)
    --- PASS: TestGetLeaderboard/Successful_retrieval_of_active_leaderboard_with_empty_data (0.01s)
=== RUN   TestRoundGetTagByUserID
2025/05/30 08:05:22 Truncating tables: rounds
2025/05/30 08:05:22 Truncating tables: users
2025/05/30 08:05:22 Truncating tables: scores
2025/05/30 08:05:22 Truncating tables: leaderboards
2025/05/30 08:05:22 Truncating tables: leaderboards
=== RUN   TestRoundGetTagByUserID/Successful_retrieval_of_tag_for_user_with_tag
=== RUN   TestRoundGetTagByUserID/User_exists_but_has_no_tag_number
2025/05/30 08:05:22 WARN No tag found for user in active leaderboard data user_id=user_no_tag
=== RUN   TestRoundGetTagByUserID/User_ID_not_found_in_database
2025/05/30 08:05:22 WARN No tag found for user in active leaderboard data user_id=non_existent_user
--- PASS: TestRoundGetTagByUserID (0.10s)
    --- PASS: TestRoundGetTagByUserID/Successful_retrieval_of_tag_for_user_with_tag (0.02s)
    --- PASS: TestRoundGetTagByUserID/User_exists_but_has_no_tag_number (0.02s)
    --- PASS: TestRoundGetTagByUserID/User_ID_not_found_in_database (0.01s)
=== RUN   TestGetTagByUserID
2025/05/30 08:05:22 Truncating tables: rounds
2025/05/30 08:05:22 Truncating tables: users
2025/05/30 08:05:22 Truncating tables: scores
2025/05/30 08:05:22 Truncating tables: leaderboards
2025/05/30 08:05:22 Truncating tables: leaderboards
=== RUN   TestGetTagByUserID/Successful_retrieval_of_tag_for_user_with_tag
=== RUN   TestGetTagByUserID/User_exists_but_has_no_tag_number
2025/05/30 08:05:22 WARN No tag found for user in active leaderboard data user_id=user_C
=== RUN   TestGetTagByUserID/User_ID_not_found_in_database
2025/05/30 08:05:22 WARN No tag found for user in active leaderboard data user_id=non_existent_user_2
--- PASS: TestGetTagByUserID (0.07s)
    --- PASS: TestGetTagByUserID/Successful_retrieval_of_tag_for_user_with_tag (0.01s)
    --- PASS: TestGetTagByUserID/User_exists_but_has_no_tag_number (0.01s)
    --- PASS: TestGetTagByUserID/User_ID_not_found_in_database (0.01s)
=== RUN   TestTagAssignmentRequested
2025/05/30 08:05:22 Truncating tables: rounds
2025/05/30 08:05:22 Truncating tables: users
2025/05/30 08:05:22 Truncating tables: scores
2025/05/30 08:05:22 Truncating tables: leaderboards
2025/05/30 08:05:22 Truncating tables: leaderboards
=== RUN   TestTagAssignmentRequested/Successful_tag_assignment_to_a_new_user
    tag_assignment_test.go:428: Expected no error, but got: invalid source type: leaderboardevents.TagAssignmentRequestedPayload
    tag_assignment_test.go:433: Expected a success result payload, but got nil
    tag_assignment_test.go:65: Expected success result, but got nil
    tag_assignment_test.go:103: Expected 2 leaderboard records (old inactive, new active), got 1
=== RUN   TestTagAssignmentRequested/Tag_swap_is_triggered_when_user_with_tag_claims_another_user's_tag
    tag_assignment_test.go:428: Expected no error, but got: invalid source type: leaderboardevents.TagAssignmentRequestedPayload
    tag_assignment_test.go:433: Expected a success result payload, but got nil
    tag_assignment_test.go:179: Expected swap result of type *TagSwapRequestedPayload, but got <nil>
    tag_assignment_test.go:199: Expected 1 leaderboard record in DB (no swap performed yet), got 2
=== RUN   TestTagAssignmentRequested/Tag_assignment_fails_if_tag_is_already_assigned
    tag_assignment_test.go:428: Expected no error, but got: invalid source type: leaderboardevents.TagAssignmentRequestedPayload
    tag_assignment_test.go:232: Expected failure result, but got nil
    tag_assignment_test.go:269: Expected 1 leaderboard record in DB, got 3
=== RUN   TestTagAssignmentRequested/Tag_assignment_fails_if_no_active_leaderboard_exists
    tag_assignment_test.go:317: Expected 0 leaderboard records in DB, got 3
=== RUN   TestTagAssignmentRequested/Tag_assignment_fails_for_invalid_tag_number_(e.g.,_negative)
    tag_assignment_test.go:428: Expected no error, but got: invalid source type: leaderboardevents.TagAssignmentRequestedPayload
    tag_assignment_test.go:347: Expected failure result, but got nil
    tag_assignment_test.go:384: Expected 1 leaderboard record in DB, got 4
--- FAIL: TestTagAssignmentRequested (0.08s)
    --- FAIL: TestTagAssignmentRequested/Successful_tag_assignment_to_a_new_user (0.01s)
    --- FAIL: TestTagAssignmentRequested/Tag_swap_is_triggered_when_user_with_tag_claims_another_user's_tag (0.01s)
    --- FAIL: TestTagAssignmentRequested/Tag_assignment_fails_if_tag_is_already_assigned (0.01s)
    --- FAIL: TestTagAssignmentRequested/Tag_assignment_fails_if_no_active_leaderboard_exists (0.01s)
    --- FAIL: TestTagAssignmentRequested/Tag_assignment_fails_for_invalid_tag_number_(e.g.,_negative) (0.01s)
=== RUN   TestCheckTagAvailability
2025/05/30 08:05:22 Truncating tables: rounds
2025/05/30 08:05:22 Truncating tables: users
2025/05/30 08:05:22 Truncating tables: scores
2025/05/30 08:05:22 Truncating tables: leaderboards
2025/05/30 08:05:22 Truncating tables: leaderboards
=== RUN   TestCheckTagAvailability/Tag_is_available_when_no_active_leaderboard_exists
=== RUN   TestCheckTagAvailability/Tag_is_available_when_active_leaderboard_exists_but_tag_is_not_assigned
=== RUN   TestCheckTagAvailability/Tag_is_not_available_when_active_leaderboard_exists_and_tag_is_assigned
    tag_availability_test.go:190: Expected tag to be unavailable, but it was available
=== RUN   TestCheckTagAvailability/Tag_availability_check_succeeds_for_invalid_tag_number_(e.g.,_negative)
    tag_availability_test.go:270: Expected 1 leaderboard record in DB, got 3
--- FAIL: TestCheckTagAvailability (0.09s)
    --- PASS: TestCheckTagAvailability/Tag_is_available_when_no_active_leaderboard_exists (0.01s)
    --- PASS: TestCheckTagAvailability/Tag_is_available_when_active_leaderboard_exists_but_tag_is_not_assigned (0.01s)
    --- FAIL: TestCheckTagAvailability/Tag_is_not_available_when_active_leaderboard_exists_and_tag_is_assigned (0.01s)
    --- FAIL: TestCheckTagAvailability/Tag_availability_check_succeeds_for_invalid_tag_number_(e.g.,_negative) (0.01s)
=== RUN   TestTagSwapRequested
2025/05/30 08:05:22 Truncating tables: rounds
2025/05/30 08:05:22 Truncating tables: users
2025/05/30 08:05:22 Truncating tables: scores
2025/05/30 08:05:22 Truncating tables: leaderboards
2025/05/30 08:05:22 Truncating tables: leaderboards
=== RUN   TestTagSwapRequested/Successful_tag_swap_between_two_users
=== RUN   TestTagSwapRequested/Tag_swap_fails_if_requestor_does_not_have_a_tag
    tag_swap_test.go:424: Expected no success result, but got: &{RequestorID:user_swap_A TargetID:user_swap_B}
    tag_swap_test.go:161: Expected failure result, but got nil
    tag_swap_test.go:191: Expected 1 leaderboard record in DB, got 4
=== RUN   TestTagSwapRequested/Tag_swap_fails_if_target_does_not_have_a_tag
    tag_swap_test.go:260: Expected 1 leaderboard record in DB, got 5
=== RUN   TestTagSwapRequested/Tag_swap_fails_if_neither_user_has_a_tag
    tag_swap_test.go:328: Expected 1 leaderboard record in DB, got 6
=== RUN   TestTagSwapRequested/Tag_swap_fails_if_no_active_leaderboard_exists
    tag_swap_test.go:392: Expected 0 leaderboard records in DB, got 6
--- FAIL: TestTagSwapRequested (0.13s)
    --- PASS: TestTagSwapRequested/Successful_tag_swap_between_two_users (0.03s)
    --- FAIL: TestTagSwapRequested/Tag_swap_fails_if_requestor_does_not_have_a_tag (0.03s)
    --- FAIL: TestTagSwapRequested/Tag_swap_fails_if_target_does_not_have_a_tag (0.01s)
    --- FAIL: TestTagSwapRequested/Tag_swap_fails_if_neither_user_has_a_tag (0.01s)
    --- FAIL: TestTagSwapRequested/Tag_swap_fails_if_no_active_leaderboard_exists (0.01s)
FAIL
coverage: 63.6% of statements
2025/05/30 08:05:22 TestMain: m.Run() finished with exit code: 1
FAIL	github.com/Black-And-White-Club/frolf-bot/integration_tests/modules/leaderboard/application_tests	22.591s
2025/05/30 08:05:04 TestMain started in package leaderboardhandler_integration_tests
2025/05/30 08:05:04 TestMain: Initializing global test environment...
2025/05/30 08:05:04 Starting PostgreSQL container with resource limits...
2025/05/30 08:05:04 github.com/testcontainers/testcontainers-go - Connected to docker: 
  Server Version: 28.1.1
  API Version: 1.48
  Operating System: Ubuntu 24.04.1 LTS
  Total Memory: 5923 MB
  Testcontainers for Go Version: v0.37.0
  Resolved Docker Host: unix:///Users/jace/.colima/default/docker.sock
  Resolved Docker Socket Path: /var/run/docker.sock
  Test SessionID: 1c3e5913ff4c8d72222fa8df6b3ad50fa0270000fc9316f5df82cdbd728ebba2
  Test ProcessID: dacc9c2e-c8b0-480e-80c2-71f29f4fd141
2025/05/30 08:05:04 üê≥ Creating container for image postgres:16-alpine
2025/05/30 08:05:04 ‚è≥ Waiting for Reaper "16723bdf" to be ready
2025/05/30 08:05:07 üî• Reaper obtained from Docker for this test session 16723bdf
2025/05/30 08:05:07 ‚úÖ Container created: 5844c16ebd57
2025/05/30 08:05:07 üê≥ Starting container: 5844c16ebd57
2025/05/30 08:05:08 ‚úÖ Container started: 5844c16ebd57
2025/05/30 08:05:08 ‚è≥ Waiting for container id 5844c16ebd57 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc00042e528 Strategies:[0xc000417b30]}
2025/05/30 08:05:16 üîî Container is ready: 5844c16ebd57
2025/05/30 08:05:16 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:33681/testdb?sslmode=disable
2025/05/30 08:05:16 Starting NATS container with resource limits...
2025/05/30 08:05:16 üê≥ Creating container for image nats:2.10-alpine
2025/05/30 08:05:16 ‚úÖ Container created: e21690eb002a
2025/05/30 08:05:16 üê≥ Starting container: e21690eb002a
2025/05/30 08:05:17 ‚úÖ Container started: e21690eb002a
2025/05/30 08:05:17 ‚è≥ Waiting for container id e21690eb002a image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc00080c3c0 Strategies:[0xc000644180 0xc000481500]}
2025/05/30 08:05:21 üîî Container is ready: e21690eb002a
2025/05/30 08:05:21 NATS container started with resource limits. URL: nats://localhost:33702
Creating score table...
Score table created successfully!
2025/05/30 08:05:21 Ran score migrations group #1
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/30 08:05:21 Ran leaderboard migrations group #2
Creating user table...
User table created successfully!
2025/05/30 08:05:21 Ran user migrations group #3
Creating round table...
Round table created successfully!
2025/05/30 08:05:21 Ran round migrations group #4
2025/05/30 08:05:21 All migrations ran successfully
2025/05/30 08:05:21 newDBServiceWithDB - Registering models
2025/05/30 08:05:21 newDBServiceWithDB - Models registered successfully
2025/05/30 08:05:21 newDBServiceWithDB - DBService initialized: &{UserDB:0xc000444110 RoundDB:0xc000444118 ScoreDB:0xc000444120 LeaderboardDB:0xc000444128 db:0xc00037ac40}
2025/05/30 08:05:21 TestMain: Global test environment initialized successfully.
2025/05/30 08:05:21 TestMain: Running tests with m.Run()...
2025/05/30 08:05:21 TestMain: Container recreation configured every 20 tests
=== RUN   TestHandleBatchTagAssignmentRequested
=== RUN   TestHandleBatchTagAssignmentRequested/Success_-_Process_Valid_Batch_Assignments
2025/05/30 08:05:21 Truncating tables: rounds
2025/05/30 08:05:21 Truncating tables: users
2025/05/30 08:05:21 Truncating tables: scores
2025/05/30 08:05:21 Truncating tables: leaderboards
2025/05/30 08:05:21 Cleaned up NATS JetStream state for leaderboard handler streams before test
2025/05/30 08:05:21 Truncating tables: users, scores, leaderboards, rounds
2025/05/30 08:05:21 Truncated relevant tables before test
    batch_tag_assign_test.go:373: Waiting for 1 messages on topic "discord.leaderboard.batch.tag.assigned" with timeout 5s
2025/05/30 08:05:22 Test received message ffde8f5b-74a0-4daa-8693-6968130dd25c on topic "discord.leaderboard.batch.tag.assigned"
    batch_tag_assign_test.go:373: Successfully received 1 messages on topic "discord.leaderboard.batch.tag.assigned"
    batch_tag_assign_test.go:161: Actual leaderboard data: map[374621655:20 564563005:2 838788034:10 952071614:1]
2025/05/30 08:05:22 Test Case "TestHandleBatchTagAssignmentRequested/Success_-_Process_Valid_Batch_Assignments": Canceling subscription context.
2025/05/30 08:05:22 Test Case "TestHandleBatchTagAssignmentRequested/Success_-_Process_Valid_Batch_Assignments": Waiting for subscriber goroutines to finish.
2025/05/30 08:05:22 Test Case "TestHandleBatchTagAssignmentRequested/Success_-_Process_Valid_Batch_Assignments": Subscriber goroutines finished.
2025/05/30 08:05:22 Running leaderboard handler test cleanup...
2025/05/30 08:05:23 Error closing Leaderboard module in test cleanup: error closing LeaderboardRouter: router close timeout
2025/05/30 08:05:23 Leaderboard handler router goroutine finished.
2025/05/30 08:05:23 Leaderboard handler test cleanup finished.
=== RUN   TestHandleBatchTagAssignmentRequested/Success_-_Batch_Assignment_with_Already_Assigned_Tag_
2025/05/30 08:05:23 Truncating tables: rounds
2025/05/30 08:05:23 Truncating tables: users
2025/05/30 08:05:23 Truncating tables: scores
2025/05/30 08:05:23 Truncating tables: leaderboards
2025/05/30 08:05:23 Cleaned up NATS JetStream state for leaderboard handler streams before test
2025/05/30 08:05:23 Truncating tables: users, scores, leaderboards, rounds
2025/05/30 08:05:23 Truncated relevant tables before test
    batch_tag_assign_test.go:373: Waiting for 1 messages on topic "discord.leaderboard.batch.tag.assigned" with timeout 5s
2025/05/30 08:05:24 Test received message 40d87cff-22fd-41ce-9a99-d5913c1229a7 on topic "discord.leaderboard.batch.tag.assigned"
    batch_tag_assign_test.go:373: Successfully received 1 messages on topic "discord.leaderboard.batch.tag.assigned"
2025/05/30 08:05:24 Test Case "TestHandleBatchTagAssignmentRequested/Success_-_Batch_Assignment_with_Already_Assigned_Tag_": Canceling subscription context.
2025/05/30 08:05:24 Test Case "TestHandleBatchTagAssignmentRequested/Success_-_Batch_Assignment_with_Already_Assigned_Tag_": Waiting for subscriber goroutines to finish.
2025/05/30 08:05:24 Test Case "TestHandleBatchTagAssignmentRequested/Success_-_Batch_Assignment_with_Already_Assigned_Tag_": Subscriber goroutines finished.
2025/05/30 08:05:24 Running leaderboard handler test cleanup...
2025/05/30 08:05:25 Error closing Leaderboard module in test cleanup: error closing LeaderboardRouter: router close timeout
2025/05/30 08:05:25 Leaderboard handler router goroutine finished.
2025/05/30 08:05:25 Leaderboard handler test cleanup finished.
=== RUN   TestHandleBatchTagAssignmentRequested/Failure_-_Invalid_Message_Payload_(Unmarshal_Error)
2025/05/30 08:05:25 Truncating tables: rounds
2025/05/30 08:05:25 Truncating tables: users
2025/05/30 08:05:25 Truncating tables: scores
2025/05/30 08:05:25 Truncating tables: leaderboards
2025/05/30 08:05:25 Cleaned up NATS JetStream state for leaderboard handler streams before test
2025/05/30 08:05:25 Truncating tables: users, scores, leaderboards, rounds
2025/05/30 08:05:25 Truncated relevant tables before test
2025/05/30 08:05:26 Test Case "TestHandleBatchTagAssignmentRequested/Failure_-_Invalid_Message_Payload_(Unmarshal_Error)": Canceling subscription context.
2025/05/30 08:05:26 Test Case "TestHandleBatchTagAssignmentRequested/Failure_-_Invalid_Message_Payload_(Unmarshal_Error)": Waiting for subscriber goroutines to finish.
2025/05/30 08:05:26 Test Case "TestHandleBatchTagAssignmentRequested/Failure_-_Invalid_Message_Payload_(Unmarshal_Error)": Subscriber goroutines finished.
2025/05/30 08:05:26 Running leaderboard handler test cleanup...
2025/05/30 08:05:27 Error closing Leaderboard module in test cleanup: error closing LeaderboardRouter: router close timeout
2025/05/30 08:05:27 Leaderboard handler router goroutine finished.
2025/05/30 08:05:27 Leaderboard handler test cleanup finished.
=== RUN   TestHandleBatchTagAssignmentRequested/Failure_-_Service_Returns_Error
2025/05/30 08:05:27 Truncating tables: rounds
2025/05/30 08:05:27 Truncating tables: users
2025/05/30 08:05:27 Truncating tables: scores
2025/05/30 08:05:27 Truncating tables: leaderboards
2025/05/30 08:05:27 Cleaned up NATS JetStream state for leaderboard handler streams before test
2025/05/30 08:05:27 Truncating tables: users, scores, leaderboards, rounds
2025/05/30 08:05:27 Truncated relevant tables before test
2025/05/30 08:05:28 Test Case "TestHandleBatchTagAssignmentRequested/Failure_-_Service_Returns_Error": Canceling subscription context.
2025/05/30 08:05:28 Test Case "TestHandleBatchTagAssignmentRequested/Failure_-_Service_Returns_Error": Waiting for subscriber goroutines to finish.
2025/05/30 08:05:28 Test Case "TestHandleBatchTagAssignmentRequested/Failure_-_Service_Returns_Error": Subscriber goroutines finished.
2025/05/30 08:05:28 Running leaderboard handler test cleanup...
2025/05/30 08:05:29 Error closing Leaderboard module in test cleanup: error closing LeaderboardRouter: router close timeout
2025/05/30 08:05:29 Leaderboard handler router goroutine finished.
2025/05/30 08:05:29 Leaderboard handler test cleanup finished.
--- PASS: TestHandleBatchTagAssignmentRequested (7.72s)
    --- PASS: TestHandleBatchTagAssignmentRequested/Success_-_Process_Valid_Batch_Assignments (1.99s)
    --- PASS: TestHandleBatchTagAssignmentRequested/Success_-_Batch_Assignment_with_Already_Assigned_Tag_ (2.05s)
    --- PASS: TestHandleBatchTagAssignmentRequested/Failure_-_Invalid_Message_Payload_(Unmarshal_Error) (1.84s)
    --- PASS: TestHandleBatchTagAssignmentRequested/Failure_-_Service_Returns_Error (1.85s)
=== RUN   TestHandleGetLeaderboardRequested
=== RUN   TestHandleGetLeaderboardRequested/Success_-_Get_Leaderboard_With_Data
2025/05/30 08:05:29 Truncating tables: rounds
2025/05/30 08:05:29 Truncating tables: users
2025/05/30 08:05:29 Truncating tables: scores
2025/05/30 08:05:29 Truncating tables: leaderboards
2025/05/30 08:05:29 Cleaned up NATS JetStream state for leaderboard handler streams before test
2025/05/30 08:05:29 Truncating tables: users, scores, leaderboards, rounds
2025/05/30 08:05:29 Truncated relevant tables before test
    get_leaderboard_test.go:240: Waiting for 1 messages on topic "discord.get.leaderboard.success" with timeout 5s
2025/05/30 08:05:30 Test received message f03406cf-186f-4760-bf4a-e24a9910458e on topic "discord.get.leaderboard.success"
    get_leaderboard_test.go:240: Successfully received 1 messages on topic "discord.get.leaderboard.success"
2025/05/30 08:05:30 Test Case "TestHandleGetLeaderboardRequested/Success_-_Get_Leaderboard_With_Data": Canceling subscription context.
2025/05/30 08:05:30 Test Case "TestHandleGetLeaderboardRequested/Success_-_Get_Leaderboard_With_Data": Waiting for subscriber goroutines to finish.
2025/05/30 08:05:30 Test Case "TestHandleGetLeaderboardRequested/Success_-_Get_Leaderboard_With_Data": Subscriber goroutines finished.
2025/05/30 08:05:30 Running leaderboard handler test cleanup...
2025/05/30 08:05:31 Error closing Leaderboard module in test cleanup: error closing LeaderboardRouter: router close timeout
2025/05/30 08:05:31 Leaderboard handler router goroutine finished.
2025/05/30 08:05:31 Leaderboard handler test cleanup finished.
=== RUN   TestHandleGetLeaderboardRequested/Success_-_Get_Empty_Leaderboard
2025/05/30 08:05:31 Truncating tables: rounds
2025/05/30 08:05:31 Truncating tables: users
2025/05/30 08:05:31 Truncating tables: scores
2025/05/30 08:05:31 Truncating tables: leaderboards
2025/05/30 08:05:31 Cleaned up NATS JetStream state for leaderboard handler streams before test
2025/05/30 08:05:31 Truncating tables: users, scores, leaderboards, rounds
2025/05/30 08:05:31 Truncated relevant tables before test
    get_leaderboard_test.go:240: Waiting for 1 messages on topic "discord.get.leaderboard.success" with timeout 5s
2025/05/30 08:05:32 Test received message 4b98de0b-3b07-412f-bbb6-b9ea6651d5b5 on topic "discord.get.leaderboard.success"
    get_leaderboard_test.go:240: Successfully received 1 messages on topic "discord.get.leaderboard.success"
2025/05/30 08:05:32 Test Case "TestHandleGetLeaderboardRequested/Success_-_Get_Empty_Leaderboard": Canceling subscription context.
2025/05/30 08:05:32 Test Case "TestHandleGetLeaderboardRequested/Success_-_Get_Empty_Leaderboard": Waiting for subscriber goroutines to finish.
2025/05/30 08:05:32 Test Case "TestHandleGetLeaderboardRequested/Success_-_Get_Empty_Leaderboard": Subscriber goroutines finished.
2025/05/30 08:05:32 Running leaderboard handler test cleanup...
2025/05/30 08:05:33 Error closing Leaderboard module in test cleanup: error closing LeaderboardRouter: router close timeout
2025/05/30 08:05:33 Leaderboard handler router goroutine finished.
2025/05/30 08:05:33 Leaderboard handler test cleanup finished.
=== RUN   TestHandleGetLeaderboardRequested/Failure_-_Invalid_Message_Payload
2025/05/30 08:05:33 Truncating tables: rounds
2025/05/30 08:05:33 Truncating tables: users
2025/05/30 08:05:33 Truncating tables: scores
2025/05/30 08:05:33 Truncating tables: leaderboards
2025/05/30 08:05:33 Cleaned up NATS JetStream state for leaderboard handler streams before test
2025/05/30 08:05:33 Truncating tables: users, scores, leaderboards, rounds
2025/05/30 08:05:33 Truncated relevant tables before test
2025/05/30 08:05:33 Test Case "TestHandleGetLeaderboardRequested/Failure_-_Invalid_Message_Payload": Canceling subscription context.
2025/05/30 08:05:33 Test Case "TestHandleGetLeaderboardRequested/Failure_-_Invalid_Message_Payload": Waiting for subscriber goroutines to finish.
2025/05/30 08:05:33 Test Case "TestHandleGetLeaderboardRequested/Failure_-_Invalid_Message_Payload": Subscriber goroutines finished.
2025/05/30 08:05:33 Running leaderboard handler test cleanup...
2025/05/30 08:05:34 Error closing Leaderboard module in test cleanup: error closing LeaderboardRouter: router close timeout
2025/05/30 08:05:34 Leaderboard handler router goroutine finished.
2025/05/30 08:05:34 Leaderboard handler test cleanup finished.
=== RUN   TestHandleGetLeaderboardRequested/Failure_-_No_Active_Leaderboard
2025/05/30 08:05:35 Truncating tables: rounds
2025/05/30 08:05:35 Truncating tables: users
2025/05/30 08:05:35 Truncating tables: scores
2025/05/30 08:05:35 Truncating tables: leaderboards
2025/05/30 08:05:35 Cleaned up NATS JetStream state for leaderboard handler streams before test
2025/05/30 08:05:35 Truncating tables: users, scores, leaderboards, rounds
2025/05/30 08:05:35 Truncated relevant tables before test
2025/05/30 08:05:35 Test Case "TestHandleGetLeaderboardRequested/Failure_-_No_Active_Leaderboard": Canceling subscription context.
2025/05/30 08:05:35 Test Case "TestHandleGetLeaderboardRequested/Failure_-_No_Active_Leaderboard": Waiting for subscriber goroutines to finish.
2025/05/30 08:05:35 Test Case "TestHandleGetLeaderboardRequested/Failure_-_No_Active_Leaderboard": Subscriber goroutines finished.
2025/05/30 08:05:35 Running leaderboard handler test cleanup...
2025/05/30 08:05:36 Error closing Leaderboard module in test cleanup: error closing LeaderboardRouter: router close timeout
2025/05/30 08:05:36 Leaderboard handler router goroutine finished.
2025/05/30 08:05:36 Leaderboard handler test cleanup finished.
--- PASS: TestHandleGetLeaderboardRequested (7.64s)
    --- PASS: TestHandleGetLeaderboardRequested/Success_-_Get_Leaderboard_With_Data (1.91s)
    --- PASS: TestHandleGetLeaderboardRequested/Success_-_Get_Empty_Leaderboard (1.97s)
    --- PASS: TestHandleGetLeaderboardRequested/Failure_-_Invalid_Message_Payload (1.92s)
    --- PASS: TestHandleGetLeaderboardRequested/Failure_-_No_Active_Leaderboard (1.84s)
=== RUN   TestHandleLeaderboardUpdateRequested
=== RUN   TestHandleLeaderboardUpdateRequested/Success_-_Sorted_participant_tags_apply_to_new_leaderboard
2025/05/30 08:05:36 Truncating tables: rounds
2025/05/30 08:05:36 Truncating tables: users
2025/05/30 08:05:36 Truncating tables: scores
2025/05/30 08:05:36 Truncating tables: leaderboards
2025/05/30 08:05:36 Cleaned up NATS JetStream state for leaderboard handler streams before test
2025/05/30 08:05:36 Truncating tables: users, scores, leaderboards, rounds
2025/05/30 08:05:36 Truncated relevant tables before test
    leaderboard_update_test.go:72: SetupFn: Initial Leaderboard ID: 12, UpdateID: 068110aa-6708-4221-b4eb-51018e1da54a, IsActive: true
    leaderboard_update_test.go:74: SetupFn: Created users with IDs: [395247222, 714554520, 106344950]
    leaderboard_update_test.go:92: PublishMsgFn: Publishing message with RoundID: 7ab0d7ff-d9cf-4939-8591-64d22280d1ab, SortedParticipantTags: [3:106344950 1:395247222 2:714554520]
    leaderboard_update_test.go:94: PublishMsgFn: Using actual user IDs: [395247222, 714554520, 106344950]
    leaderboard_update_test.go:328: Waiting for 1 messages on topic "discord.leaderboard.updated" with timeout 5s
2025/05/30 08:05:37 Test received message 18ac184c-93c4-4fb2-aa57-ccf524ee742f on topic "discord.leaderboard.updated"
    leaderboard_update_test.go:328: Successfully received 1 messages on topic "discord.leaderboard.updated"
    leaderboard_update_test.go:118: ValidateFn: Retrieved 2 leaderboards from DB
    leaderboard_update_test.go:121: ValidateFn: DB Leaderboard 0: ID: 12, UpdateID: 068110aa-6708-4221-b4eb-51018e1da54a, IsActive: false, Data: [{TagNumber:10 UserID:395247222} {TagNumber:11 UserID:714554520} {TagNumber:12 UserID:106344950}]
    leaderboard_update_test.go:121: ValidateFn: DB Leaderboard 1: ID: 13, UpdateID: 7ab0d7ff-d9cf-4939-8591-64d22280d1ab, IsActive: true, Data: [{TagNumber:1 UserID:395247222} {TagNumber:2 UserID:714554520} {TagNumber:3 UserID:106344950}]
    leaderboard_update_test.go:157: ValidateFn: Identified Old Leaderboard ID: 12, UpdateID: 068110aa-6708-4221-b4eb-51018e1da54a, IsActive: false
    leaderboard_update_test.go:159: ValidateFn: Identified New Leaderboard ID: 13, UpdateID: 7ab0d7ff-d9cf-4939-8591-64d22280d1ab, IsActive: true
    leaderboard_update_test.go:162: ValidateFn: Raw New Leaderboard Data (newLB.LeaderboardData): [{TagNumber:1 UserID:395247222} {TagNumber:2 UserID:714554520} {TagNumber:3 UserID:106344950}]
    leaderboard_update_test.go:192: ValidateFn: Expected Data Map: map[106344950:3 395247222:1 714554520:2]
    leaderboard_update_test.go:195: ValidateFn: Actual Data Map (from newLB): map[106344950:3 395247222:1 714554520:2]
2025/05/30 08:05:37 Test Case "TestHandleLeaderboardUpdateRequested/Success_-_Sorted_participant_tags_apply_to_new_leaderboard": Canceling subscription context.
2025/05/30 08:05:37 Test Case "TestHandleLeaderboardUpdateRequested/Success_-_Sorted_participant_tags_apply_to_new_leaderboard": Waiting for subscriber goroutines to finish.
2025/05/30 08:05:37 Test Case "TestHandleLeaderboardUpdateRequested/Success_-_Sorted_participant_tags_apply_to_new_leaderboard": Subscriber goroutines finished.
2025/05/30 08:05:37 Running leaderboard handler test cleanup...
2025/05/30 08:05:38 Error closing Leaderboard module in test cleanup: error closing LeaderboardRouter: router close timeout
2025/05/30 08:05:38 Leaderboard handler router goroutine finished.
2025/05/30 08:05:38 Leaderboard handler test cleanup finished.
=== RUN   TestHandleLeaderboardUpdateRequested/Failure_-_Invalid_JSON_Payload
2025/05/30 08:05:38 Truncating tables: rounds
2025/05/30 08:05:38 Truncating tables: users
2025/05/30 08:05:38 Truncating tables: scores
2025/05/30 08:05:38 Truncating tables: leaderboards
2025/05/30 08:05:38 Cleaned up NATS JetStream state for leaderboard handler streams before test
2025/05/30 08:05:38 Truncating tables: users, scores, leaderboards, rounds
2025/05/30 08:05:38 Truncated relevant tables before test
2025/05/30 08:05:39 Test Case "TestHandleLeaderboardUpdateRequested/Failure_-_Invalid_JSON_Payload": Canceling subscription context.
2025/05/30 08:05:39 Test Case "TestHandleLeaderboardUpdateRequested/Failure_-_Invalid_JSON_Payload": Waiting for subscriber goroutines to finish.
2025/05/30 08:05:39 Test Case "TestHandleLeaderboardUpdateRequested/Failure_-_Invalid_JSON_Payload": Subscriber goroutines finished.
2025/05/30 08:05:39 Running leaderboard handler test cleanup...
2025/05/30 08:05:40 Error closing Leaderboard module in test cleanup: error closing LeaderboardRouter: router close timeout
2025/05/30 08:05:40 Leaderboard handler router goroutine finished.
2025/05/30 08:05:40 Leaderboard handler test cleanup finished.
=== RUN   TestHandleLeaderboardUpdateRequested/Failure_-_Empty_SortedParticipantTags
2025/05/30 08:05:40 Truncating tables: rounds
2025/05/30 08:05:40 Truncating tables: users
2025/05/30 08:05:40 Truncating tables: scores
2025/05/30 08:05:40 Truncating tables: leaderboards
2025/05/30 08:05:40 Cleaned up NATS JetStream state for leaderboard handler streams before test
2025/05/30 08:05:40 Truncating tables: users, scores, leaderboards, rounds
2025/05/30 08:05:40 Truncated relevant tables before test
2025/05/30 08:05:41 Test Case "TestHandleLeaderboardUpdateRequested/Failure_-_Empty_SortedParticipantTags": Canceling subscription context.
2025/05/30 08:05:41 Test Case "TestHandleLeaderboardUpdateRequested/Failure_-_Empty_SortedParticipantTags": Waiting for subscriber goroutines to finish.
2025/05/30 08:05:41 Test Case "TestHandleLeaderboardUpdateRequested/Failure_-_Empty_SortedParticipantTags": Subscriber goroutines finished.
2025/05/30 08:05:41 Running leaderboard handler test cleanup...
2025/05/30 08:05:42 Error closing Leaderboard module in test cleanup: error closing LeaderboardRouter: router close timeout
2025/05/30 08:05:42 Leaderboard handler router goroutine finished.
2025/05/30 08:05:42 Leaderboard handler test cleanup finished.
=== RUN   TestHandleLeaderboardUpdateRequested/Failure_-_Incorrect_Tag_Format
2025/05/30 08:05:42 Truncating tables: rounds
2025/05/30 08:05:42 Truncating tables: users
2025/05/30 08:05:42 Truncating tables: scores
2025/05/30 08:05:42 Truncating tables: leaderboards
2025/05/30 08:05:42 Cleaned up NATS JetStream state for leaderboard handler streams before test
2025/05/30 08:05:42 Truncating tables: users, scores, leaderboards, rounds
2025/05/30 08:05:42 Truncated relevant tables before test
2025/05/30 08:05:43 Test Case "TestHandleLeaderboardUpdateRequested/Failure_-_Incorrect_Tag_Format": Canceling subscription context.
2025/05/30 08:05:43 Test Case "TestHandleLeaderboardUpdateRequested/Failure_-_Incorrect_Tag_Format": Waiting for subscriber goroutines to finish.
2025/05/30 08:05:43 Test Case "TestHandleLeaderboardUpdateRequested/Failure_-_Incorrect_Tag_Format": Subscriber goroutines finished.
2025/05/30 08:05:43 Running leaderboard handler test cleanup...
2025/05/30 08:05:44 Error closing Leaderboard module in test cleanup: error closing LeaderboardRouter: router close timeout
2025/05/30 08:05:44 Leaderboard handler router goroutine finished.
2025/05/30 08:05:44 Leaderboard handler test cleanup finished.
--- PASS: TestHandleLeaderboardUpdateRequested (7.52s)
    --- PASS: TestHandleLeaderboardUpdateRequested/Success_-_Sorted_participant_tags_apply_to_new_leaderboard (1.91s)
    --- PASS: TestHandleLeaderboardUpdateRequested/Failure_-_Invalid_JSON_Payload (1.89s)
    --- PASS: TestHandleLeaderboardUpdateRequested/Failure_-_Empty_SortedParticipantTags (1.84s)
    --- PASS: TestHandleLeaderboardUpdateRequested/Failure_-_Incorrect_Tag_Format (1.88s)
=== RUN   TestHandleRoundGetTagRequest
=== RUN   TestHandleRoundGetTagRequest/Success_-_Tag_found_for_user_on_active_leaderboard
2025/05/30 08:05:44 Truncating tables: rounds
2025/05/30 08:05:44 Truncating tables: users
2025/05/30 08:05:44 Truncating tables: scores
2025/05/30 08:05:44 Truncating tables: leaderboards
2025/05/30 08:05:44 Cleaned up NATS JetStream state for leaderboard handler streams before test
2025/05/30 08:05:44 Truncating tables: users, scores, leaderboards, rounds
2025/05/30 08:05:44 Truncated relevant tables before test
    round_tag_by_userid_test.go:221: Waiting for 1 messages on topic "round.tag.lookup.found" with timeout 5s
2025/05/30 08:05:45 Test received message 8172858d-ef0e-456c-b68d-b4361d9c6c16 on topic "round.tag.lookup.found"
    round_tag_by_userid_test.go:221: Successfully received 1 messages on topic "round.tag.lookup.found"
2025/05/30 08:05:45 Test Case "TestHandleRoundGetTagRequest/Success_-_Tag_found_for_user_on_active_leaderboard": Canceling subscription context.
2025/05/30 08:05:45 Test Case "TestHandleRoundGetTagRequest/Success_-_Tag_found_for_user_on_active_leaderboard": Waiting for subscriber goroutines to finish.
2025/05/30 08:05:45 Test Case "TestHandleRoundGetTagRequest/Success_-_Tag_found_for_user_on_active_leaderboard": Subscriber goroutines finished.
2025/05/30 08:05:45 Running leaderboard handler test cleanup...
2025/05/30 08:05:46 Error closing Leaderboard module in test cleanup: error closing LeaderboardRouter: router close timeout
2025/05/30 08:05:46 Leaderboard handler router goroutine finished.
2025/05/30 08:05:46 Leaderboard handler test cleanup finished.
=== RUN   TestHandleRoundGetTagRequest/Success_-_Tag_not_found_(user_not_on_leaderboard)
2025/05/30 08:05:46 Truncating tables: rounds
2025/05/30 08:05:46 Truncating tables: users
2025/05/30 08:05:46 Truncating tables: scores
2025/05/30 08:05:46 Truncating tables: leaderboards
2025/05/30 08:05:46 Cleaned up NATS JetStream state for leaderboard handler streams before test
2025/05/30 08:05:46 Truncating tables: users, scores, leaderboards, rounds
2025/05/30 08:05:46 Truncated relevant tables before test
    round_tag_by_userid_test.go:221: Waiting for 1 messages on topic "round.tag.lookup.not.found" with timeout 5s
2025/05/30 08:05:47 WARN No tag found for user in active leaderboard data user_id=732374582
2025/05/30 08:05:47 Test received message 3fae7b08-658b-42a8-b3c4-c821f3b41170 on topic "round.tag.lookup.not.found"
    round_tag_by_userid_test.go:221: Successfully received 1 messages on topic "round.tag.lookup.not.found"
2025/05/30 08:05:47 Test Case "TestHandleRoundGetTagRequest/Success_-_Tag_not_found_(user_not_on_leaderboard)": Canceling subscription context.
2025/05/30 08:05:47 Test Case "TestHandleRoundGetTagRequest/Success_-_Tag_not_found_(user_not_on_leaderboard)": Waiting for subscriber goroutines to finish.
2025/05/30 08:05:47 Test Case "TestHandleRoundGetTagRequest/Success_-_Tag_not_found_(user_not_on_leaderboard)": Subscriber goroutines finished.
2025/05/30 08:05:47 Running leaderboard handler test cleanup...
2025/05/30 08:05:48 Error closing Leaderboard module in test cleanup: error closing LeaderboardRouter: router close timeout
2025/05/30 08:05:48 Leaderboard handler router goroutine finished.
2025/05/30 08:05:48 Leaderboard handler test cleanup finished.
=== RUN   TestHandleRoundGetTagRequest/Failure_-_No_active_leaderboard_present
2025/05/30 08:05:48 Truncating tables: rounds
2025/05/30 08:05:48 Truncating tables: users
2025/05/30 08:05:48 Truncating tables: scores
2025/05/30 08:05:48 Truncating tables: leaderboards
2025/05/30 08:05:48 Cleaned up NATS JetStream state for leaderboard handler streams before test
2025/05/30 08:05:48 Truncating tables: users, scores, leaderboards, rounds
2025/05/30 08:05:48 Truncated relevant tables before test
    round_tag_by_userid_test.go:221: Waiting for 1 messages on topic "discord.leaderboard.tag.get.by.user.id.failed" with timeout 5s
2025/05/30 08:05:49 WARN No active leaderboard found for tag lookup
2025/05/30 08:05:49 Test received message 665935d6-75d8-4a15-bb53-5ceb4f9c394d on topic "discord.leaderboard.tag.get.by.user.id.failed"
    round_tag_by_userid_test.go:221: Successfully received 1 messages on topic "discord.leaderboard.tag.get.by.user.id.failed"
2025/05/30 08:05:49 Test Case "TestHandleRoundGetTagRequest/Failure_-_No_active_leaderboard_present": Canceling subscription context.
2025/05/30 08:05:49 Test Case "TestHandleRoundGetTagRequest/Failure_-_No_active_leaderboard_present": Waiting for subscriber goroutines to finish.
2025/05/30 08:05:49 Test Case "TestHandleRoundGetTagRequest/Failure_-_No_active_leaderboard_present": Subscriber goroutines finished.
2025/05/30 08:05:49 Running leaderboard handler test cleanup...
2025/05/30 08:05:50 Error closing Leaderboard module in test cleanup: error closing LeaderboardRouter: router close timeout
2025/05/30 08:05:50 Leaderboard handler router goroutine finished.
2025/05/30 08:05:50 Leaderboard handler test cleanup finished.
=== RUN   TestHandleRoundGetTagRequest/Failure_-_Invalid_payload_(unmarshal_error)
2025/05/30 08:05:50 Truncating tables: rounds
2025/05/30 08:05:50 Truncating tables: users
2025/05/30 08:05:50 Truncating tables: scores
2025/05/30 08:05:50 Truncating tables: leaderboards
2025/05/30 08:05:50 Cleaned up NATS JetStream state for leaderboard handler streams before test
2025/05/30 08:05:50 Truncating tables: users, scores, leaderboards, rounds
2025/05/30 08:05:50 Truncated relevant tables before test
2025/05/30 08:05:51 Test Case "TestHandleRoundGetTagRequest/Failure_-_Invalid_payload_(unmarshal_error)": Canceling subscription context.
2025/05/30 08:05:51 Test Case "TestHandleRoundGetTagRequest/Failure_-_Invalid_payload_(unmarshal_error)": Waiting for subscriber goroutines to finish.
2025/05/30 08:05:51 Test Case "TestHandleRoundGetTagRequest/Failure_-_Invalid_payload_(unmarshal_error)": Subscriber goroutines finished.
2025/05/30 08:05:51 Running leaderboard handler test cleanup...
2025/05/30 08:05:52 Error closing Leaderboard module in test cleanup: error closing LeaderboardRouter: router close timeout
2025/05/30 08:05:52 Leaderboard handler router goroutine finished.
2025/05/30 08:05:52 Leaderboard handler test cleanup finished.
--- PASS: TestHandleRoundGetTagRequest (7.69s)
    --- PASS: TestHandleRoundGetTagRequest/Success_-_Tag_found_for_user_on_active_leaderboard (2.06s)
    --- PASS: TestHandleRoundGetTagRequest/Success_-_Tag_not_found_(user_not_on_leaderboard) (1.89s)
    --- PASS: TestHandleRoundGetTagRequest/Failure_-_No_active_leaderboard_present (1.91s)
    --- PASS: TestHandleRoundGetTagRequest/Failure_-_Invalid_payload_(unmarshal_error) (1.84s)
=== RUN   TestHandleTagAssignmentRequested
=== RUN   TestHandleTagAssignmentRequested/Success_-_Assign_New_Tag
2025/05/30 08:05:52 Truncating tables: rounds
2025/05/30 08:05:52 Truncating tables: users
2025/05/30 08:05:52 Truncating tables: scores
2025/05/30 08:05:52 Truncating tables: leaderboards
2025/05/30 08:05:52 Cleaned up NATS JetStream state for leaderboard handler streams before test
2025/05/30 08:05:52 Truncating tables: users, scores, leaderboards, rounds
2025/05/30 08:05:52 Truncated relevant tables before test
    tag_assignment_test.go:269: Waiting for 1 messages on topic "discord.leaderboard.tag.assignment.success" with timeout 5s
2025/05/30 08:05:52 Test received message 983ee537-939e-451d-881b-95249954df17 on topic "discord.leaderboard.tag.assignment.success"
    tag_assignment_test.go:269: Successfully received 1 messages on topic "discord.leaderboard.tag.assignment.success"
2025/05/30 08:05:52 Test Case "TestHandleTagAssignmentRequested/Success_-_Assign_New_Tag": Canceling subscription context.
2025/05/30 08:05:52 Test Case "TestHandleTagAssignmentRequested/Success_-_Assign_New_Tag": Waiting for subscriber goroutines to finish.
2025/05/30 08:05:52 Test Case "TestHandleTagAssignmentRequested/Success_-_Assign_New_Tag": Subscriber goroutines finished.
2025/05/30 08:05:52 Running leaderboard handler test cleanup...
2025/05/30 08:05:53 Error closing Leaderboard module in test cleanup: error closing LeaderboardRouter: router close timeout
2025/05/30 08:05:53 Leaderboard handler router goroutine finished.
2025/05/30 08:05:53 Leaderboard handler test cleanup finished.
=== RUN   TestHandleTagAssignmentRequested/Success_-_Update_Existing_Tag
2025/05/30 08:05:53 Truncating tables: rounds
2025/05/30 08:05:53 Truncating tables: users
2025/05/30 08:05:53 Truncating tables: scores
2025/05/30 08:05:53 Truncating tables: leaderboards
2025/05/30 08:05:53 Cleaned up NATS JetStream state for leaderboard handler streams before test
2025/05/30 08:05:53 Truncating tables: users, scores, leaderboards, rounds
2025/05/30 08:05:53 Truncated relevant tables before test
    tag_assignment_test.go:269: Waiting for 1 messages on topic "discord.leaderboard.tag.assignment.success" with timeout 5s
2025/05/30 08:05:54 Test received message 056432a9-a7a6-49e2-b8e4-ce635c9d5a08 on topic "discord.leaderboard.tag.assignment.success"
    tag_assignment_test.go:269: Successfully received 1 messages on topic "discord.leaderboard.tag.assignment.success"
2025/05/30 08:05:54 Test Case "TestHandleTagAssignmentRequested/Success_-_Update_Existing_Tag": Canceling subscription context.
2025/05/30 08:05:54 Test Case "TestHandleTagAssignmentRequested/Success_-_Update_Existing_Tag": Waiting for subscriber goroutines to finish.
2025/05/30 08:05:54 Test Case "TestHandleTagAssignmentRequested/Success_-_Update_Existing_Tag": Subscriber goroutines finished.
2025/05/30 08:05:54 Running leaderboard handler test cleanup...
2025/05/30 08:05:55 Error closing Leaderboard module in test cleanup: error closing LeaderboardRouter: router close timeout
2025/05/30 08:05:55 Leaderboard handler router goroutine finished.
2025/05/30 08:05:55 Leaderboard handler test cleanup finished.
=== RUN   TestHandleTagAssignmentRequested/Success_-_Add_Brand_New_User
2025/05/30 08:05:55 Truncating tables: rounds
2025/05/30 08:05:55 Truncating tables: users
2025/05/30 08:05:55 Truncating tables: scores
2025/05/30 08:05:55 Truncating tables: leaderboards
2025/05/30 08:05:55 Cleaned up NATS JetStream state for leaderboard handler streams before test
2025/05/30 08:05:55 Truncating tables: users, scores, leaderboards, rounds
2025/05/30 08:05:55 Truncated relevant tables before test
    tag_assignment_test.go:269: Waiting for 1 messages on topic "discord.leaderboard.tag.assignment.success" with timeout 5s
2025/05/30 08:05:56 Test received message 2c668b3c-c7c2-43d7-ba85-a71432072d51 on topic "discord.leaderboard.tag.assignment.success"
    tag_assignment_test.go:269: Successfully received 1 messages on topic "discord.leaderboard.tag.assignment.success"
2025/05/30 08:05:56 Test Case "TestHandleTagAssignmentRequested/Success_-_Add_Brand_New_User": Canceling subscription context.
2025/05/30 08:05:56 Test Case "TestHandleTagAssignmentRequested/Success_-_Add_Brand_New_User": Waiting for subscriber goroutines to finish.
2025/05/30 08:05:56 Test Case "TestHandleTagAssignmentRequested/Success_-_Add_Brand_New_User": Subscriber goroutines finished.
2025/05/30 08:05:56 Running leaderboard handler test cleanup...
2025/05/30 08:05:57 Error closing Leaderboard module in test cleanup: error closing LeaderboardRouter: router close timeout
2025/05/30 08:05:57 Leaderboard handler router goroutine finished.
2025/05/30 08:05:57 Leaderboard handler test cleanup finished.
=== RUN   TestHandleTagAssignmentRequested/Success_-_Tag_Swap_Triggered_and_Processed
2025/05/30 08:05:57 Recreating containers after 20 tests or 36.26898204s elapsed for stability
2025/05/30 08:05:57 Recreating containers for stability...
2025/05/30 08:05:57 üê≥ Stopping container: e21690eb002a
2025/05/30 08:05:58 ‚úÖ Container stopped: e21690eb002a
2025/05/30 08:05:58 üê≥ Terminating container: e21690eb002a
2025/05/30 08:05:58 üö´ Container terminated: e21690eb002a
2025/05/30 08:05:58 üê≥ Stopping container: 5844c16ebd57
2025/05/30 08:05:58 ‚úÖ Container stopped: 5844c16ebd57
2025/05/30 08:05:58 üê≥ Terminating container: 5844c16ebd57
2025/05/30 08:05:58 üö´ Container terminated: 5844c16ebd57
2025/05/30 08:06:00 Starting PostgreSQL container with resource limits...
2025/05/30 08:06:00 üê≥ Creating container for image postgres:16-alpine
2025/05/30 08:06:00 ‚úÖ Container created: 3ab5140518f0
2025/05/30 08:06:00 üê≥ Starting container: 3ab5140518f0
2025/05/30 08:06:00 ‚úÖ Container started: 3ab5140518f0
2025/05/30 08:06:00 ‚è≥ Waiting for container id 3ab5140518f0 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc0009418e8 Strategies:[0xc0009ccea0]}
2025/05/30 08:06:03 üîî Container is ready: 3ab5140518f0
2025/05/30 08:06:03 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:33727/testdb?sslmode=disable
2025/05/30 08:06:03 Starting NATS container with resource limits...
2025/05/30 08:06:03 üê≥ Creating container for image nats:2.10-alpine
2025/05/30 08:06:03 ‚úÖ Container created: 18dc6e69f74f
2025/05/30 08:06:03 üê≥ Starting container: 18dc6e69f74f
2025/05/30 08:06:03 ‚úÖ Container started: 18dc6e69f74f
2025/05/30 08:06:03 ‚è≥ Waiting for container id 18dc6e69f74f image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000941b98 Strategies:[0xc000a95500 0xc000966930]}
2025/05/30 08:06:05 üîî Container is ready: 18dc6e69f74f
2025/05/30 08:06:05 NATS container started with resource limits. URL: nats://localhost:33728
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/30 08:06:06 Ran leaderboard migrations group #1
Creating user table...
User table created successfully!
2025/05/30 08:06:06 Ran user migrations group #2
Creating round table...
Round table created successfully!
2025/05/30 08:06:06 Ran round migrations group #3
Creating score table...
Score table created successfully!
2025/05/30 08:06:06 Ran score migrations group #4
2025/05/30 08:06:06 All migrations ran successfully
2025/05/30 08:06:06 newDBServiceWithDB - Registering models
2025/05/30 08:06:06 newDBServiceWithDB - Models registered successfully
2025/05/30 08:06:06 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00007c4f8 RoundDB:0xc00007c500 ScoreDB:0xc00007c508 LeaderboardDB:0xc00007c510 db:0xc000e18c40}
2025/05/30 08:06:06 Containers successfully recreated
2025/05/30 08:06:06 Truncating tables: rounds
2025/05/30 08:06:06 Truncating tables: users
2025/05/30 08:06:06 Truncating tables: scores
2025/05/30 08:06:06 Truncating tables: leaderboards
2025/05/30 08:06:06 Cleaned up NATS JetStream state for leaderboard handler streams before test
2025/05/30 08:06:06 Truncating tables: users, scores, leaderboards, rounds
2025/05/30 08:06:06 Truncated relevant tables before test
    tag_assignment_test.go:269: Waiting for 1 messages on topic "discord.leaderboard.tag.swap.processed" with timeout 5s
2025/05/30 08:06:06 Test received message 425e4043-a18f-471e-a63f-fcea96a9d1af on topic "discord.leaderboard.tag.swap.processed"
    tag_assignment_test.go:269: Successfully received 1 messages on topic "discord.leaderboard.tag.swap.processed"
    tag_assignment_test.go:213: Received downstream swap processed event: 425e4043-a18f-471e-a63f-fcea96a9d1af
2025/05/30 08:06:06 Test Case "TestHandleTagAssignmentRequested/Success_-_Tag_Swap_Triggered_and_Processed": Canceling subscription context.
2025/05/30 08:06:06 Test Case "TestHandleTagAssignmentRequested/Success_-_Tag_Swap_Triggered_and_Processed": Waiting for subscriber goroutines to finish.
2025/05/30 08:06:06 Test Case "TestHandleTagAssignmentRequested/Success_-_Tag_Swap_Triggered_and_Processed": Subscriber goroutines finished.
2025/05/30 08:06:06 Running leaderboard handler test cleanup...
2025/05/30 08:06:07 Error closing Leaderboard module in test cleanup: error closing LeaderboardRouter: router close timeout
2025/05/30 08:06:07 Leaderboard handler router goroutine finished.
2025/05/30 08:06:07 Leaderboard handler test cleanup finished.
=== RUN   TestHandleTagAssignmentRequested/Failure_-_Invalid_JSON_Message
2025/05/30 08:06:07 Truncating tables: rounds
2025/05/30 08:06:07 Truncating tables: users
2025/05/30 08:06:07 Truncating tables: scores
2025/05/30 08:06:07 Truncating tables: leaderboards
2025/05/30 08:06:08 Cleaned up NATS JetStream state for leaderboard handler streams before test
2025/05/30 08:06:08 Truncating tables: users, scores, leaderboards, rounds
2025/05/30 08:06:08 Truncated relevant tables before test
2025/05/30 08:06:08 Test Case "TestHandleTagAssignmentRequested/Failure_-_Invalid_JSON_Message": Canceling subscription context.
2025/05/30 08:06:08 Test Case "TestHandleTagAssignmentRequested/Failure_-_Invalid_JSON_Message": Waiting for subscriber goroutines to finish.
2025/05/30 08:06:08 Test Case "TestHandleTagAssignmentRequested/Failure_-_Invalid_JSON_Message": Subscriber goroutines finished.
2025/05/30 08:06:08 Running leaderboard handler test cleanup...
2025/05/30 08:06:09 Error closing Leaderboard module in test cleanup: error closing LeaderboardRouter: router close timeout
2025/05/30 08:06:09 Leaderboard handler router goroutine finished.
2025/05/30 08:06:09 Leaderboard handler test cleanup finished.
--- PASS: TestHandleTagAssignmentRequested (17.73s)
    --- PASS: TestHandleTagAssignmentRequested/Success_-_Assign_New_Tag (1.88s)
    --- PASS: TestHandleTagAssignmentRequested/Success_-_Update_Existing_Tag (1.91s)
    --- PASS: TestHandleTagAssignmentRequested/Success_-_Add_Brand_New_User (1.90s)
    --- PASS: TestHandleTagAssignmentRequested/Success_-_Tag_Swap_Triggered_and_Processed (10.23s)
    --- PASS: TestHandleTagAssignmentRequested/Failure_-_Invalid_JSON_Message (1.80s)
=== RUN   TestHandleTagAvailabilityCheckRequested
=== RUN   TestHandleTagAvailabilityCheckRequested/Success_-_Tag_Available
2025/05/30 08:06:09 Truncating tables: rounds
2025/05/30 08:06:09 Truncating tables: users
2025/05/30 08:06:09 Truncating tables: scores
2025/05/30 08:06:09 Truncating tables: leaderboards
2025/05/30 08:06:09 Cleaned up NATS JetStream state for leaderboard handler streams before test
2025/05/30 08:06:09 Truncating tables: users, scores, leaderboards, rounds
2025/05/30 08:06:09 Truncated relevant tables before test
    tag_availability_test.go:331: Waiting for 1 messages on topic "user.tag.available" with timeout 5s
2025/05/30 08:06:10 Test received message 7b3ccf39-6eb7-46f6-93de-985544f8c55f on topic "user.tag.available"
    tag_availability_test.go:331: Successfully received 1 messages on topic "user.tag.available"
2025/05/30 08:06:10 Test Case "TestHandleTagAvailabilityCheckRequested/Success_-_Tag_Available": Canceling subscription context.
2025/05/30 08:06:10 Test Case "TestHandleTagAvailabilityCheckRequested/Success_-_Tag_Available": Waiting for subscriber goroutines to finish.
2025/05/30 08:06:10 Test Case "TestHandleTagAvailabilityCheckRequested/Success_-_Tag_Available": Subscriber goroutines finished.
2025/05/30 08:06:10 Running leaderboard handler test cleanup...
2025/05/30 08:06:11 Error closing Leaderboard module in test cleanup: error closing LeaderboardRouter: router close timeout
2025/05/30 08:06:11 Leaderboard handler router goroutine finished.
2025/05/30 08:06:11 Leaderboard handler test cleanup finished.
=== RUN   TestHandleTagAvailabilityCheckRequested/Success_-_Tag_Unavailable_(Already_Taken)
2025/05/30 08:06:11 Truncating tables: rounds
2025/05/30 08:06:11 Truncating tables: users
2025/05/30 08:06:11 Truncating tables: scores
2025/05/30 08:06:11 Truncating tables: leaderboards
2025/05/30 08:06:11 Cleaned up NATS JetStream state for leaderboard handler streams before test
2025/05/30 08:06:11 Truncating tables: users, scores, leaderboards, rounds
2025/05/30 08:06:11 Truncated relevant tables before test
    tag_availability_test.go:331: Waiting for 1 messages on topic "user.tag.unavailable" with timeout 5s
2025/05/30 08:06:12 Test received message 87606099-44b5-4480-9b26-29bb7ecf85f7 on topic "user.tag.unavailable"
    tag_availability_test.go:331: Successfully received 1 messages on topic "user.tag.unavailable"
2025/05/30 08:06:12 Test Case "TestHandleTagAvailabilityCheckRequested/Success_-_Tag_Unavailable_(Already_Taken)": Canceling subscription context.
2025/05/30 08:06:12 Test Case "TestHandleTagAvailabilityCheckRequested/Success_-_Tag_Unavailable_(Already_Taken)": Waiting for subscriber goroutines to finish.
2025/05/30 08:06:12 Test Case "TestHandleTagAvailabilityCheckRequested/Success_-_Tag_Unavailable_(Already_Taken)": Subscriber goroutines finished.
2025/05/30 08:06:12 Running leaderboard handler test cleanup...
2025/05/30 08:06:13 Error closing Leaderboard module in test cleanup: error closing LeaderboardRouter: router close timeout
2025/05/30 08:06:13 Leaderboard handler router goroutine finished.
2025/05/30 08:06:13 Leaderboard handler test cleanup finished.
=== RUN   TestHandleTagAvailabilityCheckRequested/Failure_-_Invalid_Message_Payload
2025/05/30 08:06:13 Truncating tables: rounds
2025/05/30 08:06:13 Truncating tables: users
2025/05/30 08:06:13 Truncating tables: scores
2025/05/30 08:06:13 Truncating tables: leaderboards
2025/05/30 08:06:13 Cleaned up NATS JetStream state for leaderboard handler streams before test
2025/05/30 08:06:13 Truncating tables: users, scores, leaderboards, rounds
2025/05/30 08:06:13 Truncated relevant tables before test
2025/05/30 08:06:14 Test Case "TestHandleTagAvailabilityCheckRequested/Failure_-_Invalid_Message_Payload": Canceling subscription context.
2025/05/30 08:06:14 Test Case "TestHandleTagAvailabilityCheckRequested/Failure_-_Invalid_Message_Payload": Waiting for subscriber goroutines to finish.
2025/05/30 08:06:14 Test Case "TestHandleTagAvailabilityCheckRequested/Failure_-_Invalid_Message_Payload": Subscriber goroutines finished.
2025/05/30 08:06:14 Running leaderboard handler test cleanup...
2025/05/30 08:06:15 Error closing Leaderboard module in test cleanup: error closing LeaderboardRouter: router close timeout
2025/05/30 08:06:15 Leaderboard handler router goroutine finished.
2025/05/30 08:06:15 Leaderboard handler test cleanup finished.
--- PASS: TestHandleTagAvailabilityCheckRequested (5.59s)
    --- PASS: TestHandleTagAvailabilityCheckRequested/Success_-_Tag_Available (1.88s)
    --- PASS: TestHandleTagAvailabilityCheckRequested/Success_-_Tag_Unavailable_(Already_Taken) (1.88s)
    --- PASS: TestHandleTagAvailabilityCheckRequested/Failure_-_Invalid_Message_Payload (1.84s)
=== RUN   TestHandleGetTagByUserIDRequest
=== RUN   TestHandleGetTagByUserIDRequest/Success_-_Tag_found_for_user_on_active_leaderboard
2025/05/30 08:06:15 Truncating tables: rounds
2025/05/30 08:06:15 Truncating tables: users
2025/05/30 08:06:15 Truncating tables: scores
2025/05/30 08:06:15 Truncating tables: leaderboards
2025/05/30 08:06:15 Cleaned up NATS JetStream state for leaderboard handler streams before test
2025/05/30 08:06:15 Truncating tables: users, scores, leaderboards, rounds
2025/05/30 08:06:15 Truncated relevant tables before test
    tag_by_id_test.go:330: Waiting for 1 messages on topic "discord.leaderboard.tag.lookup.by.user.id.success" with timeout 5s
2025/05/30 08:06:16 Test received message a5cff9de-4fcd-463f-982f-540298174746 on topic "discord.leaderboard.tag.lookup.by.user.id.success"
    tag_by_id_test.go:330: Successfully received 1 messages on topic "discord.leaderboard.tag.lookup.by.user.id.success"
2025/05/30 08:06:16 Test Case "TestHandleGetTagByUserIDRequest/Success_-_Tag_found_for_user_on_active_leaderboard": Canceling subscription context.
2025/05/30 08:06:16 Test Case "TestHandleGetTagByUserIDRequest/Success_-_Tag_found_for_user_on_active_leaderboard": Waiting for subscriber goroutines to finish.
2025/05/30 08:06:16 Test Case "TestHandleGetTagByUserIDRequest/Success_-_Tag_found_for_user_on_active_leaderboard": Subscriber goroutines finished.
2025/05/30 08:06:16 Running leaderboard handler test cleanup...
2025/05/30 08:06:17 Error closing Leaderboard module in test cleanup: error closing LeaderboardRouter: router close timeout
2025/05/30 08:06:17 Leaderboard handler router goroutine finished.
2025/05/30 08:06:17 Leaderboard handler test cleanup finished.
=== RUN   TestHandleGetTagByUserIDRequest/Success_-_User_not_found_on_active_leaderboard
2025/05/30 08:06:17 Truncating tables: rounds
2025/05/30 08:06:17 Truncating tables: users
2025/05/30 08:06:17 Truncating tables: scores
2025/05/30 08:06:17 Truncating tables: leaderboards
2025/05/30 08:06:17 Cleaned up NATS JetStream state for leaderboard handler streams before test
2025/05/30 08:06:17 Truncating tables: users, scores, leaderboards, rounds
2025/05/30 08:06:17 Truncated relevant tables before test
    tag_by_id_test.go:330: Waiting for 1 messages on topic "discord.leaderboard.tag.lookup.by.user.id.not.found" with timeout 5s
2025/05/30 08:06:18 WARN No tag found for user in active leaderboard data user_id=790206903
2025/05/30 08:06:18 Test received message 2da122d7-d60b-480f-9232-783e4783bfae on topic "discord.leaderboard.tag.lookup.by.user.id.not.found"
    tag_by_id_test.go:330: Successfully received 1 messages on topic "discord.leaderboard.tag.lookup.by.user.id.not.found"
2025/05/30 08:06:18 Test Case "TestHandleGetTagByUserIDRequest/Success_-_User_not_found_on_active_leaderboard": Canceling subscription context.
2025/05/30 08:06:18 Test Case "TestHandleGetTagByUserIDRequest/Success_-_User_not_found_on_active_leaderboard": Waiting for subscriber goroutines to finish.
2025/05/30 08:06:18 Test Case "TestHandleGetTagByUserIDRequest/Success_-_User_not_found_on_active_leaderboard": Subscriber goroutines finished.
2025/05/30 08:06:18 Running leaderboard handler test cleanup...
2025/05/30 08:06:19 Error closing Leaderboard module in test cleanup: error closing LeaderboardRouter: router close timeout
2025/05/30 08:06:19 Leaderboard handler router goroutine finished.
2025/05/30 08:06:19 Leaderboard handler test cleanup finished.
=== RUN   TestHandleGetTagByUserIDRequest/Failure_-_No_active_leaderboard_exists
2025/05/30 08:06:19 Truncating tables: rounds
2025/05/30 08:06:19 Truncating tables: users
2025/05/30 08:06:19 Truncating tables: scores
2025/05/30 08:06:19 Truncating tables: leaderboards
2025/05/30 08:06:19 Cleaned up NATS JetStream state for leaderboard handler streams before test
2025/05/30 08:06:19 Truncating tables: users, scores, leaderboards, rounds
2025/05/30 08:06:19 Truncated relevant tables before test
    tag_by_id_test.go:330: Waiting for 1 messages on topic "discord.leaderboard.tag.lookup.by.user.id.failed" with timeout 5s
2025/05/30 08:06:19 WARN No active leaderboard found for tag lookup
2025/05/30 08:06:19 Test received message 0d13ec33-de6f-4b43-9de9-618879453b52 on topic "discord.leaderboard.tag.lookup.by.user.id.failed"
    tag_by_id_test.go:330: Successfully received 1 messages on topic "discord.leaderboard.tag.lookup.by.user.id.failed"
2025/05/30 08:06:20 Test Case "TestHandleGetTagByUserIDRequest/Failure_-_No_active_leaderboard_exists": Canceling subscription context.
2025/05/30 08:06:20 Test Case "TestHandleGetTagByUserIDRequest/Failure_-_No_active_leaderboard_exists": Waiting for subscriber goroutines to finish.
2025/05/30 08:06:20 Test Case "TestHandleGetTagByUserIDRequest/Failure_-_No_active_leaderboard_exists": Subscriber goroutines finished.
2025/05/30 08:06:20 Running leaderboard handler test cleanup...
2025/05/30 08:06:21 Error closing Leaderboard module in test cleanup: error closing LeaderboardRouter: router close timeout
2025/05/30 08:06:21 Leaderboard handler router goroutine finished.
2025/05/30 08:06:21 Leaderboard handler test cleanup finished.
=== RUN   TestHandleGetTagByUserIDRequest/Failure_-_Invalid_incoming_message_payload_(Unmarshal_error)
2025/05/30 08:06:21 Truncating tables: rounds
2025/05/30 08:06:21 Truncating tables: users
2025/05/30 08:06:21 Truncating tables: scores
2025/05/30 08:06:21 Truncating tables: leaderboards
2025/05/30 08:06:21 Cleaned up NATS JetStream state for leaderboard handler streams before test
2025/05/30 08:06:21 Truncating tables: users, scores, leaderboards, rounds
2025/05/30 08:06:21 Truncated relevant tables before test
2025/05/30 08:06:21 Test Case "TestHandleGetTagByUserIDRequest/Failure_-_Invalid_incoming_message_payload_(Unmarshal_error)": Canceling subscription context.
2025/05/30 08:06:21 Test Case "TestHandleGetTagByUserIDRequest/Failure_-_Invalid_incoming_message_payload_(Unmarshal_error)": Waiting for subscriber goroutines to finish.
2025/05/30 08:06:21 Test Case "TestHandleGetTagByUserIDRequest/Failure_-_Invalid_incoming_message_payload_(Unmarshal_error)": Subscriber goroutines finished.
2025/05/30 08:06:21 Running leaderboard handler test cleanup...
2025/05/30 08:06:22 Error closing Leaderboard module in test cleanup: error closing LeaderboardRouter: router close timeout
2025/05/30 08:06:22 Leaderboard handler router goroutine finished.
2025/05/30 08:06:22 Leaderboard handler test cleanup finished.
--- PASS: TestHandleGetTagByUserIDRequest (7.48s)
    --- PASS: TestHandleGetTagByUserIDRequest/Success_-_Tag_found_for_user_on_active_leaderboard (1.88s)
    --- PASS: TestHandleGetTagByUserIDRequest/Success_-_User_not_found_on_active_leaderboard (1.89s)
    --- PASS: TestHandleGetTagByUserIDRequest/Failure_-_No_active_leaderboard_exists (1.88s)
    --- PASS: TestHandleGetTagByUserIDRequest/Failure_-_Invalid_incoming_message_payload_(Unmarshal_error) (1.83s)
=== RUN   TestHandleTagSwapRequested
=== RUN   TestHandleTagSwapRequested/Success_-_Swap_Tags_Between_Two_Users
2025/05/30 08:06:22 Truncating tables: rounds
2025/05/30 08:06:22 Truncating tables: users
2025/05/30 08:06:22 Truncating tables: scores
2025/05/30 08:06:22 Truncating tables: leaderboards
2025/05/30 08:06:22 Cleaned up NATS JetStream state for leaderboard handler streams before test
2025/05/30 08:06:22 Truncating tables: users, scores, leaderboards, rounds
2025/05/30 08:06:22 Truncated relevant tables before test
    tag_swap_test.go:506: Waiting for 1 messages on topic "discord.leaderboard.tag.swap.processed" with timeout 5s
2025/05/30 08:06:23 Test received message b44f6af7-799f-40e2-a773-f0a49e0ce053 on topic "discord.leaderboard.tag.swap.processed"
    tag_swap_test.go:506: Successfully received 1 messages on topic "discord.leaderboard.tag.swap.processed"
    tag_swap_test.go:165: Initial leaderboard data: map[174035690:20 890499715:10]
    tag_swap_test.go:166: Actual leaderboard data: map[174035690:10 890499715:20]
2025/05/30 08:06:23 Test Case "TestHandleTagSwapRequested/Success_-_Swap_Tags_Between_Two_Users": Canceling subscription context.
2025/05/30 08:06:23 Test Case "TestHandleTagSwapRequested/Success_-_Swap_Tags_Between_Two_Users": Waiting for subscriber goroutines to finish.
2025/05/30 08:06:23 Test Case "TestHandleTagSwapRequested/Success_-_Swap_Tags_Between_Two_Users": Subscriber goroutines finished.
2025/05/30 08:06:23 Running leaderboard handler test cleanup...
2025/05/30 08:06:24 Error closing Leaderboard module in test cleanup: error closing LeaderboardRouter: router close timeout
2025/05/30 08:06:24 Leaderboard handler router goroutine finished.
2025/05/30 08:06:24 Leaderboard handler test cleanup finished.
=== RUN   TestHandleTagSwapRequested/Failure_-_One_User_Does_Not_Exist_on_Leaderboard
2025/05/30 08:06:24 Truncating tables: rounds
2025/05/30 08:06:24 Truncating tables: users
2025/05/30 08:06:24 Truncating tables: scores
2025/05/30 08:06:24 Truncating tables: leaderboards
2025/05/30 08:06:24 Cleaned up NATS JetStream state for leaderboard handler streams before test
2025/05/30 08:06:24 Truncating tables: users, scores, leaderboards, rounds
2025/05/30 08:06:24 Truncated relevant tables before test
    tag_swap_test.go:506: Waiting for 1 messages on topic "discord.leaderboard.tag.swap.failed" with timeout 5s
2025/05/30 08:06:25 Test received message 5101a8ac-c9fb-42df-965f-3140e154fb56 on topic "discord.leaderboard.tag.swap.failed"
    tag_swap_test.go:506: Successfully received 1 messages on topic "discord.leaderboard.tag.swap.failed"
2025/05/30 08:06:25 Test Case "TestHandleTagSwapRequested/Failure_-_One_User_Does_Not_Exist_on_Leaderboard": Canceling subscription context.
2025/05/30 08:06:25 Test Case "TestHandleTagSwapRequested/Failure_-_One_User_Does_Not_Exist_on_Leaderboard": Waiting for subscriber goroutines to finish.
2025/05/30 08:06:25 Test Case "TestHandleTagSwapRequested/Failure_-_One_User_Does_Not_Exist_on_Leaderboard": Subscriber goroutines finished.
2025/05/30 08:06:25 Running leaderboard handler test cleanup...
2025/05/30 08:06:26 Error closing Leaderboard module in test cleanup: error closing LeaderboardRouter: router close timeout
2025/05/30 08:06:26 Leaderboard handler router goroutine finished.
2025/05/30 08:06:26 Leaderboard handler test cleanup finished.
=== RUN   TestHandleTagSwapRequested/Failure_-_Invalid_Message_Payload_(Unmarshal_Error)
2025/05/30 08:06:26 Truncating tables: rounds
2025/05/30 08:06:26 Truncating tables: users
2025/05/30 08:06:26 Truncating tables: scores
2025/05/30 08:06:26 Truncating tables: leaderboards
2025/05/30 08:06:26 Cleaned up NATS JetStream state for leaderboard handler streams before test
2025/05/30 08:06:26 Truncating tables: users, scores, leaderboards, rounds
2025/05/30 08:06:26 Truncated relevant tables before test
2025/05/30 08:06:27 Test Case "TestHandleTagSwapRequested/Failure_-_Invalid_Message_Payload_(Unmarshal_Error)": Canceling subscription context.
2025/05/30 08:06:27 Test Case "TestHandleTagSwapRequested/Failure_-_Invalid_Message_Payload_(Unmarshal_Error)": Waiting for subscriber goroutines to finish.
2025/05/30 08:06:27 Test Case "TestHandleTagSwapRequested/Failure_-_Invalid_Message_Payload_(Unmarshal_Error)": Subscriber goroutines finished.
2025/05/30 08:06:27 Running leaderboard handler test cleanup...
2025/05/30 08:06:28 Error closing Leaderboard module in test cleanup: error closing LeaderboardRouter: router close timeout
2025/05/30 08:06:28 Leaderboard handler router goroutine finished.
2025/05/30 08:06:28 Leaderboard handler test cleanup finished.
=== RUN   TestHandleTagSwapRequested/Failure_-_No_Active_Leaderboard
2025/05/30 08:06:28 Truncating tables: rounds
2025/05/30 08:06:28 Truncating tables: users
2025/05/30 08:06:28 Truncating tables: scores
2025/05/30 08:06:28 Truncating tables: leaderboards
2025/05/30 08:06:28 Cleaned up NATS JetStream state for leaderboard handler streams before test
2025/05/30 08:06:28 Truncating tables: users, scores, leaderboards, rounds
2025/05/30 08:06:28 Truncated relevant tables before test
    tag_swap_test.go:506: Waiting for 1 messages on topic "discord.leaderboard.tag.swap.failed" with timeout 5s
2025/05/30 08:06:29 Test received message 081c2819-e842-4eb5-ac0b-f75f240ec2f7 on topic "discord.leaderboard.tag.swap.failed"
    tag_swap_test.go:506: Successfully received 1 messages on topic "discord.leaderboard.tag.swap.failed"
2025/05/30 08:06:29 Test Case "TestHandleTagSwapRequested/Failure_-_No_Active_Leaderboard": Canceling subscription context.
2025/05/30 08:06:29 Test Case "TestHandleTagSwapRequested/Failure_-_No_Active_Leaderboard": Waiting for subscriber goroutines to finish.
2025/05/30 08:06:29 Test Case "TestHandleTagSwapRequested/Failure_-_No_Active_Leaderboard": Subscriber goroutines finished.
2025/05/30 08:06:29 Running leaderboard handler test cleanup...
2025/05/30 08:06:30 Error closing Leaderboard module in test cleanup: error closing LeaderboardRouter: router close timeout
2025/05/30 08:06:30 Leaderboard handler router goroutine finished.
2025/05/30 08:06:30 Leaderboard handler test cleanup finished.
=== RUN   TestHandleTagSwapRequested/Failure_-_Same_User_Swap_Request
2025/05/30 08:06:30 Truncating tables: rounds
2025/05/30 08:06:30 Truncating tables: users
2025/05/30 08:06:30 Truncating tables: scores
2025/05/30 08:06:30 Truncating tables: leaderboards
2025/05/30 08:06:30 Cleaned up NATS JetStream state for leaderboard handler streams before test
2025/05/30 08:06:30 Truncating tables: users, scores, leaderboards, rounds
2025/05/30 08:06:30 Truncated relevant tables before test
    tag_swap_test.go:506: Waiting for 1 messages on topic "discord.leaderboard.tag.swap.failed" with timeout 5s
2025/05/30 08:06:31 Test received message b4f1535e-29b8-4fc7-9860-b22c92a1f2ff on topic "discord.leaderboard.tag.swap.failed"
    tag_swap_test.go:506: Successfully received 1 messages on topic "discord.leaderboard.tag.swap.failed"
2025/05/30 08:06:31 Test Case "TestHandleTagSwapRequested/Failure_-_Same_User_Swap_Request": Canceling subscription context.
2025/05/30 08:06:31 Test Case "TestHandleTagSwapRequested/Failure_-_Same_User_Swap_Request": Waiting for subscriber goroutines to finish.
2025/05/30 08:06:31 Test Case "TestHandleTagSwapRequested/Failure_-_Same_User_Swap_Request": Subscriber goroutines finished.
2025/05/30 08:06:31 Running leaderboard handler test cleanup...
2025/05/30 08:06:32 Error closing Leaderboard module in test cleanup: error closing LeaderboardRouter: router close timeout
2025/05/30 08:06:32 Leaderboard handler router goroutine finished.
2025/05/30 08:06:32 Leaderboard handler test cleanup finished.
--- PASS: TestHandleTagSwapRequested (9.39s)
    --- PASS: TestHandleTagSwapRequested/Success_-_Swap_Tags_Between_Two_Users (1.87s)
    --- PASS: TestHandleTagSwapRequested/Failure_-_One_User_Does_Not_Exist_on_Leaderboard (1.91s)
    --- PASS: TestHandleTagSwapRequested/Failure_-_Invalid_Message_Payload_(Unmarshal_Error) (1.82s)
    --- PASS: TestHandleTagSwapRequested/Failure_-_No_Active_Leaderboard (1.89s)
    --- PASS: TestHandleTagSwapRequested/Failure_-_Same_User_Swap_Request (1.90s)
PASS
coverage: 60.9% of statements
2025/05/30 08:06:32 TestMain: m.Run() finished with exit code: 0
ok  	github.com/Black-And-White-Club/frolf-bot/integration_tests/modules/leaderboard/handler_tests	90.807s	coverage: 60.9% of statements
=== RUN   TestValidateRoundDeleteRequest
=== RUN   TestValidateRoundDeleteRequest/Successful_validation_of_delete_request
2025/05/30 08:05:05 Initializing round test environment...
2025/05/30 08:05:05 Starting PostgreSQL container with resource limits...
2025/05/30 08:05:05 github.com/testcontainers/testcontainers-go - Connected to docker: 
  Server Version: 28.1.1
  API Version: 1.48
  Operating System: Ubuntu 24.04.1 LTS
  Total Memory: 5923 MB
  Testcontainers for Go Version: v0.37.0
  Resolved Docker Host: unix:///Users/jace/.colima/default/docker.sock
  Resolved Docker Socket Path: /var/run/docker.sock
  Test SessionID: 1c3e5913ff4c8d72222fa8df6b3ad50fa0270000fc9316f5df82cdbd728ebba2
  Test ProcessID: 19f73ba5-9922-46b2-9ae8-988b3e8a130f
2025/05/30 08:05:05 üê≥ Creating container for image postgres:16-alpine
2025/05/30 08:05:05 ‚è≥ Waiting for Reaper "16723bdf" to be ready
2025/05/30 08:05:07 üî• Reaper obtained from Docker for this test session 16723bdf
2025/05/30 08:05:07 ‚úÖ Container created: 2ac09045d904
2025/05/30 08:05:07 üê≥ Starting container: 2ac09045d904
2025/05/30 08:05:08 ‚úÖ Container started: 2ac09045d904
2025/05/30 08:05:08 ‚è≥ Waiting for container id 2ac09045d904 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000361c70 Strategies:[0xc0006d0c30]}
2025/05/30 08:05:14 üîî Container is ready: 2ac09045d904
2025/05/30 08:05:14 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:33682/testdb?sslmode=disable
2025/05/30 08:05:14 Starting NATS container with resource limits...
2025/05/30 08:05:14 üê≥ Creating container for image nats:2.10-alpine
2025/05/30 08:05:14 ‚úÖ Container created: dcdf280c7492
2025/05/30 08:05:14 üê≥ Starting container: dcdf280c7492
2025/05/30 08:05:16 ‚úÖ Container started: dcdf280c7492
2025/05/30 08:05:16 ‚è≥ Waiting for container id dcdf280c7492 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc0000d8f10 Strategies:[0xc0006388a0 0xc00052cc00]}
2025/05/30 08:05:18 üîî Container is ready: dcdf280c7492
2025/05/30 08:05:18 NATS container started with resource limits. URL: nats://localhost:33687
Creating score table...
Score table created successfully!
2025/05/30 08:05:18 Ran score migrations group #1
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/30 08:05:18 Ran leaderboard migrations group #2
Creating user table...
User table created successfully!
2025/05/30 08:05:18 Ran user migrations group #3
Creating round table...
Round table created successfully!
2025/05/30 08:05:18 Ran round migrations group #4
2025/05/30 08:05:18 All migrations ran successfully
2025/05/30 08:05:18 newDBServiceWithDB - Registering models
2025/05/30 08:05:18 newDBServiceWithDB - Models registered successfully
2025/05/30 08:05:18 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00011e620 RoundDB:0xc00011e628 ScoreDB:0xc00011e630 LeaderboardDB:0xc00011e638 db:0xc00071d080}
2025/05/30 08:05:18 Round test environment initialized successfully.
2025/05/30 08:05:18 Truncating tables: rounds
2025/05/30 08:05:18 Truncating tables: users
2025/05/30 08:05:18 Truncating tables: scores
2025/05/30 08:05:18 Truncating tables: leaderboards
2025/05/30 08:05:18 Truncating tables: rounds
=== RUN   TestValidateRoundDeleteRequest/Validation_fails_with_zero_RoundID
2025/05/30 08:05:18 Truncating tables: rounds
2025/05/30 08:05:18 Truncating tables: users
2025/05/30 08:05:18 Truncating tables: scores
2025/05/30 08:05:18 Truncating tables: leaderboards
2025/05/30 08:05:18 Truncating tables: rounds
=== RUN   TestValidateRoundDeleteRequest/Validation_fails_with_empty_RequestingUserUserID
2025/05/30 08:05:18 Truncating tables: rounds
2025/05/30 08:05:18 Truncating tables: users
2025/05/30 08:05:18 Truncating tables: scores
2025/05/30 08:05:18 Truncating tables: leaderboards
2025/05/30 08:05:18 Truncating tables: rounds
=== RUN   TestValidateRoundDeleteRequest/Validation_fails_when_round_does_not_exist
2025/05/30 08:05:18 Truncating tables: rounds
2025/05/30 08:05:18 Truncating tables: users
2025/05/30 08:05:18 Truncating tables: scores
2025/05/30 08:05:18 Truncating tables: leaderboards
2025/05/30 08:05:18 Truncating tables: rounds
=== RUN   TestValidateRoundDeleteRequest/Validation_fails_when_user_is_not_the_creator
2025/05/30 08:05:18 Truncating tables: rounds
2025/05/30 08:05:18 Truncating tables: users
2025/05/30 08:05:18 Truncating tables: scores
2025/05/30 08:05:18 Truncating tables: leaderboards
2025/05/30 08:05:18 Truncating tables: rounds
--- PASS: TestValidateRoundDeleteRequest (13.40s)
    --- PASS: TestValidateRoundDeleteRequest/Successful_validation_of_delete_request (12.94s)
    --- PASS: TestValidateRoundDeleteRequest/Validation_fails_with_zero_RoundID (0.12s)
    --- PASS: TestValidateRoundDeleteRequest/Validation_fails_with_empty_RequestingUserUserID (0.11s)
    --- PASS: TestValidateRoundDeleteRequest/Validation_fails_when_round_does_not_exist (0.11s)
    --- PASS: TestValidateRoundDeleteRequest/Validation_fails_when_user_is_not_the_creator (0.13s)
=== RUN   TestDeleteRound
=== RUN   TestDeleteRound/Successful_deletion_of_an_existing_round
2025/05/30 08:05:19 Truncating tables: rounds
2025/05/30 08:05:19 Truncating tables: users
2025/05/30 08:05:19 Truncating tables: scores
2025/05/30 08:05:19 Truncating tables: leaderboards
2025/05/30 08:05:19 Truncating tables: rounds
2025/05/30 08:05:19 INFO round deleted from DB
=== RUN   TestDeleteRound/Attempt_to_delete_a_non-existent_round
2025/05/30 08:05:19 Truncating tables: rounds
2025/05/30 08:05:19 Truncating tables: users
2025/05/30 08:05:19 Truncating tables: scores
2025/05/30 08:05:19 Truncating tables: leaderboards
2025/05/30 08:05:19 Truncating tables: rounds
=== RUN   TestDeleteRound/Deletion_with_EventBus_error_(should_still_succeed_for_round_deletion)
2025/05/30 08:05:19 Truncating tables: rounds
2025/05/30 08:05:19 Truncating tables: users
2025/05/30 08:05:19 Truncating tables: scores
2025/05/30 08:05:19 Truncating tables: leaderboards
2025/05/30 08:05:19 Truncating tables: rounds
2025/05/30 08:05:19 INFO round deleted from DB
=== RUN   TestDeleteRound/Attempt_to_delete_round_with_nil_UUID_payload
2025/05/30 08:05:19 Truncating tables: rounds
2025/05/30 08:05:19 Truncating tables: users
2025/05/30 08:05:19 Truncating tables: scores
2025/05/30 08:05:19 Truncating tables: leaderboards
2025/05/30 08:05:19 Truncating tables: rounds
--- PASS: TestDeleteRound (0.53s)
    --- PASS: TestDeleteRound/Successful_deletion_of_an_existing_round (0.15s)
    --- PASS: TestDeleteRound/Attempt_to_delete_a_non-existent_round (0.12s)
    --- PASS: TestDeleteRound/Deletion_with_EventBus_error_(should_still_succeed_for_round_deletion) (0.15s)
    --- PASS: TestDeleteRound/Attempt_to_delete_round_with_nil_UUID_payload (0.11s)
=== RUN   TestFinalizeRound
=== RUN   TestFinalizeRound/Successful_finalization_of_an_existing_round
2025/05/30 08:05:19 Truncating tables: rounds
2025/05/30 08:05:19 Truncating tables: users
2025/05/30 08:05:19 Truncating tables: scores
2025/05/30 08:05:19 Truncating tables: leaderboards
2025/05/30 08:05:19 Truncating tables: rounds
=== RUN   TestFinalizeRound/Attempt_to_finalize_a_non-existent_round
2025/05/30 08:05:19 Truncating tables: rounds
2025/05/30 08:05:19 Truncating tables: users
2025/05/30 08:05:19 Truncating tables: scores
2025/05/30 08:05:19 Truncating tables: leaderboards
2025/05/30 08:05:19 Truncating tables: rounds
=== RUN   TestFinalizeRound/Finalization_with_nil_UUID_payload
2025/05/30 08:05:19 Truncating tables: rounds
2025/05/30 08:05:19 Truncating tables: users
2025/05/30 08:05:19 Truncating tables: scores
2025/05/30 08:05:19 Truncating tables: leaderboards
2025/05/30 08:05:19 Truncating tables: rounds
=== RUN   TestFinalizeRound/Round_finalization_with_database_update_success_but_fetch_failure
2025/05/30 08:05:19 Truncating tables: rounds
2025/05/30 08:05:19 Truncating tables: users
2025/05/30 08:05:19 Truncating tables: scores
2025/05/30 08:05:19 Truncating tables: leaderboards
2025/05/30 08:05:19 Truncating tables: rounds
--- PASS: TestFinalizeRound (0.47s)
    --- PASS: TestFinalizeRound/Successful_finalization_of_an_existing_round (0.16s)
    --- PASS: TestFinalizeRound/Attempt_to_finalize_a_non-existent_round (0.11s)
    --- PASS: TestFinalizeRound/Finalization_with_nil_UUID_payload (0.10s)
    --- PASS: TestFinalizeRound/Round_finalization_with_database_update_success_but_fetch_failure (0.10s)
=== RUN   TestNotifyScoreModule
=== RUN   TestNotifyScoreModule/Successful_notification_with_participants_having_scores_and_tag_numbers
2025/05/30 08:05:20 Truncating tables: rounds
2025/05/30 08:05:20 Truncating tables: users
2025/05/30 08:05:20 Truncating tables: scores
2025/05/30 08:05:20 Truncating tables: leaderboards
2025/05/30 08:05:20 Truncating tables: rounds
=== RUN   TestNotifyScoreModule/Successful_notification_with_participants_having_nil_scores_and_tag_numbers
2025/05/30 08:05:20 Truncating tables: rounds
2025/05/30 08:05:20 Truncating tables: users
2025/05/30 08:05:20 Truncating tables: scores
2025/05/30 08:05:20 Truncating tables: leaderboards
2025/05/30 08:05:20 Truncating tables: rounds
=== RUN   TestNotifyScoreModule/Successful_notification_with_empty_participants_list
2025/05/30 08:05:20 Truncating tables: rounds
2025/05/30 08:05:20 Truncating tables: users
2025/05/30 08:05:20 Truncating tables: scores
2025/05/30 08:05:20 Truncating tables: leaderboards
2025/05/30 08:05:20 Truncating tables: rounds
=== RUN   TestNotifyScoreModule/Notification_with_mixed_participant_data
2025/05/30 08:05:20 Truncating tables: rounds
2025/05/30 08:05:20 Truncating tables: users
2025/05/30 08:05:20 Truncating tables: scores
2025/05/30 08:05:20 Truncating tables: leaderboards
2025/05/30 08:05:20 Truncating tables: rounds
--- PASS: TestNotifyScoreModule (0.44s)
    --- PASS: TestNotifyScoreModule/Successful_notification_with_participants_having_scores_and_tag_numbers (0.11s)
    --- PASS: TestNotifyScoreModule/Successful_notification_with_participants_having_nil_scores_and_tag_numbers (0.10s)
    --- PASS: TestNotifyScoreModule/Successful_notification_with_empty_participants_list (0.11s)
    --- PASS: TestNotifyScoreModule/Notification_with_mixed_participant_data (0.13s)
=== RUN   TestParticipantRemoval
=== RUN   TestParticipantRemoval/Valid_removal_of_existing_participant_-_Expecting_ParticipantRemovedPayload
2025/05/30 08:05:20 Truncating tables: rounds
2025/05/30 08:05:20 Truncating tables: users
2025/05/30 08:05:20 Truncating tables: scores
2025/05/30 08:05:20 Truncating tables: leaderboards
2025/05/30 08:05:20 Truncating tables: rounds
=== RUN   TestParticipantRemoval/Attempt_to_remove_non-existent_participant_-_Should_succeed_with_no_changes
2025/05/30 08:05:20 Truncating tables: rounds
2025/05/30 08:05:20 Truncating tables: users
2025/05/30 08:05:20 Truncating tables: scores
2025/05/30 08:05:20 Truncating tables: leaderboards
2025/05/30 08:05:20 Truncating tables: rounds
=== RUN   TestParticipantRemoval/Remove_participant_from_round_with_multiple_participants_of_same_response_type
2025/05/30 08:05:20 Recreating containers after 20 tests or 2.268992507s elapsed for stability
2025/05/30 08:05:20 Recreating containers for stability...
2025/05/30 08:05:20 üê≥ Stopping container: dcdf280c7492
2025/05/30 08:05:21 ‚úÖ Container stopped: dcdf280c7492
2025/05/30 08:05:21 üê≥ Terminating container: dcdf280c7492
2025/05/30 08:05:21 üö´ Container terminated: dcdf280c7492
2025/05/30 08:05:21 üê≥ Stopping container: 2ac09045d904
2025/05/30 08:05:21 ‚úÖ Container stopped: 2ac09045d904
2025/05/30 08:05:21 üê≥ Terminating container: 2ac09045d904
2025/05/30 08:05:21 üö´ Container terminated: 2ac09045d904
2025/05/30 08:05:23 Starting PostgreSQL container with resource limits...
2025/05/30 08:05:23 üê≥ Creating container for image postgres:16-alpine
2025/05/30 08:05:24 ‚úÖ Container created: bba9ff24f918
2025/05/30 08:05:24 üê≥ Starting container: bba9ff24f918
2025/05/30 08:05:24 ‚úÖ Container started: bba9ff24f918
2025/05/30 08:05:24 ‚è≥ Waiting for container id bba9ff24f918 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000694620 Strategies:[0xc00081c6c0]}
2025/05/30 08:05:26 üîî Container is ready: bba9ff24f918
2025/05/30 08:05:26 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:33711/testdb?sslmode=disable
2025/05/30 08:05:26 Starting NATS container with resource limits...
2025/05/30 08:05:26 üê≥ Creating container for image nats:2.10-alpine
2025/05/30 08:05:26 ‚úÖ Container created: 3023e0ced1c4
2025/05/30 08:05:26 üê≥ Starting container: 3023e0ced1c4
2025/05/30 08:05:27 ‚úÖ Container started: 3023e0ced1c4
2025/05/30 08:05:27 ‚è≥ Waiting for container id 3023e0ced1c4 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000695b68 Strategies:[0xc0006393e0 0xc0006b8600]}
2025/05/30 08:05:29 üîî Container is ready: 3023e0ced1c4
2025/05/30 08:05:29 NATS container started with resource limits. URL: nats://localhost:33712
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/30 08:05:29 Ran leaderboard migrations group #1
Creating user table...
User table created successfully!
2025/05/30 08:05:29 Ran user migrations group #2
Creating round table...
Round table created successfully!
2025/05/30 08:05:29 Ran round migrations group #3
Creating score table...
Score table created successfully!
2025/05/30 08:05:29 Ran score migrations group #4
2025/05/30 08:05:29 All migrations ran successfully
2025/05/30 08:05:29 newDBServiceWithDB - Registering models
2025/05/30 08:05:29 newDBServiceWithDB - Models registered successfully
2025/05/30 08:05:29 newDBServiceWithDB - DBService initialized: &{UserDB:0xc00011e5b8 RoundDB:0xc00011e5c0 ScoreDB:0xc00011e5c8 LeaderboardDB:0xc00011e5d0 db:0xc000916600}
2025/05/30 08:05:30 Containers successfully recreated
2025/05/30 08:05:30 Truncating tables: rounds
2025/05/30 08:05:30 Truncating tables: users
2025/05/30 08:05:30 Truncating tables: scores
2025/05/30 08:05:30 Truncating tables: leaderboards
2025/05/30 08:05:30 Truncating tables: rounds
=== RUN   TestParticipantRemoval/Attempt_to_remove_participant_from_non-existent_round_-_Expecting_Error
2025/05/30 08:05:30 Truncating tables: rounds
2025/05/30 08:05:30 Truncating tables: users
2025/05/30 08:05:30 Truncating tables: scores
2025/05/30 08:05:30 Truncating tables: leaderboards
2025/05/30 08:05:30 Truncating tables: rounds
=== RUN   TestParticipantRemoval/Remove_last_participant_from_round_-_Should_result_in_empty_lists
2025/05/30 08:05:30 Truncating tables: rounds
2025/05/30 08:05:30 Truncating tables: users
2025/05/30 08:05:30 Truncating tables: scores
2025/05/30 08:05:30 Truncating tables: leaderboards
2025/05/30 08:05:30 Truncating tables: rounds
--- PASS: TestParticipantRemoval (9.95s)
    --- PASS: TestParticipantRemoval/Valid_removal_of_existing_participant_-_Expecting_ParticipantRemovedPayload (0.12s)
    --- PASS: TestParticipantRemoval/Attempt_to_remove_non-existent_participant_-_Should_succeed_with_no_changes (0.11s)
    --- PASS: TestParticipantRemoval/Remove_participant_from_round_with_multiple_participants_of_same_response_type (9.47s)
    --- PASS: TestParticipantRemoval/Attempt_to_remove_participant_from_non-existent_round_-_Expecting_Error (0.12s)
    --- PASS: TestParticipantRemoval/Remove_last_participant_from_round_-_Should_result_in_empty_lists (0.12s)
=== RUN   TestUpdateParticipantStatus
=== RUN   TestUpdateParticipantStatus/Internal_update:_Participant_status_and_tag_number_set_after_lookup
2025/05/30 08:05:30 Truncating tables: rounds
2025/05/30 08:05:30 Truncating tables: users
2025/05/30 08:05:30 Truncating tables: scores
2025/05/30 08:05:30 Truncating tables: leaderboards
2025/05/30 08:05:30 Truncating tables: rounds
>>> Found existing participant existing_participant at index 0, updating...
>>> Updating response for user existing_participant: Old=TENTATIVE, New=ACCEPT
>>> Updating tag number for user existing_participant: Old=1, New=123
>>> After update: ParticipantsCount=1, Participants=[{existing_participant 123 ACCEPT 0xc0000d9020}]
>>> Update successful. Final participants count: 1
=== RUN   TestUpdateParticipantStatus/Participant_accepts_without_TagNumber_(adds_participant_with_nil_tag)
2025/05/30 08:05:30 Truncating tables: rounds
2025/05/30 08:05:30 Truncating tables: users
2025/05/30 08:05:30 Truncating tables: scores
2025/05/30 08:05:30 Truncating tables: leaderboards
2025/05/30 08:05:30 Truncating tables: rounds
>>> Adding new participant: UserID=participant_needs_tag, Response=ACCEPT, TagNumber=<nil>, Score=<nil>
>>> After update: ParticipantsCount=1, Participants=[{participant_needs_tag <nil> ACCEPT <nil>}]
>>> Update successful. Final participants count: 1
=== RUN   TestUpdateParticipantStatus/Participant_declines_(direct_update)
2025/05/30 08:05:30 Truncating tables: rounds
2025/05/30 08:05:30 Truncating tables: users
2025/05/30 08:05:30 Truncating tables: scores
2025/05/30 08:05:30 Truncating tables: leaderboards
2025/05/30 08:05:30 Truncating tables: rounds
>>> Found existing participant participant_to_decline at index 0, updating...
>>> Updating response for user participant_to_decline: Old=ACCEPT, New=DECLINE
>>> Updating tag number for user participant_to_decline: Old=2, New=<nil>
>>> After update: ParticipantsCount=1, Participants=[{participant_to_decline <nil> DECLINE 0xc00011be78}]
>>> Update successful. Final participants count: 1
=== RUN   TestUpdateParticipantStatus/Attempt_to_update_participant_in_non-existent_round_(with_tag)_-_Expecting_Error
2025/05/30 08:05:30 Truncating tables: rounds
2025/05/30 08:05:30 Truncating tables: users
2025/05/30 08:05:30 Truncating tables: scores
2025/05/30 08:05:30 Truncating tables: leaderboards
2025/05/30 08:05:30 Truncating tables: rounds
=== RUN   TestUpdateParticipantStatus/Attempt_to_update_participant_in_non-existent_round_(decline)_-_Expecting_Error
2025/05/30 08:05:30 Truncating tables: rounds
2025/05/30 08:05:30 Truncating tables: users
2025/05/30 08:05:30 Truncating tables: scores
2025/05/30 08:05:30 Truncating tables: leaderboards
2025/05/30 08:05:30 Truncating tables: rounds
=== RUN   TestUpdateParticipantStatus/Unknown_response_type_-_Expecting_Error
2025/05/30 08:05:31 Truncating tables: rounds
2025/05/30 08:05:31 Truncating tables: users
2025/05/30 08:05:31 Truncating tables: scores
2025/05/30 08:05:31 Truncating tables: leaderboards
2025/05/30 08:05:31 Truncating tables: rounds
--- PASS: TestUpdateParticipantStatus (0.76s)
    --- PASS: TestUpdateParticipantStatus/Internal_update:_Participant_status_and_tag_number_set_after_lookup (0.13s)
    --- PASS: TestUpdateParticipantStatus/Participant_accepts_without_TagNumber_(adds_participant_with_nil_tag) (0.13s)
    --- PASS: TestUpdateParticipantStatus/Participant_declines_(direct_update) (0.12s)
    --- PASS: TestUpdateParticipantStatus/Attempt_to_update_participant_in_non-existent_round_(with_tag)_-_Expecting_Error (0.12s)
    --- PASS: TestUpdateParticipantStatus/Attempt_to_update_participant_in_non-existent_round_(decline)_-_Expecting_Error (0.12s)
    --- PASS: TestUpdateParticipantStatus/Unknown_response_type_-_Expecting_Error (0.16s)
=== RUN   TestCheckParticipantStatus
=== RUN   TestCheckParticipantStatus/User_not_a_participant,_requesting_Accept_-_Expecting_Validation_Request
2025/05/30 08:05:31 Truncating tables: rounds
2025/05/30 08:05:31 Truncating tables: users
2025/05/30 08:05:31 Truncating tables: scores
2025/05/30 08:05:31 Truncating tables: leaderboards
2025/05/30 08:05:31 Truncating tables: rounds
=== RUN   TestCheckParticipantStatus/User_is_participant_with_Accept,_requesting_Accept_(toggle_off)_-_Expecting_Removal_Request
2025/05/30 08:05:31 Truncating tables: rounds
2025/05/30 08:05:31 Truncating tables: users
2025/05/30 08:05:31 Truncating tables: scores
2025/05/30 08:05:31 Truncating tables: leaderboards
2025/05/30 08:05:31 Truncating tables: rounds
=== RUN   TestCheckParticipantStatus/User_is_participant_with_Tentative,_requesting_Accept_(change_status)_-_Expecting_Validation_Request
2025/05/30 08:05:31 Truncating tables: rounds
2025/05/30 08:05:31 Truncating tables: users
2025/05/30 08:05:31 Truncating tables: scores
2025/05/30 08:05:31 Truncating tables: leaderboards
2025/05/30 08:05:31 Truncating tables: rounds
=== RUN   TestCheckParticipantStatus/Round_ID_is_nil_-_Expecting_Error
2025/05/30 08:05:31 Truncating tables: rounds
2025/05/30 08:05:31 Truncating tables: users
2025/05/30 08:05:31 Truncating tables: scores
2025/05/30 08:05:31 Truncating tables: leaderboards
2025/05/30 08:05:31 Truncating tables: rounds
=== RUN   TestCheckParticipantStatus/Attempt_to_check_status_for_a_non-existent_round_-_Expecting_Error
2025/05/30 08:05:31 Truncating tables: rounds
2025/05/30 08:05:31 Truncating tables: users
2025/05/30 08:05:31 Truncating tables: scores
2025/05/30 08:05:31 Truncating tables: leaderboards
2025/05/30 08:05:31 Truncating tables: rounds
--- PASS: TestCheckParticipantStatus (0.81s)
    --- PASS: TestCheckParticipantStatus/User_not_a_participant,_requesting_Accept_-_Expecting_Validation_Request (0.20s)
    --- PASS: TestCheckParticipantStatus/User_is_participant_with_Accept,_requesting_Accept_(toggle_off)_-_Expecting_Removal_Request (0.12s)
    --- PASS: TestCheckParticipantStatus/User_is_participant_with_Tentative,_requesting_Accept_(change_status)_-_Expecting_Validation_Request (0.14s)
    --- PASS: TestCheckParticipantStatus/Round_ID_is_nil_-_Expecting_Error (0.18s)
    --- PASS: TestCheckParticipantStatus/Attempt_to_check_status_for_a_non-existent_round_-_Expecting_Error (0.17s)
=== RUN   TestValidateParticipantJoinRequest
=== RUN   TestValidateParticipantJoinRequest/Valid_Accept_request,_round_Created_(not_late_join)_-_Expecting_TagLookupRequestPayload
2025/05/30 08:05:32 Truncating tables: rounds
2025/05/30 08:05:32 Truncating tables: users
2025/05/30 08:05:32 Truncating tables: scores
2025/05/30 08:05:32 Truncating tables: leaderboards
2025/05/30 08:05:32 Truncating tables: rounds
=== RUN   TestValidateParticipantJoinRequest/Valid_Tentative_request,_round_InProgress_(late_join)_-_Expecting_TagLookupRequestPayload
2025/05/30 08:05:32 Truncating tables: rounds
2025/05/30 08:05:32 Truncating tables: users
2025/05/30 08:05:32 Truncating tables: scores
2025/05/30 08:05:32 Truncating tables: leaderboards
2025/05/30 08:05:32 Truncating tables: rounds
=== RUN   TestValidateParticipantJoinRequest/Valid_Decline_request,_round_Finalized_(late_join)_-_Expecting_ParticipantJoinRequestPayload
2025/05/30 08:05:32 Truncating tables: rounds
2025/05/30 08:05:32 Truncating tables: users
2025/05/30 08:05:32 Truncating tables: scores
2025/05/30 08:05:32 Truncating tables: leaderboards
2025/05/30 08:05:32 Truncating tables: rounds
=== RUN   TestValidateParticipantJoinRequest/Invalid:_Nil_Round_ID_-_Expecting_Error
2025/05/30 08:05:32 Truncating tables: rounds
2025/05/30 08:05:32 Truncating tables: users
2025/05/30 08:05:32 Truncating tables: scores
2025/05/30 08:05:32 Truncating tables: leaderboards
2025/05/30 08:05:32 Truncating tables: rounds
=== RUN   TestValidateParticipantJoinRequest/Invalid:_Empty_User_ID_-_Expecting_Error
2025/05/30 08:05:32 Truncating tables: rounds
2025/05/30 08:05:32 Truncating tables: users
2025/05/30 08:05:32 Truncating tables: scores
2025/05/30 08:05:32 Truncating tables: leaderboards
2025/05/30 08:05:32 Truncating tables: rounds
=== RUN   TestValidateParticipantJoinRequest/Attempt_to_validate_join_for_a_non-existent_round_-_Expecting_Error
2025/05/30 08:05:32 Truncating tables: rounds
2025/05/30 08:05:32 Truncating tables: users
2025/05/30 08:05:32 Truncating tables: scores
2025/05/30 08:05:32 Truncating tables: leaderboards
2025/05/30 08:05:32 Truncating tables: rounds
=== RUN   TestValidateParticipantJoinRequest/Invalid:_Unexpected_response_type_-_Expecting_Error
2025/05/30 08:05:32 Recreating containers after 40 tests or 2.935018818s elapsed for stability
2025/05/30 08:05:32 Recreating containers for stability...
2025/05/30 08:05:32 üê≥ Stopping container: 3023e0ced1c4
2025/05/30 08:05:33 ‚úÖ Container stopped: 3023e0ced1c4
2025/05/30 08:05:33 üê≥ Terminating container: 3023e0ced1c4
2025/05/30 08:05:33 üö´ Container terminated: 3023e0ced1c4
2025/05/30 08:05:33 üê≥ Stopping container: bba9ff24f918
2025/05/30 08:05:33 ‚úÖ Container stopped: bba9ff24f918
2025/05/30 08:05:33 üê≥ Terminating container: bba9ff24f918
2025/05/30 08:05:33 üö´ Container terminated: bba9ff24f918
2025/05/30 08:05:35 Starting PostgreSQL container with resource limits...
2025/05/30 08:05:35 üê≥ Creating container for image postgres:16-alpine
2025/05/30 08:05:35 ‚úÖ Container created: ad9078adf2f0
2025/05/30 08:05:35 üê≥ Starting container: ad9078adf2f0
2025/05/30 08:05:35 ‚úÖ Container started: ad9078adf2f0
2025/05/30 08:05:35 ‚è≥ Waiting for container id ad9078adf2f0 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000768f20 Strategies:[0xc00061e5a0]}
2025/05/30 08:05:38 üîî Container is ready: ad9078adf2f0
2025/05/30 08:05:38 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:33715/testdb?sslmode=disable
2025/05/30 08:05:38 Starting NATS container with resource limits...
2025/05/30 08:05:38 üê≥ Creating container for image nats:2.10-alpine
2025/05/30 08:05:38 ‚úÖ Container created: 760d6208a22b
2025/05/30 08:05:38 üê≥ Starting container: 760d6208a22b
2025/05/30 08:05:39 ‚úÖ Container started: 760d6208a22b
2025/05/30 08:05:39 ‚è≥ Waiting for container id 760d6208a22b image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc000769590 Strategies:[0xc0006397a0 0xc0006d1200]}
2025/05/30 08:05:42 üîî Container is ready: 760d6208a22b
2025/05/30 08:05:42 NATS container started with resource limits. URL: nats://localhost:33716
Creating user table...
User table created successfully!
2025/05/30 08:05:42 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/30 08:05:42 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/30 08:05:42 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/30 08:05:42 Ran leaderboard migrations group #4
2025/05/30 08:05:42 All migrations ran successfully
2025/05/30 08:05:42 newDBServiceWithDB - Registering models
2025/05/30 08:05:42 newDBServiceWithDB - Models registered successfully
2025/05/30 08:05:42 newDBServiceWithDB - DBService initialized: &{UserDB:0xc0004a4458 RoundDB:0xc0004a4460 ScoreDB:0xc0004a4468 LeaderboardDB:0xc0004a4478 db:0xc0002c5c00}
2025/05/30 08:05:42 Containers successfully recreated
2025/05/30 08:05:42 Truncating tables: rounds
2025/05/30 08:05:42 Truncating tables: users
2025/05/30 08:05:42 Truncating tables: scores
2025/05/30 08:05:42 Truncating tables: leaderboards
2025/05/30 08:05:42 Truncating tables: rounds
--- PASS: TestValidateParticipantJoinRequest (10.58s)
    --- PASS: TestValidateParticipantJoinRequest/Valid_Accept_request,_round_Created_(not_late_join)_-_Expecting_TagLookupRequestPayload (0.16s)
    --- PASS: TestValidateParticipantJoinRequest/Valid_Tentative_request,_round_InProgress_(late_join)_-_Expecting_TagLookupRequestPayload (0.12s)
    --- PASS: TestValidateParticipantJoinRequest/Valid_Decline_request,_round_Finalized_(late_join)_-_Expecting_ParticipantJoinRequestPayload (0.18s)
    --- PASS: TestValidateParticipantJoinRequest/Invalid:_Nil_Round_ID_-_Expecting_Error (0.20s)
    --- PASS: TestValidateParticipantJoinRequest/Invalid:_Empty_User_ID_-_Expecting_Error (0.16s)
    --- PASS: TestValidateParticipantJoinRequest/Attempt_to_validate_join_for_a_non-existent_round_-_Expecting_Error (0.15s)
    --- PASS: TestValidateParticipantJoinRequest/Invalid:_Unexpected_response_type_-_Expecting_Error (9.61s)
=== RUN   TestUpdateScheduledRoundsWithNewTags
=== RUN   TestUpdateScheduledRoundsWithNewTags/Successful_update_of_scheduled_rounds_with_new_tags
2025/05/30 08:05:42 Truncating tables: rounds
2025/05/30 08:05:42 Truncating tables: users
2025/05/30 08:05:42 Truncating tables: scores
2025/05/30 08:05:42 Truncating tables: leaderboards
2025/05/30 08:05:42 Truncating tables: rounds
    participant_tags_test.go:114: Expected DiscordRoundUpdatePayload, got *roundevents.DiscordRoundUpdatePayload
=== RUN   TestUpdateScheduledRoundsWithNewTags/No_rounds_to_update_when_no_participants_match_changed_tags
2025/05/30 08:05:42 Truncating tables: rounds
2025/05/30 08:05:42 Truncating tables: users
2025/05/30 08:05:42 Truncating tables: scores
2025/05/30 08:05:42 Truncating tables: leaderboards
2025/05/30 08:05:42 Truncating tables: rounds
    participant_tags_test.go:225: Expected DiscordRoundUpdatePayload, got *roundevents.DiscordRoundUpdatePayload
=== RUN   TestUpdateScheduledRoundsWithNewTags/Update_with_empty_ChangedTags_map
2025/05/30 08:05:42 Truncating tables: rounds
2025/05/30 08:05:42 Truncating tables: users
2025/05/30 08:05:42 Truncating tables: scores
2025/05/30 08:05:42 Truncating tables: leaderboards
2025/05/30 08:05:42 Truncating tables: rounds
    participant_tags_test.go:284: Expected DiscordRoundUpdatePayload, got *roundevents.DiscordRoundUpdatePayload
=== RUN   TestUpdateScheduledRoundsWithNewTags/Update_with_nil_tag_values
2025/05/30 08:05:42 Truncating tables: rounds
2025/05/30 08:05:42 Truncating tables: users
2025/05/30 08:05:43 Truncating tables: scores
2025/05/30 08:05:43 Truncating tables: leaderboards
2025/05/30 08:05:43 Truncating tables: rounds
    participant_tags_test.go:338: Expected DiscordRoundUpdatePayload, got *roundevents.DiscordRoundUpdatePayload
--- FAIL: TestUpdateScheduledRoundsWithNewTags (0.57s)
    --- FAIL: TestUpdateScheduledRoundsWithNewTags/Successful_update_of_scheduled_rounds_with_new_tags (0.14s)
    --- FAIL: TestUpdateScheduledRoundsWithNewTags/No_rounds_to_update_when_no_participants_match_changed_tags (0.12s)
    --- FAIL: TestUpdateScheduledRoundsWithNewTags/Update_with_empty_ChangedTags_map (0.15s)
    --- FAIL: TestUpdateScheduledRoundsWithNewTags/Update_with_nil_tag_values (0.16s)
=== RUN   TestGetRound
=== RUN   TestGetRound/Successful_retrieval_of_an_existing_round
2025/05/30 08:05:43 Truncating tables: rounds
2025/05/30 08:05:43 Truncating tables: users
2025/05/30 08:05:43 Truncating tables: scores
2025/05/30 08:05:43 Truncating tables: leaderboards
2025/05/30 08:05:43 Truncating tables: rounds
    retrieve_round_test.go:103: Expected result to be of type roundtypes.Round, got *roundtypes.Round
=== RUN   TestGetRound/Retrieval_of_a_non-existent_round
2025/05/30 08:05:43 Truncating tables: rounds
2025/05/30 08:05:43 Truncating tables: users
2025/05/30 08:05:43 Truncating tables: scores
2025/05/30 08:05:43 Truncating tables: leaderboards
2025/05/30 08:05:43 Truncating tables: rounds
    retrieve_round_test.go:246: Expected an error, but got none
    retrieve_round_test.go:216: Expected returnedResult.Failure to be of type roundevents.RoundErrorPayload, got *roundevents.RoundErrorPayload
--- FAIL: TestGetRound (0.26s)
    --- FAIL: TestGetRound/Successful_retrieval_of_an_existing_round (0.14s)
    --- FAIL: TestGetRound/Retrieval_of_a_non-existent_round (0.12s)
=== RUN   TestProcessRoundReminder
=== RUN   TestProcessRoundReminder/Successful_processing_with_accepted_and_tentative_participants
2025/05/30 08:05:43 Truncating tables: rounds
2025/05/30 08:05:43 Truncating tables: users
2025/05/30 08:05:43 Truncating tables: scores
2025/05/30 08:05:43 Truncating tables: leaderboards
2025/05/30 08:05:43 Truncating tables: rounds
    round_reminders_test.go:81: Expected result to be of type DiscordReminderPayload, got *roundevents.DiscordReminderPayload
=== RUN   TestProcessRoundReminder/Successful_processing_with_no_participants_to_notify
2025/05/30 08:05:43 Truncating tables: rounds
2025/05/30 08:05:43 Truncating tables: users
2025/05/30 08:05:43 Truncating tables: scores
2025/05/30 08:05:43 Truncating tables: leaderboards
2025/05/30 08:05:43 Truncating tables: rounds
    round_reminders_test.go:165: Expected result to be of type RoundReminderProcessedPayload, got *roundevents.DiscordReminderPayload
=== RUN   TestProcessRoundReminder/Error:_Round_not_found_in_DB
2025/05/30 08:05:43 Truncating tables: rounds
2025/05/30 08:05:43 Truncating tables: users
2025/05/30 08:05:43 Truncating tables: scores
2025/05/30 08:05:43 Truncating tables: leaderboards
2025/05/30 08:05:43 Truncating tables: rounds
    round_reminders_test.go:226: Expected an error, but got none
    round_reminders_test.go:197: Expected returnedResult.Failure to be of type roundevents.RoundErrorPayload, got *roundevents.RoundErrorPayload
--- FAIL: TestProcessRoundReminder (0.46s)
    --- FAIL: TestProcessRoundReminder/Successful_processing_with_accepted_and_tentative_participants (0.15s)
    --- FAIL: TestProcessRoundReminder/Successful_processing_with_no_participants_to_notify (0.15s)
    --- FAIL: TestProcessRoundReminder/Error:_Round_not_found_in_DB (0.16s)
=== RUN   TestScheduleRoundEvents_Behavioral
=== RUN   TestScheduleRoundEvents_Behavioral/Round_scheduled_1_second_in_future_-_only_start_event_expected_(reminder_skipped)
2025/05/30 08:05:43 Truncating tables: rounds
2025/05/30 08:05:43 Truncating tables: users
2025/05/30 08:05:43 Truncating tables: scores
2025/05/30 08:05:43 Truncating tables: leaderboards
2025/05/30 08:05:43 Truncating tables: rounds
    schedule_round_test.go:276: Expected result to be RoundScheduledPayload, got *roundevents.RoundScheduledPayload
=== RUN   TestScheduleRoundEvents_Behavioral/Verify_delayed_messages_are_published_to_stream_with_correct_info
2025/05/30 08:05:44 Truncating tables: rounds
2025/05/30 08:05:44 Truncating tables: users
2025/05/30 08:05:44 Truncating tables: scores
2025/05/30 08:05:44 Truncating tables: leaderboards
2025/05/30 08:05:44 Truncating tables: rounds
    schedule_round_test.go:276: Expected result to be RoundScheduledPayload, got *roundevents.RoundScheduledPayload
--- FAIL: TestScheduleRoundEvents_Behavioral (0.29s)
    --- FAIL: TestScheduleRoundEvents_Behavioral/Round_scheduled_1_second_in_future_-_only_start_event_expected_(reminder_skipped) (0.16s)
    --- FAIL: TestScheduleRoundEvents_Behavioral/Verify_delayed_messages_are_published_to_stream_with_correct_info (0.14s)
=== RUN   TestValidateScoreUpdateRequest
=== RUN   TestValidateScoreUpdateRequest/Valid_score_update_request
2025/05/30 08:05:44 Truncating tables: rounds
2025/05/30 08:05:44 Truncating tables: users
2025/05/30 08:05:44 Truncating tables: scores
2025/05/30 08:05:44 Truncating tables: leaderboards
2025/05/30 08:05:44 Truncating tables: rounds
=== RUN   TestValidateScoreUpdateRequest/Invalid_request_-_zero_round_ID
2025/05/30 08:05:44 Truncating tables: rounds
2025/05/30 08:05:44 Truncating tables: users
2025/05/30 08:05:44 Truncating tables: scores
2025/05/30 08:05:44 Truncating tables: leaderboards
2025/05/30 08:05:44 Truncating tables: rounds
    score_round_test.go:154: Expected an error, but got none
    score_round_test.go:165: Expected RoundScoreUpdateErrorPayload, got *roundevents.RoundScoreUpdateErrorPayload
    score_round_test.go:168: Expected error message to contain 'round ID cannot be zero', got ''
    score_round_test.go:171: Expected ScoreUpdateRequest in failure payload, but got nil
=== RUN   TestValidateScoreUpdateRequest/Invalid_request_-_empty_participant
2025/05/30 08:05:44 Truncating tables: rounds
2025/05/30 08:05:44 Truncating tables: users
2025/05/30 08:05:44 Truncating tables: scores
2025/05/30 08:05:44 Truncating tables: leaderboards
2025/05/30 08:05:44 Truncating tables: rounds
    score_round_test.go:154: Expected an error, but got none
    score_round_test.go:165: Expected RoundScoreUpdateErrorPayload, got *roundevents.RoundScoreUpdateErrorPayload
    score_round_test.go:168: Expected error message to contain 'participant Discord ID cannot be empty', got ''
    score_round_test.go:171: Expected ScoreUpdateRequest in failure payload, but got nil
=== RUN   TestValidateScoreUpdateRequest/Invalid_request_-_nil_score
2025/05/30 08:05:44 Truncating tables: rounds
2025/05/30 08:05:44 Truncating tables: users
2025/05/30 08:05:44 Truncating tables: scores
2025/05/30 08:05:44 Truncating tables: leaderboards
2025/05/30 08:05:44 Truncating tables: rounds
    score_round_test.go:154: Expected an error, but got none
    score_round_test.go:165: Expected RoundScoreUpdateErrorPayload, got *roundevents.RoundScoreUpdateErrorPayload
    score_round_test.go:168: Expected error message to contain 'score cannot be empty', got ''
    score_round_test.go:171: Expected ScoreUpdateRequest in failure payload, but got nil
=== RUN   TestValidateScoreUpdateRequest/Invalid_request_-_multiple_validation_errors
2025/05/30 08:05:44 Truncating tables: rounds
2025/05/30 08:05:44 Truncating tables: users
2025/05/30 08:05:44 Truncating tables: scores
2025/05/30 08:05:44 Truncating tables: leaderboards
2025/05/30 08:05:44 Truncating tables: rounds
    score_round_test.go:154: Expected an error, but got none
    score_round_test.go:165: Expected RoundScoreUpdateErrorPayload, got *roundevents.RoundScoreUpdateErrorPayload
    score_round_test.go:168: Expected error message to contain 'round ID cannot be zero; participant Discord ID cannot be empty; score cannot be empty', got ''
    score_round_test.go:171: Expected ScoreUpdateRequest in failure payload, but got nil
--- FAIL: TestValidateScoreUpdateRequest (0.80s)
    --- PASS: TestValidateScoreUpdateRequest/Valid_score_update_request (0.14s)
    --- FAIL: TestValidateScoreUpdateRequest/Invalid_request_-_zero_round_ID (0.19s)
    --- FAIL: TestValidateScoreUpdateRequest/Invalid_request_-_empty_participant (0.23s)
    --- FAIL: TestValidateScoreUpdateRequest/Invalid_request_-_nil_score (0.12s)
    --- FAIL: TestValidateScoreUpdateRequest/Invalid_request_-_multiple_validation_errors (0.12s)
=== RUN   TestUpdateParticipantScore
=== RUN   TestUpdateParticipantScore/Successful_score_update
2025/05/30 08:05:44 Truncating tables: rounds
2025/05/30 08:05:44 Truncating tables: users
2025/05/30 08:05:44 Truncating tables: scores
2025/05/30 08:05:44 Truncating tables: leaderboards
2025/05/30 08:05:45 Truncating tables: rounds
=== RUN   TestUpdateParticipantScore/Database_update_failure_(non-existent_round)
2025/05/30 08:05:45 Truncating tables: rounds
2025/05/30 08:05:45 Truncating tables: users
2025/05/30 08:05:45 Truncating tables: scores
2025/05/30 08:05:45 Truncating tables: leaderboards
2025/05/30 08:05:45 Truncating tables: rounds
    score_round_test.go:306: Expected an error, but got none
    score_round_test.go:278: Expected RoundScoreUpdateErrorPayload, got *roundevents.RoundScoreUpdateErrorPayload
--- FAIL: TestUpdateParticipantScore (0.33s)
    --- PASS: TestUpdateParticipantScore/Successful_score_update (0.16s)
    --- FAIL: TestUpdateParticipantScore/Database_update_failure_(non-existent_round) (0.17s)
=== RUN   TestCheckAllScoresSubmitted
=== RUN   TestCheckAllScoresSubmitted/All_scores_submitted
2025/05/30 08:05:45 Truncating tables: rounds
2025/05/30 08:05:45 Truncating tables: users
2025/05/30 08:05:45 Truncating tables: scores
2025/05/30 08:05:45 Truncating tables: leaderboards
2025/05/30 08:05:45 Truncating tables: rounds
    score_round_test.go:377: Expected AllScoresSubmittedPayload, got *roundevents.AllScoresSubmittedPayload
=== RUN   TestCheckAllScoresSubmitted/Not_all_scores_submitted
2025/05/30 08:05:45 Recreating containers after 60 tests or 3.026184513s elapsed for stability
2025/05/30 08:05:45 Recreating containers for stability...
2025/05/30 08:05:45 üê≥ Stopping container: 760d6208a22b
2025/05/30 08:05:45 ‚úÖ Container stopped: 760d6208a22b
2025/05/30 08:05:45 üê≥ Terminating container: 760d6208a22b
2025/05/30 08:05:45 üö´ Container terminated: 760d6208a22b
2025/05/30 08:05:45 üê≥ Stopping container: ad9078adf2f0
2025/05/30 08:05:46 ‚úÖ Container stopped: ad9078adf2f0
2025/05/30 08:05:46 üê≥ Terminating container: ad9078adf2f0
2025/05/30 08:05:46 üö´ Container terminated: ad9078adf2f0
2025/05/30 08:05:48 Starting PostgreSQL container with resource limits...
2025/05/30 08:05:48 üê≥ Creating container for image postgres:16-alpine
2025/05/30 08:05:48 ‚úÖ Container created: 17c66d9ad0a4
2025/05/30 08:05:48 üê≥ Starting container: 17c66d9ad0a4
2025/05/30 08:05:48 ‚úÖ Container started: 17c66d9ad0a4
2025/05/30 08:05:48 ‚è≥ Waiting for container id 17c66d9ad0a4 image: postgres:16-alpine. Waiting for: &{timeout:<nil> deadline:0xc000695890 Strategies:[0xc00052df20]}
2025/05/30 08:05:50 üîî Container is ready: 17c66d9ad0a4
2025/05/30 08:05:50 PostgreSQL container started with resource limits and init script. URL: postgres://testuser:testpass@localhost:33723/testdb?sslmode=disable
2025/05/30 08:05:50 Starting NATS container with resource limits...
2025/05/30 08:05:50 üê≥ Creating container for image nats:2.10-alpine
2025/05/30 08:05:50 ‚úÖ Container created: 6c0667df7f96
2025/05/30 08:05:50 üê≥ Starting container: 6c0667df7f96
2025/05/30 08:05:51 ‚úÖ Container started: 6c0667df7f96
2025/05/30 08:05:51 ‚è≥ Waiting for container id 6c0667df7f96 image: nats:2.10-alpine. Waiting for: &{timeout:<nil> deadline:0xc00088db38 Strategies:[0xc00003f320 0xc0006864b0]}
2025/05/30 08:05:53 üîî Container is ready: 6c0667df7f96
2025/05/30 08:05:53 NATS container started with resource limits. URL: nats://localhost:33724
Creating user table...
User table created successfully!
2025/05/30 08:05:53 Ran user migrations group #1
Creating round table...
Round table created successfully!
2025/05/30 08:05:53 Ran round migrations group #2
Creating score table...
Score table created successfully!
2025/05/30 08:05:53 Ran score migrations group #3
Creating leaderboard table...
Leaderboard table created successfully!
2025/05/30 08:05:53 Ran leaderboard migrations group #4
2025/05/30 08:05:53 All migrations ran successfully
2025/05/30 08:05:53 newDBServiceWithDB - Registering models
2025/05/30 08:05:53 newDBServiceWithDB - Models registered successfully
2025/05/30 08:05:53 newDBServiceWithDB - DBService initialized: &{UserDB:0xc0000e60c0 RoundDB:0xc0000e60c8 ScoreDB:0xc0000e60d0 LeaderboardDB:0xc0000e60d8 db:0xc000978b40}
2025/05/30 08:05:53 Containers successfully recreated
2025/05/30 08:05:53 Truncating tables: rounds
2025/05/30 08:05:53 Truncating tables: users
2025/05/30 08:05:53 Truncating tables: scores
2025/05/30 08:05:53 Truncating tables: leaderboards
2025/05/30 08:05:53 Truncating tables: rounds
    score_round_test.go:415: Expected NotAllScoresSubmittedPayload, got *roundevents.NotAllScoresSubmittedPayload
=== RUN   TestCheckAllScoresSubmitted/Database_error_during_score_check_(non-existent_round)
2025/05/30 08:05:54 Truncating tables: rounds
2025/05/30 08:05:54 Truncating tables: users
2025/05/30 08:05:54 Truncating tables: scores
2025/05/30 08:05:54 Truncating tables: leaderboards
2025/05/30 08:05:54 Truncating tables: rounds
    score_round_test.go:486: Expected an error, but got none
    score_round_test.go:458: Expected RoundErrorPayload, got *roundevents.RoundErrorPayload
--- FAIL: TestCheckAllScoresSubmitted (8.92s)
    --- FAIL: TestCheckAllScoresSubmitted/All_scores_submitted (0.14s)
    --- FAIL: TestCheckAllScoresSubmitted/Not_all_scores_submitted (8.65s)
    --- FAIL: TestCheckAllScoresSubmitted/Database_error_during_score_check_(non-existent_round) (0.12s)
=== RUN   TestProcessRoundStart
=== RUN   TestProcessRoundStart/Successful_round_start
2025/05/30 08:05:54 Truncating tables: rounds
2025/05/30 08:05:54 Truncating tables: users
2025/05/30 08:05:54 Truncating tables: scores
2025/05/30 08:05:54 Truncating tables: leaderboards
2025/05/30 08:05:54 Truncating tables: rounds
    start_round_test.go:51: Expected DiscordRoundStartPayload, got *roundevents.DiscordRoundStartPayload
=== RUN   TestProcessRoundStart/Round_not_found_in_DB
2025/05/30 08:05:54 Truncating tables: rounds
2025/05/30 08:05:54 Truncating tables: users
2025/05/30 08:05:54 Truncating tables: scores
2025/05/30 08:05:54 Truncating tables: leaderboards
2025/05/30 08:05:54 Truncating tables: rounds
    start_round_test.go:169: Expected an error, but got none
    start_round_test.go:96: Expected RoundErrorPayload, got *roundevents.RoundErrorPayload
=== RUN   TestProcessRoundStart/Failed_to_update_round_state_in_DB
2025/05/30 08:05:54 Truncating tables: rounds
2025/05/30 08:05:54 Truncating tables: users
2025/05/30 08:05:54 Truncating tables: scores
2025/05/30 08:05:54 Truncating tables: leaderboards
2025/05/30 08:05:54 Truncating tables: rounds
    start_round_test.go:169: Expected an error, but got none
    start_round_test.go:125: Expected RoundErrorPayload, got *roundevents.RoundErrorPayload
--- FAIL: TestProcessRoundStart (0.42s)
    --- FAIL: TestProcessRoundStart/Successful_round_start (0.14s)
    --- FAIL: TestProcessRoundStart/Round_not_found_in_DB (0.14s)
    --- FAIL: TestProcessRoundStart/Failed_to_update_round_state_in_DB (0.14s)
=== RUN   TestStoreRound
=== RUN   TestStoreRound/Successful_round_storage
2025/05/30 08:05:54 Truncating tables: rounds
2025/05/30 08:05:54 Truncating tables: users
2025/05/30 08:05:54 Truncating tables: scores
2025/05/30 08:05:54 Truncating tables: leaderboards
2025/05/30 08:05:54 Truncating tables: rounds
=== RUN   TestStoreRound/Validation_failure_-_missing_title_in_payload
2025/05/30 08:05:54 Truncating tables: rounds
2025/05/30 08:05:54 Truncating tables: users
2025/05/30 08:05:54 Truncating tables: scores
2025/05/30 08:05:54 Truncating tables: leaderboards
2025/05/30 08:05:54 Truncating tables: rounds
=== RUN   TestStoreRound/Validation_failure_-_nil_description_in_payload
2025/05/30 08:05:54 Truncating tables: rounds
2025/05/30 08:05:54 Truncating tables: users
2025/05/30 08:05:54 Truncating tables: scores
2025/05/30 08:05:54 Truncating tables: leaderboards
2025/05/30 08:05:54 Truncating tables: rounds
=== RUN   TestStoreRound/Validation_failure_-_nil_location_in_payload
2025/05/30 08:05:55 Truncating tables: rounds
2025/05/30 08:05:55 Truncating tables: users
2025/05/30 08:05:55 Truncating tables: scores
2025/05/30 08:05:55 Truncating tables: leaderboards
2025/05/30 08:05:55 Truncating tables: rounds
=== RUN   TestStoreRound/Validation_failure_-_nil_start_time_in_payload
2025/05/30 08:05:55 Truncating tables: rounds
2025/05/30 08:05:55 Truncating tables: users
2025/05/30 08:05:55 Truncating tables: scores
2025/05/30 08:05:55 Truncating tables: leaderboards
2025/05/30 08:05:55 Truncating tables: rounds
--- PASS: TestStoreRound (0.66s)
    --- PASS: TestStoreRound/Successful_round_storage (0.15s)
    --- PASS: TestStoreRound/Validation_failure_-_missing_title_in_payload (0.15s)
    --- PASS: TestStoreRound/Validation_failure_-_nil_description_in_payload (0.14s)
    --- PASS: TestStoreRound/Validation_failure_-_nil_location_in_payload (0.11s)
    --- PASS: TestStoreRound/Validation_failure_-_nil_start_time_in_payload (0.11s)
=== RUN   TestUpdateRoundMessageID
=== RUN   TestUpdateRoundMessageID/Successful_update_of_Discord_message_ID_for_an_existing_round
2025/05/30 08:05:55 Truncating tables: rounds
2025/05/30 08:05:55 Truncating tables: users
2025/05/30 08:05:55 Truncating tables: scores
2025/05/30 08:05:55 Truncating tables: leaderboards
2025/05/30 08:05:55 Truncating tables: rounds
=== RUN   TestUpdateRoundMessageID/Attempt_to_update_Discord_message_ID_for_a_non-existent_round
2025/05/30 08:05:55 Truncating tables: rounds
2025/05/30 08:05:55 Truncating tables: users
2025/05/30 08:05:55 Truncating tables: scores
2025/05/30 08:05:55 Truncating tables: leaderboards
2025/05/30 08:05:55 Truncating tables: rounds
=== RUN   TestUpdateRoundMessageID/Update_Discord_message_ID_to_an_empty_string
2025/05/30 08:05:55 Truncating tables: rounds
2025/05/30 08:05:55 Truncating tables: users
2025/05/30 08:05:55 Truncating tables: scores
2025/05/30 08:05:55 Truncating tables: leaderboards
2025/05/30 08:05:55 Truncating tables: rounds
--- PASS: TestUpdateRoundMessageID (0.39s)
    --- PASS: TestUpdateRoundMessageID/Successful_update_of_Discord_message_ID_for_an_existing_round (0.13s)
    --- PASS: TestUpdateRoundMessageID/Attempt_to_update_Discord_message_ID_for_a_non-existent_round (0.12s)
    --- PASS: TestUpdateRoundMessageID/Update_Discord_message_ID_to_an_empty_string (0.14s)
=== RUN   TestValidateRoundUpdateRequest
=== RUN   TestValidateRoundUpdateRequest/Valid_update_request_-_Title_only
2025/05/30 08:05:55 Truncating tables: rounds
2025/05/30 08:05:55 Truncating tables: users
2025/05/30 08:05:55 Truncating tables: scores
2025/05/30 08:05:55 Truncating tables: leaderboards
2025/05/30 08:05:55 Truncating tables: rounds
    update_round_test.go:45: Expected RoundUpdateValidatedPayload, got *roundevents.RoundUpdateValidatedPayload
    update_round_test.go:48: Expected title 'New Title', got ''
=== RUN   TestValidateRoundUpdateRequest/Valid_update_request_-_All_fields_including_EventType
2025/05/30 08:05:55 Truncating tables: rounds
2025/05/30 08:05:55 Truncating tables: users
2025/05/30 08:05:55 Truncating tables: scores
2025/05/30 08:05:55 Truncating tables: leaderboards
2025/05/30 08:05:55 Truncating tables: rounds
    update_round_test.go:71: Expected RoundUpdateValidatedPayload, got *roundevents.RoundUpdateValidatedPayload
    update_round_test.go:74: Expected title 'New Title', got ''
--- FAIL: TestValidateRoundUpdateRequest (0.21s)
    --- FAIL: TestValidateRoundUpdateRequest/Valid_update_request_-_Title_only (0.10s)
    --- FAIL: TestValidateRoundUpdateRequest/Valid_update_request_-_All_fields_including_EventType (0.11s)
panic: runtime error: invalid memory address or nil pointer dereference [recovered]
	panic: runtime error: invalid memory address or nil pointer dereference
[signal SIGSEGV: segmentation violation code=0x1 addr=0x8 pc=0x5802a99]

goroutine 3674 [running]:
testing.tRunner.func1.2({0x5bd1b60, 0x6700520})
	/usr/local/Cellar/go/1.24.2/libexec/src/testing/testing.go:1734 +0x21c
testing.tRunner.func1()
	/usr/local/Cellar/go/1.24.2/libexec/src/testing/testing.go:1737 +0x35e
panic({0x5bd1b60?, 0x6700520?})
	/usr/local/Cellar/go/1.24.2/libexec/src/runtime/panic.go:792 +0x132
github.com/Black-And-White-Club/frolf-bot/integration_tests/modules/round/application_tests.TestValidateRoundUpdateRequest.func2(0xc000835880, {{0x5b16620, 0xc00096d630}, {0x0, 0x0}, {0x0, 0x0}})
	/Users/jace/Documents/GitHub/frolf-bot/integration_tests/modules/round/application_tests/update_round_test.go:76 +0x1d9
github.com/Black-And-White-Club/frolf-bot/integration_tests/modules/round/application_tests.TestValidateRoundUpdateRequest.func6(0xc000835880)
	/Users/jace/Documents/GitHub/frolf-bot/integration_tests/modules/round/application_tests/update_round_test.go:178 +0x303
testing.tRunner(0xc000835880, 0xc00054fa70)
	/usr/local/Cellar/go/1.24.2/libexec/src/testing/testing.go:1792 +0xf4
created by testing.(*T).Run in goroutine 3641
	/usr/local/Cellar/go/1.24.2/libexec/src/testing/testing.go:1851 +0x413
FAIL	github.com/Black-And-White-Club/frolf-bot/integration_tests/modules/round/application_tests	54.451s
